{"version":3,"file":"typst.worker-DaZY_zu0.js","sources":["../node_modules/@myriaddreamin/typst.ts/dist/esm/init.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/internal.types.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/options.init.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/wasm.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/compiler.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/render/canvas/view.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/contrib/dom/typst-doc.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/contrib/dom/typst-cancel.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/dom.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/renderer.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/fs/memory.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/fs/package.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/utils.mjs","../node_modules/@myriaddreamin/typst.ts/dist/esm/contrib/snippet.mjs","../src/workers/typst.worker.ts"],"sourcesContent":["class ComponentBuilder {\n    loadedFonts = new Set();\n    fetcher = fetch;\n    setFetcher(fetcher) {\n        this.fetcher = fetcher;\n    }\n    async loadFonts(builder, fonts) {\n        const escapeImport = new Function('m', 'return import(m)');\n        const fetcher = (this.fetcher ||= await (async function () {\n            const { fetchBuilder, FileSystemCache } = await escapeImport('node-fetch-cache');\n            const cache = new FileSystemCache({\n                /// By default, we don't have a complicated cache policy.\n                cacheDirectory: '.cache/typst/fonts',\n            });\n            const cachedFetcher = fetchBuilder.withCache(cache);\n            return function (input, init) {\n                const timeout = setTimeout(() => {\n                    console.warn('font fetching is stucking:', input);\n                }, 15000);\n                return cachedFetcher(input, init).finally(() => {\n                    clearTimeout(timeout);\n                });\n            };\n        })());\n        const fontsToLoad = fonts.filter(font => {\n            if (font instanceof Uint8Array || (typeof font === 'object' && 'info' in font)) {\n                return true;\n            }\n            if (this.loadedFonts.has(font)) {\n                return false;\n            }\n            this.loadedFonts.add(font);\n            return true;\n        });\n        const fontLists = await Promise.all(fontsToLoad.map(async (font) => {\n            if (font instanceof Uint8Array) {\n                await builder.add_raw_font(font);\n                return;\n            }\n            if (typeof font === 'object' && 'info' in font) {\n                await builder.add_lazy_font(font, 'blob' in font ? font.blob : loadFontSync(font));\n                return;\n            }\n            return new Uint8Array(await (await fetcher(font)).arrayBuffer());\n        }));\n        for (const font of fontLists) {\n            if (!font) {\n                continue;\n            }\n            await builder.add_raw_font(font);\n        }\n    }\n    async build(options, builder, hooks) {\n        /// build typst component\n        const buildCtx = { ref: this, builder, hooks };\n        for (const fn of options?.beforeBuild ?? []) {\n            await fn(undefined, buildCtx);\n        }\n        // await addPartialFonts(buildCtx);\n        if (hooks.latelyBuild) {\n            hooks.latelyBuild(buildCtx);\n        }\n        return await builder.build();\n    }\n}\n/** @internal */\nexport async function buildComponent(options, gModule, Builder, hooks) {\n    /// init typst wasm module\n    await gModule.init(options?.getModule?.());\n    return await new ComponentBuilder().build(options, new Builder(), hooks);\n}\n/**\n * Loads a font by a lazy font synchronously, which is required by the compiler.\n * @param font\n */\nexport function loadFontSync(font) {\n    return () => {\n        const xhr = new XMLHttpRequest();\n        xhr.overrideMimeType('text/plain; charset=x-user-defined');\n        xhr.open('GET', font.url, false);\n        xhr.send(null);\n        if (xhr.status === 200 &&\n            (xhr.response instanceof String || typeof xhr.response === 'string')) {\n            return Uint8Array.from(xhr.response, (c) => c.charCodeAt(0));\n        }\n        return new Uint8Array();\n    };\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5pdC5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvaW5pdC5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBOEJBLE1BQU0sZ0JBQWdCO0lBQ3BCLFdBQVcsR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO0lBQ2hDLE9BQU8sR0FBa0IsS0FBSyxDQUFDO0lBRS9CLFVBQVUsQ0FBQyxPQUFxQjtRQUM5QixJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztJQUN6QixDQUFDO0lBRUQsS0FBSyxDQUFDLFNBQVMsQ0FDYixPQUE4QixFQUM5QixLQUF5QztRQUV6QyxNQUFNLFlBQVksR0FBRyxJQUFJLFFBQVEsQ0FBQyxHQUFHLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUMzRCxNQUFNLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxPQUFPLEtBQUssTUFBTSxDQUFDLEtBQUs7WUFDNUMsTUFBTSxFQUFFLFlBQVksRUFBRSxlQUFlLEVBQUUsR0FBRyxNQUFNLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQ2pGLE1BQU0sS0FBSyxHQUFHLElBQUksZUFBZSxDQUFDO2dCQUNoQyx5REFBeUQ7Z0JBQ3pELGNBQWMsRUFBRSxvQkFBb0I7YUFDckMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxhQUFhLEdBQUcsWUFBWSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUVwRCxPQUFPLFVBQVUsS0FBd0IsRUFBRSxJQUFrQjtnQkFDM0QsTUFBTSxPQUFPLEdBQUcsVUFBVSxDQUFDLEdBQUcsRUFBRTtvQkFDOUIsT0FBTyxDQUFDLElBQUksQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQztnQkFDcEQsQ0FBQyxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUNWLE9BQU8sYUFBYSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFO29CQUM3QyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUM7Z0JB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RUQ7OztHQUdHO0FBQ0gsTUFBTSxVQUFVLFlBQVksQ0FBQyxJQUFnQztJQUMzRCxPQUFPLEdBQUcsRUFBRTtRQUNWLE1BQU0sR0FBRyxHQUFHLElBQUksY0FBYyxFQUFFLENBQUM7UUFDakMsR0FBRyxDQUFDLGdCQUFnQixDQUFDLG9DQUFvQyxDQUFDLENBQUM7UUFDM0QsR0FBRyxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNqQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRWYsSUFDRSxHQUFHLENBQUMsTUFBTSxLQUFLLEdBQUc7WUFDbEIsQ0FBQyxHQUFHLENBQUMsUUFBUSxZQUFZLE1BQU0sSUFBSSxPQUFPLEdBQUcsQ0FBQyxRQUFRLEtBQUssUUFBUSxDQUFDLEVBQ3BFLENBQUM7WUFDRCxPQUFPLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZFLENBQUM7UUFDRCxPQUFPLElBQUksVUFBVSxFQUFFLENBQUM7SUFDMUIsQ0FBQyxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJlZm9yZUJ1aWxkTWFyaywgSW5pdE9wdGlvbnMsIExhenlGb250IH0gZnJvbSAnLi9vcHRpb25zLmluaXQubWpzJztcbmltcG9ydCB7IExhenlXYXNtTW9kdWxlIH0gZnJvbSAnLi93YXNtLm1qcyc7XG5cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBpbnRlcmZhY2UgVHlwc3RDb21tb25CdWlsZGVyPFQ+IHtcbiAgZnJlZSgpOiB2b2lkO1xuXG4gIGFkZF9yYXdfZm9udChmb250X2J1ZmZlcjogVWludDhBcnJheSk6IFByb21pc2U8dm9pZD47XG5cbiAgYWRkX2xhenlfZm9udDxDIGV4dGVuZHMgTGF6eUZvbnQ+KFxuICAgIGluZm86IEMsXG4gICAgYmxvYjogKHRoaXM6IEMsIGluZGV4OiBudW1iZXIpID0+IFVpbnQ4QXJyYXksXG4gICk6IFByb21pc2U8dm9pZD47XG5cbiAgYnVpbGQoKTogUHJvbWlzZTxUPjtcbn1cblxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGludGVyZmFjZSBDb21wb25lbnRCdWlsZEhvb2tzIHtcbiAgbGF0ZWx5QnVpbGQ/OiAoY3R4OiB1bmtub3duKSA9PiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSW5pdENvbnRleHQ8VD4ge1xuICByZWY6IHtcbiAgICBsb2FkRm9udHMoYnVpbGRlcjogVHlwc3RDb21tb25CdWlsZGVyPFQ+LCBmb250czogKHN0cmluZyB8IFVpbnQ4QXJyYXkpW10pOiBQcm9taXNlPHZvaWQ+O1xuICB9O1xuICBidWlsZGVyOiBUeXBzdENvbW1vbkJ1aWxkZXI8VD47XG4gIGhvb2tzOiBDb21wb25lbnRCdWlsZEhvb2tzO1xufVxuXG5jbGFzcyBDb21wb25lbnRCdWlsZGVyPFQ+IHtcbiAgbG9hZGVkRm9udHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcbiAgZmV0Y2hlcj86IHR5cGVvZiBmZXRjaCA9IGZldGNoO1xuXG4gIHNldEZldGNoZXIoZmV0Y2hlcjogdHlwZW9mIGZldGNoKTogdm9pZCB7XG4gICAgdGhpcy5mZXRjaGVyID0gZmV0Y2hlcjtcbiAgfVxuXG4gIGFzeW5jIGxvYWRGb250cyhcbiAgICBidWlsZGVyOiBUeXBzdENvbW1vbkJ1aWxkZXI8VD4sXG4gICAgZm9udHM6IChzdHJpbmcgfCBVaW50OEFycmF5IHwgTGF6eUZvbnQpW10sXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGVzY2FwZUltcG9ydCA9IG5ldyBGdW5jdGlvbignbScsICdyZXR1cm4gaW1wb3J0KG0pJyk7XG4gICAgY29uc3QgZmV0Y2hlciA9ICh0aGlzLmZldGNoZXIgfHw9IGF3YWl0IChhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCB7IGZldGNoQnVpbGRlciwgRmlsZVN5c3RlbUNhY2hlIH0gPSBhd2FpdCBlc2NhcGVJbXBvcnQoJ25vZGUtZmV0Y2gtY2FjaGUnKTtcbiAgICAgIGNvbnN0IGNhY2hlID0gbmV3IEZpbGVTeXN0ZW1DYWNoZSh7XG4gICAgICAgIC8vLyBCeSBkZWZhdWx0LCB3ZSBkb24ndCBoYXZlIGEgY29tcGxpY2F0ZWQgY2FjaGUgcG9saWN5LlxuICAgICAgICBjYWNoZURpcmVjdG9yeTogJy5jYWNoZS90eXBzdC9mb250cycsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgY2FjaGVkRmV0Y2hlciA9IGZldGNoQnVpbGRlci53aXRoQ2FjaGUoY2FjaGUpO1xuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gKGlucHV0OiBSZXF1ZXN0SW5mbyB8IFVSTCwgaW5pdD86IFJlcXVlc3RJbml0KSB7XG4gICAgICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ2ZvbnQgZmV0Y2hpbmcgaXMgc3R1Y2tpbmc6JywgaW5wdXQpO1xuICAgICAgICB9LCAxNTAwMCk7XG4gICAgICAgIHJldHVybiBjYWNoZWRGZXRjaGVyKGlucHV0LCBpbml0KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7XG4gICAgICAgIH0pO1xuICAgICAgfTtcbiAgICB9KSgpKTtcblxuICAgIGNvbnN0IGZvbnRzVG9Mb2FkID0gZm9udHMuZmlsdGVyKGZvbnQgPT4ge1xuICAgICAgaWYgKGZvbnQgaW5zdGFuY2VvZiBVaW50OEFycmF5IHx8ICh0eXBlb2YgZm9udCA9PT0gJ29iamVjdCcgJiYgJ2luZm8nIGluIGZvbnQpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5sb2FkZWRGb250cy5oYXMoZm9udCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmxvYWRlZEZvbnRzLmFkZChmb250KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuXG4gICAgY29uc3QgZm9udExpc3RzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICBmb250c1RvTG9hZC5tYXAoYXN5bmMgZm9udCA9PiB7XG4gICAgICAgIGlmIChmb250IGluc3RhbmNlb2YgVWludDhBcnJheSkge1xuICAgICAgICAgIGF3YWl0IGJ1aWxkZXIuYWRkX3Jhd19mb250KGZvbnQpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGZvbnQgPT09ICdvYmplY3QnICYmICdpbmZvJyBpbiBmb250KSB7XG4gICAgICAgICAgYXdhaXQgYnVpbGRlci5hZGRfbGF6eV9mb250KGZvbnQsICdibG9iJyBpbiBmb250ID8gZm9udC5ibG9iIDogbG9hZEZvbnRTeW5jKGZvbnQpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoYXdhaXQgKGF3YWl0IGZldGNoZXIoZm9udCkpLmFycmF5QnVmZmVyKCkpO1xuICAgICAgfSksXG4gICAgKTtcblxuICAgIGZvciAoY29uc3QgZm9udCBvZiBmb250TGlzdHMpIHtcbiAgICAgIGlmICghZm9udCkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IGJ1aWxkZXIuYWRkX3Jhd19mb250KGZvbnQpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGJ1aWxkKFxuICAgIG9wdGlvbnM6IFBhcnRpYWw8SW5pdE9wdGlvbnM+IHwgdW5kZWZpbmVkLFxuICAgIGJ1aWxkZXI6IFR5cHN0Q29tbW9uQnVpbGRlcjxUPixcbiAgICBob29rczogQ29tcG9uZW50QnVpbGRIb29rcyxcbiAgKTogUHJvbWlzZTxUPiB7XG4gICAgLy8vIGJ1aWxkIHR5cHN0IGNvbXBvbmVudFxuICAgIGNvbnN0IGJ1aWxkQ3R4OiBJbml0Q29udGV4dDxUPiA9IHsgcmVmOiB0aGlzLCBidWlsZGVyLCBob29rcyB9O1xuXG4gICAgZm9yIChjb25zdCBmbiBvZiBvcHRpb25zPy5iZWZvcmVCdWlsZCA/PyBbXSkge1xuICAgICAgYXdhaXQgZm4odW5kZWZpbmVkIGFzIHVua25vd24gYXMgQmVmb3JlQnVpbGRNYXJrLCBidWlsZEN0eCk7XG4gICAgfVxuICAgIC8vIGF3YWl0IGFkZFBhcnRpYWxGb250cyhidWlsZEN0eCk7XG5cbiAgICBpZiAoaG9va3MubGF0ZWx5QnVpbGQpIHtcbiAgICAgIGhvb2tzLmxhdGVseUJ1aWxkKGJ1aWxkQ3R4KTtcbiAgICB9XG5cbiAgICByZXR1cm4gYXdhaXQgYnVpbGRlci5idWlsZCgpO1xuICB9XG59XG5cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBidWlsZENvbXBvbmVudDxUPihcbiAgb3B0aW9uczogUGFydGlhbDxJbml0T3B0aW9ucz4gfCB1bmRlZmluZWQsXG4gIGdNb2R1bGU6IExhenlXYXNtTW9kdWxlLFxuICBCdWlsZGVyOiB7IG5ldyAoKTogVHlwc3RDb21tb25CdWlsZGVyPFQ+IH0sXG4gIGhvb2tzOiBDb21wb25lbnRCdWlsZEhvb2tzLFxuKTogUHJvbWlzZTxUPiB7XG4gIC8vLyBpbml0IHR5cHN0IHdhc20gbW9kdWxlXG4gIGF3YWl0IGdNb2R1bGUuaW5pdChvcHRpb25zPy5nZXRNb2R1bGU/LigpKTtcblxuICByZXR1cm4gYXdhaXQgbmV3IENvbXBvbmVudEJ1aWxkZXI8VD4oKS5idWlsZChvcHRpb25zLCBuZXcgQnVpbGRlcigpLCBob29rcyk7XG59XG5cbi8qKlxuICogTG9hZHMgYSBmb250IGJ5IGEgbGF6eSBmb250IHN5bmNocm9ub3VzbHksIHdoaWNoIGlzIHJlcXVpcmVkIGJ5IHRoZSBjb21waWxlci5cbiAqIEBwYXJhbSBmb250XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsb2FkRm9udFN5bmMoZm9udDogTGF6eUZvbnQgJiB7IHVybDogc3RyaW5nIH0pOiAoaW5kZXg6IG51bWJlcikgPT4gVWludDhBcnJheSB7XG4gIHJldHVybiAoKSA9PiB7XG4gICAgY29uc3QgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgeGhyLm92ZXJyaWRlTWltZVR5cGUoJ3RleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQnKTtcbiAgICB4aHIub3BlbignR0VUJywgZm9udC51cmwsIGZhbHNlKTtcbiAgICB4aHIuc2VuZChudWxsKTtcblxuICAgIGlmIChcbiAgICAgIHhoci5zdGF0dXMgPT09IDIwMCAmJlxuICAgICAgKHhoci5yZXNwb25zZSBpbnN0YW5jZW9mIFN0cmluZyB8fCB0eXBlb2YgeGhyLnJlc3BvbnNlID09PSAnc3RyaW5nJylcbiAgICApIHtcbiAgICAgIHJldHVybiBVaW50OEFycmF5LmZyb20oeGhyLnJlc3BvbnNlLCAoYzogc3RyaW5nKSA9PiBjLmNoYXJDb2RlQXQoMCkpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoKTtcbiAgfTtcbn1cbiJdfQ==","export const kObject = Symbol.for('reflexo-obj');\n/**\n * The page information of a Typst document.\n * @property {number} pageOffset - The offset of the page.\n * @property {number} width - The width of the page in pt.\n * @property {number} height - The height of the page in pt.\n */\nexport class PageInfo {\n    pageOffset;\n    width;\n    height;\n}\nexport var TypstDefaultParams;\n(function (TypstDefaultParams) {\n    TypstDefaultParams[TypstDefaultParams[\"PIXEL_PER_PT\"] = 3] = \"PIXEL_PER_PT\";\n})(TypstDefaultParams || (TypstDefaultParams = {}));\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW50ZXJuYWwudHlwZXMubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2ludGVybmFsLnR5cGVzLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxNQUFNLENBQUMsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUVqRDs7Ozs7R0FLRztBQUNILE1BQU0sT0FBTyxRQUFRO0lBQ25CLFVBQVUsQ0FBUztJQUNuQixLQUFLLENBQVM7SUFDZCxNQUFNLENBQVM7Q0FDaEI7QUE0REQsTUFBTSxDQUFOLElBQWtCLGtCQUVqQjtBQUZELFdBQWtCLGtCQUFrQjtJQUNsQywyRUFBZ0IsQ0FBQTtBQUNsQixDQUFDLEVBRmlCLGtCQUFrQixLQUFsQixrQkFBa0IsUUFFbkMiLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgY29uc3Qga09iamVjdCA9IFN5bWJvbC5mb3IoJ3JlZmxleG8tb2JqJyk7XG5cbi8qKlxuICogVGhlIHBhZ2UgaW5mb3JtYXRpb24gb2YgYSBUeXBzdCBkb2N1bWVudC5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBwYWdlT2Zmc2V0IC0gVGhlIG9mZnNldCBvZiB0aGUgcGFnZS5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSB3aWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgcGFnZSBpbiBwdC5cbiAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBoZWlnaHQgLSBUaGUgaGVpZ2h0IG9mIHRoZSBwYWdlIGluIHB0LlxuICovXG5leHBvcnQgY2xhc3MgUGFnZUluZm8ge1xuICBwYWdlT2Zmc2V0OiBudW1iZXI7XG4gIHdpZHRoOiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZzQWNjZXNzTW9kZWwge1xuICBnZXRNVGltZShwYXRoOiBzdHJpbmcpOiBEYXRlIHwgdW5kZWZpbmVkO1xuICBpc0ZpbGUocGF0aDogc3RyaW5nKTogYm9vbGVhbiB8IHVuZGVmaW5lZDtcbiAgZ2V0UmVhbFBhdGgocGF0aDogc3RyaW5nKTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICByZWFkQWxsKHBhdGg6IHN0cmluZyk6IFVpbnQ4QXJyYXkgfCB1bmRlZmluZWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFja2FnZVNwZWMge1xuICBuYW1lc3BhY2U6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICB2ZXJzaW9uOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFja2FnZVJlc29sdmVDb250ZXh0IHtcbiAgdW50YXIoZGF0YTogVWludDhBcnJheSwgY2I6IChwYXRoOiBzdHJpbmcsIGRhdGE6IFVpbnQ4QXJyYXksIG10aW1lOiBudW1iZXIpID0+IHZvaWQpOiB2b2lkO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBhY2thZ2VSZWdpc3RyeSB7XG4gIHJlc29sdmUocGF0aDogUGFja2FnZVNwZWMsIGNvbnRleHQ6IFBhY2thZ2VSZXNvbHZlQ29udGV4dCk6IHN0cmluZyB8IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQb2ludCB7XG4gIHg6IG51bWJlcjtcbiAgeTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlY3Qge1xuICBsbzogUG9pbnQ7XG4gIGhpOiBQb2ludDtcbn1cblxuZXhwb3J0IHR5cGUgVHJhbnNmb3JtTWF0cml4ID0gW251bWJlciwgbnVtYmVyLCBudW1iZXIsIG51bWJlciwgbnVtYmVyLCBudW1iZXJdO1xuXG4vLyNyZWdpb24gU2VtYW50aWMgdG9rZW5zOiBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L3ZzY29kZS9pc3N1ZXMvODY0MTVcbmV4cG9ydCBpbnRlcmZhY2UgU2VtYW50aWNUb2tlbnNMZWdlbmQge1xuICByZWFkb25seSB0b2tlblR5cGVzOiBzdHJpbmdbXTtcbiAgcmVhZG9ubHkgdG9rZW5Nb2RpZmllcnM6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlbWFudGljVG9rZW5zIHtcbiAgLyoqXG4gICAqIFRoZSByZXN1bHQgaWQgb2YgdGhlIHRva2Vucy5cbiAgICpcbiAgICogVGhpcyBpcyB0aGUgaWQgdGhhdCB3aWxsIGJlIHBhc3NlZCB0byBgRG9jdW1lbnRTZW1hbnRpY1Rva2Vuc1Byb3ZpZGVyLnByb3ZpZGVEb2N1bWVudFNlbWFudGljVG9rZW5zRWRpdHNgIChpZiBpbXBsZW1lbnRlZCkuXG4gICAqL1xuICByZWFkb25seSByZXN1bHRJZD86IHN0cmluZztcbiAgcmVhZG9ubHkgZGF0YTogVWludDMyQXJyYXk7XG59XG4vLyNlbmRyZWdpb25cblxuLyoqXG4gKiBUaGUgcmVzdWx0IG9mIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50IHRvIGEgY2FudmFzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFJlbmRlckNhbnZhc1Jlc3VsdCB7XG4gIGNhY2hlS2V5OiBzdHJpbmc7XG4gIGh0bWxTZW1hbnRpY3M6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgY29uc3QgZW51bSBUeXBzdERlZmF1bHRQYXJhbXMge1xuICBQSVhFTF9QRVJfUFQgPSAzLFxufVxuIl19","/**\n * this mark is used to identify the beforeBuild stage\n * @description will not be used in runtime code\n */\nconst BeforeBuildSymbol = Symbol('beforeBuild');\n/** @internal */\nconst _textFonts = [\n    'DejaVuSansMono-Bold.ttf',\n    'DejaVuSansMono-BoldOblique.ttf',\n    'DejaVuSansMono-Oblique.ttf',\n    'DejaVuSansMono.ttf',\n    'LibertinusSerif-Bold.otf',\n    'LibertinusSerif-BoldItalic.otf',\n    'LibertinusSerif-Italic.otf',\n    'LibertinusSerif-Regular.otf',\n    'LibertinusSerif-Semibold.otf',\n    'LibertinusSerif-SemiboldItalic.otf',\n    'NewCM10-Bold.otf',\n    'NewCM10-BoldItalic.otf',\n    'NewCM10-Italic.otf',\n    'NewCM10-Regular.otf',\n    'NewCMMath-Bold.otf',\n    'NewCMMath-Book.otf',\n    'NewCMMath-Regular.otf',\n];\n/** @internal */\nconst _cjkFonts = [\n    'InriaSerif-Bold.ttf',\n    'InriaSerif-BoldItalic.ttf',\n    'InriaSerif-Italic.ttf',\n    'InriaSerif-Regular.ttf',\n    'Roboto-Regular.ttf',\n    'NotoSerifCJKsc-Regular.otf',\n];\n/** @internal */\nconst _emojiFonts = ['TwitterColorEmoji.ttf', 'NotoColorEmoji-Regular-COLR.subset.ttf'];\n/**\n * disable default font assets\n */\nexport function disableDefaultFontAssets() {\n    return loadFonts([], { assets: false });\n}\n/**\n * preload font assets\n */\nexport function preloadFontAssets(options) {\n    return loadFonts([], options);\n}\nexport function _resolveAssets(options) {\n    const fonts = [];\n    if (options &&\n        options?.assets !== false &&\n        options?.assets?.length &&\n        options?.assets?.length > 0) {\n        let defaultPrefix = {\n            text: 'https://cdn.jsdelivr.net/gh/typst/typst-assets@v0.13.1/files/fonts/',\n            _: 'https://cdn.jsdelivr.net/gh/typst/typst-dev-assets@v0.13.1/files/fonts/',\n        };\n        let assetUrlPrefix = options.assetUrlPrefix ?? defaultPrefix;\n        if (typeof assetUrlPrefix === 'string') {\n            assetUrlPrefix = { _: assetUrlPrefix };\n        }\n        else {\n            assetUrlPrefix = { ...defaultPrefix, ...assetUrlPrefix };\n        }\n        for (const key of Object.keys(assetUrlPrefix)) {\n            const u = assetUrlPrefix[key];\n            if (u[u.length - 1] !== '/') {\n                assetUrlPrefix[key] = u + '/';\n            }\n        }\n        const prefix = (asset, f) => f.map(font => (assetUrlPrefix[asset] || assetUrlPrefix['_']) + font);\n        for (const asset of options.assets) {\n            switch (asset) {\n                case 'text':\n                    fonts.push(...prefix(asset, _textFonts));\n                    break;\n                case 'cjk':\n                    fonts.push(...prefix(asset, _cjkFonts));\n                    break;\n                case 'emoji':\n                    fonts.push(...prefix(asset, _emojiFonts));\n                    break;\n            }\n        }\n    }\n    return fonts;\n}\n/**\n * @deprecated use {@link loadFonts} instead\n */\nexport function preloadRemoteFonts(userFonts, options) {\n    return loadFonts(userFonts, options);\n}\n/**\n * load fonts\n *\n * @param fonts - url path to font files\n * @returns {BeforeBuildFn}\n * @example\n * ```ts\n * // preLoad fonts from remote url (because finto info is not provided)\n * import { init, loadFonts } from 'typst';\n * init({\n *   beforeBuild: [\n *     loadFonts([\n *      'https://fonts.gstatic.com/s/roboto/v27/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2', // remote url\n *      'dist/fonts/Roboto-Regular.ttf', // relative to the root of the website\n *     ]),\n *   ],\n * });\n * ```\n * @example\n * ```ts\n * // lazily Load fonts from remote url. The font information is obtained by `getFontInfo`\n * import { init, loadFonts } from 'typst';\n * init({\n *   beforeBuild: [\n *     loadFonts([\n *      {\n *        info: [...]\n *        url: 'https://fonts.gstatic.com/s/roboto/v27/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2';\n *      }\n *     ]),\n *   ],\n * });\n * ```\n */\nexport function loadFonts(userFonts, options) {\n    const assetFonts = _resolveAssets(options);\n    const loader = async (_, { ref, builder }) => {\n        if (options?.fetcher) {\n            ref.setFetcher(options.fetcher);\n        }\n        await ref.loadFonts(builder, [...userFonts, ...assetFonts]);\n    };\n    loader._preloadRemoteFontOptions = options;\n    loader._kind = 'fontLoader';\n    return loader;\n}\n/**\n * preload system fonts\n * @param byFamily - filter system fonts to preload by family name\n * @returns {BeforeBuildFn}\n * @example\n * ```typescript\n * import { init, preloadSystemFonts } from 'typst';\n * init({\n *   beforeBuild: [\n *     preloadSystemFonts({\n *       byFamily: ['Roboto'], // preload fonts by family name\n *     }),\n *   ],\n * });\n * ```\n */\nexport function preloadSystemFonts({ byFamily }) {\n    return async (_, { builder }) => {\n        const t = performance.now();\n        if ('queryLocalFonts' in window) {\n            const fonts = await window.queryLocalFonts();\n            byFamily = byFamily ?? [];\n            for (const font of fonts) {\n                if (!byFamily.includes(font.family)) {\n                    continue;\n                }\n                const data = await (await font.blob()).arrayBuffer();\n                await builder.add_raw_font(new Uint8Array(data));\n            }\n        }\n        const t2 = performance.now();\n        console.log('preload system font time used:', t2 - t);\n    };\n}\n/**\n * (compile only) set pacoage registry\n *\n * @param accessModel: when compiling, the pacoage registry is used to access the\n * data of files\n * @returns {BeforeBuildFn}\n */\nexport function withPackageRegistry(packageRegistry) {\n    return async (_, { builder }) => {\n        return new Promise(resolve => {\n            builder.set_package_registry(packageRegistry, function (spec) {\n                return packageRegistry.resolve(spec, this);\n            });\n            resolve();\n        });\n    };\n}\n/**\n * (compile only) set access model\n *\n * @param accessModel: when compiling, the access model is used to access the\n * data of files\n * @returns {BeforeBuildFn}\n */\nexport function withAccessModel(accessModel) {\n    return async (_, ctx) => {\n        if (ctx.alreadySetAccessModel) {\n            throw new Error(`already set some assess model before: ${ctx.alreadySetAccessModel.constructor?.name}(${ctx.alreadySetAccessModel})`);\n        }\n        ctx.alreadySetAccessModel = accessModel;\n        return new Promise(resolve => {\n            ctx.builder.set_access_model(accessModel, (path) => {\n                const lastModified = accessModel.getMTime(path);\n                if (lastModified) {\n                    return lastModified.getTime();\n                }\n                return 0;\n            }, (path) => {\n                return accessModel.isFile(path) || false;\n            }, (path) => {\n                return accessModel.getRealPath(path) || path;\n            }, (path) => {\n                return accessModel.readAll(path);\n            });\n            resolve();\n        });\n    };\n}\n// todo: search browser\n// searcher.search_browser().await?;\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3B0aW9ucy5pbml0Lm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9vcHRpb25zLmluaXQubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQWFBOzs7R0FHRztBQUNILE1BQU0saUJBQWlCLEdBQWtCLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQTREL0QsZ0JBQWdCO0FBQ2hCLE1BQU0sVUFBVSxHQUFhO0lBQzNCLHlCQUF5QjtJQUN6QixnQ0FBZ0M7SUFDaEMsNEJBQTRCO0lBQzVCLG9CQUFvQjtJQUNwQiwwQkFBMEI7SUFDMUIsZ0NBQWdDO0lBQ2hDLDRCQUE0QjtJQUM1Qiw2QkFBNkI7SUFDN0IsOEJBQThCO0lBQzlCLG9DQUFvQztJQUNwQyxrQkFBa0I7SUFDbEIsd0JBQXdCO0lBQ3hCLG9CQUFvQjtJQUNwQixxQkFBcUI7SUFDckIsb0JBQW9CO0lBQ3BCLG9CQUFvQjtJQUNwQix1QkFBdUI7Q0FDeEIsQ0FBQztBQUNGLGdCQUFnQjtBQUNoQixNQUFNLFNBQVMsR0FBYTtJQUMxQixxQkFBcUI7SUFDckIsMkJBQTJCO0lBQzNCLHVCQUF1QjtJQUN2Qix3QkFBd0I7SUFDeEIsb0JBQW9CO0lBQ3BCLDRCQUE0QjtDQUM3QixDQUFDO0FBQ0YsZ0JBQWdCO0FBQ2hCLE1BQU0sV0FBVyxHQUFhLENBQUMsdUJBQXVCLEVBQUUsd0NBQXdDLENBQUMsQ0FBQztBQW1DbEc7O0dBRUc7QUFDSCxNQUFNLFVBQVUsd0JBQXdCO0lBQ3RDLE9BQU8sU0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0FBQzFDLENBQUM7QUFFRDs7R0FFRztBQUNILE1BQU0sVUFBVSxpQkFBaUIsQ0FBQyxPQUFpQztJQUNqRSxPQUFPLFNBQVMsQ0FBQyxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUM7QUFDaEMsQ0FBQztBQUVELE1BQU0sVUFBVSxjQUFjLENBQUMsT0FBZ0M7SUFDN0QsTUFBTSxLQUFLLEdBQUcs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TUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssQ0FBQztZQUMzQyxDQUFDLEVBQ0QsQ0FBQyxJQUFZLEVBQUUsRUFBRTtnQkFDZixPQUFPLFdBQVcsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDO1lBQy9DLENBQUMsRUFDRCxDQUFDLElBQVksRUFBRSxFQUFFO2dCQUNmLE9BQU8sV0FBVyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNuQyxDQUFDLENBQ0YsQ0FBQztZQUNGLE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUM7QUFDSixDQUFDO0FBbUJELHVCQUF1QjtBQUN2QixvQ0FBb0MiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAdHMtaWdub3JlXG5pbXBvcnQgdHlwZSAqIGFzIHR5cHN0UmVuZGVyZXIgZnJvbSAnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtcmVuZGVyZXInO1xuaW1wb3J0IHR5cGUgKiBhcyB0eXBzdENvbXBpbGVyIGZyb20gJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXdlYi1jb21waWxlcic7XG5pbXBvcnQgdHlwZSB7IEZzQWNjZXNzTW9kZWwsIFBhY2thZ2VSZWdpc3RyeSwgUGFja2FnZVNwZWMgfSBmcm9tICcuL2ludGVybmFsLnR5cGVzLm1qcyc7XG5pbXBvcnQgdHlwZSB7IFdlYkFzc2VtYmx5TW9kdWxlUmVmIH0gZnJvbSAnLi93YXNtLm1qcyc7XG5cbi8qKlxuICogc3RhZ2VkIG9wdGlvbnMgZnVuY3Rpb25cbiAqIEB0ZW1wbGF0ZSBTIC0gc3RhZ2UgbWFya1xuICogQHRlbXBsYXRlIFQgLSBjb250ZXh0IHR5cGVcbiAqL1xuZXhwb3J0IHR5cGUgU3RhZ2VkT3B0Rm48UyBleHRlbmRzIHN5bWJvbCwgVCA9IGFueT4gPSAoczogUywgdDogVCkgPT4gUHJvbWlzZTx2b2lkPjtcblxuLyoqXG4gKiB0aGlzIG1hcmsgaXMgdXNlZCB0byBpZGVudGlmeSB0aGUgYmVmb3JlQnVpbGQgc3RhZ2VcbiAqIEBkZXNjcmlwdGlvbiB3aWxsIG5vdCBiZSB1c2VkIGluIHJ1bnRpbWUgY29kZVxuICovXG5jb25zdCBCZWZvcmVCdWlsZFN5bWJvbDogdW5pcXVlIHN5bWJvbCA9IFN5bWJvbCgnYmVmb3JlQnVpbGQnKTtcblxuLyoqXG4gKiB0aGlzIG1hcmsgaXMgdXNlZCB0byBpZGVudGlmeSB0aGUgYmVmb3JlQnVpbGQgc3RhZ2VcbiAqIEBkZXNjcmlwdGlvbiBjYW5ub3QgYmUgY3JlYXRlZCBieSBhbnkgcnVudGltZSBjb2RlXG4gKi9cbmV4cG9ydCB0eXBlIEJlZm9yZUJ1aWxkTWFyayA9IHR5cGVvZiBCZWZvcmVCdWlsZFN5bWJvbDtcblxuLyoqXG4gKiBiZWZvcmUgYnVpbGQgc3RhZ2VcbiAqIEBkZXNjcmlwdGlvbiBwb3NzaWJsZSBjcmVhdGVkIGJ5OlxuICogICAtIGxvYWRGb250c1xuICogICAtIHByZWxvYWRTeXN0ZW1Gb250c1xuICogICAtIHdpdGhBY2Nlc3NNb2RlbFxuICogICAtIHdpdGhQYWNrYWdlUmVnaXN0cnlcbiAqL1xuZXhwb3J0IHR5cGUgQmVmb3JlQnVpbGRGbiA9IFN0YWdlZE9wdEZuPEJlZm9yZUJ1aWxkTWFyaz47XG5cbi8qKlxuICpcbiAqIEBwcm9wZXJ0eSB7QmVmb3JlQnVpbGRGbltdfSBiZWZvcmVCdWlsZCAtIGNhbGxiYWNrcyBiZWZvcmUgYnVpbGQgc3RhZ2VcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJbml0T3B0aW9ucyB7XG4gIC8qKlxuICAgKiBjYWxsYmFja3MgYmVmb3JlIGJ1aWxkIHN0YWdlXG4gICAqXG4gICAqIGJlZm9yZSBidWlsZCBzdGFnZSwgdGhlIHJlZ2lzdGVyZWQgZnVuY3Rpb25zIHdpbGwgYmUgZXhlY3V0ZWQgaW4gb3JkZXJcbiAgICogcG9zc2libGUgb3B0aW9uczpcbiAgICogLSBsb2FkRm9udHNcbiAgICogLSBwcmVsb2FkU3lzdGVtRm9udHNcbiAgICogLSB3aXRoQWNjZXNzTW9kZWxcbiAgICovXG4gIGJlZm9yZUJ1aWxkOiBCZWZvcmVCdWlsZEZuW107XG5cbiAgLyoqXG4gICAqIGNhbGxiYWNrcyB0byBmZXRjaCB0aGUgd2FzbSBtb2R1bGUgd3JhcHBlclxuICAgKi9cbiAgZ2V0V3JhcHBlcj8oKTogUHJvbWlzZTxhbnk+O1xuXG4gIC8qKlxuICAgKiBjYWxsYmFja3MgdG8gZmV0Y2ggdGhlIHdhc20gbW9kdWxlXG4gICAqXG4gICAqIFRoZXJlIGFyZSBtYW55IHdheXMgdG8gcHJvdmlkZSBhIHdhc20gbW9kdWxlLCBzZWVcbiAgICoge0BsaW5rIFdlYkFzc2VtYmx5TW9kdWxlUmVmfSBmb3IgbW9yZSBkZXRhaWxzLiBJZiB5b3UgZG9uJ3QgcHJvdmlkZSBhIHdhc21cbiAgICogbW9kdWxlLCB0aGUgZGVmYXVsdCBtb2R1bGUgd2lsbCBiZSB1c2VkLlxuICAgKi9cbiAgZ2V0TW9kdWxlKCk6IFdlYkFzc2VtYmx5TW9kdWxlUmVmIHwgUHJvbWlzZTxXZWJBc3NlbWJseU1vZHVsZVJlZj47XG59XG5cbmV4cG9ydCB0eXBlIExhenlGb250ID0ge1xuICBpbmZvOiBhbnk7XG59ICYgKFxuICAgIHwge1xuICAgICAgYmxvYjogKGluZGV4OiBudW1iZXIpID0+IFVpbnQ4QXJyYXk7XG4gICAgfVxuICAgIHwge1xuICAgICAgdXJsOiBzdHJpbmc7XG4gICAgfVxuICApO1xuXG4vKiogQGludGVybmFsICovXG5jb25zdCBfdGV4dEZvbnRzOiBzdHJpbmdbXSA9IFtcbiAgJ0RlamFWdVNhbnNNb25vLUJvbGQudHRmJyxcbiAgJ0RlamFWdVNhbnNNb25vLUJvbGRPYmxpcXVlLnR0ZicsXG4gICdEZWphVnVTYW5zTW9uby1PYmxpcXVlLnR0ZicsXG4gICdEZWphVnVTYW5zTW9uby50dGYnLFxuICAnTGliZXJ0aW51c1NlcmlmLUJvbGQub3RmJyxcbiAgJ0xpYmVydGludXNTZXJpZi1Cb2xkSXRhbGljLm90ZicsXG4gICdMaWJlcnRpbnVzU2VyaWYtSXRhbGljLm90ZicsXG4gICdMaWJlcnRpbnVzU2VyaWYtUmVndWxhci5vdGYnLFxuICAnTGliZXJ0aW51c1NlcmlmLVNlbWlib2xkLm90ZicsXG4gICdMaWJlcnRpbnVzU2VyaWYtU2VtaWJvbGRJdGFsaWMub3RmJyxcbiAgJ05ld0NNMTAtQm9sZC5vdGYnLFxuICAnTmV3Q00xMC1Cb2xkSXRhbGljLm90ZicsXG4gICdOZXdDTTEwLUl0YWxpYy5vdGYnLFxuICAnTmV3Q00xMC1SZWd1bGFyLm90ZicsXG4gICdOZXdDTU1hdGgtQm9sZC5vdGYnLFxuICAnTmV3Q01NYXRoLUJvb2sub3RmJyxcbiAgJ05ld0NNTWF0aC1SZWd1bGFyLm90ZicsXG5dO1xuLyoqIEBpbnRlcm5hbCAqL1xuY29uc3QgX2Nqa0ZvbnRzOiBzdHJpbmdbXSA9IFtcbiAgJ0lucmlhU2VyaWYtQm9sZC50dGYnLFxuICAnSW5yaWFTZXJpZi1Cb2xkSXRhbGljLnR0ZicsXG4gICdJbnJpYVNlcmlmLUl0YWxpYy50dGYnLFxuICAnSW5yaWFTZXJpZi1SZWd1bGFyLnR0ZicsXG4gICdSb2JvdG8tUmVndWxhci50dGYnLFxuICAnTm90b1NlcmlmQ0pLc2MtUmVndWxhci5vdGYnLFxuXTtcbi8qKiBAaW50ZXJuYWwgKi9cbmNvbnN0IF9lbW9qaUZvbnRzOiBzdHJpbmdbXSA9IFsnVHdpdHRlckNvbG9yRW1vamkudHRmJywgJ05vdG9Db2xvckVtb2ppLVJlZ3VsYXItQ09MUi5zdWJzZXQudHRmJ107XG5cbnR5cGUgQXZhaWxhYmxlRm9udEFzc2V0ID0gJ3RleHQnIHwgJ2NqaycgfCAnZW1vamknO1xuXG5leHBvcnQgaW50ZXJmYWNlIExvYWRSZW1vdGVBc3NldHNPcHRpb25zIHtcbiAgLyoqXG4gICAqIHByZWxvYWQgZm9udCBhc3NldHMgb3IgZG9uJ3QgcHJlbG9hZCBhbnkgZm9udCBhc3NldHNcbiAgICogQGRlZmF1bHQgWyd0ZXh0J11cbiAgICovXG4gIGFzc2V0cz86IEF2YWlsYWJsZUZvbnRBc3NldFtdIHwgZmFsc2U7XG5cbiAgLyoqXG4gICAqIGN1c3RvbWl6ZSB1cmwgcHJlZml4IGZvciBkZWZhdWx0IGFzc2V0cyBmcm9tIHJlbW90ZVxuICAgKlxuICAgKiBUaGUgZGVmYXVsdCBhc3NldHMgYXJlIGhvc3RlZCBvbiBnaXRodWIsIHlvdSBjYW4gZG93bmxvYWQgdGhlbSBhbmQgaG9zdFxuICAgKiB0aGVtIG9uIHlvdXIgb3duIHNlcnZlciwgd2hpY2ggaXMgbW9yZSBwcmFjdGljYWwgZm9yIHByb2R1Y3Rpb24uXG4gICAqXG4gICAqIEhvc3RlZCBhdDogaHR0cHM6Ly9naXRodWIuY29tL015cmlhZC1EcmVhbWluL3R5cHN0L3RyZWUvYXNzZXRzLWZvbnRzXG4gICAqIExpc3Qgb2YgYXNzZXRzOlxuICAgKiBTZWUge0BsaW5rIF90ZXh0Rm9udHN9LCB7QGxpbmsgX2Nqa0ZvbnRzfSwgYW5kIHtAbGluayBfZW1vamlGb250c31cbiAgICpcbiAgICogQGRlZmF1bHQgJ2pzZGVsaXZyLXVybCBvZiB0eXBzdC1hc3NldHMgYW5kIHR5cHN0LWRldi1hc3NldHMnXG4gICAqL1xuICBhc3NldFVybFByZWZpeD86IHN0cmluZyB8IFJlY29yZDxzdHJpbmcsIHN0cmluZz47XG5cbiAgLyoqXG4gICAqIGN1c3RvbSBmZXRjaGVyXG4gICAqIE5vdGU6IHRoZSBkZWZhdWx0IGZldGNoZXIgZm9yIG5vZGUuanMgZG9lcyBub3QgY2FjaGUgYW55IGZvbnRzXG4gICAqIEBkZWZhdWx0IGZldGNoXG4gICAqL1xuICBmZXRjaGVyPzogdHlwZW9mIGZldGNoO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExvYWRSZW1vdGVGb250c09wdGlvbnMgZXh0ZW5kcyBMb2FkUmVtb3RlQXNzZXRzT3B0aW9ucyB7IH1cblxuLyoqXG4gKiBkaXNhYmxlIGRlZmF1bHQgZm9udCBhc3NldHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRpc2FibGVEZWZhdWx0Rm9udEFzc2V0cygpOiBCZWZvcmVCdWlsZEZuIHtcbiAgcmV0dXJuIGxvYWRGb250cyhbXSwgeyBhc3NldHM6IGZhbHNlIH0pO1xufVxuXG4vKipcbiAqIHByZWxvYWQgZm9udCBhc3NldHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHByZWxvYWRGb250QXNzZXRzKG9wdGlvbnM/OiBMb2FkUmVtb3RlQXNzZXRzT3B0aW9ucyk6IEJlZm9yZUJ1aWxkRm4ge1xuICByZXR1cm4gbG9hZEZvbnRzKFtdLCBvcHRpb25zKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9yZXNvbHZlQXNzZXRzKG9wdGlvbnM/OiBMb2FkUmVtb3RlRm9udHNPcHRpb25zKSB7XG4gIGNvbnN0IGZvbnRzID0gW107XG4gIGlmIChcbiAgICBvcHRpb25zICYmXG4gICAgb3B0aW9ucz8uYXNzZXRzICE9PSBmYWxzZSAmJlxuICAgIG9wdGlvbnM/LmFzc2V0cz8ubGVuZ3RoICYmXG4gICAgb3B0aW9ucz8uYXNzZXRzPy5sZW5ndGggPiAwXG4gICkge1xuICAgIGxldCBkZWZhdWx0UHJlZml4OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+ID0ge1xuICAgICAgdGV4dDogJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC90eXBzdC90eXBzdC1hc3NldHNAdjAuMTMuMS9maWxlcy9mb250cy8nLFxuICAgICAgXzogJ2h0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9naC90eXBzdC90eXBzdC1kZXYtYXNzZXRzQHYwLjEzLjEvZmlsZXMvZm9udHMvJyxcbiAgICB9O1xuICAgIGxldCBhc3NldFVybFByZWZpeCA9IG9wdGlvbnMuYXNzZXRVcmxQcmVmaXggPz8gZGVmYXVsdFByZWZpeDtcbiAgICBpZiAodHlwZW9mIGFzc2V0VXJsUHJlZml4ID09PSAnc3RyaW5nJykge1xuICAgICAgYXNzZXRVcmxQcmVmaXggPSB7IF86IGFzc2V0VXJsUHJlZml4IH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGFzc2V0VXJsUHJlZml4ID0geyAuLi5kZWZhdWx0UHJlZml4LCAuLi5hc3NldFVybFByZWZpeCB9O1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IGtleSBvZiBPYmplY3Qua2V5cyhhc3NldFVybFByZWZpeCkpIHtcbiAgICAgIGNvbnN0IHUgPSBhc3NldFVybFByZWZpeFtrZXldO1xuICAgICAgaWYgKHVbdS5sZW5ndGggLSAxXSAhPT0gJy8nKSB7XG4gICAgICAgIGFzc2V0VXJsUHJlZml4W2tleV0gPSB1ICsgJy8nO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHByZWZpeCA9IChhc3NldDogc3RyaW5nLCBmOiBzdHJpbmdbXSkgPT5cbiAgICAgIGYubWFwKGZvbnQgPT4gKGFzc2V0VXJsUHJlZml4W2Fzc2V0XSB8fCBhc3NldFVybFByZWZpeFsnXyddKSArIGZvbnQpO1xuICAgIGZvciAoY29uc3QgYXNzZXQgb2Ygb3B0aW9ucy5hc3NldHMpIHtcbiAgICAgIHN3aXRjaCAoYXNzZXQpIHtcbiAgICAgICAgY2FzZSAndGV4dCc6XG4gICAgICAgICAgZm9udHMucHVzaCguLi5wcmVmaXgoYXNzZXQsIF90ZXh0Rm9udHMpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnY2prJzpcbiAgICAgICAgICBmb250cy5wdXNoKC4uLnByZWZpeChhc3NldCwgX2Nqa0ZvbnRzKSk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2Vtb2ppJzpcbiAgICAgICAgICBmb250cy5wdXNoKC4uLnByZWZpeChhc3NldCwgX2Vtb2ppRm9udHMpKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICByZXR1cm4gZm9udHM7XG59XG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgdXNlIHtAbGluayBsb2FkRm9udHN9IGluc3RlYWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHByZWxvYWRSZW1vdGVGb250cyhcbiAgdXNlckZvbnRzOiAoc3RyaW5nIHwgVWludDhBcnJheSlbXSxcbiAgb3B0aW9ucz86IExvYWRSZW1vdGVGb250c09wdGlvbnMsXG4pOiBCZWZvcmVCdWlsZEZuIHtcbiAgcmV0dXJuIGxvYWRGb250cyh1c2VyRm9udHMsIG9wdGlvbnMpO1xufVxuXG4vKipcbiAqIGxvYWQgZm9udHNcbiAqXG4gKiBAcGFyYW0gZm9udHMgLSB1cmwgcGF0aCB0byBmb250IGZpbGVzXG4gKiBAcmV0dXJucyB7QmVmb3JlQnVpbGRGbn1cbiAqIEBleGFtcGxlXG4gKiBgYGB0c1xuICogLy8gcHJlTG9hZCBmb250cyBmcm9tIHJlbW90ZSB1cmwgKGJlY2F1c2UgZmludG8gaW5mbyBpcyBub3QgcHJvdmlkZWQpXG4gKiBpbXBvcnQgeyBpbml0LCBsb2FkRm9udHMgfSBmcm9tICd0eXBzdCc7XG4gKiBpbml0KHtcbiAqICAgYmVmb3JlQnVpbGQ6IFtcbiAqICAgICBsb2FkRm9udHMoW1xuICogICAgICAnaHR0cHM6Ly9mb250cy5nc3RhdGljLmNvbS9zL3JvYm90by92MjcvS0ZPbUNucUV1OTJGcjFNdTRteEtLVFUxS2cud29mZjInLCAvLyByZW1vdGUgdXJsXG4gKiAgICAgICdkaXN0L2ZvbnRzL1JvYm90by1SZWd1bGFyLnR0ZicsIC8vIHJlbGF0aXZlIHRvIHRoZSByb290IG9mIHRoZSB3ZWJzaXRlXG4gKiAgICAgXSksXG4gKiAgIF0sXG4gKiB9KTtcbiAqIGBgYFxuICogQGV4YW1wbGVcbiAqIGBgYHRzXG4gKiAvLyBsYXppbHkgTG9hZCBmb250cyBmcm9tIHJlbW90ZSB1cmwuIFRoZSBmb250IGluZm9ybWF0aW9uIGlzIG9idGFpbmVkIGJ5IGBnZXRGb250SW5mb2BcbiAqIGltcG9ydCB7IGluaXQsIGxvYWRGb250cyB9IGZyb20gJ3R5cHN0JztcbiAqIGluaXQoe1xuICogICBiZWZvcmVCdWlsZDogW1xuICogICAgIGxvYWRGb250cyhbXG4gKiAgICAgIHtcbiAqICAgICAgICBpbmZvOiBbLi4uXVxuICogICAgICAgIHVybDogJ2h0dHBzOi8vZm9udHMuZ3N0YXRpYy5jb20vcy9yb2JvdG8vdjI3L0tGT21DbnFFdTkyRnIxTXU0bXhLS1RVMUtnLndvZmYyJztcbiAqICAgICAgfVxuICogICAgIF0pLFxuICogICBdLFxuICogfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxvYWRGb250cyhcbiAgdXNlckZvbnRzOiAoc3RyaW5nIHwgVWludDhBcnJheSB8IExhenlGb250KVtdLFxuICBvcHRpb25zPzogTG9hZFJlbW90ZUZvbnRzT3B0aW9ucyxcbik6IEJlZm9yZUJ1aWxkRm4ge1xuICBjb25zdCBhc3NldEZvbnRzID0gX3Jlc29sdmVBc3NldHMob3B0aW9ucyk7XG4gIGNvbnN0IGxvYWRlciA9IGFzeW5jIChfOiBCZWZvcmVCdWlsZE1hcmssIHsgcmVmLCBidWlsZGVyIH06IEluaXRDb250ZXh0KSA9PiB7XG4gICAgaWYgKG9wdGlvbnM/LmZldGNoZXIpIHtcbiAgICAgIHJlZi5zZXRGZXRjaGVyKG9wdGlvbnMuZmV0Y2hlcik7XG4gICAgfVxuICAgIGF3YWl0IHJlZi5sb2FkRm9udHMoYnVpbGRlciwgWy4uLnVzZXJGb250cywgLi4uYXNzZXRGb250c10pO1xuICB9O1xuICBsb2FkZXIuX3ByZWxvYWRSZW1vdGVGb250T3B0aW9ucyA9IG9wdGlvbnM7XG4gIGxvYWRlci5fa2luZCA9ICdmb250TG9hZGVyJztcbiAgcmV0dXJuIGxvYWRlcjtcbn1cblxuLyoqXG4gKiBwcmVsb2FkIHN5c3RlbSBmb250c1xuICogQHBhcmFtIGJ5RmFtaWx5IC0gZmlsdGVyIHN5c3RlbSBmb250cyB0byBwcmVsb2FkIGJ5IGZhbWlseSBuYW1lXG4gKiBAcmV0dXJucyB7QmVmb3JlQnVpbGRGbn1cbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbXBvcnQgeyBpbml0LCBwcmVsb2FkU3lzdGVtRm9udHMgfSBmcm9tICd0eXBzdCc7XG4gKiBpbml0KHtcbiAqICAgYmVmb3JlQnVpbGQ6IFtcbiAqICAgICBwcmVsb2FkU3lzdGVtRm9udHMoe1xuICogICAgICAgYnlGYW1pbHk6IFsnUm9ib3RvJ10sIC8vIHByZWxvYWQgZm9udHMgYnkgZmFtaWx5IG5hbWVcbiAqICAgICB9KSxcbiAqICAgXSxcbiAqIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwcmVsb2FkU3lzdGVtRm9udHMoeyBieUZhbWlseSB9OiB7IGJ5RmFtaWx5Pzogc3RyaW5nW10gfSk6IEJlZm9yZUJ1aWxkRm4ge1xuICByZXR1cm4gYXN5bmMgKF8sIHsgYnVpbGRlciB9OiBJbml0Q29udGV4dCkgPT4ge1xuICAgIGNvbnN0IHQgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICAgIGlmICgncXVlcnlMb2NhbEZvbnRzJyBpbiB3aW5kb3cpIHtcbiAgICAgIGNvbnN0IGZvbnRzOiB7XG4gICAgICAgIGZhbWlseTogc3RyaW5nO1xuICAgICAgICBibG9iKCk6IFByb21pc2U8QmxvYj47XG4gICAgICB9W10gPSBhd2FpdCAod2luZG93IGFzIGFueSkucXVlcnlMb2NhbEZvbnRzKCk7XG5cbiAgICAgIGJ5RmFtaWx5ID0gYnlGYW1pbHkgPz8gW107XG5cbiAgICAgIGZvciAoY29uc3QgZm9udCBvZiBmb250cykge1xuICAgICAgICBpZiAoIWJ5RmFtaWx5LmluY2x1ZGVzKGZvbnQuZmFtaWx5KSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZGF0YTogQXJyYXlCdWZmZXIgPSBhd2FpdCAoYXdhaXQgZm9udC5ibG9iKCkpLmFycmF5QnVmZmVyKCk7XG4gICAgICAgIGF3YWl0IGJ1aWxkZXIuYWRkX3Jhd19mb250KG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCB0MiA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIGNvbnNvbGUubG9nKCdwcmVsb2FkIHN5c3RlbSBmb250IHRpbWUgdXNlZDonLCB0MiAtIHQpO1xuICB9O1xufVxuXG4vKipcbiAqIChjb21waWxlIG9ubHkpIHNldCBwYWNvYWdlIHJlZ2lzdHJ5XG4gKlxuICogQHBhcmFtIGFjY2Vzc01vZGVsOiB3aGVuIGNvbXBpbGluZywgdGhlIHBhY29hZ2UgcmVnaXN0cnkgaXMgdXNlZCB0byBhY2Nlc3MgdGhlXG4gKiBkYXRhIG9mIGZpbGVzXG4gKiBAcmV0dXJucyB7QmVmb3JlQnVpbGRGbn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdpdGhQYWNrYWdlUmVnaXN0cnkocGFja2FnZVJlZ2lzdHJ5OiBQYWNrYWdlUmVnaXN0cnkpOiBCZWZvcmVCdWlsZEZuIHtcbiAgcmV0dXJuIGFzeW5jIChfLCB7IGJ1aWxkZXIgfTogSW5pdENvbnRleHQpID0+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiB7XG4gICAgICBidWlsZGVyLnNldF9wYWNrYWdlX3JlZ2lzdHJ5KHBhY2thZ2VSZWdpc3RyeSwgZnVuY3Rpb24gKHNwZWM6IFBhY2thZ2VTcGVjKSB7XG4gICAgICAgIHJldHVybiBwYWNrYWdlUmVnaXN0cnkucmVzb2x2ZShzcGVjLCB0aGlzKTtcbiAgICAgIH0pO1xuICAgICAgcmVzb2x2ZSgpO1xuICAgIH0pO1xuICB9O1xufVxuXG4vKipcbiAqIChjb21waWxlIG9ubHkpIHNldCBhY2Nlc3MgbW9kZWxcbiAqXG4gKiBAcGFyYW0gYWNjZXNzTW9kZWw6IHdoZW4gY29tcGlsaW5nLCB0aGUgYWNjZXNzIG1vZGVsIGlzIHVzZWQgdG8gYWNjZXNzIHRoZVxuICogZGF0YSBvZiBmaWxlc1xuICogQHJldHVybnMge0JlZm9yZUJ1aWxkRm59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB3aXRoQWNjZXNzTW9kZWwoYWNjZXNzTW9kZWw6IEZzQWNjZXNzTW9kZWwpOiBCZWZvcmVCdWlsZEZuIHtcbiAgcmV0dXJuIGFzeW5jIChfLCBjdHg6IEluaXRDb250ZXh0KSA9PiB7XG4gICAgaWYgKGN0eC5hbHJlYWR5U2V0QWNjZXNzTW9kZWwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgYGFscmVhZHkgc2V0IHNvbWUgYXNzZXNzIG1vZGVsIGJlZm9yZTogJHtjdHguYWxyZWFkeVNldEFjY2Vzc01vZGVsLmNvbnN0cnVjdG9yPy5uYW1lfSgke2N0eC5hbHJlYWR5U2V0QWNjZXNzTW9kZWx9KWAsXG4gICAgICApO1xuICAgIH1cbiAgICBjdHguYWxyZWFkeVNldEFjY2Vzc01vZGVsID0gYWNjZXNzTW9kZWw7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgY3R4LmJ1aWxkZXIuc2V0X2FjY2Vzc19tb2RlbChcbiAgICAgICAgYWNjZXNzTW9kZWwsXG4gICAgICAgIChwYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBjb25zdCBsYXN0TW9kaWZpZWQgPSBhY2Nlc3NNb2RlbC5nZXRNVGltZShwYXRoKTtcbiAgICAgICAgICBpZiAobGFzdE1vZGlmaWVkKSB7XG4gICAgICAgICAgICByZXR1cm4gbGFzdE1vZGlmaWVkLmdldFRpbWUoKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH0sXG4gICAgICAgIChwYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICByZXR1cm4gYWNjZXNzTW9kZWwuaXNGaWxlKHBhdGgpIHx8IGZhbHNlO1xuICAgICAgICB9LFxuICAgICAgICAocGF0aDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIGFjY2Vzc01vZGVsLmdldFJlYWxQYXRoKHBhdGgpIHx8IHBhdGg7XG4gICAgICAgIH0sXG4gICAgICAgIChwYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICByZXR1cm4gYWNjZXNzTW9kZWwucmVhZEFsbChwYXRoKTtcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgICByZXNvbHZlKCk7XG4gICAgfSk7XG4gIH07XG59XG5cbi8qKlxuICogQGludGVybmFsIGJ1aWxkZXJcbiAqL1xudHlwZSBCdWlsZGVyID0gdHlwc3RSZW5kZXJlci5UeXBzdFJlbmRlcmVyQnVpbGRlciAmIHR5cHN0Q29tcGlsZXIuVHlwc3RDb21waWxlckJ1aWxkZXI7XG5cbi8qKlxuICogQGludGVybmFsIGJ1aWxkIGNvbnRleHRcbiAqL1xuaW50ZXJmYWNlIEluaXRDb250ZXh0IHtcbiAgcmVmOiB7XG4gICAgc2V0RmV0Y2hlcihmZXRjaGVyOiB0eXBlb2YgZmV0Y2gpOiB2b2lkO1xuICAgIGxvYWRGb250cyhidWlsZGVyOiBCdWlsZGVyLCBmb250czogKHN0cmluZyB8IFVpbnQ4QXJyYXkgfCBMYXp5Rm9udClbXSk6IFByb21pc2U8dm9pZD47XG4gIH07XG4gIGJ1aWxkZXI6IEJ1aWxkZXI7XG4gIGFscmVhZHlTZXRBY2Nlc3NNb2RlbDogYW55O1xufVxuXG4vLyB0b2RvOiBzZWFyY2ggYnJvd3NlclxuLy8gc2VhcmNoZXIuc2VhcmNoX2Jyb3dzZXIoKS5hd2FpdD87XG4iXX0=","/**\n * @internal\n */\nconst once = (fn) => {\n    let called = false;\n    let res;\n    return () => {\n        if (called) {\n            return res;\n        }\n        called = true;\n        return (res = fn());\n    };\n};\n/** @internal */\nexport class LazyWasmModule {\n    wasmBin;\n    initOnce;\n    constructor(initFn) {\n        if (typeof initFn !== 'function') {\n            throw new Error('initFn is not a function');\n        }\n        this.initOnce = once(async () => {\n            await initFn(this.wasmBin);\n        });\n    }\n    async init(module) {\n        this.wasmBin = module;\n        await this.initOnce();\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2FzbS5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvd2FzbS5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBV0E7O0dBRUc7QUFDSCxNQUFNLElBQUksR0FBRyxDQUFnQixFQUFXLEVBQUUsRUFBRTtJQUMxQyxJQUFJLE1BQU0sR0FBRyxLQUFLLENBQUM7SUFDbkIsSUFBSSxHQUFNLENBQUM7SUFDWCxPQUFPLEdBQUcsRUFBRTtRQUNWLElBQUksTUFBTSxFQUFFLENBQUM7WUFDWCxPQUFPLEdBQUcsQ0FBQztRQUNiLENBQUM7UUFDRCxNQUFNLEdBQUcsSUFBSSxDQUFDO1FBQ2QsT0FBTyxDQUFDLEdBQUcsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ3RCLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUtGLGdCQUFnQjtBQUNoQixNQUFNLE9BQU8sY0FBYztJQUNqQixPQUFPLENBQXNCO0lBQzdCLFFBQVEsQ0FBc0I7SUFFdEMsWUFBWSxNQUF3RDtRQUNsRSxJQUFJLE9BQU8sTUFBTSxLQUFLLFVBQVUsRUFBRSxDQUFDO1lBQ2pDLE1BQU0sSUFBSSxLQUFLLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUM5QyxDQUFDO1FBRUQsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDOUIsTUFBTSxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzdCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELEtBQUssQ0FBQyxJQUFJLENBQUMsTUFBNkQ7UUFDdEUsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFDdEIsTUFBTSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDeEIsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaGUgcmVmZXJlbmNlIG9mIGEgV2ViQXNzZW1ibHkgbW9kdWxlIHdoaWNoIGlzIGNvcGllZCBmcm9tIHRoZSB3YXNtLWJpbmRnZW5cbiAqIEBzZWUgaHR0cHM6Ly9naXRodWIuY29tL3J1c3R3YXNtL3dhc20tYmluZGdlbi9ibG9iLzJjNjIyNzE1YzllNjYwMmY3YmIzNzc4MjhjNzJmNzk1M2IxNzhlZDcvY3JhdGVzL2NsaS1zdXBwb3J0L3NyYy9qcy9tb2QucnMjTDY1NlxuICpcbiAqIFlvdXIgbW9zdCBjb21tb24gdXNlIGNhc2Ugd2lsbCBiZSB0byBwYXNzIGEgVVJMIHRvIGEgd2FzbSBmaWxlIGhlcmUuXG4gKiArIGBXZWJBc3NlbWJseS5Nb2R1bGVgIC0gQW4gaW5zdGFudGlhdGVkIHdhc20gbW9kdWxlLlxuICogKyBgVVJMYCAtIFJlbW90ZSB1cmwgdG8gYSB3YXNtIGZpbGVcbiAqICsgYEJ1ZmZlclNvdXJjZWAgLSBBbiBBcnJheUJ1ZmZlclZpZXcgb3IgYW4gQXJyYXlCdWZmZXJcbiAqL1xuZXhwb3J0IHR5cGUgV2ViQXNzZW1ibHlNb2R1bGVSZWYgPSBSZXF1ZXN0SW5mbyB8IFVSTCB8IFJlc3BvbnNlIHwgQnVmZmVyU291cmNlIHwgV2ViQXNzZW1ibHkuTW9kdWxlO1xuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5jb25zdCBvbmNlID0gPFQgZXh0ZW5kcyBhbnk+KGZuOiAoKSA9PiBUKSA9PiB7XG4gIGxldCBjYWxsZWQgPSBmYWxzZTtcbiAgbGV0IHJlczogVDtcbiAgcmV0dXJuICgpID0+IHtcbiAgICBpZiAoY2FsbGVkKSB7XG4gICAgICByZXR1cm4gcmVzO1xuICAgIH1cbiAgICBjYWxsZWQgPSB0cnVlO1xuICAgIHJldHVybiAocmVzID0gZm4oKSk7XG4gIH07XG59O1xuXG4vKiogQGludGVybmFsIGNvcGllZCBmcm9tIHdhc20tYmluZGdlbiAqL1xudHlwZSBXYXNtTW9kdWxlSW5pdFBhcmFtID0gV2ViQXNzZW1ibHlNb2R1bGVSZWYgfCBQcm9taXNlPFdlYkFzc2VtYmx5TW9kdWxlUmVmPiB8IHVuZGVmaW5lZDtcblxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGNsYXNzIExhenlXYXNtTW9kdWxlIHtcbiAgcHJpdmF0ZSB3YXNtQmluOiBXYXNtTW9kdWxlSW5pdFBhcmFtO1xuICBwcml2YXRlIGluaXRPbmNlOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuXG4gIGNvbnN0cnVjdG9yKGluaXRGbjogKHBhcmFtOiBXYXNtTW9kdWxlSW5pdFBhcmFtKSA9PiBQcm9taXNlPHVua25vd24+KSB7XG4gICAgaWYgKHR5cGVvZiBpbml0Rm4gIT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignaW5pdEZuIGlzIG5vdCBhIGZ1bmN0aW9uJyk7XG4gICAgfVxuXG4gICAgdGhpcy5pbml0T25jZSA9IG9uY2UoYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgaW5pdEZuKHRoaXMud2FzbUJpbik7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBpbml0KG1vZHVsZT86IFdlYkFzc2VtYmx5TW9kdWxlUmVmIHwgUHJvbWlzZTxXZWJBc3NlbWJseU1vZHVsZVJlZj4pIHtcbiAgICB0aGlzLndhc21CaW4gPSBtb2R1bGU7XG4gICAgYXdhaXQgdGhpcy5pbml0T25jZSgpO1xuICB9XG59XG4iXX0=","import { buildComponent } from './init.mjs';\nimport { kObject } from './internal.types.mjs';\nimport { loadFonts } from './options.init.mjs';\nimport { LazyWasmModule } from './wasm.mjs';\n/**\n * Available formats for compiling the document.\n */\nexport var CompileFormatEnum;\n(function (CompileFormatEnum) {\n    CompileFormatEnum[CompileFormatEnum[\"vector\"] = 0] = \"vector\";\n    CompileFormatEnum[CompileFormatEnum[\"pdf\"] = 1] = \"pdf\";\n    CompileFormatEnum[CompileFormatEnum[\"_dummy\"] = 2] = \"_dummy\";\n})(CompileFormatEnum || (CompileFormatEnum = {}));\nexport class IncrementalServer {\n    /**\n     * @internal\n     */\n    [kObject];\n    /**\n     * @internal\n     */\n    constructor(s) {\n        this[kObject] = s;\n    }\n    /**\n     * Reset the incremental server to the initial state.\n     */\n    reset() {\n        this[kObject].reset();\n    }\n    /**\n     * Return current result.\n     */\n    current() {\n        return this[kObject].current();\n    }\n    /**\n     * Also attach the debug info to the result.\n     */\n    setAttachDebugInfo(enable) {\n        this[kObject].set_attach_debug_info(enable);\n    }\n}\nvar TypstFontResolverCons;\n(function (TypstFontResolverCons) {\n})(TypstFontResolverCons || (TypstFontResolverCons = {}));\n/**\n * create a Typst font builder.\n * @returns {TypstFontBuilder} - The Typst font builder.\n * @example\n * ```typescript\n * import { createTypstFontBuilder } from 'typst';\n * const fb = createTypstFontBuilder();\n * await fb.init();\n * await fb.addFontData(new Uint8Array(await fetch('font.ttf').then(r => r.arrayBuffer())));\n * await fb.build();\n * ```\n */\nexport function createTypstFontBuilder() {\n    return new TypstFontBuilderDriver();\n}\nexport class TypstWorld {\n    [kObject];\n    constructor(world) {\n        this[kObject] = world;\n    }\n    /**\n     * Compile the paged document.\n     *\n     * @param {DiagnosticsFormat} format - The format of the diagnostics.\n     * @returns {Promise<{ diagnostics?: DiagnosticsData[DiagnosticsFormat][] }>} - The result of the compilation.\n     */\n    compile(opts) {\n        return this[kObject].compile(0, getDiagnosticsArg(opts?.diagnostics));\n    }\n    /**\n     * Compile the paged document.\n     *\n     * @param {DiagnosticsFormat} format - The format of the diagnostics.\n     * @returns {Promise<{ diagnostics?: DiagnosticsData[DiagnosticsFormat][] }>} - The result of the compilation.\n     */\n    compileHtml(opts) {\n        return this[kObject].compile(1, getDiagnosticsArg(opts?.diagnostics));\n    }\n    /**\n     * Runs query on the paged document.\n     */\n    async query(options) {\n        return JSON.parse(this[kObject].query(0, options.selector, options.field));\n    }\n    /**\n     * Get the title of the paged document.\n     * Throw error if the world didn't compile the paged document.\n     *\n     * @returns {string | undefined} - The title of the paged document.\n     */\n    title() {\n        return this[kObject].title(0);\n    }\n    /**\n     * Export the paged document as vector format.\n     *\n     * @returns {Uint8Array | undefined} - The title of the paged document.\n     */\n    vector(opts) {\n        return this[kObject].get_artifact(0, getDiagnosticsArg(opts?.diagnostics)) || {};\n    }\n    /**\n     * Export the paged document to PDF.\n     *\n     * @returns {Uint8Array | undefined} - The title of the paged document.\n     */\n    pdf(opts) {\n        return this[kObject].get_artifact(1, getDiagnosticsArg(opts?.diagnostics)) || {};\n    }\n    /**\n     * Change the PDF options.\n     *\n     * @param opts RenderPdfOpts\n     */\n    setPdfOpts(opts) {\n        this[kObject].set_pdf_opts(opts);\n    }\n}\nconst gCompilerModule = (module) => new LazyWasmModule(async (bin) => {\n    return await module.default(bin);\n});\n/**\n * create a Typst compiler.\n * @returns {TypstCompiler} - The Typst compiler.\n * @example\n * ```typescript\n * import { createTypstCompiler } from 'typst';\n * const compiler = createTypstCompiler();\n * await compiler.init();\n * compiler.addSource('/main.typ', 'Hello, typst!');\n * await compiler.compile({ mainFilePath: '/main.typ' });\n * ```\n */\nexport function createTypstCompiler() {\n    return new TypstCompilerDriver();\n}\nexport class TypstFontBuilderDriver {\n    fontBuilderJs;\n    fontBuilder;\n    async init(options) {\n        this.fontBuilderJs = await (options?.getWrapper?.() || import('@myriaddreamin/typst-ts-web-compiler'));\n        /// init typst wasm module\n        await gCompilerModule(this.fontBuilderJs).init(options?.getModule?.());\n        this.fontBuilder = new this.fontBuilderJs.TypstFontResolverBuilder();\n    }\n    async getFontInfo(font_buffer) {\n        return this.fontBuilder.get_font_info(font_buffer);\n    }\n    async addFontData(font_buffer) {\n        this.fontBuilder.add_raw_font(font_buffer);\n    }\n    async addLazyFont(info, blob) {\n        return this.fontBuilder.add_lazy_font(info, blob);\n    }\n    async build(cb) {\n        const fonts = await this.fontBuilder.build();\n        const result = await cb(fonts);\n        fonts.free();\n        return result;\n    }\n}\nclass TypstCompilerDriver {\n    compiler;\n    compilerJs;\n    pdfOpts;\n    static defaultAssets = ['text'];\n    constructor() { }\n    async init(options) {\n        this.compilerJs = await (options?.getWrapper?.() || import('@myriaddreamin/typst-ts-web-compiler'));\n        const TypstCompilerBuilder = this.compilerJs.TypstCompilerBuilder;\n        const compilerOptions = { ...(options || {}) };\n        const beforeBuild = (compilerOptions.beforeBuild ??= []);\n        const hasPreloadRemoteFonts = beforeBuild.some((fn) => fn._preloadRemoteFontOptions !== undefined);\n        const hasSpecifiedAssets = beforeBuild.some((fn) => fn._preloadRemoteFontOptions?.assets !== undefined);\n        const hasDisableAssets = beforeBuild.some((fn) => fn._preloadRemoteFontOptions?.assets === false);\n        if (!hasPreloadRemoteFonts || (!hasSpecifiedAssets && !hasDisableAssets)) {\n            beforeBuild.push(loadFonts([], { assets: TypstCompilerDriver.defaultAssets }));\n        }\n        const hasFontLoader = beforeBuild.some((fn) => fn._kind === 'fontLoader');\n        if (!hasFontLoader) {\n            throw new Error('TypstCompiler: no font loader found, please use font loaders, e.g. loadFonts or preloadSystemFonts');\n        }\n        const hooks = {};\n        if (this.pdfOpts) {\n            hooks.latelyBuild = (ctx) => {\n                ctx.builder.set_pdf_opts(this.pdfOpts);\n            };\n        }\n        this.compiler = await buildComponent(options, gCompilerModule(this.compilerJs), TypstCompilerBuilder, hooks);\n    }\n    setPdfOpts(opts) {\n        if (this.compiler) {\n            throw new Error('setPdfOpts must be called before init()');\n        }\n        this.pdfOpts = opts;\n    }\n    setPdfOptsForNextCompile(opts) {\n        this.pdfOpts = opts;\n    }\n    setFonts(fonts) {\n        this.compiler.set_fonts(fonts);\n    }\n    compile(options) {\n        return new Promise(resolve => {\n            const world = this.compiler.snapshot(options.root, options.mainFilePath, convertInputs(options.inputs));\n            if (this.pdfOpts) {\n                world.set_pdf_opts(this.pdfOpts);\n            }\n            if ('incrementalServer' in options) {\n                resolve(world.incr_compile(options.incrementalServer[kObject], getDiagnosticsArg(options.diagnostics)));\n                return;\n            }\n            resolve(world.get_artifact(options.format || CompileFormatEnum.vector, getDiagnosticsArg(options.diagnostics)));\n        });\n    }\n    async runWithWorld(options, cb) {\n        const world = this.compiler.snapshot(options.root, options.mainFilePath, convertInputs(options.inputs));\n        let result = await cb(new TypstWorld(world));\n        world.free();\n        return result;\n    }\n    query(options) {\n        return this.runWithWorld(options, async (world) => {\n            return JSON.parse(await world.query(options));\n        });\n    }\n    getSemanticTokenLegend() {\n        return new Promise(resolve => {\n            resolve(this.compiler.get_semantic_token_legend());\n        });\n    }\n    getSemanticTokens(opts) {\n        return new Promise(resolve => {\n            this.compiler.reset();\n            resolve(this.compiler.get_semantic_tokens(opts.offsetEncoding || 'utf-16', opts.mainFilePath, opts.resultId));\n        });\n    }\n    async withIncrementalServer(f) {\n        const srv = new IncrementalServer(this.compiler.create_incr_server());\n        try {\n            return await f(srv);\n        }\n        finally {\n            srv[kObject].free();\n        }\n    }\n    async getAst(mainFilePath) {\n        return this.compiler.get_ast(mainFilePath);\n    }\n    async reset() {\n        await new Promise(resolve => {\n            this.compiler.reset();\n            resolve(undefined);\n        });\n    }\n    addSource(path, source) {\n        if (arguments.length > 2) {\n            throw new Error('use of addSource(path, source, isMain) is deprecated, please use addSource(path, source) instead');\n        }\n        this.compiler.add_source(path, source);\n    }\n    mapShadow(path, content) {\n        this.compiler.map_shadow(path, content);\n    }\n    unmapShadow(path) {\n        this.compiler.unmap_shadow(path);\n    }\n    resetShadow() {\n        this.compiler.reset_shadow();\n    }\n    renderPageToCanvas() {\n        throw new Error('Please use the api TypstRenderer.renderToCanvas in v0.4.0');\n    }\n}\ncreateTypstCompiler._impl = TypstCompilerDriver;\n// todo: caching inputs\nfunction convertInputs(inputs) {\n    return inputs ? Object.entries(inputs) : undefined;\n}\nfunction getDiagnosticsArg(diagnostics) {\n    switch (diagnostics) {\n        case 'none':\n            return 1;\n        case 'unix':\n            return 2;\n        case 'full':\n        default:\n            return 3;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29tcGlsZXIubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbXBpbGVyLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxPQUFPLEVBQUUsY0FBYyxFQUE0QixNQUFNLFlBQVksQ0FBQztBQUN0RSxPQUFPLEVBQXdDLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBRXJGLE9BQU8sRUFBRSxTQUFTLEVBQW9CLE1BQU0sb0JBQW9CLENBQUM7QUFDakUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLFlBQVksQ0FBQztBQU81Qzs7R0FFRztBQUNILE1BQU0sQ0FBTixJQUFZLGlCQUlYO0FBSkQsV0FBWSxpQkFBaUI7SUFDM0IsNkRBQVUsQ0FBQTtJQUNWLHVEQUFPLENBQUE7SUFDUCw2REFBVSxDQUFBO0FBQ1osQ0FBQyxFQUpXLGlCQUFpQixLQUFqQixpQkFBaUIsUUFJNUI7QUFnSUQsTUFBTSxPQUFPLGlCQUFpQjtJQUM1Qjs7T0FFRztJQUNILENBQUMsT0FBTyxDQUFDLENBQW1CO0lBRTVCOztPQUVHO0lBQ0gsWUFBWSxDQUFtQjtRQUM3QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUs7UUFDSCxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDeEIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsT0FBTztRQUNMLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO0lBQ2pDLENBQUM7SUFFRDs7T0FFRztJQUNILGtCQUFrQixDQUFDLE1BQWU7UUFDaEMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLHFCQUFxQixDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzlDLENBQUM7Q0FDRjtBQVNELElBQUsscUJBQXlCO0FBQTlCLFdBQUsscUJBQXFCO0FBQUcsQ0FBQyxFQUF6QixxQkFBcUIsS0FBckIscUJB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RUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFFRCxTQUFTLENBQUMsSUFBWSxFQUFFLE9BQW1CO1FBQ3pDLElBQUksQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxPQUFPLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBRUQsV0FBVyxDQUFDLElBQVk7UUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDbkMsQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFFRCxrQkFBa0I7UUFDaEIsTUFBTSxJQUFJLEtBQUssQ0FBQywyREFBMkQsQ0FBQyxDQUFDO0lBQy9FLENBQUM7O0FBRUgsbUJBQW1CLENBQUMsS0FBSyxHQUFHLG1CQUFtQixDQUFDO0FBRWhELHVCQUF1QjtBQUN2QixTQUFTLGFBQWEsQ0FBQyxNQUErQjtJQUNwRCxPQUFPLE1BQU0sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQ3JELENBQUM7QUFFRCxTQUFTLGlCQUFpQixDQUFDLFdBQStCO0lBQ3hELFFBQVEsV0FBVyxFQUFFLENBQUM7UUFDcEIsS0FBSyxNQUFNO1lBQ1QsT0FBTyxDQUFDLENBQUM7UUFDWCxLQUFLLE1BQU07WUFDVCxPQUFPLENBQUMsQ0FBQztRQUNYLEtBQUssTUFBTSxDQUFDO1FBQ1o7WUFDRSxPQUFPLENBQUMsQ0FBQztJQUNiLENBQUM7QUFDSCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLy8gQHRzLWlnbm9yZVxuaW1wb3J0IHR5cGUgKiBhcyB0eXBzdCBmcm9tICdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy13ZWItY29tcGlsZXInO1xuaW1wb3J0IHsgYnVpbGRDb21wb25lbnQsIHR5cGUgQ29tcG9uZW50QnVpbGRIb29rcyB9IGZyb20gJy4vaW5pdC5tanMnO1xuaW1wb3J0IHsgU2VtYW50aWNUb2tlbnMsIFNlbWFudGljVG9rZW5zTGVnZW5kLCBrT2JqZWN0IH0gZnJvbSAnLi9pbnRlcm5hbC50eXBlcy5tanMnO1xuXG5pbXBvcnQgeyBsb2FkRm9udHMsIHR5cGUgSW5pdE9wdGlvbnMgfSBmcm9tICcuL29wdGlvbnMuaW5pdC5tanMnO1xuaW1wb3J0IHsgTGF6eVdhc21Nb2R1bGUgfSBmcm9tICcuL3dhc20ubWpzJztcblxuLyoqXG4gKiBBdmFpbGFibGUgZm9ybWF0cyBmb3IgY29tcGlsaW5nIHRoZSBkb2N1bWVudC5cbiAqL1xuZXhwb3J0IHR5cGUgQ29tcGlsZUZvcm1hdCA9IGtleW9mIHR5cGVvZiBDb21waWxlRm9ybWF0RW51bTtcblxuLyoqXG4gKiBBdmFpbGFibGUgZm9ybWF0cyBmb3IgY29tcGlsaW5nIHRoZSBkb2N1bWVudC5cbiAqL1xuZXhwb3J0IGVudW0gQ29tcGlsZUZvcm1hdEVudW0ge1xuICB2ZWN0b3IgPSAwLFxuICBwZGYgPSAxLFxuICBfZHVtbXkgPSAyLFxufVxuXG5cbi8qKlxuICogVGhlIGRpYWdub3N0aWMgbWVzc2FnZSBwYXJ0aWFsbHkgZm9sbG93aW5nIHRoZSBMU1Agc3BlY2lmaWNhdGlvbi5cbiAqL1xuaW50ZXJmYWNlIERpYWdub3N0aWNNZXNzYWdlIHtcbiAgLy8gVGhlIHBhY2thZ2Ugb3duaW5nIHRoZSBwYXRoLlxuICAvLyBJZiB0aGUgcGFja2FnZSBpcyBlbXB0eSwgdGhlIHBhdGggaXMgYSByZWxhdGl2ZSBwYXRoIHRvIHRoZSAqd29ya3NwYWNlIHJvb3QqLlxuICBwYWNrYWdlOiBzdHJpbmc7XG4gIC8vIFRoZSBwYXRoIG9mIHRoZSBmaWxlLlxuICBwYXRoOiBzdHJpbmc7XG4gIC8vIFNldmVyaXR5IG9mIHRoZSBkaWFnbm9zdGljIG1lc3NhZ2UuXG4gIHNldmVyaXR5OiBzdHJpbmc7XG4gIC8vIFplcm8tYmFzZWQgbGluZSBudW1iZXIgYW5kIG9uZS1iYXNlZCBjaGFyYWN0ZXIgb2Zmc2V0LlxuICAvLyBUaGUgcmFuZ2Ugb2YgdGhlIGRpYWdub3N0aWMgbWVzc2FnZS5cbiAgLy8gSWYgdGhlIGRpYWdub3N0aWMgbWVzc2FnZSBpcyBhIHJhbmdlLCB0aGUgcmFuZ2UgaXMgaW4gdGhlIGZvcm1hdCBvZiBgc3RhcnRMaW5lOnN0YXJ0Q2hhcmFjdGVyLWVuZExpbmU6ZW5kQ2hhcmFjdGVyYC5cbiAgLy8gSWYgdGhlIGRpYWdub3N0aWMgbWVzc2FnZSBpcyBhIHBvaW50LCB0aGUgcmFuZ2UgaXMgaW4gdGhlIGZvcm1hdCBvZiBgbGluZTpjaGFyYWN0ZXJgLlxuICAvLyBPdGhlcndpc2UsIHRoZSByYW5nZSBpcyBlbXB0eS5cbiAgcmFuZ2U6IHN0cmluZztcbiAgLy8gVGhlIG1lc3NhZ2Ugb2YgdGhlIGRpYWdub3N0aWMgbWVzc2FnZS5cbiAgbWVzc2FnZTogc3RyaW5nO1xufVxuXG4vKipcbiAqIEF2YWlsYWJsZSBmb3JtYXRzIGZvciBjb21waWxpbmcgdGhlIGRvY3VtZW50LlxuICpcbiAqIElmIHNldCB0byB1bml4LCBhIGRpYWdub3N0aWNzIGlzIGluIGZvcm1hdCBvZlxuICpcbiAqIGBgYGxvZ1xuICogLy8gd2l0aCBwYWNrYWdlXG4gKiBjZXR6OjAuMi4wQGxpYi50eXA6Mjo5LTM6MTU6IGVycm9yOiB1bmV4cGVjdGVkIHR5cGUgaW4gYCtgIGFwcGxpY2F0aW9uXG4gKiAvLyB3aXRob3V0IHBhY2thZ2VcbiAqIG1haW4udHlwOjI6OS0zOjE1OiBlcnJvcjogdW5leHBlY3RlZCB0eXBlIGluIGArYCBhcHBsaWNhdGlvblxuICogYGBgXG4gKlxuICogSWYgc2V0IHRvIGxvbmcsIGEgZGlhZ25vc3RpY3MgaXMgaW4gZm9ybWF0IG9mIHtAbGluayBEaWFnbm9zdGljTWVzc2FnZX0uXG4gKlxuICogSWYgc2V0IHRvIGZ1bGwsIGEgZGlhZ25vc3RpY3MgaXMgaW4gZm9ybWF0IG9mIHtAbGluayBEaWFnbm9zdGljTWVzc2FnZX0sIGJ1dCBhbHNvIHdpdGggdHJhY2UgbWVzc2FnZXMuXG4gKi9cbmV4cG9ydCB0eXBlIERpYWdub3N0aWNzRm9ybWF0ID0gJ25vbmUnIHwgJ3VuaXgnIHwgJ2Z1bGwnO1xuXG5leHBvcnQgdHlwZSBEaWFnbm9zdGljc0RhdGEgPSB7XG4gIG5vbmU6IG5ldmVyO1xuICB1bml4OiBzdHJpbmc7XG4gIGZ1bGw6IERpYWdub3N0aWNNZXNzYWdlO1xufTtcblxuaW50ZXJmYWNlIERpYWdPcHRzPEQgZXh0ZW5kcyBEaWFnbm9zdGljc0Zvcm1hdCA9IERpYWdub3N0aWNzRm9ybWF0PiB7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIGluY2x1ZGUgZGlhZ25vc3RpYyBpbmZvcm1hdGlvbiBpbiB0aGUgcmVzdWx0LlxuICAgKiBOb3RlOiBpdCB3aWxsIGJlIHNldCB0byAnZnVsbCcgYnkgZGVmYXVsdCBpbiB2MC42LjBcbiAgICogQGRlZmF1bHQgJ2Z1bGwnXG4gICAqL1xuICBkaWFnbm9zdGljcz86IEQ7XG59XG5cbmludGVyZmFjZSBTbmFwc2hvdE9wdGlvbnMge1xuICAvKipcbiAgICogVGhlIHBhdGggb2YgdGhlIG1haW4gZmlsZS5cbiAgICovXG4gIG1haW5GaWxlUGF0aDogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHJvb3Qgb2YgdGhlIG1haW4gZmlsZS5cbiAgICovXG4gIHJvb3Q/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBBZGRzIGEgc3RyaW5nIGtleS12YWx1ZSBwYWlyIHZpc2libGUgdGhyb3VnaCBgc3lzLmlucHV0c2BcbiAgICpcbiAgICogTm90ZTogcGFzcyBge31gIHRvIGNsZWFyIGBzeXMuaW5wdXRzYFxuICAgKlxuICAgKiBOb3RlOiBXaGVuIHBhc3NpbmcgYHVuZGVmaW5lZGAsIGNvbXBpbGVyIHdpbGwgdXNlIGxhc3Qgc2V0IGBzeXMuaW5wdXRzYC5cbiAgICpcbiAgICogTm90ZTogVGhpcyBtZWFucyB5b3Ugc2hvdWxkIGFsd2F5cyBzcGVjaWZ5IGlucHV0cyB3aGVuIHVzaW5nIGNvbXBpbGVyIGZvciBjb25jdXJyZW50IHRhc2tzLlxuICAgKi9cbiAgaW5wdXRzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn1cblxuaW50ZXJmYWNlIFRyYW5zaWVudENvbXBpbGVPcHRpb25zPFxuICBGIGV4dGVuZHMgQ29tcGlsZUZvcm1hdEVudW0gPSBDb21waWxlRm9ybWF0RW51bSxcbiAgRGlhZ25vc3RpY3MgZXh0ZW5kcyBEaWFnbm9zdGljc0Zvcm1hdCA9IERpYWdub3N0aWNzRm9ybWF0LFxuPiBleHRlbmRzIFNuYXBzaG90T3B0aW9ucyxcbiAgRGlhZ09wdHM8RGlhZ25vc3RpY3M+IHtcbiAgLyoqXG4gICAqIFRoZSBmb3JtYXQgb2YgdGhlIGFydGlmYWN0LlxuICAgKiAtIENvbXBpbGVGb3JtYXRFbnVtLnZlY3RvcjogY2FuIHRoZW4gbG9hZCB0byB0aGUgcmVuZGVyZXIgdG8gcmVuZGVyIHRoZSBkb2N1bWVudC5cbiAgICogLSBDb21waWxlRm9ybWF0RW51bS5wZGY6IGZvciBmaW5hbGx5IGV4cG9ydGluZyBwZGYgdG8gdGhlIHVzZXIuXG4gICAqIFxuICAgKiBIaW50OiB5b3UgY2FuIGNvbnZlcnQgdGhlIGZvcm1hdCBmcm9tIHtAbGluayBDb21waWxlRm9ybWF0fSB0b1xuICAgKiB7QGxpbmsgQ29tcGlsZUZvcm1hdEVudW19IGJ5IGBDb21waWxlRm9ybWF0RW51bVtGb3JtYXRdYC5cbiAgICogQGRlZmF1bHQgQ29tcGlsZUZvcm1hdEVudW0udmVjdG9yXG4gICAqL1xuICBmb3JtYXQ/OiBGO1xufVxuXG5pbnRlcmZhY2UgSW5jcmVtZW50YWxDb21waWxlT3B0aW9uczxEaWFnbm9zdGljcyBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0ID0gRGlhZ25vc3RpY3NGb3JtYXQ+XG4gIGV4dGVuZHMgU25hcHNob3RPcHRpb25zLFxuICBEaWFnT3B0czxEaWFnbm9zdGljcz4ge1xuICAvKipcbiAgICogVGhlIGZvcm1hdCBvZiB0aGUgaW5jcmVtZW50YWxseSBleHBvcnRlZCBhcnRpZmFjdC5cbiAgICogQGRlZmF1bHQgJ3ZlY3RvcidcbiAgICovXG4gIGZvcm1hdD86ICd2ZWN0b3InO1xuICAvKipcbiAgICogVGhlIGluY3JlbWVudGFsIHNlcnZlciBmb3IgdGhlIGRvY3VtZW50LlxuICAgKi9cbiAgaW5jcmVtZW50YWxTZXJ2ZXI6IEluY3JlbWVudGFsU2VydmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFF1ZXJ5T3B0aW9ucyB7XG4gIC8qKlxuICAgKiBzZWxlY3QgcGFydCBvZiBkb2N1bWVudCBmb3IgcXVlcnkuXG4gICAqL1xuICBzZWxlY3Rvcjogc3RyaW5nO1xuICAvKipcbiAgICogY2FzdCByZXN1bHQgYnkgYWNjZXNzaW5nIHNpbmdsZSBmaWVsZC5cbiAgICovXG4gIGZpZWxkPzogc3RyaW5nO1xufVxuXG4vKipcbiAqIFRoZSBvcHRpb25zIGZvciBjb21waWxpbmcgdGhlIGRvY3VtZW50LlxuICovXG5leHBvcnQgdHlwZSBDb21waWxlT3B0aW9uczxcbiAgRm9ybWF0IGV4dGVuZHMgQ29tcGlsZUZvcm1hdEVudW0gPSBDb21waWxlRm9ybWF0RW51bSxcbiAgRGlhZ25vc3RpY3MgZXh0ZW5kcyBEaWFnbm9zdGljc0Zvcm1hdCA9IERpYWdub3N0aWNzRm9ybWF0LFxuPiA9IFRyYW5zaWVudENvbXBpbGVPcHRpb25zPEZvcm1hdCwgRGlhZ25vc3RpY3M+IHwgSW5jcmVtZW50YWxDb21waWxlT3B0aW9ucztcblxuZXhwb3J0IGNsYXNzIEluY3JlbWVudGFsU2VydmVyIHtcbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgW2tPYmplY3RdOiB0eXBzdC5JbmNyU2VydmVyO1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKHM6IHR5cHN0LkluY3JTZXJ2ZXIpIHtcbiAgICB0aGlzW2tPYmplY3RdID0gcztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCB0aGUgaW5jcmVtZW50YWwgc2VydmVyIHRvIHRoZSBpbml0aWFsIHN0YXRlLlxuICAgKi9cbiAgcmVzZXQoKTogdm9pZCB7XG4gICAgdGhpc1trT2JqZWN0XS5yZXNldCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybiBjdXJyZW50IHJlc3VsdC5cbiAgICovXG4gIGN1cnJlbnQoKTogVWludDhBcnJheSB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uY3VycmVudCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsc28gYXR0YWNoIHRoZSBkZWJ1ZyBpbmZvIHRvIHRoZSByZXN1bHQuXG4gICAqL1xuICBzZXRBdHRhY2hEZWJ1Z0luZm8oZW5hYmxlOiBib29sZWFuKTogdm9pZCB7XG4gICAgdGhpc1trT2JqZWN0XS5zZXRfYXR0YWNoX2RlYnVnX2luZm8oZW5hYmxlKTtcbiAgfVxufVxuXG5pbnRlcmZhY2UgQ29tcGlsZVJlc3VsdDxULCBEIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQ+IHtcbiAgcmVzdWx0PzogVDtcbiAgZGlhZ25vc3RpY3M/OiBEaWFnbm9zdGljc0RhdGFbRF1bXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUeXBzdEZvbnRJbmZvIHsgfVxuXG5lbnVtIFR5cHN0Rm9udFJlc29sdmVyQ29ucyB7IH1cbmV4cG9ydCB0eXBlIFR5cHN0Rm9udFJlc29sdmVyID0gVHlwc3RGb250UmVzb2x2ZXJDb25zO1xuXG5leHBvcnQgaW50ZXJmYWNlIFR5cHN0Rm9udEJ1aWxkZXIge1xuICAvKipcbiAgICogSW5pdGlhbGl6ZSB0aGUgZm9udCBidWlsZGVyLlxuICAgKiBAcGFyYW0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvciBpbml0aWFsaXppbmcgdGhlIGZvbnQgYnVpbGRlci5cbiAgICovXG4gIGluaXQob3B0aW9ucz86IFBhcnRpYWw8SW5pdE9wdGlvbnM+KTogUHJvbWlzZTx2b2lkPjtcbiAgLyoqXG4gICAqIEdldCB0aGUgZm9udCBpbmZvLlxuICAgKlxuICAgKiBAcGFyYW0gZm9udF9idWZmZXIgLSBUaGUgZm9udCBidWZmZXIgdG8gZ2V0IHRoZSBmb250IGluZm8uXG4gICAqIEByZXR1cm5zIHtUeXBzdEZvbnRJbmZvfSAtIFRoZSBmb250IGluZm8uXG4gICAqL1xuICBnZXRGb250SW5mbyhmb250X2J1ZmZlcjogVWludDhBcnJheSk6IFByb21pc2U8VHlwc3RGb250SW5mbz47XG4gIC8qKlxuICAgKiBBZGQgYSByYXcgZm9udC5cbiAgICpcbiAgICogQHBhcmFtIGZvbnRfYnVmZmVyIC0gVGhlIGZvbnQgYnVmZmVyIHRvIGFkZC5cbiAgICovXG4gIGFkZEZvbnREYXRhKGZvbnRfYnVmZmVyOiBVaW50OEFycmF5KTogUHJvbWlzZTx2b2lkPjtcbiAgLyoqXG4gICAqIEFkZCBhIGxhenkgZm9udC5cbiAgICpcbiAgICogQHBhcmFtIGluZm8gLSBUaGUgZm9udCBpbmZvLCB1c3VhbGx5IGZyb20ge0BsaW5rIGdldEZvbnRJbmZvfS5cbiAgICogQHBhcmFtIGJsb2IgLSBUaGUgYmxvYiBmdW5jdGlvbiB0byBnZXQgdGhlIGZvbnQgYnVmZmVyLlxuICAgKiBAcGFyYW0gY29udGV4dCAtIFRoZSBjb250ZXh0LlxuICAgKi9cbiAgYWRkTGF6eUZvbnQoXG4gICAgaW5mbzogVHlwc3RGb250SW5mbyxcbiAgICBibG9iOiAoaWR4OiBudW1iZXIpID0+IFVpbnQ4QXJyYXksXG4gICAgY29udGV4dD86IG9iamVjdCxcbiAgKTogUHJvbWlzZTx2b2lkPjtcblxuICAvKipcbiAgICogQnVpbGQgdGhlIGZvbnQgcmVzb2x2ZXIuIFRoZSBmb250IHJlc29sdmVyIHdpbGwgYmUgZnJlZWQgYWZ0ZXIgdGhlIGNhbGxiYWNrXG4gICAqIGlzIGludm9rZWQgYW5kIGJlZm9yZSByZXR1cm5pbmcgdGhlIGJ1aWxkIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBAcGFyYW0gY2IgLSBUaGUgZnVuY3Rpb24gdG8gdXNlIHRoZSBmb250IHJlc29sdmVyLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxUPn0gLSBUaGUgcmVzdWx0IG9mIHRoZSBmdW5jdGlvbi5cbiAgICovXG4gIGJ1aWxkPFQ+KGNiOiAocmVzb2x2ZXI6IFR5cHN0Rm9udFJlc29sdmVyKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPjtcbn1cblxuLyoqXG4gKiBjcmVhdGUgYSBUeXBzdCBmb250IGJ1aWxkZXIuXG4gKiBAcmV0dXJucyB7VHlwc3RGb250QnVpbGRlcn0gLSBUaGUgVHlwc3QgZm9udCBidWlsZGVyLlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGltcG9ydCB7IGNyZWF0ZVR5cHN0Rm9udEJ1aWxkZXIgfSBmcm9tICd0eXBzdCc7XG4gKiBjb25zdCBmYiA9IGNyZWF0ZVR5cHN0Rm9udEJ1aWxkZXIoKTtcbiAqIGF3YWl0IGZiLmluaXQoKTtcbiAqIGF3YWl0IGZiLmFkZEZvbnREYXRhKG5ldyBVaW50OEFycmF5KGF3YWl0IGZldGNoKCdmb250LnR0ZicpLnRoZW4ociA9PiByLmFycmF5QnVmZmVyKCkpKSk7XG4gKiBhd2FpdCBmYi5idWlsZCgpO1xuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUeXBzdEZvbnRCdWlsZGVyKCk6IFR5cHN0Rm9udEJ1aWxkZXIge1xuICByZXR1cm4gbmV3IFR5cHN0Rm9udEJ1aWxkZXJEcml2ZXIoKTtcbn1cblxuZXhwb3J0IGNsYXNzIFR5cHN0V29ybGQge1xuICBwcml2YXRlIFtrT2JqZWN0XTogdHlwc3QuVHlwc3RDb21waWxlV29ybGQ7XG5cbiAgY29uc3RydWN0b3Iod29ybGQ6IHR5cHN0LlR5cHN0Q29tcGlsZVdvcmxkKSB7XG4gICAgdGhpc1trT2JqZWN0XSA9IHdvcmxkO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXBpbGUgdGhlIHBhZ2VkIGRvY3VtZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge0RpYWdub3N0aWNzRm9ybWF0fSBmb3JtYXQgLSBUaGUgZm9ybWF0IG9mIHRoZSBkaWFnbm9zdGljcy5cbiAgICogQHJldHVybnMge1Byb21pc2U8eyBkaWFnbm9zdGljcz86IERpYWdub3N0aWNzRGF0YVtEaWFnbm9zdGljc0Zvcm1hdF1bXSB9Pn0gLSBUaGUgcmVzdWx0IG9mIHRoZSBjb21waWxhdGlvbi5cbiAgICovXG4gIGNvbXBpbGU8RCBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0ID0gJ2Z1bGwnPihcbiAgICBvcHRzPzogRGlhZ09wdHM8RD4sXG4gICk6IFByb21pc2U8Q29tcGlsZVJlc3VsdDx1bmRlZmluZWQsIEQ+ICYgeyBoYXNFcnJvcjogYm9vbGVhbiB9PiB7XG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uY29tcGlsZSgwLCBnZXREaWFnbm9zdGljc0FyZyhvcHRzPy5kaWFnbm9zdGljcykpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbXBpbGUgdGhlIHBhZ2VkIGRvY3VtZW50LlxuICAgKlxuICAgKiBAcGFyYW0ge0RpYWdub3N0aWNzRm9ybWF0fSBmb3JtYXQgLSBUaGUgZm9ybWF0IG9mIHRoZSBkaWFnbm9zdGljcy5cbiAgICogQHJldHVybnMge1Byb21pc2U8eyBkaWFnbm9zdGljcz86IERpYWdub3N0aWNzRGF0YVtEaWFnbm9zdGljc0Zvcm1hdF1bXSB9Pn0gLSBUaGUgcmVzdWx0IG9mIHRoZSBjb21waWxhdGlvbi5cbiAgICovXG4gIGNvbXBpbGVIdG1sPEQgZXh0ZW5kcyBEaWFnbm9zdGljc0Zvcm1hdCA9ICdmdWxsJz4oXG4gICAgb3B0cz86IERpYWdPcHRzPEQ+LFxuICApOiBQcm9taXNlPENvbXBpbGVSZXN1bHQ8dW5kZWZpbmVkLCBEPiAmIHsgaGFzRXJyb3I6IGJvb2xlYW4gfT4ge1xuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmNvbXBpbGUoMSwgZ2V0RGlhZ25vc3RpY3NBcmcob3B0cz8uZGlhZ25vc3RpY3MpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSdW5zIHF1ZXJ5IG9uIHRoZSBwYWdlZCBkb2N1bWVudC5cbiAgICovXG4gIGFzeW5jIHF1ZXJ5PFQgPSBhbnk+KG9wdGlvbnM6IFF1ZXJ5T3B0aW9ucyk6IFByb21pc2U8VD4ge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHRoaXNba09iamVjdF0ucXVlcnkoMCwgb3B0aW9ucy5zZWxlY3Rvciwgb3B0aW9ucy5maWVsZCkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgdGl0bGUgb2YgdGhlIHBhZ2VkIGRvY3VtZW50LlxuICAgKiBUaHJvdyBlcnJvciBpZiB0aGUgd29ybGQgZGlkbid0IGNvbXBpbGUgdGhlIHBhZ2VkIGRvY3VtZW50LlxuICAgKlxuICAgKiBAcmV0dXJucyB7c3RyaW5nIHwgdW5kZWZpbmVkfSAtIFRoZSB0aXRsZSBvZiB0aGUgcGFnZWQgZG9jdW1lbnQuXG4gICAqL1xuICB0aXRsZSgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLnRpdGxlKDApO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydCB0aGUgcGFnZWQgZG9jdW1lbnQgYXMgdmVjdG9yIGZvcm1hdC5cbiAgICpcbiAgICogQHJldHVybnMge1VpbnQ4QXJyYXkgfCB1bmRlZmluZWR9IC0gVGhlIHRpdGxlIG9mIHRoZSBwYWdlZCBkb2N1bWVudC5cbiAgICovXG4gIHZlY3RvcjxEIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQgPSAnZnVsbCc+KFxuICAgIG9wdHM/OiBEaWFnT3B0czxEPixcbiAgKTogUHJvbWlzZTxDb21waWxlUmVzdWx0PFVpbnQ4QXJyYXksIEQ+PiB7XG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0uZ2V0X2FydGlmYWN0KDAsIGdldERpYWdub3N0aWNzQXJnKG9wdHM/LmRpYWdub3N0aWNzKSkgfHwge307XG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IHRoZSBwYWdlZCBkb2N1bWVudCB0byBQREYuXG4gICAqXG4gICAqIEByZXR1cm5zIHtVaW50OEFycmF5IHwgdW5kZWZpbmVkfSAtIFRoZSB0aXRsZSBvZiB0aGUgcGFnZWQgZG9jdW1lbnQuXG4gICAqL1xuICBwZGY8RCBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0ID0gJ2Z1bGwnPihcbiAgICBvcHRzPzogRGlhZ09wdHM8RD4sXG4gICk6IFByb21pc2U8Q29tcGlsZVJlc3VsdDxVaW50OEFycmF5LCBEPj4ge1xuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmdldF9hcnRpZmFjdCgxLCBnZXREaWFnbm9zdGljc0FyZyhvcHRzPy5kaWFnbm9zdGljcykpIHx8IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIENoYW5nZSB0aGUgUERGIG9wdGlvbnMuXG4gICAqIFxuICAgKiBAcGFyYW0gb3B0cyBSZW5kZXJQZGZPcHRzXG4gICAqL1xuICBzZXRQZGZPcHRzKG9wdHM6IGFueSk6IHZvaWQge1xuICAgIHRoaXNba09iamVjdF0uc2V0X3BkZl9vcHRzKG9wdHMpO1xuICB9XG59XG5cbi8qKlxuICogVGhlIGludGVyZmFjZSBvZiBUeXBzdCBjb21waWxlci5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUeXBzdENvbXBpbGVyIHtcbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIHR5cHN0IGNvbXBpbGVyLlxuICAgKiBAcGFyYW0ge1BhcnRpYWw8SW5pdE9wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yIGluaXRpYWxpemluZyB0aGVcbiAgICogdHlwc3QgY29tcGlsZXIuXG4gICAqL1xuICBpbml0KG9wdGlvbnM/OiBQYXJ0aWFsPEluaXRPcHRpb25zPik6IFByb21pc2U8dm9pZD47XG5cbiAgLyoqXG4gICAqIFJlc2V0IHRoZSB0eXBzdCBjb21waWxlciB0byB0aGUgaW5pdGlhbCBzdGF0ZS5cbiAgICogTm90ZTogd2l0aG91dCBjYWxsaW5nIHRoaXMgZnVuY3Rpb24sIHRoZSBjb21waWxlciB3aWxsIGFsd2F5cyBrZWVwIGNhY2hlc1xuICAgKiBzdWNoIGFzOlxuICAgKiAtIGxvYWRlZCBmb250c1xuICAgKiAtIHNvdXJjZSBmaWxlcyBjb3JyZXNwb25kaW5nIHRvIHR5cHN0IG1vZHVsZXNcbiAgICpcbiAgICogTm90ZTogdGhpcyBmdW5jdGlvbiBpcyBpbmRlcGVuZGVudCB0byB0aGUge0BsaW5rIHJlc2V0U2hhZG93fSBmdW5jdGlvbi5cbiAgICogVGhpcyBpcyBpbnRlbmRlZCB0byBvcHRpbWl6ZSB0aGUgcGVyZm9ybWFuY2Ugb2YgdGhlIGNvbXBpbGVyLlxuICAgKi9cbiAgcmVzZXQoKTogUHJvbWlzZTx2b2lkPjtcblxuICAvKipcbiAgICogIFNldCBQREYgY29tcGlsYXRpb24gb3B0aW9ucy5cbiAgICogTm90ZTogVGhpcyBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgaW5pdCgpIHRvIHRha2UgZWZmZWN0IGR1cmluZyBjb21waWxlciBidWlsZC5cbiAgICogQHBhcmFtIHthbnl9IG9wdHMgLSBUaGUgUERGIG9wdGlvbnMgdG8gc2V0LlxuICAgKi9cbiAgc2V0UGRmT3B0cyhvcHRzOiBhbnkpOiB2b2lkO1xuXG4gIHNldFBkZk9wdHNGb3JOZXh0Q29tcGlsZShvcHRzOiBhbnkpOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBDb21waWxlIGFuIGRvY3VtZW50IHdpdGggdGhlIG1haW50YWluZWQgc3RhdGUuXG4gICAqIEBwYXJhbSB7Q29tcGlsZU9wdGlvbnN9IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3IgY29tcGlsaW5nIHRoZSBkb2N1bWVudC5cbiAgICogQHJldHVybnMge1Byb21pc2U8VWludDhBcnJheT59IC0gYXJ0aWZhY3QgaW4gdmVjdG9yIGZvcm1hdC5cbiAgICogWW91IGNhbiB0aGVuIGxvYWQgdGhlIGFydGlmYWN0IHRvIHRoZSByZW5kZXJlciB0byByZW5kZXIgdGhlIGRvY3VtZW50LlxuICAgKi9cbiAgY29tcGlsZTxEIGV4dGVuZHMgRGlhZ25vc3RpY3NGb3JtYXQ+KFxuICAgIG9wdGlvbnM6IENvbXBpbGVPcHRpb25zPENvbXBpbGVGb3JtYXRFbnVtLnZlY3RvciwgRD4sXG4gICk6IFByb21pc2U8Q29tcGlsZVJlc3VsdDxVaW50OEFycmF5LCBEPj47XG4gIGNvbXBpbGU8RCBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0PihcbiAgICBvcHRpb25zOiBDb21waWxlT3B0aW9uczxDb21waWxlRm9ybWF0RW51bS5wZGYsIEQ+LFxuICApOiBQcm9taXNlPENvbXBpbGVSZXN1bHQ8VWludDhBcnJheSwgRD4+O1xuICBjb21waWxlPEYgZXh0ZW5kcyBDb21waWxlRm9ybWF0RW51bSwgRCBleHRlbmRzIERpYWdub3N0aWNzRm9ybWF0PihcbiAgICBvcHRpb25zOiBDb21waWxlT3B0aW9uczxGLCBEPixcbiAgKTogUHJvbWlzZTxDb21waWxlUmVzdWx0PFVpbnQ4QXJyYXksIEQ+PjtcblxuICBydW5XaXRoV29ybGQ8VD4ob3B0aW9uczogU25hcHNob3RPcHRpb25zLCBjYjogKHdvcmxkOiBUeXBzdFdvcmxkKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPjtcblxuICAvKipcbiAgICogU2V0IHRoZSBmb250cyB0byB0aGUgY29tcGlsZXIuIE5vdGU6IG11bHRpcGxlIGNvbXBpbGVycyBjYW4gc2hhcmUgdGhlIHNhbWUgZm9udHMuXG4gICAqXG4gICAqIEBwYXJhbSB7VHlwc3RGb250UmVzb2x2ZXJ9IGZvbnRzIC0gVGhlIGZvbnRzIHRvIHNldC5cbiAgICovXG4gIHNldEZvbnRzKGZvbnRzOiBUeXBzdEZvbnRSZXNvbHZlcik6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIGV4cGVyaW1lbnRhbFxuICAgKiBRdWVyeSB0aGUgcmVzdWx0IHdpdGggZG9jdW1lbnRcbiAgICovXG4gIHF1ZXJ5PFQ+KG9wdGlvbnM6IFF1ZXJ5T3B0aW9ucyAmIFNuYXBzaG90T3B0aW9ucyk6IFByb21pc2U8VD47XG5cbiAgLyoqXG4gICAqIFByaW50IHRoZSBBU1Qgb2YgdGhlIG1haW4gZmlsZS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG1haW5GaWxlUGF0aCAtIFRoZSBwYXRoIG9mIHRoZSBtYWluIGZpbGUuXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPHN0cmluZz59IC0gYW4gc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBBU1QuXG4gICAqL1xuICBnZXRBc3QobWFpbkZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz47XG5cbiAgLyoqXG4gICAqIEFkZCBhIHNvdXJjZSBmaWxlIHRvIHRoZSBjb21waWxlci5cbiAgICogQHBhcmFtIHtzdHJpbmd9IHBhdGggLSBUaGUgcGF0aCBvZiB0aGUgc291cmNlIGZpbGUuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2UgLSBUaGUgc291cmNlIGNvZGUgb2YgdGhlIHNvdXJjZSBmaWxlLlxuICAgKlxuICAgKi9cbiAgYWRkU291cmNlKHBhdGg6IHN0cmluZywgc291cmNlOiBzdHJpbmcpOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBBZGQgYSBzaGFkb3cgZmlsZSB0byB0aGUgY29tcGlsZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gVGhlIHBhdGggdG8gdGhlIHNoYWRvdyBmaWxlLlxuICAgKiBAcGFyYW0ge1VpbnQ4QXJyYXl9IGNvbnRlbnQgLSBUaGUgY29udGVudCBvZiB0aGUgc2hhZG93IGZpbGUuXG4gICAqXG4gICAqL1xuICBtYXBTaGFkb3cocGF0aDogc3RyaW5nLCBjb250ZW50OiBVaW50OEFycmF5KTogdm9pZDtcblxuICAvKipcbiAgICogUmVtb3ZlIGEgc2hhZG93IGZpbGUgZnJvbSB0aGUgY29tcGlsZXIuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwYXRoIC0gVGhlIHBhdGggdG8gdGhlIHNoYWRvdyBmaWxlLlxuICAgKi9cbiAgdW5tYXBTaGFkb3cocGF0aDogc3RyaW5nKTogdm9pZDtcblxuICAvKipcbiAgICogUmVzZXQgdGhlIHNoYWRvdyBmaWxlcy5cbiAgICogTm90ZTogdGhpcyBmdW5jdGlvbiBpcyBpbmRlcGVuZGVudCB0byB0aGUge0BsaW5rIHJlc2V0fSBmdW5jdGlvbi5cbiAgICovXG4gIHJlc2V0U2hhZG93KCk6IHZvaWQ7XG5cbiAgLyoqXG4gICAqIGV4cGVyaW1lbnRhbFxuICAgKiBTZWUgU2VtYW50aWMgdG9rZW5zOiBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L3ZzY29kZS9pc3N1ZXMvODY0MTVcbiAgICovXG4gIGdldFNlbWFudGljVG9rZW5MZWdlbmQoKTogUHJvbWlzZTxTZW1hbnRpY1Rva2Vuc0xlZ2VuZD47XG5cbiAgLyoqXG4gICAqIGV4cGVyaW1lbnRhbFxuICAgKiBTZWUgU2VtYW50aWMgdG9rZW5zOiBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L3ZzY29kZS9pc3N1ZXMvODY0MTVcbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdHMubWFpbkZpbGVQYXRoIC0gVGhlIHBhdGggb2YgdGhlIG1haW4gZmlsZS5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdHMucmVzdWx0SWQgLSBUaGUgaWQgb2YgdGhlIHJlc3VsdC5cbiAgICogQHBhcmFtIHtzdHJpbmd9IG9wdHMub2Zmc2V0RW5jb2RpbmcgLSBUaGUgZW5jb2Rpbmcgb2YgdGhlIG9mZnNldC5cbiAgICogICAtICd1dGYtMTYnOiB0aGUgb2Zmc2V0IGlzIGVuY29kZWQgaW4gdXRmLTE2LlxuICAgKiAgIC0gJ3V0Zi04JzogdGhlIG9mZnNldCBpcyBlbmNvZGVkIGluIHV0Zi04LlxuICAgKiAgIEBkZWZhdWx0ICd1dGYtMTYnXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPFNlbWFudGljVG9rZW5zPn0gLSBUaGUgc2VtYW50aWMgdG9rZW5zLlxuICAgKi9cbiAgZ2V0U2VtYW50aWNUb2tlbnMob3B0czoge1xuICAgIG1haW5GaWxlUGF0aDogc3RyaW5nO1xuICAgIHJlc3VsdElkPzogc3RyaW5nO1xuICAgIG9mZnNldEVuY29kaW5nPzogc3RyaW5nO1xuICB9KTogUHJvbWlzZTxTZW1hbnRpY1Rva2Vucz47XG5cbiAgLyoqXG4gICAqIGV4cGVyaW1lbnRhbFxuICAgKiBSdW4gd2l0aCBhbiBpbmNyZW1lbnRhbCBzZXJ2ZXIgd2hpY2ggaG9sZHMgdGhlIHN0YXRlIG9mIHRoZSBkb2N1bWVudCBpbiB3YXNtLlxuICAgKlxuICAgKiBAcGFyYW0ge2Z1bmN0aW9uKEluY3JlbWVudGFsU2VydmVyKTogUHJvbWlzZTxUPn0gZiAtIFRoZSBmdW5jdGlvbiB0byBydW4gd2l0aCB0aGUgaW5jcmVtZW50YWwgc2VydmVyLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxUPn0gLSBUaGUgcmVzdWx0IG9mIHRoZSBmdW5jdGlvbi5cbiAgICpcbiAgICogTm90ZTogdGhlIGluY3JlbWVudGFsIHNlcnZlciB3aWxsIGJlIGZyZWVkIGFmdGVyIHRoZSBmdW5jdGlvbiBpcyBmaW5pc2hlZC5cbiAgICovXG4gIHdpdGhJbmNyZW1lbnRhbFNlcnZlcjxUPihmOiAoczogSW5jcmVtZW50YWxTZXJ2ZXIpID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+O1xufVxuXG5jb25zdCBnQ29tcGlsZXJNb2R1bGUgPSAobW9kdWxlOiB0eXBlb2YgdHlwc3QpID0+XG4gIG5ldyBMYXp5V2FzbU1vZHVsZShhc3luYyAoYmluPzogYW55KSA9PiB7XG4gICAgcmV0dXJuIGF3YWl0IG1vZHVsZS5kZWZhdWx0KGJpbik7XG4gIH0pO1xuXG4vKipcbiAqIGNyZWF0ZSBhIFR5cHN0IGNvbXBpbGVyLlxuICogQHJldHVybnMge1R5cHN0Q29tcGlsZXJ9IC0gVGhlIFR5cHN0IGNvbXBpbGVyLlxuICogQGV4YW1wbGVcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGltcG9ydCB7IGNyZWF0ZVR5cHN0Q29tcGlsZXIgfSBmcm9tICd0eXBzdCc7XG4gKiBjb25zdCBjb21waWxlciA9IGNyZWF0ZVR5cHN0Q29tcGlsZXIoKTtcbiAqIGF3YWl0IGNvbXBpbGVyLmluaXQoKTtcbiAqIGNvbXBpbGVyLmFkZFNvdXJjZSgnL21haW4udHlwJywgJ0hlbGxvLCB0eXBzdCEnKTtcbiAqIGF3YWl0IGNvbXBpbGVyLmNvbXBpbGUoeyBtYWluRmlsZVBhdGg6ICcvbWFpbi50eXAnIH0pO1xuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVUeXBzdENvbXBpbGVyKCk6IFR5cHN0Q29tcGlsZXIge1xuICByZXR1cm4gbmV3IFR5cHN0Q29tcGlsZXJEcml2ZXIoKTtcbn1cblxuZXhwb3J0IGNsYXNzIFR5cHN0Rm9udEJ1aWxkZXJEcml2ZXIgaW1wbGVtZW50cyBUeXBzdEZvbnRCdWlsZGVyIHtcbiAgcHJpdmF0ZSBmb250QnVpbGRlckpzOiB0eXBlb2YgdHlwc3Q7XG4gIHByaXZhdGUgZm9udEJ1aWxkZXI6IHR5cHN0LlR5cHN0Rm9udFJlc29sdmVyQnVpbGRlcjtcblxuICBhc3luYyBpbml0KG9wdGlvbnM/OiBQYXJ0aWFsPEluaXRPcHRpb25zPik6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuZm9udEJ1aWxkZXJKcyA9IGF3YWl0IChvcHRpb25zPy5nZXRXcmFwcGVyPy4oKSB8fCBpbXBvcnQoJ0BteXJpYWRkcmVhbWluL3R5cHN0LXRzLXdlYi1jb21waWxlcicpKTtcbiAgICAvLy8gaW5pdCB0eXBzdCB3YXNtIG1vZHVsZVxuICAgIGF3YWl0IGdDb21waWxlck1vZHVsZSh0aGlzLmZvbnRCdWlsZGVySnMpLmluaXQob3B0aW9ucz8uZ2V0TW9kdWxlPy4oKSk7XG5cbiAgICB0aGlzLmZvbnRCdWlsZGVyID0gbmV3IHRoaXMuZm9udEJ1aWxkZXJKcy5UeXBzdEZvbnRSZXNvbHZlckJ1aWxkZXIoKTtcbiAgfVxuXG4gIGFzeW5jIGdldEZvbnRJbmZvKGZvbnRfYnVmZmVyOiBVaW50OEFycmF5KTogUHJvbWlzZTxUeXBzdEZvbnRJbmZvPiB7XG4gICAgcmV0dXJuIHRoaXMuZm9udEJ1aWxkZXIuZ2V0X2ZvbnRfaW5mbyhmb250X2J1ZmZlcikgYXMgVHlwc3RGb250SW5mbztcbiAgfVxuXG4gIGFzeW5jIGFkZEZvbnREYXRhKGZvbnRfYnVmZmVyOiBVaW50OEFycmF5KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdGhpcy5mb250QnVpbGRlci5hZGRfcmF3X2ZvbnQoZm9udF9idWZmZXIpO1xuICB9XG4gIGFzeW5jIGFkZExhenlGb250PEMgZXh0ZW5kcyBUeXBzdEZvbnRJbmZvPihcbiAgICBpbmZvOiBUeXBzdEZvbnRJbmZvLFxuICAgIGJsb2I6ICh0aGlzOiBDLCBpZHg6IG51bWJlcikgPT4gVWludDhBcnJheSxcbiAgKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuZm9udEJ1aWxkZXIuYWRkX2xhenlfZm9udChpbmZvLCBibG9iKTtcbiAgfVxuICBhc3luYyBidWlsZDxUPihjYjogKHJlc29sdmVyOiBUeXBzdEZvbnRSZXNvbHZlcikgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IGZvbnRzID0gYXdhaXQgdGhpcy5mb250QnVpbGRlci5idWlsZCgpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNiKGZvbnRzIGFzIGFueSBhcyBUeXBzdEZvbnRSZXNvbHZlcik7XG4gICAgZm9udHMuZnJlZSgpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbn1cblxuY2xhc3MgVHlwc3RDb21waWxlckRyaXZlciBpbXBsZW1lbnRzIFR5cHN0Q29tcGlsZXIge1xuICBjb21waWxlcjogdHlwc3QuVHlwc3RDb21waWxlcjtcbiAgY29tcGlsZXJKczogdHlwZW9mIHR5cHN0O1xuICBwcml2YXRlIHBkZk9wdHM6IGFueTtcblxuICBzdGF0aWMgZGVmYXVsdEFzc2V0cyA9IFsndGV4dCcgYXMgY29uc3RdO1xuXG4gIGNvbnN0cnVjdG9yKCkgeyB9XG5cbiAgYXN5bmMgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmNvbXBpbGVySnMgPSBhd2FpdCAob3B0aW9ucz8uZ2V0V3JhcHBlcj8uKCkgfHwgaW1wb3J0KCdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy13ZWItY29tcGlsZXInKSk7XG4gICAgY29uc3QgVHlwc3RDb21waWxlckJ1aWxkZXIgPSB0aGlzLmNvbXBpbGVySnMuVHlwc3RDb21waWxlckJ1aWxkZXI7XG5cbiAgICBjb25zdCBjb21waWxlck9wdGlvbnMgPSB7IC4uLihvcHRpb25zIHx8IHt9KSB9O1xuICAgIGNvbnN0IGJlZm9yZUJ1aWxkID0gKGNvbXBpbGVyT3B0aW9ucy5iZWZvcmVCdWlsZCA/Pz0gW10pO1xuICAgIGNvbnN0IGhhc1ByZWxvYWRSZW1vdGVGb250cyA9IGJlZm9yZUJ1aWxkLnNvbWUoXG4gICAgICAoZm46IGFueSkgPT4gZm4uX3ByZWxvYWRSZW1vdGVGb250T3B0aW9ucyAhPT0gdW5kZWZpbmVkLFxuICAgICk7XG4gICAgY29uc3QgaGFzU3BlY2lmaWVkQXNzZXRzID0gYmVmb3JlQnVpbGQuc29tZShcbiAgICAgIChmbjogYW55KSA9PiBmbi5fcHJlbG9hZFJlbW90ZUZvbnRPcHRpb25zPy5hc3NldHMgIT09IHVuZGVmaW5lZCxcbiAgICApO1xuICAgIGNvbnN0IGhhc0Rpc2FibGVBc3NldHMgPSBiZWZvcmVCdWlsZC5zb21lKFxuICAgICAgKGZuOiBhbnkpID0+IGZuLl9wcmVsb2FkUmVtb3RlRm9udE9wdGlvbnM/LmFzc2V0cyA9PT0gZmFsc2UsXG4gICAgKTtcblxuICAgIGlmICghaGFzUHJlbG9hZFJlbW90ZUZvbnRzIHx8ICghaGFzU3BlY2lmaWVkQXNzZXRzICYmICFoYXNEaXNhYmxlQXNzZXRzKSkge1xuICAgICAgYmVmb3JlQnVpbGQucHVzaChsb2FkRm9udHMoW10sIHsgYXNzZXRzOiBUeXBzdENvbXBpbGVyRHJpdmVyLmRlZmF1bHRBc3NldHMgfSkpO1xuICAgIH1cblxuICAgIGNvbnN0IGhhc0ZvbnRMb2FkZXIgPSBiZWZvcmVCdWlsZC5zb21lKChmbjogYW55KSA9PiBmbi5fa2luZCA9PT0gJ2ZvbnRMb2FkZXInKTtcbiAgICBpZiAoIWhhc0ZvbnRMb2FkZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ1R5cHN0Q29tcGlsZXI6IG5vIGZvbnQgbG9hZGVyIGZvdW5kLCBwbGVhc2UgdXNlIGZvbnQgbG9hZGVycywgZS5nLiBsb2FkRm9udHMgb3IgcHJlbG9hZFN5c3RlbUZvbnRzJyxcbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgaG9va3M6IENvbXBvbmVudEJ1aWxkSG9va3MgPSB7fTtcbiAgICBpZiAodGhpcy5wZGZPcHRzKSB7XG4gICAgICBob29rcy5sYXRlbHlCdWlsZCA9IChjdHg6IGFueSkgPT4ge1xuICAgICAgICBjdHguYnVpbGRlci5zZXRfcGRmX29wdHModGhpcy5wZGZPcHRzKTtcbiAgICAgIH07XG4gICAgfVxuXG4gICAgdGhpcy5jb21waWxlciA9IGF3YWl0IGJ1aWxkQ29tcG9uZW50KG9wdGlvbnMsIGdDb21waWxlck1vZHVsZSh0aGlzLmNvbXBpbGVySnMpLCBUeXBzdENvbXBpbGVyQnVpbGRlciwgaG9va3MpO1xuICB9XG5cbiAgc2V0UGRmT3B0cyhvcHRzOiBhbnkpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb21waWxlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdzZXRQZGZPcHRzIG11c3QgYmUgY2FsbGVkIGJlZm9yZSBpbml0KCknKTtcbiAgICB9XG4gICAgdGhpcy5wZGZPcHRzID0gb3B0cztcbiAgfVxuXG4gIHNldFBkZk9wdHNGb3JOZXh0Q29tcGlsZShvcHRzOiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLnBkZk9wdHMgPSBvcHRzO1xuICB9XG5cbiAgc2V0Rm9udHMoZm9udHM6IFR5cHN0Rm9udFJlc29sdmVyKTogdm9pZCB7XG4gICAgdGhpcy5jb21waWxlci5zZXRfZm9udHMoZm9udHMgYXMgYW55IGFzIHR5cHN0LlR5cHN0Rm9udFJlc29sdmVyKTtcbiAgfVxuXG4gIGNvbXBpbGUob3B0aW9uczogQ29tcGlsZU9wdGlvbnMpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIGNvbnN0IHdvcmxkID0gdGhpcy5jb21waWxlci5zbmFwc2hvdChcbiAgICAgICAgb3B0aW9ucy5yb290LFxuICAgICAgICBvcHRpb25zLm1haW5GaWxlUGF0aCxcbiAgICAgICAgY29udmVydElucHV0cyhvcHRpb25zLmlucHV0cyksXG4gICAgICApO1xuXG4gICAgICBpZiAodGhpcy5wZGZPcHRzKSB7XG4gICAgICAgIHdvcmxkLnNldF9wZGZfb3B0cyh0aGlzLnBkZk9wdHMpO1xuICAgICAgfVxuXG4gICAgICBpZiAoJ2luY3JlbWVudGFsU2VydmVyJyBpbiBvcHRpb25zKSB7XG4gICAgICAgIHJlc29sdmUoXG4gICAgICAgICAgd29ybGQuaW5jcl9jb21waWxlKFxuICAgICAgICAgICAgb3B0aW9ucy5pbmNyZW1lbnRhbFNlcnZlcltrT2JqZWN0XSxcbiAgICAgICAgICAgIGdldERpYWdub3N0aWNzQXJnKG9wdGlvbnMuZGlhZ25vc3RpY3MpLFxuICAgICAgICAgICksXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHJlc29sdmUoXG4gICAgICAgIHdvcmxkLmdldF9hcnRpZmFjdChvcHRpb25zLmZvcm1hdCB8fCBDb21waWxlRm9ybWF0RW51bS52ZWN0b3IsIGdldERpYWdub3N0aWNzQXJnKG9wdGlvbnMuZGlhZ25vc3RpY3MpKSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBydW5XaXRoV29ybGQ8VD4oXG4gICAgb3B0aW9uczogU25hcHNob3RPcHRpb25zLFxuICAgIGNiOiAod29ybGQ6IFR5cHN0V29ybGQpID0+IFByb21pc2U8VD4sXG4gICk6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IHdvcmxkID0gdGhpcy5jb21waWxlci5zbmFwc2hvdChcbiAgICAgIG9wdGlvbnMucm9vdCxcbiAgICAgIG9wdGlvbnMubWFpbkZpbGVQYXRoLFxuICAgICAgY29udmVydElucHV0cyhvcHRpb25zLmlucHV0cyksXG4gICAgKTtcbiAgICBsZXQgcmVzdWx0ID0gYXdhaXQgY2IobmV3IFR5cHN0V29ybGQod29ybGQpKTtcbiAgICB3b3JsZC5mcmVlKCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHF1ZXJ5KG9wdGlvbnM6IFF1ZXJ5T3B0aW9ucyAmIFNuYXBzaG90T3B0aW9ucyk6IFByb21pc2U8YW55PiB7XG4gICAgcmV0dXJuIHRoaXMucnVuV2l0aFdvcmxkKG9wdGlvbnMsIGFzeW5jIHdvcmxkID0+IHtcbiAgICAgIHJldHVybiBKU09OLnBhcnNlKGF3YWl0IHdvcmxkLnF1ZXJ5KG9wdGlvbnMpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFNlbWFudGljVG9rZW5MZWdlbmQoKTogUHJvbWlzZTxTZW1hbnRpY1Rva2Vuc0xlZ2VuZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZTxTZW1hbnRpY1Rva2Vuc0xlZ2VuZD4ocmVzb2x2ZSA9PiB7XG4gICAgICByZXNvbHZlKHRoaXMuY29tcGlsZXIuZ2V0X3NlbWFudGljX3Rva2VuX2xlZ2VuZCgpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGdldFNlbWFudGljVG9rZW5zKG9wdHM6IHtcbiAgICBtYWluRmlsZVBhdGg6IHN0cmluZztcbiAgICByZXN1bHRJZD86IHN0cmluZztcbiAgICBvZmZzZXRFbmNvZGluZz86IHN0cmluZztcbiAgfSk6IFByb21pc2U8U2VtYW50aWNUb2tlbnM+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2U8U2VtYW50aWNUb2tlbnM+KHJlc29sdmUgPT4ge1xuICAgICAgdGhpcy5jb21waWxlci5yZXNldCgpO1xuICAgICAgcmVzb2x2ZShcbiAgICAgICAgdGhpcy5jb21waWxlci5nZXRfc2VtYW50aWNfdG9rZW5zKFxuICAgICAgICAgIG9wdHMub2Zmc2V0RW5jb2RpbmcgfHwgJ3V0Zi0xNicsXG4gICAgICAgICAgb3B0cy5tYWluRmlsZVBhdGgsXG4gICAgICAgICAgb3B0cy5yZXN1bHRJZCxcbiAgICAgICAgKSBhcyBhbnksXG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgd2l0aEluY3JlbWVudGFsU2VydmVyPFQ+KGY6IChzOiBJbmNyZW1lbnRhbFNlcnZlcikgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IHNydiA9IG5ldyBJbmNyZW1lbnRhbFNlcnZlcih0aGlzLmNvbXBpbGVyLmNyZWF0ZV9pbmNyX3NlcnZlcigpKTtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGYoc3J2KTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgc3J2W2tPYmplY3RdLmZyZWUoKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRBc3QobWFpbkZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLmNvbXBpbGVyLmdldF9hc3QobWFpbkZpbGVQYXRoKTtcbiAgfVxuXG4gIGFzeW5jIHJlc2V0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IG5ldyBQcm9taXNlPHZvaWQ+KHJlc29sdmUgPT4ge1xuICAgICAgdGhpcy5jb21waWxlci5yZXNldCgpO1xuICAgICAgcmVzb2x2ZSh1bmRlZmluZWQpO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkU291cmNlKHBhdGg6IHN0cmluZywgc291cmNlOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgJ3VzZSBvZiBhZGRTb3VyY2UocGF0aCwgc291cmNlLCBpc01haW4pIGlzIGRlcHJlY2F0ZWQsIHBsZWFzZSB1c2UgYWRkU291cmNlKHBhdGgsIHNvdXJjZSkgaW5zdGVhZCcsXG4gICAgICApO1xuICAgIH1cblxuICAgIHRoaXMuY29tcGlsZXIuYWRkX3NvdXJjZShwYXRoLCBzb3VyY2UpO1xuICB9XG5cbiAgbWFwU2hhZG93KHBhdGg6IHN0cmluZywgY29udGVudDogVWludDhBcnJheSk6IHZvaWQge1xuICAgIHRoaXMuY29tcGlsZXIubWFwX3NoYWRvdyhwYXRoLCBjb250ZW50KTtcbiAgfVxuXG4gIHVubWFwU2hhZG93KHBhdGg6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuY29tcGlsZXIudW5tYXBfc2hhZG93KHBhdGgpO1xuICB9XG5cbiAgcmVzZXRTaGFkb3coKTogdm9pZCB7XG4gICAgdGhpcy5jb21waWxlci5yZXNldF9zaGFkb3coKTtcbiAgfVxuXG4gIHJlbmRlclBhZ2VUb0NhbnZhcygpOiBQcm9taXNlPGFueT4ge1xuICAgIHRocm93IG5ldyBFcnJvcignUGxlYXNlIHVzZSB0aGUgYXBpIFR5cHN0UmVuZGVyZXIucmVuZGVyVG9DYW52YXMgaW4gdjAuNC4wJyk7XG4gIH1cbn1cbmNyZWF0ZVR5cHN0Q29tcGlsZXIuX2ltcGwgPSBUeXBzdENvbXBpbGVyRHJpdmVyO1xuXG4vLyB0b2RvOiBjYWNoaW5nIGlucHV0c1xuZnVuY3Rpb24gY29udmVydElucHV0cyhpbnB1dHM/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KTogW3N0cmluZywgc3RyaW5nXVtdIHwgdW5kZWZpbmVkIHtcbiAgcmV0dXJuIGlucHV0cyA/IE9iamVjdC5lbnRyaWVzKGlucHV0cykgOiB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIGdldERpYWdub3N0aWNzQXJnKGRpYWdub3N0aWNzOiBzdHJpbmcgfCB1bmRlZmluZWQpOiBudW1iZXIge1xuICBzd2l0Y2ggKGRpYWdub3N0aWNzKSB7XG4gICAgY2FzZSAnbm9uZSc6XG4gICAgICByZXR1cm4gMTtcbiAgICBjYXNlICd1bml4JzpcbiAgICAgIHJldHVybiAyO1xuICAgIGNhc2UgJ2Z1bGwnOlxuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gMztcbiAgfVxufVxuIl19","import { TypstDefaultParams } from '../../internal.types.mjs';\n/** @internal */\nexport class RenderView {\n    pageInfos;\n    loadPageCount;\n    imageScaleFactor;\n    container;\n    canvasList;\n    textLayerList;\n    commonList;\n    textLayerParentList;\n    semanticLayerList;\n    constructor(pageInfos, container, options) {\n        this.pageInfos = pageInfos;\n        this.imageScaleFactor = options.pixelPerPt ?? TypstDefaultParams.PIXEL_PER_PT;\n        container.innerHTML = '';\n        container.style.width = '100%';\n        // canvas[data-typst-session='{}']\n        /// refer html elements\n        this.container = container;\n        this.canvasList = new Array(this.loadPageCount);\n        this.textLayerList = new Array(this.loadPageCount);\n        this.commonList = new Array(this.loadPageCount);\n        this.textLayerParentList = new Array(this.loadPageCount);\n        this.semanticLayerList = new Array(this.loadPageCount);\n        const createOver = (i, pageAst, commonDiv) => {\n            const width = Math.ceil(pageAst.width) * this.imageScaleFactor;\n            const height = Math.ceil(pageAst.height) * this.imageScaleFactor;\n            const canvas = (this.canvasList[i] = document.createElement('canvas'));\n            const semanticLayer = (this.semanticLayerList[i] = document.createElement('div'));\n            const textLayer = (this.textLayerList[i] = document.createElement('div'));\n            const textLayerParent = (this.textLayerParentList[i] = document.createElement('div'));\n            const ctx = canvas.getContext('2d');\n            if (ctx) {\n                const canvasDiv = document.createElement('div');\n                canvas.width = width;\n                canvas.height = height;\n                canvasDiv.appendChild(canvas);\n                // canvasDiv.style.zIndex = '-1';\n                // canvas.style.zIndex = '-1';\n                commonDiv.appendChild(canvasDiv);\n                canvasDiv.style.position = 'absolute';\n            }\n            {\n                textLayerParent.appendChild(textLayer);\n                textLayerParent.className = 'typst-html-semantics';\n                /// on width change\n                const containerWidth = container.offsetWidth;\n                const originalScale = containerWidth / pageAst.width;\n                textLayerParent.style.width = `${containerWidth}px`;\n                textLayerParent.style.height = `${pageAst.height * originalScale}px`;\n                // --data-text-width\n                textLayerParent.style.setProperty('--data-text-width', `${originalScale}px`);\n                textLayerParent.style.setProperty('--data-text-height', `${originalScale}px`);\n                // textLayerParent.style.position = 'absolute';\n                commonDiv.classList.add('typst-page');\n                commonDiv.classList.add('canvas');\n                commonDiv.style.width = `${containerWidth}px`;\n                commonDiv.style.height = `${height * originalScale}px`;\n                commonDiv.style.position = 'relative';\n                // textLayerParent.style.zIndex = '1';\n                semanticLayer.appendChild(textLayerParent);\n                commonDiv.appendChild(semanticLayer);\n            }\n        };\n        for (let i = 0; i < this.pageInfos.length; i++) {\n            const pageAst = this.pageInfos[i];\n            // const commonDiv = document.createElement('div');\n            let commonDiv = undefined;\n            commonDiv = this.commonList[i] = document.createElement('div');\n            container.appendChild(commonDiv);\n            createOver(i, pageAst, commonDiv);\n        }\n    }\n    resetLayout() {\n        /// resize again to avoid bad width change after render\n        for (let i = 0; i < this.pageInfos.length; i++) {\n            const pageAst = this.pageInfos[i];\n            const width = Math.ceil(pageAst.width) * this.imageScaleFactor;\n            const height = Math.ceil(pageAst.height) * this.imageScaleFactor;\n            const canvasDiv = this.canvasList[i].parentElement;\n            if (!canvasDiv) {\n                throw new Error(`canvasDiv is null for page ${i}, canvas list length ${this.canvasList.length}`);\n            }\n            const commonDiv = this.commonList[i];\n            const textLayerParent = this.textLayerParentList[i];\n            /// on width change\n            const containerWidth = this.container.offsetWidth;\n            const originalScale = containerWidth / width;\n            textLayerParent.style.width = `${containerWidth}px`;\n            textLayerParent.style.height = `${height * originalScale}px`;\n            commonDiv.style.width = `${containerWidth}px`;\n            commonDiv.style.height = `${height * originalScale}px`;\n            // compute scaling factor according to the paper size\n            const currentScale = this.container.offsetWidth / width;\n            canvasDiv.style.transformOrigin = '0px 0px';\n            canvasDiv.style.transform = `scale(${currentScale})`;\n        }\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmlldy5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvcmVuZGVyL2NhbnZhcy92aWV3Lm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQVksa0JBQWtCLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUl4RSxnQkFBZ0I7QUFDaEIsTUFBTSxPQUFPLFVBQVU7SUFZWjtJQVhULGFBQWEsQ0FBUztJQUN0QixnQkFBZ0IsQ0FBUztJQUV6QixTQUFTLENBQWM7SUFDdkIsVUFBVSxDQUFzQjtJQUNoQyxhQUFhLENBQW1CO0lBQ2hDLFVBQVUsQ0FBbUI7SUFDN0IsbUJBQW1CLENBQW1CO0lBQ3RDLGlCQUFpQixDQUFtQjtJQUVwQyxZQUNTLFNBQXFCLEVBQzVCLFNBQXNCLEVBQ3RCLE9BQThCO1FBRnZCLGNBQVMsR0FBVCxTQUFTLENBQVk7UUFJNUIsSUFBSSxDQUFDLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxVQUFVLElBQUksa0JBQWtCLENBQUMsWUFBWSxDQUFDO1FBRTlFLFNBQVMsQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLFNBQVMsQ0FBQyxLQUFLLENBQUMsS0FBSyxHQUFHLE1BQU0sQ0FBQztRQUUvQixrQ0FBa0M7UUFFbEMsdUJBQXVCO1FBQ3ZCLElBQUksQ0FBQyxTQUFTLEdBQUcsU0FBUyxDQUFDO1FBQzNCLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ2hELElBQUksQ0FBQyxtQkFBbUIsR0FBRyxJQUFJLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDekQsSUFB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b3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlSW5mbywgVHlwc3REZWZhdWx0UGFyYW1zIH0gZnJvbSAnLi4vLi4vaW50ZXJuYWwudHlwZXMubWpzJztcbmltcG9ydCB7IFJlbmRlclRvQ2FudmFzT3B0aW9ucyB9IGZyb20gJy4uLy4uL29wdGlvbnMucmVuZGVyLm1qcyc7XG5pbXBvcnQgeyBQYWdlVmlld3BvcnQgfSBmcm9tICcuL3ZpZXdwb3J0Lm1qcyc7XG5cbi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBjbGFzcyBSZW5kZXJWaWV3IHtcbiAgbG9hZFBhZ2VDb3VudDogbnVtYmVyO1xuICBpbWFnZVNjYWxlRmFjdG9yOiBudW1iZXI7XG5cbiAgY29udGFpbmVyOiBIVE1MRWxlbWVudDtcbiAgY2FudmFzTGlzdDogSFRNTENhbnZhc0VsZW1lbnRbXTtcbiAgdGV4dExheWVyTGlzdDogSFRNTERpdkVsZW1lbnRbXTtcbiAgY29tbW9uTGlzdDogSFRNTERpdkVsZW1lbnRbXTtcbiAgdGV4dExheWVyUGFyZW50TGlzdDogSFRNTERpdkVsZW1lbnRbXTtcbiAgc2VtYW50aWNMYXllckxpc3Q6IEhUTUxEaXZFbGVtZW50W107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIHBhZ2VJbmZvczogUGFnZUluZm9bXSxcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICAgIG9wdGlvbnM6IFJlbmRlclRvQ2FudmFzT3B0aW9ucyxcbiAgKSB7XG4gICAgdGhpcy5pbWFnZVNjYWxlRmFjdG9yID0gb3B0aW9ucy5waXhlbFBlclB0ID8/IFR5cHN0RGVmYXVsdFBhcmFtcy5QSVhFTF9QRVJfUFQ7XG5cbiAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7XG4gICAgY29udGFpbmVyLnN0eWxlLndpZHRoID0gJzEwMCUnO1xuXG4gICAgLy8gY2FudmFzW2RhdGEtdHlwc3Qtc2Vzc2lvbj0ne30nXVxuXG4gICAgLy8vIHJlZmVyIGh0bWwgZWxlbWVudHNcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICB0aGlzLmNhbnZhc0xpc3QgPSBuZXcgQXJyYXkodGhpcy5sb2FkUGFnZUNvdW50KTtcbiAgICB0aGlzLnRleHRMYXllckxpc3QgPSBuZXcgQXJyYXkodGhpcy5sb2FkUGFnZUNvdW50KTtcbiAgICB0aGlzLmNvbW1vbkxpc3QgPSBuZXcgQXJyYXkodGhpcy5sb2FkUGFnZUNvdW50KTtcbiAgICB0aGlzLnRleHRMYXllclBhcmVudExpc3QgPSBuZXcgQXJyYXkodGhpcy5sb2FkUGFnZUNvdW50KTtcbiAgICB0aGlzLnNlbWFudGljTGF5ZXJMaXN0ID0gbmV3IEFycmF5KHRoaXMubG9hZFBhZ2VDb3VudCk7XG5cbiAgICBjb25zdCBjcmVhdGVPdmVyID0gKGk6IG51bWJlciwgcGFnZUFzdDogUGFnZUluZm8sIGNvbW1vbkRpdjogSFRNTERpdkVsZW1lbnQpID0+IHtcbiAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5jZWlsKHBhZ2VBc3Qud2lkdGgpICogdGhpcy5pbWFnZVNjYWxlRmFjdG9yO1xuICAgICAgY29uc3QgaGVpZ2h0ID0gTWF0aC5jZWlsKHBhZ2VBc3QuaGVpZ2h0KSAqIHRoaXMuaW1hZ2VTY2FsZUZhY3RvcjtcblxuICAgICAgY29uc3QgY2FudmFzID0gKHRoaXMuY2FudmFzTGlzdFtpXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpKTtcbiAgICAgIGNvbnN0IHNlbWFudGljTGF5ZXIgPSAodGhpcy5zZW1hbnRpY0xheWVyTGlzdFtpXSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpKTtcbiAgICAgIGNvbnN0IHRleHRMYXllciA9ICh0aGlzLnRleHRMYXllckxpc3RbaV0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSk7XG4gICAgICBjb25zdCB0ZXh0TGF5ZXJQYXJlbnQgPSAodGhpcy50ZXh0TGF5ZXJQYXJlbnRMaXN0W2ldID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xuXG4gICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICAgIGlmIChjdHgpIHtcbiAgICAgICAgY29uc3QgY2FudmFzRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgICAgIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG5cbiAgICAgICAgY2FudmFzRGl2LmFwcGVuZENoaWxkKGNhbnZhcyk7XG4gICAgICAgIC8vIGNhbnZhc0Rpdi5zdHlsZS56SW5kZXggPSAnLTEnO1xuICAgICAgICAvLyBjYW52YXMuc3R5bGUuekluZGV4ID0gJy0xJztcbiAgICAgICAgY29tbW9uRGl2LmFwcGVuZENoaWxkKGNhbnZhc0Rpdik7XG4gICAgICAgIGNhbnZhc0Rpdi5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgICB9XG5cbiAgICAgIHtcbiAgICAgICAgdGV4dExheWVyUGFyZW50LmFwcGVuZENoaWxkKHRleHRMYXllcik7XG5cbiAgICAgICAgdGV4dExheWVyUGFyZW50LmNsYXNzTmFtZSA9ICd0eXBzdC1odG1sLXNlbWFudGljcyc7XG5cbiAgICAgICAgLy8vIG9uIHdpZHRoIGNoYW5nZVxuICAgICAgICBjb25zdCBjb250YWluZXJXaWR0aCA9IGNvbnRhaW5lci5vZmZzZXRXaWR0aDtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxTY2FsZSA9IGNvbnRhaW5lcldpZHRoIC8gcGFnZUFzdC53aWR0aDtcbiAgICAgICAgdGV4dExheWVyUGFyZW50LnN0eWxlLndpZHRoID0gYCR7Y29udGFpbmVyV2lkdGh9cHhgO1xuICAgICAgICB0ZXh0TGF5ZXJQYXJlbnQuc3R5bGUuaGVpZ2h0ID0gYCR7cGFnZUFzdC5oZWlnaHQgKiBvcmlnaW5hbFNjYWxlfXB4YDtcbiAgICAgICAgLy8gLS1kYXRhLXRleHQtd2lkdGhcbiAgICAgICAgdGV4dExheWVyUGFyZW50LnN0eWxlLnNldFByb3BlcnR5KCctLWRhdGEtdGV4dC13aWR0aCcsIGAke29yaWdpbmFsU2NhbGV9cHhgKTtcbiAgICAgICAgdGV4dExheWVyUGFyZW50LnN0eWxlLnNldFByb3BlcnR5KCctLWRhdGEtdGV4dC1oZWlnaHQnLCBgJHtvcmlnaW5hbFNjYWxlfXB4YCk7XG4gICAgICAgIC8vIHRleHRMYXllclBhcmVudC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgICAgIGNvbW1vbkRpdi5jbGFzc0xpc3QuYWRkKCd0eXBzdC1wYWdlJyk7XG4gICAgICAgIGNvbW1vbkRpdi5jbGFzc0xpc3QuYWRkKCdjYW52YXMnKTtcbiAgICAgICAgY29tbW9uRGl2LnN0eWxlLndpZHRoID0gYCR7Y29udGFpbmVyV2lkdGh9cHhgO1xuICAgICAgICBjb21tb25EaXYuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0ICogb3JpZ2luYWxTY2FsZX1weGA7XG4gICAgICAgIGNvbW1vbkRpdi5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XG5cbiAgICAgICAgLy8gdGV4dExheWVyUGFyZW50LnN0eWxlLnpJbmRleCA9ICcxJztcbiAgICAgICAgc2VtYW50aWNMYXllci5hcHBlbmRDaGlsZCh0ZXh0TGF5ZXJQYXJlbnQpO1xuICAgICAgICBjb21tb25EaXYuYXBwZW5kQ2hpbGQoc2VtYW50aWNMYXllcik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wYWdlSW5mb3MubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IHBhZ2VBc3QgPSB0aGlzLnBhZ2VJbmZvc1tpXTtcblxuICAgICAgLy8gY29uc3QgY29tbW9uRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBsZXQgY29tbW9uRGl2OiBIVE1MRGl2RWxlbWVudCB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcblxuICAgICAgY29tbW9uRGl2ID0gdGhpcy5jb21tb25MaXN0W2ldID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQoY29tbW9uRGl2KTtcbiAgICAgIGNyZWF0ZU92ZXIoaSwgcGFnZUFzdCwgY29tbW9uRGl2KTtcbiAgICB9XG4gIH1cblxuICByZXNldExheW91dCgpIHtcbiAgICAvLy8gcmVzaXplIGFnYWluIHRvIGF2b2lkIGJhZCB3aWR0aCBjaGFuZ2UgYWZ0ZXIgcmVuZGVyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBhZ2VJbmZvcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgcGFnZUFzdCA9IHRoaXMucGFnZUluZm9zW2ldO1xuICAgICAgY29uc3Qgd2lkdGggPSBNYXRoLmNlaWwocGFnZUFzdC53aWR0aCkgKiB0aGlzLmltYWdlU2NhbGVGYWN0b3I7XG4gICAgICBjb25zdCBoZWlnaHQgPSBNYXRoLmNlaWwocGFnZUFzdC5oZWlnaHQpICogdGhpcy5pbWFnZVNjYWxlRmFjdG9yO1xuXG4gICAgICBjb25zdCBjYW52YXNEaXYgPSB0aGlzLmNhbnZhc0xpc3RbaV0ucGFyZW50RWxlbWVudDtcbiAgICAgIGlmICghY2FudmFzRGl2KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICBgY2FudmFzRGl2IGlzIG51bGwgZm9yIHBhZ2UgJHtpfSwgY2FudmFzIGxpc3QgbGVuZ3RoICR7dGhpcy5jYW52YXNMaXN0Lmxlbmd0aH1gLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3QgY29tbW9uRGl2ID0gdGhpcy5jb21tb25MaXN0W2ldO1xuICAgICAgY29uc3QgdGV4dExheWVyUGFyZW50ID0gdGhpcy50ZXh0TGF5ZXJQYXJlbnRMaXN0W2ldO1xuXG4gICAgICAvLy8gb24gd2lkdGggY2hhbmdlXG4gICAgICBjb25zdCBjb250YWluZXJXaWR0aCA9IHRoaXMuY29udGFpbmVyLm9mZnNldFdpZHRoO1xuICAgICAgY29uc3Qgb3JpZ2luYWxTY2FsZSA9IGNvbnRhaW5lcldpZHRoIC8gd2lkdGg7XG4gICAgICB0ZXh0TGF5ZXJQYXJlbnQuc3R5bGUud2lkdGggPSBgJHtjb250YWluZXJXaWR0aH1weGA7XG4gICAgICB0ZXh0TGF5ZXJQYXJlbnQuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0ICogb3JpZ2luYWxTY2FsZX1weGA7XG4gICAgICBjb21tb25EaXYuc3R5bGUud2lkdGggPSBgJHtjb250YWluZXJXaWR0aH1weGA7XG4gICAgICBjb21tb25EaXYuc3R5bGUuaGVpZ2h0ID0gYCR7aGVpZ2h0ICogb3JpZ2luYWxTY2FsZX1weGA7XG5cbiAgICAgIC8vIGNvbXB1dGUgc2NhbGluZyBmYWN0b3IgYWNjb3JkaW5nIHRvIHRoZSBwYXBlciBzaXplXG4gICAgICBjb25zdCBjdXJyZW50U2NhbGUgPSB0aGlzLmNvbnRhaW5lci5vZmZzZXRXaWR0aCAvIHdpZHRoO1xuICAgICAgY2FudmFzRGl2LnN0eWxlLnRyYW5zZm9ybU9yaWdpbiA9ICcwcHggMHB4JztcbiAgICAgIGNhbnZhc0Rpdi5zdHlsZS50cmFuc2Zvcm0gPSBgc2NhbGUoJHtjdXJyZW50U2NhbGV9KWA7XG4gICAgfVxuICB9XG59XG4iXX0=","export var PreviewMode;\n(function (PreviewMode) {\n    PreviewMode[PreviewMode[\"Doc\"] = 0] = \"Doc\";\n    PreviewMode[PreviewMode[\"Slide\"] = 1] = \"Slide\";\n})(PreviewMode || (PreviewMode = {}));\nexport class TypstDocumentContext {\n    hookedElem;\n    kModule;\n    opts;\n    modes = [];\n    /// Configuration fields\n    /// enable partial rendering\n    partialRendering = true;\n    /// underlying renderer\n    renderMode = 'svg';\n    r = undefined;\n    /// preview mode\n    previewMode = PreviewMode.Doc;\n    /// whether this is a content preview\n    isContentPreview = false;\n    /// whether this content preview will mix outline titles\n    isMixinOutline = false;\n    /// background color\n    backgroundColor = 'black';\n    /// default page color (empty string means transparent)\n    pageColor = 'white';\n    /// pixel per pt\n    pixelPerPt = 3;\n    /// customized way to retrieving dom state\n    retrieveDOMState;\n    /// State fields\n    /// whether svg is updating (in triggerSvgUpdate)\n    isRendering = false;\n    /// whether kModule is initialized\n    moduleInitialized = false;\n    /// patch queue for updating data.\n    patchQueue = [];\n    /// resources to dispose\n    disposeList = [];\n    /// canvas render ctoken\n    canvasRenderCToken;\n    /// There are two scales in this class: The real scale is to adjust the size\n    /// of `hookedElem` to fit the svg. The virtual scale (scale ratio) is to let\n    /// user zoom in/out the svg. For example:\n    /// + the default value of virtual scale is 1, which means the svg is totally\n    ///   fit in `hookedElem`.\n    /// + if user set virtual scale to 0.5, then the svg will be zoomed out to fit\n    ///   in half width of `hookedElem`. \"real\" current scale of `hookedElem`\n    currentRealScale = 1;\n    /// \"virtual\" current scale of `hookedElem`\n    currentScaleRatio = 1;\n    /// timeout for delayed viewport change\n    vpTimeout = undefined;\n    /// sampled by last render time.\n    sampledRenderTime = 0;\n    /// page to partial render\n    partialRenderPage = 0;\n    /// outline data\n    outline = undefined;\n    /// cursor position in form of [page, x, y]\n    cursorPosition = undefined;\n    // id: number = rnd++;\n    /// Cache fields\n    /// cached state of container, default to retrieve state from `this.hookedElem`\n    cachedDOMState = {\n        width: 0,\n        height: 0,\n        window: {\n            innerWidth: 0,\n            innerHeight: 0,\n        },\n        boundingRect: {\n            left: 0,\n            top: 0,\n            right: 0,\n        },\n    };\n    constructor(opts) {\n        this.hookedElem = opts.hookedElem;\n        this.kModule = opts.kModule;\n        this.opts = opts || {};\n        /// Apply configuration\n        {\n            const { renderMode, previewMode, isContentPreview, retrieveDOMState } = opts || {};\n            this.partialRendering = false;\n            this.renderMode = renderMode ?? this.renderMode;\n            this.previewMode = previewMode ?? this.previewMode;\n            this.isContentPreview = isContentPreview || false;\n            this.retrieveDOMState =\n                retrieveDOMState ??\n                    (() => {\n                        return {\n                            width: this.hookedElem.offsetWidth,\n                            height: this.hookedElem.offsetHeight,\n                            window: {\n                                innerWidth: window.innerWidth,\n                                innerHeight: window.innerHeight,\n                            },\n                            boundingRect: this.hookedElem.getBoundingClientRect(),\n                        };\n                    });\n            this.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--typst-preview-background-color');\n        }\n        // if init scale == 1\n        // hide scrollbar if scale == 1\n        this.hookedElem.classList.add('hide-scrollbar-x');\n        this.hookedElem.parentElement?.classList.add('hide-scrollbar-x');\n        if (this.previewMode === PreviewMode.Slide) {\n            this.hookedElem.classList.add('hide-scrollbar-y');\n            this.hookedElem.parentElement?.classList.add('hide-scrollbar-y');\n        }\n        this.installCtrlWheelHandler();\n    }\n    reset() {\n        this.kModule.reset();\n        this.moduleInitialized = false;\n    }\n    dispose() {\n        const disposeList = this.disposeList;\n        this.disposeList = [];\n        disposeList.forEach(x => x());\n    }\n    static derive(ctx, mode) {\n        return ['rescale', 'rerender', 'postRender'].reduce((acc, x) => {\n            acc[x] = ctx[`${x}$${mode}`].bind(ctx);\n            console.assert(acc[x] !== undefined, `${x}$${mode} is undefined`);\n            return acc;\n        }, {});\n    }\n    registerMode(mode) {\n        const facade = TypstDocumentContext.derive(this, mode);\n        this.modes.push([mode, facade]);\n        if (mode === this.renderMode) {\n            this.r = facade;\n        }\n    }\n    installCtrlWheelHandler() {\n        // Ctrl+scroll rescaling\n        // will disable auto resizing\n        // fixed factors, same as pdf.js\n        const factors = [\n            0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1, 1.1, 1.3, 1.5, 1.7, 1.9, 2.1, 2.4, 2.7, 3,\n            3.3, 3.7, 4.1, 4.6, 5.1, 5.7, 6.3, 7, 7.7, 8.5, 9.4, 10,\n        ];\n        const wheelEventHandler = (event) => {\n            if (event.ctrlKey) {\n                event.preventDefault();\n                // retrieve dom state before any operation\n                this.cachedDOMState = this.retrieveDOMState();\n                if (window.onresize !== null) {\n                    // is auto resizing\n                    window.onresize = null;\n                }\n                const prevScaleRatio = this.currentScaleRatio;\n                // Get wheel scroll direction and calculate new scale\n                if (event.deltaY < 0) {\n                    // enlarge\n                    if (this.currentScaleRatio >= factors.at(-1)) {\n                        // already large than max factor\n                        return;\n                    }\n                    else {\n                        this.currentScaleRatio = factors.filter(x => x > this.currentScaleRatio).at(0);\n                    }\n                }\n                else if (event.deltaY > 0) {\n                    // reduce\n                    if (this.currentScaleRatio <= factors.at(0)) {\n                        return;\n                    }\n                    else {\n                        this.currentScaleRatio = factors.filter(x => x < this.currentScaleRatio).at(-1);\n                    }\n                }\n                else {\n                    // no y-axis scroll\n                    return;\n                }\n                const scrollFactor = this.currentScaleRatio / prevScaleRatio;\n                const scrollX = event.pageX * (scrollFactor - 1);\n                const scrollY = event.pageY * (scrollFactor - 1);\n                // hide scrollbar if scale == 1\n                if (Math.abs(this.currentScaleRatio - 1) < 1e-5) {\n                    this.hookedElem.classList.add('hide-scrollbar-x');\n                    this.hookedElem.parentElement?.classList.add('hide-scrollbar-x');\n                    if (this.previewMode === PreviewMode.Slide) {\n                        this.hookedElem.classList.add('hide-scrollbar-y');\n                        this.hookedElem.parentElement?.classList.add('hide-scrollbar-y');\n                    }\n                }\n                else {\n                    this.hookedElem.classList.remove('hide-scrollbar-x');\n                    this.hookedElem.parentElement?.classList.remove('hide-scrollbar-x');\n                    if (this.previewMode === PreviewMode.Slide) {\n                        this.hookedElem.classList.remove('hide-scrollbar-y');\n                        this.hookedElem.parentElement?.classList.remove('hide-scrollbar-y');\n                    }\n                }\n                // reserve space to scroll down\n                const svg = this.hookedElem.firstElementChild;\n                if (svg) {\n                    const scaleRatio = this.getSvgScaleRatio();\n                    const dataHeight = Number.parseFloat(svg.getAttribute('data-height'));\n                    const scaledHeight = Math.ceil(dataHeight * scaleRatio);\n                    // we increase the height by 2 times.\n                    // The `2` is only a magic number that is large enough.\n                    this.hookedElem.style.height = `${scaledHeight * 2}px`;\n                }\n                // make sure the cursor is still on the same position\n                window.scrollBy(scrollX, scrollY);\n                // toggle scale change event\n                this.addViewportChange();\n                return false;\n            }\n        };\n        if (this.renderMode !== 'dom') {\n            const vscodeAPI = typeof acquireVsCodeApi !== 'undefined';\n            if (vscodeAPI) {\n                window.addEventListener('wheel', wheelEventHandler, {\n                    passive: false,\n                });\n                this.disposeList.push(() => {\n                    window.removeEventListener('wheel', wheelEventHandler);\n                });\n            }\n            else {\n                document.body.addEventListener('wheel', wheelEventHandler, {\n                    passive: false,\n                });\n                this.disposeList.push(() => {\n                    document.body.removeEventListener('wheel', wheelEventHandler);\n                });\n            }\n        }\n    }\n    /// Get current scale from html to svg\n    // Note: one should retrieve dom state before rescale\n    getSvgScaleRatio() {\n        const svg = this.hookedElem.firstElementChild;\n        if (!svg) {\n            return 0;\n        }\n        const container = this.cachedDOMState;\n        const svgWidth = Number.parseFloat(svg.getAttribute('data-width') || svg.getAttribute('width') || '1');\n        const svgHeight = Number.parseFloat(svg.getAttribute('data-height') || svg.getAttribute('height') || '1');\n        this.currentRealScale =\n            this.previewMode === PreviewMode.Slide\n                ? Math.min(container.width / svgWidth, container.height / svgHeight)\n                : container.width / svgWidth;\n        return this.currentRealScale * this.currentScaleRatio;\n    }\n    processQueue(svgUpdateEvent) {\n        const eventName = svgUpdateEvent[0];\n        switch (eventName) {\n            case 'new':\n            case 'diff-v1': {\n                if (eventName === 'new') {\n                    this.reset();\n                }\n                this.kModule.manipulateData({\n                    action: 'merge',\n                    data: svgUpdateEvent[1],\n                });\n                this.moduleInitialized = true;\n                return true;\n            }\n            case 'viewport-change': {\n                if (!this.moduleInitialized) {\n                    console.log('viewport-change before initialization');\n                    return false;\n                }\n                return true;\n            }\n            default:\n                console.log('svgUpdateEvent', svgUpdateEvent);\n                return false;\n        }\n    }\n    triggerUpdate() {\n        if (this.isRendering) {\n            return;\n        }\n        this.isRendering = true;\n        const doUpdate = async () => {\n            this.cachedDOMState = this.retrieveDOMState();\n            if (this.patchQueue.length === 0) {\n                this.isRendering = false;\n                this.postprocessChanges();\n                return;\n            }\n            try {\n                let t0 = performance.now();\n                const ctoken = this.canvasRenderCToken;\n                if (ctoken) {\n                    await ctoken.cancel();\n                    await ctoken.wait();\n                    this.canvasRenderCToken = undefined;\n                    console.log('cancel canvas rendering');\n                }\n                let needRerender = false;\n                // console.log('patchQueue', JSON.stringify(this.patchQueue.map(x => x[0])));\n                while (this.patchQueue.length > 0) {\n                    needRerender = this.processQueue(this.patchQueue.shift()) || needRerender;\n                }\n                // todo: trigger viewport change once\n                let t1 = performance.now();\n                if (needRerender) {\n                    this.r.rescale();\n                    await this.r.rerender();\n                    this.r.rescale();\n                }\n                let t2 = performance.now();\n                /// perf event\n                const d = (e, x, y) => `${e} ${(y - x).toFixed(2)} ms`;\n                this.sampledRenderTime = t2 - t0;\n                // todo: log in production\n                // console.log([d('parse', t0, t1), d('rerender', t1, t2), d('total', t0, t2)].join(', '));\n                requestAnimationFrame(doUpdate);\n            }\n            catch (e) {\n                console.error(e);\n                this.isRendering = false;\n                this.postprocessChanges();\n            }\n        };\n        requestAnimationFrame(doUpdate);\n    }\n    postprocessChanges() {\n        this.r.postRender();\n        // todo: abstract this\n        if (this.previewMode === PreviewMode.Slide) {\n            document.querySelectorAll('.typst-page-number-indicator').forEach(x => {\n                x.textContent = `${this.kModule.retrievePagesInfo().length}`;\n            });\n        }\n    }\n    addChangement(change) {\n        if (change[0] === 'new') {\n            this.patchQueue.splice(0, this.patchQueue.length);\n        }\n        const pushChange = () => {\n            this.vpTimeout = undefined;\n            this.patchQueue.push(change);\n            this.triggerUpdate();\n        };\n        if (this.vpTimeout !== undefined) {\n            clearTimeout(this.vpTimeout);\n        }\n        if (change[0] === 'viewport-change' && this.isRendering) {\n            // delay viewport change a bit\n            this.vpTimeout = setTimeout(pushChange, this.sampledRenderTime || 100);\n        }\n        else {\n            pushChange();\n        }\n    }\n    addViewportChange() {\n        this.addChangement(['viewport-change', '']);\n    }\n}\nexport function provideDoc(Base) {\n    return class TypstDocument {\n        impl;\n        kModule;\n        constructor(options) {\n            if (options.isContentPreview) {\n                options.renderMode = 'canvas';\n            }\n            this.kModule = options.kModule;\n            this.impl = new Base(options);\n            if (!this.impl.r) {\n                throw new Error(`mode is not supported, ${options?.renderMode}`);\n            }\n            if (options.isContentPreview) {\n                // content preview has very bad performance without partial rendering\n                this.impl.partialRendering = true;\n                this.impl.pixelPerPt = 1;\n                this.impl.isMixinOutline = true;\n            }\n        }\n        dispose() {\n            this.impl.dispose();\n        }\n        reset() {\n            this.impl.reset();\n        }\n        addChangement(change) {\n            this.impl.addChangement(change);\n        }\n        addViewportChange() {\n            this.impl.addViewportChange();\n        }\n        setPageColor(color) {\n            this.impl.pageColor = color;\n            this.addViewportChange();\n        }\n        setPartialRendering(partialRendering) {\n            this.impl.partialRendering = partialRendering;\n        }\n        setCursor(page, x, y) {\n            this.impl.cursorPosition = [page, x, y];\n        }\n        setPartialPageNumber(page) {\n            if (page <= 0 || page > this.kModule.retrievePagesInfo().length) {\n                return false;\n            }\n            this.impl.partialRenderPage = page - 1;\n            this.addViewportChange();\n            return true;\n        }\n        getPartialPageNumber() {\n            return this.impl.partialRenderPage + 1;\n        }\n        setOutineData(outline) {\n            this.impl.outline = outline;\n            this.addViewportChange();\n        }\n    };\n}\nexport function composeDoc(Base, ...mixins) {\n    return mixins.reduce((acc, mixin) => mixin(acc), Base);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwc3QtZG9jLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb250cmliL2RvbS90eXBzdC1kb2MubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQXVCQSxNQUFNLENBQU4sSUFBWSxXQUdYO0FBSEQsV0FBWSxXQUFXO0lBQ3JCLDJDQUFHLENBQUE7SUFDSCwrQ0FBSyxDQUFBO0FBQ1AsQ0FBQyxFQUhXLFdBQVcsS0FBWCxXQUFXLFFBR3RCO0FBb0JELE1BQU0sT0FBTyxvQkFBb0I7SUFDeEIsVUFBVSxDQUFjO0lBQ3hCLE9BQU8sQ0FBZ0I7SUFDdkIsSUFBSSxDQUFJO0lBQ2YsS0FBSyxHQUFvQyxFQUFFLENBQUM7SUFFNUMsd0JBQXdCO0lBRXhCLDRCQUE0QjtJQUM1QixnQkFBZ0IsR0FBWSxJQUFJLENBQUM7SUFDakMsdUJBQXVCO0lBQ3ZCLFVBQVUsR0FBZSxLQUFLLENBQUM7SUFDL0IsQ0FBQyxHQUF3QixTQUFVLENBQUM7SUFDcEMsZ0JBQWdCO0lBQ2hCLFdBQVcsR0FBZ0IsV0FBVyxDQUFDLEdBQUcsQ0FBQztJQUMzQyxxQ0FBcUM7SUFDckMsZ0JBQWdCLEdBQVksS0FBSyxDQUFDO0lBQ2xDLHdEQUF3RDtJQUN4RCxjQUFjLEdBQVksS0FBSyxDQUFDO0lBQ2hDLG9CQUFvQjtJQUNwQixlQUFlLEdBQVcsT0FBTyxDQUFDO0lBQ2xDLHVEQUF1RDtJQUN2RCxTQUFTLEdBQVcsT0FBTyxDQUFDO0lBQzVCLGdCQUFnQjtJQUNoQixVQUFVLEdBQVcsQ0FBQyxDQUFDO0lBQ3ZCLDBDQUEwQztJQUMxQyxnQkFBZ0IsQ0FBMEI7SUFFMUMsZ0JBQWdCO0lBRWhCLGlEQUFpRDtJQUNqRCxXQUFXLEdBQVksS0FBSyxDQUFDO0lBQzdCLGtDQUFrQztJQUNsQyxpQkFBaUIsR0FBWSxLQUFLLENBQUM7SUFDbkMsa0NBQWtDO0lBQ2xDLFVBQVUsR0FBdUIsRUFBRSxDQUFDO0lBQ3BDLHdCQUF3QjtJQUN4QixXQUFXLEdBQW1C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QUFFLENBQVM7WUFDMUMsSUFBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzFDLENBQUM7UUFFRCxvQkFBb0IsQ0FBQyxJQUFZO1lBQy9CLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNoRSxPQUFPLEtBQUssQ0FBQztZQUNmLENBQUM7WUFDRCxJQUFJLENBQUMsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksR0FBRyxDQUFDLENBQUM7WUFDdkMsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDekIsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsb0JBQW9CO1lBQ2xCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxDQUFDLENBQUM7UUFDekMsQ0FBQztRQUVELGFBQWEsQ0FBQyxPQUFZO1lBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztZQUM1QixJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUMzQixDQUFDO0tBQ0YsQ0FBQztBQUNKLENBQUM7QUEwRUQsTUFBTSxVQUFVLFVBQVUsQ0FBNkIsSUFBVyxFQUFFLEdBQUcsTUFBYTtJQUNsRixPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDekQsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgUmVuZGVyU2Vzc2lvbiB9IGZyb20gJy4uLy4uL3JlbmRlcmVyLm1qcyc7XG5pbXBvcnQgeyBUeXBzdENhbmNlbGxhdGlvblRva2VuIH0gZnJvbSAnLi90eXBzdC1jYW5jZWwubWpzJztcblxuZXhwb3J0IGludGVyZmFjZSBDb250YWluZXJET01TdGF0ZSB7XG4gIC8vLyBjYWNoZWQgYGhvb2tlZEVsZW0ub2Zmc2V0V2lkdGhgIG9yIGBob29rZWRFbGVtLmlubmVyV2lkdGhgXG4gIHdpZHRoOiBudW1iZXI7XG4gIC8vLyBjYWNoZWQgYGhvb2tlZEVsZW0ub2Zmc2V0SGVpZ2h0YCBvciBgaG9va2VkRWxlbS5pbm5lckhlaWdodGBcbiAgaGVpZ2h0OiBudW1iZXI7XG4gIHdpbmRvdzoge1xuICAgIGlubmVyV2lkdGg6IG51bWJlcjtcbiAgICBpbm5lckhlaWdodDogbnVtYmVyO1xuICB9O1xuICAvLy8gY2FjaGVkIGBob29rZWRFbGVtLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpYFxuICAvLy8gV2Ugb25seSB1c2UgYGxlZnRgIGFuZCBgdG9wYCBoZXJlLlxuICBib3VuZGluZ1JlY3Q6IHtcbiAgICBsZWZ0OiBudW1iZXI7XG4gICAgdG9wOiBudW1iZXI7XG4gICAgcmlnaHQ6IG51bWJlcjtcbiAgfTtcbn1cblxuZXhwb3J0IHR5cGUgUmVuZGVyTW9kZSA9ICdzdmcnIHwgJ2NhbnZhcycgfCAnZG9tJztcblxuZXhwb3J0IGVudW0gUHJldmlld01vZGUge1xuICBEb2MsXG4gIFNsaWRlLFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9wdGlvbnMge1xuICBob29rZWRFbGVtOiBIVE1MRWxlbWVudDtcbiAga01vZHVsZTogUmVuZGVyU2Vzc2lvbjtcbiAgcmVuZGVyTW9kZT86IFJlbmRlck1vZGU7XG4gIHByZXZpZXdNb2RlPzogUHJldmlld01vZGU7XG4gIGlzQ29udGVudFByZXZpZXc/OiBib29sZWFuO1xuICBzb3VyY2VNYXBwaW5nPzogYm9vbGVhbjtcbiAgcmV0cmlldmVET01TdGF0ZT86ICgpID0+IENvbnRhaW5lckRPTVN0YXRlO1xufVxuXG5leHBvcnQgdHlwZSBHQ29uc3RydWN0b3I8VCA9IHt9PiA9IG5ldyAoLi4uYXJnczogYW55W10pID0+IFQ7XG5cbmludGVyZmFjZSBUeXBzdERvY3VtZW50RmFjYWRlIHtcbiAgcmVzY2FsZSgpOiB2b2lkO1xuICByZXJlbmRlcigpOiBQcm9taXNlPHZvaWQ+O1xuICBwb3N0UmVuZGVyKCk6IHZvaWQ7XG59XG5cbmV4cG9ydCBjbGFzcyBUeXBzdERvY3VtZW50Q29udGV4dDxPID0gYW55PiB7XG4gIHB1YmxpYyBob29rZWRFbGVtOiBIVE1MRWxlbWVudDtcbiAgcHVibGljIGtNb2R1bGU6IFJlbmRlclNlc3Npb247XG4gIHB1YmxpYyBvcHRzOiBPO1xuICBtb2RlczogW3N0cmluZywgVHlwc3REb2N1bWVudEZhY2FkZV1bXSA9IFtdO1xuXG4gIC8vLyBDb25maWd1cmF0aW9uIGZpZWxkc1xuXG4gIC8vLyBlbmFibGUgcGFydGlhbCByZW5kZXJpbmdcbiAgcGFydGlhbFJlbmRlcmluZzogYm9vbGVhbiA9IHRydWU7XG4gIC8vLyB1bmRlcmx5aW5nIHJlbmRlcmVyXG4gIHJlbmRlck1vZGU6IFJlbmRlck1vZGUgPSAnc3ZnJztcbiAgcjogVHlwc3REb2N1bWVudEZhY2FkZSA9IHVuZGVmaW5lZCE7XG4gIC8vLyBwcmV2aWV3IG1vZGVcbiAgcHJldmlld01vZGU6IFByZXZpZXdNb2RlID0gUHJldmlld01vZGUuRG9jO1xuICAvLy8gd2hldGhlciB0aGlzIGlzIGEgY29udGVudCBwcmV2aWV3XG4gIGlzQ29udGVudFByZXZpZXc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgLy8vIHdoZXRoZXIgdGhpcyBjb250ZW50IHByZXZpZXcgd2lsbCBtaXggb3V0bGluZSB0aXRsZXNcbiAgaXNNaXhpbk91dGxpbmU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgLy8vIGJhY2tncm91bmQgY29sb3JcbiAgYmFja2dyb3VuZENvbG9yOiBzdHJpbmcgPSAnYmxhY2snO1xuICAvLy8gZGVmYXVsdCBwYWdlIGNvbG9yIChlbXB0eSBzdHJpbmcgbWVhbnMgdHJhbnNwYXJlbnQpXG4gIHBhZ2VDb2xvcjogc3RyaW5nID0gJ3doaXRlJztcbiAgLy8vIHBpeGVsIHBlciBwdFxuICBwaXhlbFBlclB0OiBudW1iZXIgPSAzO1xuICAvLy8gY3VzdG9taXplZCB3YXkgdG8gcmV0cmlldmluZyBkb20gc3RhdGVcbiAgcmV0cmlldmVET01TdGF0ZTogKCkgPT4gQ29udGFpbmVyRE9NU3RhdGU7XG5cbiAgLy8vIFN0YXRlIGZpZWxkc1xuXG4gIC8vLyB3aGV0aGVyIHN2ZyBpcyB1cGRhdGluZyAoaW4gdHJpZ2dlclN2Z1VwZGF0ZSlcbiAgaXNSZW5kZXJpbmc6IGJvb2xlYW4gPSBmYWxzZTtcbiAgLy8vIHdoZXRoZXIga01vZHVsZSBpcyBpbml0aWFsaXplZFxuICBtb2R1bGVJbml0aWFsaXplZDogYm9vbGVhbiA9IGZhbHNlO1xuICAvLy8gcGF0Y2ggcXVldWUgZm9yIHVwZGF0aW5nIGRhdGEuXG4gIHBhdGNoUXVldWU6IFtzdHJpbmcsIHN0cmluZ11bXSA9IFtdO1xuICAvLy8gcmVzb3VyY2VzIHRvIGRpc3Bvc2VcbiAgZGlzcG9zZUxpc3Q6ICgoKSA9PiB2b2lkKVtdID0gW107XG4gIC8vLyBjYW52YXMgcmVuZGVyIGN0b2tlblxuICBjYW52YXNSZW5kZXJDVG9rZW4/OiBUeXBzdENhbmNlbGxhdGlvblRva2VuO1xuXG4gIC8vLyBUaGVyZSBhcmUgdHdvIHNjYWxlcyBpbiB0aGlzIGNsYXNzOiBUaGUgcmVhbCBzY2FsZSBpcyB0byBhZGp1c3QgdGhlIHNpemVcbiAgLy8vIG9mIGBob29rZWRFbGVtYCB0byBmaXQgdGhlIHN2Zy4gVGhlIHZpcnR1YWwgc2NhbGUgKHNjYWxlIHJhdGlvKSBpcyB0byBsZXRcbiAgLy8vIHVzZXIgem9vbSBpbi9vdXQgdGhlIHN2Zy4gRm9yIGV4YW1wbGU6XG4gIC8vLyArIHRoZSBkZWZhdWx0IHZhbHVlIG9mIHZpcnR1YWwgc2NhbGUgaXMgMSwgd2hpY2ggbWVhbnMgdGhlIHN2ZyBpcyB0b3RhbGx5XG4gIC8vLyAgIGZpdCBpbiBgaG9va2VkRWxlbWAuXG4gIC8vLyArIGlmIHVzZXIgc2V0IHZpcnR1YWwgc2NhbGUgdG8gMC41LCB0aGVuIHRoZSBzdmcgd2lsbCBiZSB6b29tZWQgb3V0IHRvIGZpdFxuICAvLy8gICBpbiBoYWxmIHdpZHRoIG9mIGBob29rZWRFbGVtYC4gXCJyZWFsXCIgY3VycmVudCBzY2FsZSBvZiBgaG9va2VkRWxlbWBcbiAgY3VycmVudFJlYWxTY2FsZTogbnVtYmVyID0gMTtcbiAgLy8vIFwidmlydHVhbFwiIGN1cnJlbnQgc2NhbGUgb2YgYGhvb2tlZEVsZW1gXG4gIGN1cnJlbnRTY2FsZVJhdGlvOiBudW1iZXIgPSAxO1xuICAvLy8gdGltZW91dCBmb3IgZGVsYXllZCB2aWV3cG9ydCBjaGFuZ2VcbiAgdnBUaW1lb3V0OiBhbnkgPSB1bmRlZmluZWQ7XG4gIC8vLyBzYW1wbGVkIGJ5IGxhc3QgcmVuZGVyIHRpbWUuXG4gIHNhbXBsZWRSZW5kZXJUaW1lOiBudW1iZXIgPSAwO1xuICAvLy8gcGFnZSB0byBwYXJ0aWFsIHJlbmRlclxuICBwYXJ0aWFsUmVuZGVyUGFnZTogbnVtYmVyID0gMDtcbiAgLy8vIG91dGxpbmUgZGF0YVxuICBvdXRsaW5lOiBhbnkgPSB1bmRlZmluZWQ7XG4gIC8vLyBjdXJzb3IgcG9zaXRpb24gaW4gZm9ybSBvZiBbcGFnZSwgeCwgeV1cbiAgY3Vyc29yUG9zaXRpb24/OiBbbnVtYmVyLCBudW1iZXIsIG51bWJlcl0gPSB1bmRlZmluZWQ7XG4gIC8vIGlkOiBudW1iZXIgPSBybmQrKztcblxuICAvLy8gQ2FjaGUgZmllbGRzXG5cbiAgLy8vIGNhY2hlZCBzdGF0ZSBvZiBjb250YWluZXIsIGRlZmF1bHQgdG8gcmV0cmlldmUgc3RhdGUgZnJvbSBgdGhpcy5ob29rZWRFbGVtYFxuICBjYWNoZWRET01TdGF0ZTogQ29udGFpbmVyRE9NU3RhdGUgPSB7XG4gICAgd2lkdGg6IDAsXG4gICAgaGVpZ2h0OiAwLFxuICAgIHdpbmRvdzoge1xuICAgICAgaW5uZXJXaWR0aDogMCxcbiAgICAgIGlubmVySGVpZ2h0OiAwLFxuICAgIH0sXG4gICAgYm91bmRpbmdSZWN0OiB7XG4gICAgICBsZWZ0OiAwLFxuICAgICAgdG9wOiAwLFxuICAgICAgcmlnaHQ6IDAsXG4gICAgfSxcbiAgfTtcblxuICBjb25zdHJ1Y3RvcihvcHRzOiBPcHRpb25zICYgTykge1xuICAgIHRoaXMuaG9va2VkRWxlbSA9IG9wdHMuaG9va2VkRWxlbTtcbiAgICB0aGlzLmtNb2R1bGUgPSBvcHRzLmtNb2R1bGU7XG4gICAgdGhpcy5vcHRzID0gb3B0cyB8fCB7fTtcblxuICAgIC8vLyBBcHBseSBjb25maWd1cmF0aW9uXG4gICAge1xuICAgICAgY29uc3QgeyByZW5kZXJNb2RlLCBwcmV2aWV3TW9kZSwgaXNDb250ZW50UHJldmlldywgcmV0cmlldmVET01TdGF0ZSB9ID0gb3B0cyB8fCB7fTtcbiAgICAgIHRoaXMucGFydGlhbFJlbmRlcmluZyA9IGZhbHNlO1xuICAgICAgdGhpcy5yZW5kZXJNb2RlID0gcmVuZGVyTW9kZSA/PyB0aGlzLnJlbmRlck1vZGU7XG4gICAgICB0aGlzLnByZXZpZXdNb2RlID0gcHJldmlld01vZGUgPz8gdGhpcy5wcmV2aWV3TW9kZTtcbiAgICAgIHRoaXMuaXNDb250ZW50UHJldmlldyA9IGlzQ29udGVudFByZXZpZXcgfHwgZmFsc2U7XG4gICAgICB0aGlzLnJldHJpZXZlRE9NU3RhdGUgPVxuICAgICAgICByZXRyaWV2ZURPTVN0YXRlID8/XG4gICAgICAgICgoKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmhvb2tlZEVsZW0ub2Zmc2V0V2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuaG9va2VkRWxlbS5vZmZzZXRIZWlnaHQsXG4gICAgICAgICAgICB3aW5kb3c6IHtcbiAgICAgICAgICAgICAgaW5uZXJXaWR0aDogd2luZG93LmlubmVyV2lkdGgsXG4gICAgICAgICAgICAgIGlubmVySGVpZ2h0OiB3aW5kb3cuaW5uZXJIZWlnaHQsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYm91bmRpbmdSZWN0OiB0aGlzLmhvb2tlZEVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB0aGlzLmJhY2tncm91bmRDb2xvciA9IGdldENvbXB1dGVkU3R5bGUoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5nZXRQcm9wZXJ0eVZhbHVlKFxuICAgICAgICAnLS10eXBzdC1wcmV2aWV3LWJhY2tncm91bmQtY29sb3InLFxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBpZiBpbml0IHNjYWxlID09IDFcbiAgICAvLyBoaWRlIHNjcm9sbGJhciBpZiBzY2FsZSA9PSAxXG5cbiAgICB0aGlzLmhvb2tlZEVsZW0uY2xhc3NMaXN0LmFkZCgnaGlkZS1zY3JvbGxiYXIteCcpO1xuICAgIHRoaXMuaG9va2VkRWxlbS5wYXJlbnRFbGVtZW50Py5jbGFzc0xpc3QuYWRkKCdoaWRlLXNjcm9sbGJhci14Jyk7XG4gICAgaWYgKHRoaXMucHJldmlld01vZGUgPT09IFByZXZpZXdNb2RlLlNsaWRlKSB7XG4gICAgICB0aGlzLmhvb2tlZEVsZW0uY2xhc3NMaXN0LmFkZCgnaGlkZS1zY3JvbGxiYXIteScpO1xuICAgICAgdGhpcy5ob29rZWRFbGVtLnBhcmVudEVsZW1lbnQ/LmNsYXNzTGlzdC5hZGQoJ2hpZGUtc2Nyb2xsYmFyLXknKTtcbiAgICB9XG5cbiAgICB0aGlzLmluc3RhbGxDdHJsV2hlZWxIYW5kbGVyKCk7XG4gIH1cblxuICByZXNldCgpIHtcbiAgICB0aGlzLmtNb2R1bGUucmVzZXQoKTtcbiAgICB0aGlzLm1vZHVsZUluaXRpYWxpemVkID0gZmFsc2U7XG4gIH1cblxuICBkaXNwb3NlKCkge1xuICAgIGNvbnN0IGRpc3Bvc2VMaXN0ID0gdGhpcy5kaXNwb3NlTGlzdDtcbiAgICB0aGlzLmRpc3Bvc2VMaXN0ID0gW107XG4gICAgZGlzcG9zZUxpc3QuZm9yRWFjaCh4ID0+IHgoKSk7XG4gIH1cblxuICBzdGF0aWMgZGVyaXZlKGN0eDogYW55LCBtb2RlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gWydyZXNjYWxlJywgJ3JlcmVuZGVyJywgJ3Bvc3RSZW5kZXInXS5yZWR1Y2UoKGFjYzogYW55LCB4OiBzdHJpbmcpID0+IHtcbiAgICAgIGFjY1t4XSA9IGN0eFtgJHt4fSQke21vZGV9YF0uYmluZChjdHgpO1xuICAgICAgY29uc29sZS5hc3NlcnQoYWNjW3hdICE9PSB1bmRlZmluZWQsIGAke3h9JCR7bW9kZX0gaXMgdW5kZWZpbmVkYCk7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9IGFzIFR5cHN0RG9jdW1lbnRGYWNhZGUpO1xuICB9XG5cbiAgcmVnaXN0ZXJNb2RlKG1vZGU6IGFueSkge1xuICAgIGNvbnN0IGZhY2FkZSA9IFR5cHN0RG9jdW1lbnRDb250ZXh0LmRlcml2ZSh0aGlzLCBtb2RlKTtcbiAgICB0aGlzLm1vZGVzLnB1c2goW21vZGUsIGZhY2FkZV0pO1xuICAgIGlmIChtb2RlID09PSB0aGlzLnJlbmRlck1vZGUpIHtcbiAgICAgIHRoaXMuciA9IGZhY2FkZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGluc3RhbGxDdHJsV2hlZWxIYW5kbGVyKCkge1xuICAgIC8vIEN0cmwrc2Nyb2xsIHJlc2NhbGluZ1xuICAgIC8vIHdpbGwgZGlzYWJsZSBhdXRvIHJlc2l6aW5nXG4gICAgLy8gZml4ZWQgZmFjdG9ycywgc2FtZSBhcyBwZGYuanNcbiAgICBjb25zdCBmYWN0b3JzID0gW1xuICAgICAgMC4xLCAwLjIsIDAuMywgMC40LCAwLjUsIDAuNiwgMC43LCAwLjgsIDAuOSwgMSwgMS4xLCAxLjMsIDEuNSwgMS43LCAxLjksIDIuMSwgMi40LCAyLjcsIDMsXG4gICAgICAzLjMsIDMuNywgNC4xLCA0LjYsIDUuMSwgNS43LCA2LjMsIDcsIDcuNywgOC41LCA5LjQsIDEwLFxuICAgIF07XG4gICAgY29uc3Qgd2hlZWxFdmVudEhhbmRsZXIgPSAoZXZlbnQ6IFdoZWVsRXZlbnQpID0+IHtcbiAgICAgIGlmIChldmVudC5jdHJsS2V5KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIC8vIHJldHJpZXZlIGRvbSBzdGF0ZSBiZWZvcmUgYW55IG9wZXJhdGlvblxuICAgICAgICB0aGlzLmNhY2hlZERPTVN0YXRlID0gdGhpcy5yZXRyaWV2ZURPTVN0YXRlKCk7XG4gICAgICAgIGlmICh3aW5kb3cub25yZXNpemUgIT09IG51bGwpIHtcbiAgICAgICAgICAvLyBpcyBhdXRvIHJlc2l6aW5nXG4gICAgICAgICAgd2luZG93Lm9ucmVzaXplID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcmV2U2NhbGVSYXRpbyA9IHRoaXMuY3VycmVudFNjYWxlUmF0aW87XG4gICAgICAgIC8vIEdldCB3aGVlbCBzY3JvbGwgZGlyZWN0aW9uIGFuZCBjYWxjdWxhdGUgbmV3IHNjYWxlXG4gICAgICAgIGlmIChldmVudC5kZWx0YVkgPCAwKSB7XG4gICAgICAgICAgLy8gZW5sYXJnZVxuICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRTY2FsZVJhdGlvID49IGZhY3RvcnMuYXQoLTEpISkge1xuICAgICAgICAgICAgLy8gYWxyZWFkeSBsYXJnZSB0aGFuIG1heCBmYWN0b3JcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50U2NhbGVSYXRpbyA9IGZhY3RvcnMuZmlsdGVyKHggPT4geCA+IHRoaXMuY3VycmVudFNjYWxlUmF0aW8pLmF0KDApITtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSBpZiAoZXZlbnQuZGVsdGFZID4gMCkge1xuICAgICAgICAgIC8vIHJlZHVjZVxuICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRTY2FsZVJhdGlvIDw9IGZhY3RvcnMuYXQoMCkhKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFNjYWxlUmF0aW8gPSBmYWN0b3JzLmZpbHRlcih4ID0+IHggPCB0aGlzLmN1cnJlbnRTY2FsZVJhdGlvKS5hdCgtMSkhO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBubyB5LWF4aXMgc2Nyb2xsXG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNjcm9sbEZhY3RvciA9IHRoaXMuY3VycmVudFNjYWxlUmF0aW8gLyBwcmV2U2NhbGVSYXRpbztcbiAgICAgICAgY29uc3Qgc2Nyb2xsWCA9IGV2ZW50LnBhZ2VYICogKHNjcm9sbEZhY3RvciAtIDEpO1xuICAgICAgICBjb25zdCBzY3JvbGxZID0gZXZlbnQucGFnZVkgKiAoc2Nyb2xsRmFjdG9yIC0gMSk7XG4gICAgICAgIC8vIGhpZGUgc2Nyb2xsYmFyIGlmIHNjYWxlID09IDFcbiAgICAgICAgaWYgKE1hdGguYWJzKHRoaXMuY3VycmVudFNjYWxlUmF0aW8gLSAxKSA8IDFlLTUpIHtcbiAgICAgICAgICB0aGlzLmhvb2tlZEVsZW0uY2xhc3NMaXN0LmFkZCgnaGlkZS1zY3JvbGxiYXIteCcpO1xuICAgICAgICAgIHRoaXMuaG9va2VkRWxlbS5wYXJlbnRFbGVtZW50Py5jbGFzc0xpc3QuYWRkKCdoaWRlLXNjcm9sbGJhci14Jyk7XG4gICAgICAgICAgaWYgKHRoaXMucHJldmlld01vZGUgPT09IFByZXZpZXdNb2RlLlNsaWRlKSB7XG4gICAgICAgICAgICB0aGlzLmhvb2tlZEVsZW0uY2xhc3NMaXN0LmFkZCgnaGlkZS1zY3JvbGxiYXIteScpO1xuICAgICAgICAgICAgdGhpcy5ob29rZWRFbGVtLnBhcmVudEVsZW1lbnQ/LmNsYXNzTGlzdC5hZGQoJ2hpZGUtc2Nyb2xsYmFyLXknKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5ob29rZWRFbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUtc2Nyb2xsYmFyLXgnKTtcbiAgICAgICAgICB0aGlzLmhvb2tlZEVsZW0ucGFyZW50RWxlbWVudD8uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZS1zY3JvbGxiYXIteCcpO1xuICAgICAgICAgIGlmICh0aGlzLnByZXZpZXdNb2RlID09PSBQcmV2aWV3TW9kZS5TbGlkZSkge1xuICAgICAgICAgICAgdGhpcy5ob29rZWRFbGVtLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGUtc2Nyb2xsYmFyLXknKTtcbiAgICAgICAgICAgIHRoaXMuaG9va2VkRWxlbS5wYXJlbnRFbGVtZW50Py5jbGFzc0xpc3QucmVtb3ZlKCdoaWRlLXNjcm9sbGJhci15Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHJlc2VydmUgc3BhY2UgdG8gc2Nyb2xsIGRvd25cbiAgICAgICAgY29uc3Qgc3ZnID0gdGhpcy5ob29rZWRFbGVtLmZpcnN0RWxlbWVudENoaWxkISBhcyBTVkdFbGVtZW50O1xuICAgICAgICBpZiAoc3ZnKSB7XG4gICAgICAgICAgY29uc3Qgc2NhbGVSYXRpbyA9IHRoaXMuZ2V0U3ZnU2NhbGVSYXRpbygpO1xuICAgICAgICAgIGNvbnN0IGRhdGFIZWlnaHQgPSBOdW1iZXIucGFyc2VGbG9hdChzdmcuZ2V0QXR0cmlidXRlKCdkYXRhLWhlaWdodCcpISk7XG4gICAgICAgICAgY29uc3Qgc2NhbGVkSGVpZ2h0ID0gTWF0aC5jZWlsKGRhdGFIZWlnaHQgKiBzY2FsZVJhdGlvKTtcbiAgICAgICAgICAvLyB3ZSBpbmNyZWFzZSB0aGUgaGVpZ2h0IGJ5IDIgdGltZXMuXG4gICAgICAgICAgLy8gVGhlIGAyYCBpcyBvbmx5IGEgbWFnaWMgbnVtYmVyIHRoYXQgaXMgbGFyZ2UgZW5vdWdoLlxuICAgICAgICAgIHRoaXMuaG9va2VkRWxlbS5zdHlsZS5oZWlnaHQgPSBgJHtzY2FsZWRIZWlnaHQgKiAyfXB4YDtcbiAgICAgICAgfVxuICAgICAgICAvLyBtYWtlIHN1cmUgdGhlIGN1cnNvciBpcyBzdGlsbCBvbiB0aGUgc2FtZSBwb3NpdGlvblxuICAgICAgICB3aW5kb3cuc2Nyb2xsQnkoc2Nyb2xsWCwgc2Nyb2xsWSk7XG4gICAgICAgIC8vIHRvZ2dsZSBzY2FsZSBjaGFuZ2UgZXZlbnRcbiAgICAgICAgdGhpcy5hZGRWaWV3cG9ydENoYW5nZSgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmICh0aGlzLnJlbmRlck1vZGUgIT09ICdkb20nKSB7XG4gICAgICBjb25zdCB2c2NvZGVBUEkgPSB0eXBlb2YgYWNxdWlyZVZzQ29kZUFwaSAhPT0gJ3VuZGVmaW5lZCc7XG4gICAgICBpZiAodnNjb2RlQVBJKSB7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCd3aGVlbCcsIHdoZWVsRXZlbnRIYW5kbGVyLCB7XG4gICAgICAgICAgcGFzc2l2ZTogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmRpc3Bvc2VMaXN0LnB1c2goKCkgPT4ge1xuICAgICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCd3aGVlbCcsIHdoZWVsRXZlbnRIYW5kbGVyKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ3doZWVsJywgd2hlZWxFdmVudEhhbmRsZXIsIHtcbiAgICAgICAgICBwYXNzaXZlOiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZGlzcG9zZUxpc3QucHVzaCgoKSA9PiB7XG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCd3aGVlbCcsIHdoZWVsRXZlbnRIYW5kbGVyKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLy8vIEdldCBjdXJyZW50IHNjYWxlIGZyb20gaHRtbCB0byBzdmdcbiAgLy8gTm90ZTogb25lIHNob3VsZCByZXRyaWV2ZSBkb20gc3RhdGUgYmVmb3JlIHJlc2NhbGVcbiAgZ2V0U3ZnU2NhbGVSYXRpbygpIHtcbiAgICBjb25zdCBzdmcgPSB0aGlzLmhvb2tlZEVsZW0uZmlyc3RFbGVtZW50Q2hpbGQgYXMgU1ZHRWxlbWVudDtcbiAgICBpZiAoIXN2Zykge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuXG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5jYWNoZWRET01TdGF0ZTtcblxuICAgIGNvbnN0IHN2Z1dpZHRoID0gTnVtYmVyLnBhcnNlRmxvYXQoXG4gICAgICBzdmcuZ2V0QXR0cmlidXRlKCdkYXRhLXdpZHRoJykgfHwgc3ZnLmdldEF0dHJpYnV0ZSgnd2lkdGgnKSB8fCAnMScsXG4gICAgKTtcbiAgICBjb25zdCBzdmdIZWlnaHQgPSBOdW1iZXIucGFyc2VGbG9hdChcbiAgICAgIHN2Zy5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGVpZ2h0JykgfHwgc3ZnLmdldEF0dHJpYnV0ZSgnaGVpZ2h0JykgfHwgJzEnLFxuICAgICk7XG4gICAgdGhpcy5jdXJyZW50UmVhbFNjYWxlID1cbiAgICAgIHRoaXMucHJldmlld01vZGUgPT09IFByZXZpZXdNb2RlLlNsaWRlXG4gICAgICAgID8gTWF0aC5taW4oY29udGFpbmVyLndpZHRoIC8gc3ZnV2lkdGgsIGNvbnRhaW5lci5oZWlnaHQgLyBzdmdIZWlnaHQpXG4gICAgICAgIDogY29udGFpbmVyLndpZHRoIC8gc3ZnV2lkdGg7XG5cbiAgICByZXR1cm4gdGhpcy5jdXJyZW50UmVhbFNjYWxlICogdGhpcy5jdXJyZW50U2NhbGVSYXRpbztcbiAgfVxuXG4gIHByaXZhdGUgcHJvY2Vzc1F1ZXVlKHN2Z1VwZGF0ZUV2ZW50OiBbc3RyaW5nLCBzdHJpbmddKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZXZlbnROYW1lID0gc3ZnVXBkYXRlRXZlbnRbMF07XG4gICAgc3dpdGNoIChldmVudE5hbWUpIHtcbiAgICAgIGNhc2UgJ25ldyc6XG4gICAgICBjYXNlICdkaWZmLXYxJzoge1xuICAgICAgICBpZiAoZXZlbnROYW1lID09PSAnbmV3Jykge1xuICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmtNb2R1bGUubWFuaXB1bGF0ZURhdGEoe1xuICAgICAgICAgIGFjdGlvbjogJ21lcmdlJyxcbiAgICAgICAgICBkYXRhOiBzdmdVcGRhdGVFdmVudFsxXSBhcyB1bmtub3duIGFzIFVpbnQ4QXJyYXksXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMubW9kdWxlSW5pdGlhbGl6ZWQgPSB0cnVlO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGNhc2UgJ3ZpZXdwb3J0LWNoYW5nZSc6IHtcbiAgICAgICAgaWYgKCF0aGlzLm1vZHVsZUluaXRpYWxpemVkKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3ZpZXdwb3J0LWNoYW5nZSBiZWZvcmUgaW5pdGlhbGl6YXRpb24nKTtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25zb2xlLmxvZygnc3ZnVXBkYXRlRXZlbnQnLCBzdmdVcGRhdGVFdmVudCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHRyaWdnZXJVcGRhdGUoKSB7XG4gICAgaWYgKHRoaXMuaXNSZW5kZXJpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmlzUmVuZGVyaW5nID0gdHJ1ZTtcbiAgICBjb25zdCBkb1VwZGF0ZSA9IGFzeW5jICgpID0+IHtcbiAgICAgIHRoaXMuY2FjaGVkRE9NU3RhdGUgPSB0aGlzLnJldHJpZXZlRE9NU3RhdGUoKTtcblxuICAgICAgaWYgKHRoaXMucGF0Y2hRdWV1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhpcy5pc1JlbmRlcmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBvc3Rwcm9jZXNzQ2hhbmdlcygpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGxldCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgICAgIGNvbnN0IGN0b2tlbiA9IHRoaXMuY2FudmFzUmVuZGVyQ1Rva2VuO1xuICAgICAgICBpZiAoY3Rva2VuKSB7XG4gICAgICAgICAgYXdhaXQgY3Rva2VuLmNhbmNlbCgpO1xuICAgICAgICAgIGF3YWl0IGN0b2tlbi53YWl0KCk7XG4gICAgICAgICAgdGhpcy5jYW52YXNSZW5kZXJDVG9rZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2NhbmNlbCBjYW52YXMgcmVuZGVyaW5nJyk7XG4gICAgICAgIH1cblxuICAgICAgICBsZXQgbmVlZFJlcmVuZGVyID0gZmFsc2U7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCdwYXRjaFF1ZXVlJywgSlNPTi5zdHJpbmdpZnkodGhpcy5wYXRjaFF1ZXVlLm1hcCh4ID0+IHhbMF0pKSk7XG4gICAgICAgIHdoaWxlICh0aGlzLnBhdGNoUXVldWUubGVuZ3RoID4gMCkge1xuICAgICAgICAgIG5lZWRSZXJlbmRlciA9IHRoaXMucHJvY2Vzc1F1ZXVlKHRoaXMucGF0Y2hRdWV1ZS5zaGlmdCgpISkgfHwgbmVlZFJlcmVuZGVyO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gdG9kbzogdHJpZ2dlciB2aWV3cG9ydCBjaGFuZ2Ugb25jZVxuICAgICAgICBsZXQgdDEgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgaWYgKG5lZWRSZXJlbmRlcikge1xuICAgICAgICAgIHRoaXMuci5yZXNjYWxlKCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yLnJlcmVuZGVyKCk7XG4gICAgICAgICAgdGhpcy5yLnJlc2NhbGUoKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICAgICAgICAvLy8gcGVyZiBldmVudFxuICAgICAgICBjb25zdCBkID0gKGU6IHN0cmluZywgeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IGAke2V9ICR7KHkgLSB4KS50b0ZpeGVkKDIpfSBtc2A7XG4gICAgICAgIHRoaXMuc2FtcGxlZFJlbmRlclRpbWUgPSB0MiAtIHQwO1xuICAgICAgICAvLyB0b2RvOiBsb2cgaW4gcHJvZHVjdGlvblxuICAgICAgICAvLyBjb25zb2xlLmxvZyhbZCgncGFyc2UnLCB0MCwgdDEpLCBkKCdyZXJlbmRlcicsIHQxLCB0MiksIGQoJ3RvdGFsJywgdDAsIHQyKV0uam9pbignLCAnKSk7XG5cbiAgICAgICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGRvVXBkYXRlKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgdGhpcy5pc1JlbmRlcmluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBvc3Rwcm9jZXNzQ2hhbmdlcygpO1xuICAgICAgfVxuICAgIH07XG4gICAgcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGRvVXBkYXRlKTtcbiAgfVxuXG4gIHByaXZhdGUgcG9zdHByb2Nlc3NDaGFuZ2VzKCkge1xuICAgIHRoaXMuci5wb3N0UmVuZGVyKCk7XG5cbiAgICAvLyB0b2RvOiBhYnN0cmFjdCB0aGlzXG4gICAgaWYgKHRoaXMucHJldmlld01vZGUgPT09IFByZXZpZXdNb2RlLlNsaWRlKSB7XG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcudHlwc3QtcGFnZS1udW1iZXItaW5kaWNhdG9yJykuZm9yRWFjaCh4ID0+IHtcbiAgICAgICAgeC50ZXh0Q29udGVudCA9IGAke3RoaXMua01vZHVsZS5yZXRyaWV2ZVBhZ2VzSW5mbygpLmxlbmd0aH1gO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgYWRkQ2hhbmdlbWVudChjaGFuZ2U6IFtzdHJpbmcsIHN0cmluZ10pIHtcbiAgICBpZiAoY2hhbmdlWzBdID09PSAnbmV3Jykge1xuICAgICAgdGhpcy5wYXRjaFF1ZXVlLnNwbGljZSgwLCB0aGlzLnBhdGNoUXVldWUubGVuZ3RoKTtcbiAgICB9XG5cbiAgICBjb25zdCBwdXNoQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgdGhpcy52cFRpbWVvdXQgPSB1bmRlZmluZWQ7XG4gICAgICB0aGlzLnBhdGNoUXVldWUucHVzaChjaGFuZ2UpO1xuICAgICAgdGhpcy50cmlnZ2VyVXBkYXRlKCk7XG4gICAgfTtcblxuICAgIGlmICh0aGlzLnZwVGltZW91dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjbGVhclRpbWVvdXQodGhpcy52cFRpbWVvdXQpO1xuICAgIH1cblxuICAgIGlmIChjaGFuZ2VbMF0gPT09ICd2aWV3cG9ydC1jaGFuZ2UnICYmIHRoaXMuaXNSZW5kZXJpbmcpIHtcbiAgICAgIC8vIGRlbGF5IHZpZXdwb3J0IGNoYW5nZSBhIGJpdFxuICAgICAgdGhpcy52cFRpbWVvdXQgPSBzZXRUaW1lb3V0KHB1c2hDaGFuZ2UsIHRoaXMuc2FtcGxlZFJlbmRlclRpbWUgfHwgMTAwKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcHVzaENoYW5nZSgpO1xuICAgIH1cbiAgfVxuXG4gIGFkZFZpZXdwb3J0Q2hhbmdlKCkge1xuICAgIHRoaXMuYWRkQ2hhbmdlbWVudChbJ3ZpZXdwb3J0LWNoYW5nZScsICcnXSk7XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBUeXBzdERvY3VtZW50PFQ+IHtcbiAgaW1wbDogVDtcbiAga01vZHVsZTogUmVuZGVyU2Vzc2lvbjtcbiAgZGlzcG9zZSgpOiB2b2lkO1xuICByZXNldCgpOiB2b2lkO1xuICBhZGRDaGFuZ2VtZW50KGNoYW5nZTogW3N0cmluZywgc3RyaW5nXSk6IHZvaWQ7XG4gIGFkZFZpZXdwb3J0Q2hhbmdlKCk6IHZvaWQ7XG4gIHNldFBhZ2VDb2xvcihjb2xvcjogc3RyaW5nKTogdm9pZDtcbiAgc2V0UGFydGlhbFJlbmRlcmluZyhwYXJ0aWFsUmVuZGVyaW5nOiBib29sZWFuKTogdm9pZDtcbiAgc2V0Q3Vyc29yKHBhZ2U6IG51bWJlciwgeDogbnVtYmVyLCB5OiBudW1iZXIpOiB2b2lkO1xuICBzZXRQYXJ0aWFsUGFnZU51bWJlcihwYWdlOiBudW1iZXIpOiBib29sZWFuO1xuICBnZXRQYXJ0aWFsUGFnZU51bWJlcigpOiBudW1iZXI7XG4gIHNldE91dGluZURhdGEob3V0bGluZTogYW55KTogdm9pZDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb3ZpZGVEb2M8VCBleHRlbmRzIFR5cHN0RG9jdW1lbnRDb250ZXh0PihcbiAgQmFzZTogR0NvbnN0cnVjdG9yPFQ+LFxuKTogbmV3IChvcHRpb25zOiBPcHRpb25zICYgVFsnb3B0cyddKSA9PiBUeXBzdERvY3VtZW50PFQ+IHtcbiAgcmV0dXJuIGNsYXNzIFR5cHN0RG9jdW1lbnQge1xuICAgIHB1YmxpYyBpbXBsOiBUO1xuICAgIHB1YmxpYyBrTW9kdWxlOiBSZW5kZXJTZXNzaW9uO1xuXG4gICAgY29uc3RydWN0b3Iob3B0aW9uczogT3B0aW9ucykge1xuICAgICAgaWYgKG9wdGlvbnMuaXNDb250ZW50UHJldmlldykge1xuICAgICAgICBvcHRpb25zLnJlbmRlck1vZGUgPSAnY2FudmFzJztcbiAgICAgIH1cblxuICAgICAgdGhpcy5rTW9kdWxlID0gb3B0aW9ucy5rTW9kdWxlO1xuICAgICAgdGhpcy5pbXBsID0gbmV3IEJhc2Uob3B0aW9ucyk7XG4gICAgICBpZiAoIXRoaXMuaW1wbC5yKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgbW9kZSBpcyBub3Qgc3VwcG9ydGVkLCAke29wdGlvbnM/LnJlbmRlck1vZGV9YCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChvcHRpb25zLmlzQ29udGVudFByZXZpZXcpIHtcbiAgICAgICAgLy8gY29udGVudCBwcmV2aWV3IGhhcyB2ZXJ5IGJhZCBwZXJmb3JtYW5jZSB3aXRob3V0IHBhcnRpYWwgcmVuZGVyaW5nXG4gICAgICAgIHRoaXMuaW1wbC5wYXJ0aWFsUmVuZGVyaW5nID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5pbXBsLnBpeGVsUGVyUHQgPSAxO1xuICAgICAgICB0aGlzLmltcGwuaXNNaXhpbk91dGxpbmUgPSB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICB0aGlzLmltcGwuZGlzcG9zZSgpO1xuICAgIH1cblxuICAgIHJlc2V0KCkge1xuICAgICAgdGhpcy5pbXBsLnJlc2V0KCk7XG4gICAgfVxuXG4gICAgYWRkQ2hhbmdlbWVudChjaGFuZ2U6IFtzdHJpbmcsIHN0cmluZ10pIHtcbiAgICAgIHRoaXMuaW1wbC5hZGRDaGFuZ2VtZW50KGNoYW5nZSk7XG4gICAgfVxuXG4gICAgYWRkVmlld3BvcnRDaGFuZ2UoKSB7XG4gICAgICB0aGlzLmltcGwuYWRkVmlld3BvcnRDaGFuZ2UoKTtcbiAgICB9XG5cbiAgICBzZXRQYWdlQ29sb3IoY29sb3I6IHN0cmluZykge1xuICAgICAgdGhpcy5pbXBsLnBhZ2VDb2xvciA9IGNvbG9yO1xuICAgICAgdGhpcy5hZGRWaWV3cG9ydENoYW5nZSgpO1xuICAgIH1cblxuICAgIHNldFBhcnRpYWxSZW5kZXJpbmcocGFydGlhbFJlbmRlcmluZzogYm9vbGVhbikge1xuICAgICAgdGhpcy5pbXBsLnBhcnRpYWxSZW5kZXJpbmcgPSBwYXJ0aWFsUmVuZGVyaW5nO1xuICAgIH1cblxuICAgIHNldEN1cnNvcihwYWdlOiBudW1iZXIsIHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgICB0aGlzLmltcGwuY3Vyc29yUG9zaXRpb24gPSBbcGFnZSwgeCwgeV07XG4gICAgfVxuXG4gICAgc2V0UGFydGlhbFBhZ2VOdW1iZXIocGFnZTogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgICBpZiAocGFnZSA8PSAwIHx8IHBhZ2UgPiB0aGlzLmtNb2R1bGUucmV0cmlldmVQYWdlc0luZm8oKS5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgdGhpcy5pbXBsLnBhcnRpYWxSZW5kZXJQYWdlID0gcGFnZSAtIDE7XG4gICAgICB0aGlzLmFkZFZpZXdwb3J0Q2hhbmdlKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICBnZXRQYXJ0aWFsUGFnZU51bWJlcigpOiBudW1iZXIge1xuICAgICAgcmV0dXJuIHRoaXMuaW1wbC5wYXJ0aWFsUmVuZGVyUGFnZSArIDE7XG4gICAgfVxuXG4gICAgc2V0T3V0aW5lRGF0YShvdXRsaW5lOiBhbnkpIHtcbiAgICAgIHRoaXMuaW1wbC5vdXRsaW5lID0gb3V0bGluZTtcbiAgICAgIHRoaXMuYWRkVmlld3BvcnRDaGFuZ2UoKTtcbiAgICB9XG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMT4oXG4gIEJhc2U6IFRCYXNlLFxuICBmMTogKGJhc2U6IFRCYXNlKSA9PiBGMSxcbik6IFRCYXNlICYgRjE7XG5leHBvcnQgZnVuY3Rpb24gY29tcG9zZURvYzxUQmFzZSBleHRlbmRzIEdDb25zdHJ1Y3RvciwgRjEsIEYyPihcbiAgQmFzZTogVEJhc2UsXG4gIGYxOiAoYmFzZTogVEJhc2UpID0+IEYxLFxuICBmMjogKGJhc2U6IEYxKSA9PiBGMixcbik6IFRCYXNlICYgRjEgJiBGMjtcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzPihcbiAgQmFzZTogVEJhc2UsXG4gIGYxOiAoYmFzZTogVEJhc2UpID0+IEYxLFxuICBmMjogKGJhc2U6IEYxKSA9PiBGMixcbiAgZjM6IChiYXNlOiBGMikgPT4gRjMsXG4pOiBUQmFzZSAmIEYxICYgRjIgJiBGMztcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGND4oXG4gIEJhc2U6IFRCYXNlLFxuICBmMTogKGJhc2U6IFRCYXNlKSA9PiBGMSxcbiAgZjI6IChiYXNlOiBGMSkgPT4gRjIsXG4gIGYzOiAoYmFzZTogRjIpID0+IEYzLFxuICBmNDogKGJhc2U6IEYzKSA9PiBGNCxcbik6IFRCYXNlICYgRjEgJiBGMiAmIEYzICYgRjQ7XG5leHBvcnQgZnVuY3Rpb24gY29tcG9zZURvYzxUQmFzZSBleHRlbmRzIEdDb25zdHJ1Y3RvciwgRjEsIEYyLCBGMywgRjQsIEY1PihcbiAgQmFzZTogVEJhc2UsXG4gIGYxOiAoYmFzZTogVEJhc2UpID0+IEYxLFxuICBmMjogKGJhc2U6IEYxKSA9PiBGMixcbiAgZjM6IChiYXNlOiBGMikgPT4gRjMsXG4gIGY0OiAoYmFzZTogRjMpID0+IEY0LFxuICBmNTogKGJhc2U6IEY0KSA9PiBGNSxcbik6IFRCYXNlICYgRjEgJiBGMiAmIEYzICYgRjQgJiBGNTtcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGNCwgRjUsIEY2PihcbiAgQmFzZTogVEJhc2UsXG4gIGYxOiAoYmFzZTogVEJhc2UpID0+IEYxLFxuICBmMjogKGJhc2U6IEYxKSA9PiBGMixcbiAgZjM6IChiYXNlOiBGMikgPT4gRjMsXG4gIGY0OiAoYmFzZTogRjMpID0+IEY0LFxuICBmNTogKGJhc2U6IEY0KSA9PiBGNSxcbiAgZjY6IChiYXNlOiBGNSkgPT4gRjYsXG4pOiBUQmFzZSAmIEYxICYgRjIgJiBGMyAmIEY0ICYgRjUgJiBGNjtcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGNCwgRjUsIEY2LCBGNz4oXG4gIEJhc2U6IFRCYXNlLFxuICBmMTogKGJhc2U6IFRCYXNlKSA9PiBGMSxcbiAgZjI6IChiYXNlOiBGMSkgPT4gRjIsXG4gIGYzOiAoYmFzZTogRjIpID0+IEYzLFxuICBmNDogKGJhc2U6IEYzKSA9PiBGNCxcbiAgZjU6IChiYXNlOiBGNCkgPT4gRjUsXG4gIGY2OiAoYmFzZTogRjUpID0+IEY2LFxuICBmNzogKGJhc2U6IEY2KSA9PiBGNyxcbik6IFRCYXNlICYgRjEgJiBGMiAmIEYzICYgRjQgJiBGNSAmIEY2ICYgRjc7XG5leHBvcnQgZnVuY3Rpb24gY29tcG9zZURvYzxUQmFzZSBleHRlbmRzIEdDb25zdHJ1Y3RvciwgRjEsIEYyLCBGMywgRjQsIEY1LCBGNiwgRjcsIEY4PihcbiAgQmFzZTogVEJhc2UsXG4gIGYxOiAoYmFzZTogVEJhc2UpID0+IEYxLFxuICBmMjogKGJhc2U6IEYxKSA9PiBGMixcbiAgZjM6IChiYXNlOiBGMikgPT4gRjMsXG4gIGY0OiAoYmFzZTogRjMpID0+IEY0LFxuICBmNTogKGJhc2U6IEY0KSA9PiBGNSxcbiAgZjY6IChiYXNlOiBGNSkgPT4gRjYsXG4gIGY3OiAoYmFzZTogRjYpID0+IEY3LFxuICBmODogKGJhc2U6IEY3KSA9PiBGOCxcbik6IFRCYXNlICYgRjEgJiBGMiAmIEYzICYgRjQgJiBGNSAmIEY2ICYgRjcgJiBGODtcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yLCBGMSwgRjIsIEYzLCBGNCwgRjUsIEY2LCBGNywgRjgsIEY5PihcbiAgQmFzZTogVEJhc2UsXG4gIGYxOiAoYmFzZTogVEJhc2UpID0+IEYxLFxuICBmMjogKGJhc2U6IEYxKSA9PiBGMixcbiAgZjM6IChiYXNlOiBGMikgPT4gRjMsXG4gIGY0OiAoYmFzZTogRjMpID0+IEY0LFxuICBmNTogKGJhc2U6IEY0KSA9PiBGNSxcbiAgZjY6IChiYXNlOiBGNSkgPT4gRjYsXG4gIGY3OiAoYmFzZTogRjYpID0+IEY3LFxuICBmODogKGJhc2U6IEY3KSA9PiBGOCxcbiAgZjk6IChiYXNlOiBGOCkgPT4gRjksXG4pOiBUQmFzZSAmIEYxICYgRjIgJiBGMyAmIEY0ICYgRjUgJiBGNiAmIEY3ICYgRjggJiBGOTtcbmV4cG9ydCBmdW5jdGlvbiBjb21wb3NlRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yPihCYXNlOiBUQmFzZSwgLi4ubWl4aW5zOiBhbnlbXSk6IFRCYXNlIHtcbiAgcmV0dXJuIG1peGlucy5yZWR1Y2UoKGFjYywgbWl4aW4pID0+IG1peGluKGFjYyksIEJhc2UpO1xufVxuIl19","export class TypstCancellationToken {\n    isCancellationRequested = false;\n    _onCancelled;\n    _onCancelledResolveResolved;\n    constructor() {\n        let resolveT = undefined;\n        let resolveX = undefined;\n        this._onCancelled = new Promise(resolve => {\n            resolveT = resolve;\n            if (resolveX) {\n                resolveX(resolve);\n            }\n        });\n        this._onCancelledResolveResolved = new Promise(resolve => {\n            resolveX = resolve;\n            if (resolveT) {\n                resolve(resolveT);\n            }\n        });\n    }\n    async cancel() {\n        await this._onCancelledResolveResolved;\n        this.isCancellationRequested = true;\n    }\n    isCancelRequested() {\n        return this.isCancellationRequested;\n    }\n    async consume() {\n        (await this._onCancelledResolveResolved)();\n    }\n    wait() {\n        return this._onCancelled;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHlwc3QtY2FuY2VsLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb250cmliL2RvbS90eXBzdC1jYW5jZWwubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE1BQU0sT0FBTyxzQkFBc0I7SUFDakMsdUJBQXVCLEdBQVksS0FBSyxDQUFDO0lBQ2pDLFlBQVksQ0FBZ0I7SUFDNUIsMkJBQTJCLENBQXNCO0lBRXpEO1FBQ0UsSUFBSSxRQUFRLEdBQWUsU0FBVSxDQUFDO1FBQ3RDLElBQUksUUFBUSxHQUE0QixTQUFVLENBQUM7UUFDbkQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUN4QyxRQUFRLEdBQUcsT0FBTyxDQUFDO1lBQ25CLElBQUksUUFBUSxFQUFFLENBQUM7Z0JBQ2IsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ3BCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUNILElBQUksQ0FBQywyQkFBMkIsR0FBRyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUN2RCxRQUFRLEdBQUcsT0FBTyxDQUFDO1lBQ25CLElBQUksUUFBUSxFQUFFLENBQUM7Z0JBQ2IsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3BCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFRCxLQUFLLENBQUMsTUFBTTtRQUNWLE1BQU0sSUFBSSxDQUFDLDJCQUEyQixDQUFDO1FBQ3ZDLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLENBQUM7SUFDdEMsQ0FBQztJQUVELGlCQUFpQjtRQUNmLE9BQU8sSUFBSSxDQUFDLHVCQUF1QixDQUFDO0lBQ3RDLENBQUM7SUFFRCxLQUFLLENBQUMsT0FBTztRQUNYLENBQUMsTUFBTSxJQUFJLENBQUMsMkJBQTJCLENBQUMsRUFBRSxDQUFDO0lBQzdDLENBQUM7SUFFRCxJQUFJO1FBQ0YsT0FBTyxJQUFJLENBQUMsWUFBWSxDQUFDO0lBQzNCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBUeXBzdENhbmNlbGxhdGlvblRva2VuIHtcbiAgaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgcHJpdmF0ZSBfb25DYW5jZWxsZWQ6IFByb21pc2U8dm9pZD47XG4gIHByaXZhdGUgX29uQ2FuY2VsbGVkUmVzb2x2ZVJlc29sdmVkOiBQcm9taXNlPCgpID0+IHZvaWQ+O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIGxldCByZXNvbHZlVDogKCkgPT4gdm9pZCA9IHVuZGVmaW5lZCE7XG4gICAgbGV0IHJlc29sdmVYOiAoXzogKCkgPT4gdm9pZCkgPT4gdm9pZCA9IHVuZGVmaW5lZCE7XG4gICAgdGhpcy5fb25DYW5jZWxsZWQgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgIHJlc29sdmVUID0gcmVzb2x2ZTtcbiAgICAgIGlmIChyZXNvbHZlWCkge1xuICAgICAgICByZXNvbHZlWChyZXNvbHZlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICB0aGlzLl9vbkNhbmNlbGxlZFJlc29sdmVSZXNvbHZlZCA9IG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgcmVzb2x2ZVggPSByZXNvbHZlO1xuICAgICAgaWYgKHJlc29sdmVUKSB7XG4gICAgICAgIHJlc29sdmUocmVzb2x2ZVQpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY2FuY2VsKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuX29uQ2FuY2VsbGVkUmVzb2x2ZVJlc29sdmVkO1xuICAgIHRoaXMuaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQgPSB0cnVlO1xuICB9XG5cbiAgaXNDYW5jZWxSZXF1ZXN0ZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNDYW5jZWxsYXRpb25SZXF1ZXN0ZWQ7XG4gIH1cblxuICBhc3luYyBjb25zdW1lKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIChhd2FpdCB0aGlzLl9vbkNhbmNlbGxlZFJlc29sdmVSZXNvbHZlZCkoKTtcbiAgfVxuXG4gIHdhaXQoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIHRoaXMuX29uQ2FuY2VsbGVkO1xuICB9XG59XG4iXX0=","import { kObject } from './internal.types.mjs';\nimport { TypstDocumentContext, composeDoc, provideDoc, } from './contrib/dom/typst-doc.mjs';\nimport { TypstCancellationToken } from './contrib/dom/typst-cancel.mjs';\nconst animationFrame = () => new Promise(resolve => requestAnimationFrame(resolve));\nclass DomPage {\n    dispose() { }\n}\nvar TrackMode;\n(function (TrackMode) {\n    TrackMode[TrackMode[\"Doc\"] = 0] = \"Doc\";\n    TrackMode[TrackMode[\"Pages\"] = 1] = \"Pages\";\n})(TrackMode || (TrackMode = {}));\nvar RepaintStage;\n(function (RepaintStage) {\n    RepaintStage[RepaintStage[\"Layout\"] = 0] = \"Layout\";\n    RepaintStage[RepaintStage[\"Svg\"] = 1] = \"Svg\";\n    RepaintStage[RepaintStage[\"Semantics\"] = 2] = \"Semantics\";\n    RepaintStage[RepaintStage[\"PrepareCanvas\"] = 3] = \"PrepareCanvas\";\n    RepaintStage[RepaintStage[\"Canvas\"] = 4] = \"Canvas\";\n})(RepaintStage || (RepaintStage = {}));\nexport function provideDomDoc(Base) {\n    return class DomDocument extends Base {\n        /// The template element for creating DOM by string.\n        tmpl = document.createElement('template');\n        /// The stub element for replacing an invisible element.\n        stub = this.createElement('<stub></stub>');\n        /// Typescript side of lib.\n        plugin;\n        /// Rust side of kernel.\n        docKernel;\n        /// The element to track.\n        resourceHeader = undefined;\n        /// Expected exact state of the current DOM.\n        /// Initially it is empty meaning no any page is rendered.\n        pages = [];\n        /// The virtual scale of the document.\n        domScale = 1;\n        /// Track mode.\n        track_mode = TrackMode.Doc;\n        /// Current executing task.\n        current_task = undefined;\n        /// The currently maintained viewport.\n        viewport;\n        constructor(...args) {\n            super(...args);\n            this.registerMode('dom');\n            this.disposeList.push(() => {\n                this.dispose();\n            });\n            this.plugin = this.opts.renderer;\n            if (this.opts.domScale !== undefined) {\n                if (this.opts.domScale <= 0) {\n                    throw new Error('domScale must be positive');\n                }\n                this.domScale = this.opts.domScale;\n            }\n        }\n        dispose() {\n            for (const page of this.pages) {\n                page.dispose();\n            }\n            if (this.docKernel) {\n                this.docKernel.free();\n            }\n        }\n        createElement(tmpl) {\n            this.tmpl.innerHTML = tmpl;\n            return this.tmpl.content.firstElementChild;\n        }\n        async mountDom(pixelPerPt) {\n            // console.log('mountDom', pixelPerPt);\n            if (this.docKernel) {\n                throw new Error('already mounted');\n            }\n            // create typst-svg-resources by string\n            this.hookedElem.innerHTML = `<svg class=\"typst-svg-resources\" viewBox=\"0 0 0 0\" width=\"0\" height=\"0\" style=\"opacity: 0; position: absolute;\"></svg>`;\n            this.resourceHeader = this.hookedElem.querySelector('.typst-svg-resources');\n            this.docKernel = await this.plugin.renderer.mount_dom(this.kModule[kObject], this.hookedElem);\n            this.docKernel.bind_functions({\n                populateGlyphs: (data) => {\n                    let svg = this.createElement(data);\n                    // console.log('populateGlyphs', svg);\n                    let content = svg.firstElementChild;\n                    this.resourceHeader.append(content);\n                },\n            });\n        }\n        async cancelAnyway$dom() {\n            // console.log('cancelAnyway$dom');\n            if (this.current_task) {\n                const task = this.current_task;\n                this.current_task = undefined;\n                await task.cancel();\n            }\n        }\n        retrieveDOMPages() {\n            return Array.from(this.hookedElem.querySelectorAll('.typst-dom-page'));\n        }\n        // doesn't need to postRender\n        postRender$dom() { }\n        // doesn't need to rescale\n        rescale$dom() { }\n        getDomViewport(cachedWindow, cachedBoundingRect) {\n            const left = cachedBoundingRect.left;\n            const top = -cachedBoundingRect.top;\n            const right = cachedBoundingRect.right;\n            const bottom = cachedWindow.innerHeight - cachedBoundingRect.top;\n            const rect = {\n                x: 0,\n                y: top / this.domScale,\n                width: Math.max(right - left, 0) / this.domScale,\n                height: Math.max(bottom - top, 0) / this.domScale,\n            };\n            if (rect.width <= 0 || rect.height <= 0) {\n                rect.x = rect.y = rect.width = rect.height = 0;\n            }\n            // console.log('ccc', basePos, appPos, rect);\n            return rect;\n        }\n        // fast mode\n        async rerender$dom() {\n            const domState = this.retrieveDOMState();\n            // const l = domState.boundingRect.left;\n            const { x, y, width, height } = this.getDomViewport(domState.window, domState.boundingRect);\n            let dirty = await this.docKernel.relayout(x, y, width, height);\n            if (!dirty) {\n                return;\n            }\n            const cancel = new TypstCancellationToken();\n            this.doRender$dom(cancel);\n            this.current_task = cancel;\n        }\n        async doRender$dom(ctx) {\n            const condOrExit = (needFrame, cb) => {\n                if (needFrame && !ctx.isCancelRequested() && cb) {\n                    return cb();\n                }\n            };\n            const pages = this.retrieveDOMPages().map(page => {\n                const { innerWidth, innerHeight } = window;\n                const browserBBox = page.getBoundingClientRect();\n                // any part of the page is in the window\n                return {\n                    inWindow: !(browserBBox.left > innerWidth ||\n                        browserBBox.right < 0 ||\n                        browserBBox.top > innerHeight ||\n                        browserBBox.bottom < 0),\n                    page,\n                };\n            });\n            const renderPage = async (i) => {\n                await animationFrame();\n                if (ctx.isCancelRequested()) {\n                    // console.log('cancel stage', RepaintStage.Layout, i);\n                    return undefined;\n                }\n                const page = pages[i].page;\n                const browserBBox = page.getBoundingClientRect();\n                const v = this.getDomViewport(window, browserBBox);\n                const needCalc = (stage) => this.docKernel.need_repaint(i, v.x, v.y, v.width, v.height, stage);\n                const repaint = (stage) => this.docKernel.repaint(i, v.x, v.y, v.width, v.height, stage);\n                const calc = (stage) => {\n                    if (ctx.isCancelRequested()) {\n                        return undefined;\n                    }\n                    return condOrExit(needCalc(stage), () => repaint(stage));\n                };\n                await calc(RepaintStage.Layout);\n                const wScale = (browserBBox.width\n                    ? Number.parseFloat(page.getAttribute('data-width')) / browserBBox.width\n                    : 1) * this.domScale;\n                const hScale = (browserBBox.height\n                    ? Number.parseFloat(page.getAttribute('data-height')) / browserBBox.height\n                    : 1) * this.domScale;\n                v.x *= wScale;\n                v.y *= hScale;\n                v.y -= 100;\n                v.width *= wScale;\n                v.height *= hScale;\n                v.height += 200;\n                await calc(RepaintStage.Svg);\n                await calc(RepaintStage.Semantics);\n                if (ctx.isCancelRequested()) {\n                    // console.log('cancel stage', RepaintStage.Semantics, i);\n                    return undefined;\n                }\n                if (needCalc(RepaintStage.PrepareCanvas)) {\n                    const calcCanvasAfterPreparing = async () => {\n                        await repaint(RepaintStage.PrepareCanvas);\n                        if (ctx.isCancelRequested()) {\n                            return undefined;\n                        }\n                        return calc(RepaintStage.Canvas);\n                    };\n                    calcCanvasAfterPreparing();\n                }\n                else {\n                    await calc(RepaintStage.Canvas);\n                }\n            };\n            const renderPages = async (inWindow) => {\n                for (let idx = 0; idx < pages.length; ++idx) {\n                    if (ctx.isCancelRequested()) {\n                        // console.log('cancel page', RepaintStage.Layout, idx);\n                        return;\n                    }\n                    if (pages[idx].inWindow === inWindow) {\n                        await renderPage(idx);\n                    }\n                }\n            };\n            this.cancelAnyway$dom();\n            await renderPages(true);\n            await renderPages(false);\n            if (ctx.isCancelRequested()) {\n                return;\n            }\n            // console.log('finished', RepaintStage.Layout);\n        }\n    };\n}\nexport class TypstDomDocument extends provideDoc(composeDoc(TypstDocumentContext, provideDomDoc)) {\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZG9tLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kb20ubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBUSxPQUFPLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUVyRCxPQUFPLEVBRUwsb0JBQW9CLEVBQ3BCLFVBQVUsRUFDVixVQUFVLEdBQ1gsTUFBTSw2QkFBNkIsQ0FBQztBQUNyQyxPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUV4RSxNQUFNLGNBQWMsR0FBRyxHQUFHLEVBQUUsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLHFCQUFxQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7QUFFcEYsTUFBTSxPQUFPO0lBQ1gsT0FBTyxLQUFLLENBQUM7Q0FDZDtBQUVELElBQVcsU0FHVjtBQUhELFdBQVcsU0FBUztJQUNsQix1Q0FBRyxDQUFBO0lBQ0gsMkNBQUssQ0FBQTtBQUNQLENBQUMsRUFIVSxTQUFTLEtBQVQsU0FBUyxRQUduQjtBQUVELElBQVcsWUFNVjtBQU5ELFdBQVcsWUFBWTtJQUNyQixtREFBVSxDQUFBO0lBQ1YsNkNBQU8sQ0FBQTtJQUNQLHlEQUFhLENBQUE7SUFDYixpRUFBaUIsQ0FBQTtJQUNqQixtREFBVSxDQUFBO0FBQ1osQ0FBQyxFQU5VLFlBQVksS0FBWixZQUFZLFFBTXRCO0FBZUQsTUFBTSxVQUFVLGFBQWEsQ0FDM0IsSUFBVztJQUVYLE9BQU8sTUFBTSxXQUFZLFNBQVEsSUFBSTtRQUNuQyxvREFBb0Q7UUFDcEQsSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDMUMsd0RBQXdEO1FBQ3hELElBQUksR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzNDLDJCQUEyQjtRQUMzQixNQUFNLENBQXNCO1FBQzVCLHdCQUF3QjtRQUN4QixTQUFTLENBQW1CO1FBQzVC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RCxPQUFPO29CQUNULENBQUM7b0JBQ0QsSUFBSSxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxLQUFLLFFBQVEsRUFBRSxDQUFDO3dCQUNyQyxNQUFNLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDeEIsQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQyxDQUFDO1lBRUYsSUFBSSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFeEIsTUFBTSxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDeEIsTUFBTSxXQUFXLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDekIsSUFBSSxHQUFHLENBQUMsaUJBQWlCLEVBQUUsRUFBRSxDQUFDO2dCQUM1QixPQUFPO1lBQ1QsQ0FBQztZQUNELGdEQUFnRDtRQUNsRCxDQUFDO0tBQ0YsQ0FBQztBQUNKLENBQUM7QUFFRCxNQUFNLE9BQU8sZ0JBQWlCLFNBQVEsVUFBVSxDQUM5QyxVQUFVLENBQ1Isb0JBQTBFLEVBQzFFLGFBQWEsQ0FDZCxDQUNGO0NBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEluY3JEb21Eb2NDbGllbnQgfSBmcm9tICdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy1yZW5kZXJlcic7XG5pbXBvcnQgeyBSZWN0LCBrT2JqZWN0IH0gZnJvbSAnLi9pbnRlcm5hbC50eXBlcy5tanMnO1xuaW1wb3J0IHsgVHlwc3RSZW5kZXJlciwgVHlwc3RSZW5kZXJlckRyaXZlciB9IGZyb20gJy4vcmVuZGVyZXIubWpzJztcbmltcG9ydCB7XG4gIEdDb25zdHJ1Y3RvcixcbiAgVHlwc3REb2N1bWVudENvbnRleHQsXG4gIGNvbXBvc2VEb2MsXG4gIHByb3ZpZGVEb2MsXG59IGZyb20gJy4vY29udHJpYi9kb20vdHlwc3QtZG9jLm1qcyc7XG5pbXBvcnQgeyBUeXBzdENhbmNlbGxhdGlvblRva2VuIH0gZnJvbSAnLi9jb250cmliL2RvbS90eXBzdC1jYW5jZWwubWpzJztcblxuY29uc3QgYW5pbWF0aW9uRnJhbWUgPSAoKSA9PiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZShyZXNvbHZlKSk7XG5cbmNsYXNzIERvbVBhZ2Uge1xuICBkaXNwb3NlKCkgeyB9XG59XG5cbmNvbnN0IGVudW0gVHJhY2tNb2RlIHtcbiAgRG9jLFxuICBQYWdlcyxcbn1cblxuY29uc3QgZW51bSBSZXBhaW50U3RhZ2Uge1xuICBMYXlvdXQgPSAwLFxuICBTdmcgPSAxLFxuICBTZW1hbnRpY3MgPSAyLFxuICBQcmVwYXJlQ2FudmFzID0gMyxcbiAgQ2FudmFzID0gNCxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBJVHlwc3REb21Eb2N1bWVudCB7XG4gIG1vdW50RG9tKHBpeGVsUGVyUHQ6IG51bWJlciB8IHVuZGVmaW5lZCk6IFByb21pc2U8dm9pZD47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW5pdERvbURvY0FyZ3Mge1xuICByZW5kZXJlcjogVHlwc3RSZW5kZXJlcjtcbiAgZG9tU2NhbGU/OiBudW1iZXI7XG59XG5cbmludGVyZmFjZSBSZW5kZXJUYXNrIHtcbiAgY2FuY2VsKCk6IFByb21pc2U8dm9pZD47XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwcm92aWRlRG9tRG9jPFRCYXNlIGV4dGVuZHMgR0NvbnN0cnVjdG9yPFR5cHN0RG9jdW1lbnRDb250ZXh0PEluaXREb21Eb2NBcmdzPj4+KFxuICBCYXNlOiBUQmFzZSxcbik6IFRCYXNlICYgR0NvbnN0cnVjdG9yPElUeXBzdERvbURvY3VtZW50PiB7XG4gIHJldHVybiBjbGFzcyBEb21Eb2N1bWVudCBleHRlbmRzIEJhc2Uge1xuICAgIC8vLyBUaGUgdGVtcGxhdGUgZWxlbWVudCBmb3IgY3JlYXRpbmcgRE9NIGJ5IHN0cmluZy5cbiAgICB0bXBsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGVtcGxhdGUnKTtcbiAgICAvLy8gVGhlIHN0dWIgZWxlbWVudCBmb3IgcmVwbGFjaW5nIGFuIGludmlzaWJsZSBlbGVtZW50LlxuICAgIHN0dWIgPSB0aGlzLmNyZWF0ZUVsZW1lbnQoJzxzdHViPjwvc3R1Yj4nKTtcbiAgICAvLy8gVHlwZXNjcmlwdCBzaWRlIG9mIGxpYi5cbiAgICBwbHVnaW46IFR5cHN0UmVuZGVyZXJEcml2ZXI7XG4gICAgLy8vIFJ1c3Qgc2lkZSBvZiBrZXJuZWwuXG4gICAgZG9jS2VybmVsOiBJbmNyRG9tRG9jQ2xpZW50O1xuICAgIC8vLyBUaGUgZWxlbWVudCB0byB0cmFjay5cbiAgICByZXNvdXJjZUhlYWRlcjogU1ZHRWxlbWVudCA9IHVuZGVmaW5lZCE7XG4gICAgLy8vIEV4cGVjdGVkIGV4YWN0IHN0YXRlIG9mIHRoZSBjdXJyZW50IERPTS5cbiAgICAvLy8gSW5pdGlhbGx5IGl0IGlzIGVtcHR5IG1lYW5pbmcgbm8gYW55IHBhZ2UgaXMgcmVuZGVyZWQuXG4gICAgcGFnZXM6IERvbVBhZ2VbXSA9IFtdO1xuICAgIC8vLyBUaGUgdmlydHVhbCBzY2FsZSBvZiB0aGUgZG9jdW1lbnQuXG4gICAgZG9tU2NhbGUgPSAxO1xuICAgIC8vLyBUcmFjayBtb2RlLlxuICAgIHRyYWNrX21vZGU6IFRyYWNrTW9kZSA9IFRyYWNrTW9kZS5Eb2M7XG4gICAgLy8vIEN1cnJlbnQgZXhlY3V0aW5nIHRhc2suXG4gICAgY3VycmVudF90YXNrPzogUmVuZGVyVGFzayA9IHVuZGVmaW5lZDtcbiAgICAvLy8gVGhlIGN1cnJlbnRseSBtYWludGFpbmVkIHZpZXdwb3J0LlxuICAgIHZpZXdwb3J0OiBSZWN0O1xuICAgIGNvbnN0cnVjdG9yKC4uLmFyZ3M6IGFueVtdKSB7XG4gICAgICBzdXBlciguLi5hcmdzKTtcbiAgICAgIHRoaXMucmVnaXN0ZXJNb2RlKCdkb20nKTtcbiAgICAgIHRoaXMuZGlzcG9zZUxpc3QucHVzaCgoKSA9PiB7XG4gICAgICAgIHRoaXMuZGlzcG9zZSgpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLnBsdWdpbiA9IHRoaXMub3B0cy5yZW5kZXJlciBhcyBhbnkgYXMgVHlwc3RSZW5kZXJlckRyaXZlcjtcbiAgICAgIGlmICh0aGlzLm9wdHMuZG9tU2NhbGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAodGhpcy5vcHRzLmRvbVNjYWxlIDw9IDApIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2RvbVNjYWxlIG11c3QgYmUgcG9zaXRpdmUnKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRvbVNjYWxlID0gdGhpcy5vcHRzLmRvbVNjYWxlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGRpc3Bvc2UoKSB7XG4gICAgICBmb3IgKGNvbnN0IHBhZ2Ugb2YgdGhpcy5wYWdlcykge1xuICAgICAgICBwYWdlLmRpc3Bvc2UoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuZG9jS2VybmVsKSB7XG4gICAgICAgIHRoaXMuZG9jS2VybmVsLmZyZWUoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjcmVhdGVFbGVtZW50KHRtcGw6IHN0cmluZykge1xuICAgICAgdGhpcy50bXBsLmlubmVySFRNTCA9IHRtcGw7XG4gICAgICByZXR1cm4gdGhpcy50bXBsLmNvbnRlbnQuZmlyc3RFbGVtZW50Q2hpbGQ7XG4gICAgfVxuXG4gICAgYXN5bmMgbW91bnREb20ocGl4ZWxQZXJQdDogbnVtYmVyIHwgdW5kZWZpbmVkKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnbW91bnREb20nLCBwaXhlbFBlclB0KTtcblxuICAgICAgaWYgKHRoaXMuZG9jS2VybmVsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignYWxyZWFkeSBtb3VudGVkJyk7XG4gICAgICB9XG5cbiAgICAgIC8vIGNyZWF0ZSB0eXBzdC1zdmctcmVzb3VyY2VzIGJ5IHN0cmluZ1xuICAgICAgdGhpcy5ob29rZWRFbGVtLmlubmVySFRNTCA9IGA8c3ZnIGNsYXNzPVwidHlwc3Qtc3ZnLXJlc291cmNlc1wiIHZpZXdCb3g9XCIwIDAgMCAwXCIgd2lkdGg9XCIwXCIgaGVpZ2h0PVwiMFwiIHN0eWxlPVwib3BhY2l0eTogMDsgcG9zaXRpb246IGFic29sdXRlO1wiPjwvc3ZnPmA7XG4gICAgICB0aGlzLnJlc291cmNlSGVhZGVyID0gdGhpcy5ob29rZWRFbGVtLnF1ZXJ5U2VsZWN0b3IoJy50eXBzdC1zdmctcmVzb3VyY2VzJykhO1xuXG4gICAgICB0aGlzLmRvY0tlcm5lbCA9IGF3YWl0IHRoaXMucGx1Z2luLnJlbmRlcmVyLm1vdW50X2RvbSh0aGlzLmtNb2R1bGVba09iamVjdF0sIHRoaXMuaG9va2VkRWxlbSk7XG5cbiAgICAgIHRoaXMuZG9jS2VybmVsLmJpbmRfZnVuY3Rpb25zKHtcbiAgICAgICAgcG9wdWxhdGVHbHlwaHM6IChkYXRhOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBsZXQgc3ZnID0gdGhpcy5jcmVhdGVFbGVtZW50KGRhdGEpITtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygncG9wdWxhdGVHbHlwaHMnLCBzdmcpO1xuICAgICAgICAgIGxldCBjb250ZW50ID0gc3ZnLmZpcnN0RWxlbWVudENoaWxkITtcbiAgICAgICAgICB0aGlzLnJlc291cmNlSGVhZGVyLmFwcGVuZChjb250ZW50KTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGFzeW5jIGNhbmNlbEFueXdheSRkb20oKSB7XG4gICAgICAvLyBjb25zb2xlLmxvZygnY2FuY2VsQW55d2F5JGRvbScpO1xuICAgICAgaWYgKHRoaXMuY3VycmVudF90YXNrKSB7XG4gICAgICAgIGNvbnN0IHRhc2sgPSB0aGlzLmN1cnJlbnRfdGFzaztcbiAgICAgICAgdGhpcy5jdXJyZW50X3Rhc2sgPSB1bmRlZmluZWQ7XG4gICAgICAgIGF3YWl0IHRhc2suY2FuY2VsKCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0cmlldmVET01QYWdlcygpIHtcbiAgICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMuaG9va2VkRWxlbS5xdWVyeVNlbGVjdG9yQWxsKCcudHlwc3QtZG9tLXBhZ2UnKSk7XG4gICAgfVxuXG4gICAgLy8gZG9lc24ndCBuZWVkIHRvIHBvc3RSZW5kZXJcbiAgICBwb3N0UmVuZGVyJGRvbSgpIHsgfVxuXG4gICAgLy8gZG9lc24ndCBuZWVkIHRvIHJlc2NhbGVcbiAgICByZXNjYWxlJGRvbSgpIHsgfVxuXG4gICAgZ2V0RG9tVmlld3BvcnQoXG4gICAgICBjYWNoZWRXaW5kb3c6IFBpY2s8V2luZG93LCAnaW5uZXJIZWlnaHQnIHwgJ2lubmVyV2lkdGgnPixcbiAgICAgIGNhY2hlZEJvdW5kaW5nUmVjdDogUGljazxET01SZWN0LCAnbGVmdCcgfCAndG9wJyB8ICdyaWdodCc+LFxuICAgICkge1xuICAgICAgY29uc3QgbGVmdCA9IGNhY2hlZEJvdW5kaW5nUmVjdC5sZWZ0O1xuICAgICAgY29uc3QgdG9wID0gLWNhY2hlZEJvdW5kaW5nUmVjdC50b3A7XG4gICAgICBjb25zdCByaWdodCA9IGNhY2hlZEJvdW5kaW5nUmVjdC5yaWdodDtcbiAgICAgIGNvbnN0IGJvdHRvbSA9IGNhY2hlZFdpbmRvdy5pbm5lckhlaWdodCAtIGNhY2hlZEJvdW5kaW5nUmVjdC50b3A7XG4gICAgICBjb25zdCByZWN0ID0ge1xuICAgICAgICB4OiAwLFxuICAgICAgICB5OiB0b3AgLyB0aGlzLmRvbVNjYWxlLFxuICAgICAgICB3aWR0aDogTWF0aC5tYXgocmlnaHQgLSBsZWZ0LCAwKSAvIHRoaXMuZG9tU2NhbGUsXG4gICAgICAgIGhlaWdodDogTWF0aC5tYXgoYm90dG9tIC0gdG9wLCAwKSAvIHRoaXMuZG9tU2NhbGUsXG4gICAgICB9O1xuICAgICAgaWYgKHJlY3Qud2lkdGggPD0gMCB8fCByZWN0LmhlaWdodCA8PSAwKSB7XG4gICAgICAgIHJlY3QueCA9IHJlY3QueSA9IHJlY3Qud2lkdGggPSByZWN0LmhlaWdodCA9IDA7XG4gICAgICB9XG4gICAgICAvLyBjb25zb2xlLmxvZygnY2NjJywgYmFzZVBvcywgYXBwUG9zLCByZWN0KTtcbiAgICAgIHJldHVybiByZWN0O1xuICAgIH1cblxuICAgIC8vIGZhc3QgbW9kZVxuICAgIGFzeW5jIHJlcmVuZGVyJGRvbSgpIHtcbiAgICAgIGNvbnN0IGRvbVN0YXRlID0gdGhpcy5yZXRyaWV2ZURPTVN0YXRlKCk7XG5cbiAgICAgIC8vIGNvbnN0IGwgPSBkb21TdGF0ZS5ib3VuZGluZ1JlY3QubGVmdDtcbiAgICAgIGNvbnN0IHsgeCwgeSwgd2lkdGgsIGhlaWdodCB9ID0gdGhpcy5nZXREb21WaWV3cG9ydChkb21TdGF0ZS53aW5kb3csIGRvbVN0YXRlLmJvdW5kaW5nUmVjdCk7XG5cbiAgICAgIGxldCBkaXJ0eSA9IGF3YWl0IHRoaXMuZG9jS2VybmVsLnJlbGF5b3V0KHgsIHksIHdpZHRoLCBoZWlnaHQpO1xuICAgICAgaWYgKCFkaXJ0eSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNhbmNlbCA9IG5ldyBUeXBzdENhbmNlbGxhdGlvblRva2VuKCk7XG4gICAgICB0aGlzLmRvUmVuZGVyJGRvbShjYW5jZWwpO1xuICAgICAgdGhpcy5jdXJyZW50X3Rhc2sgPSBjYW5jZWw7XG4gICAgfVxuXG4gICAgYXN5bmMgZG9SZW5kZXIkZG9tKGN0eDogVHlwc3RDYW5jZWxsYXRpb25Ub2tlbikge1xuICAgICAgY29uc3QgY29uZE9yRXhpdCA9IDxULD4obmVlZEZyYW1lOiBib29sZWFuLCBjYjogKCkgPT4gUHJvbWlzZTxUPikgPT4ge1xuICAgICAgICBpZiAobmVlZEZyYW1lICYmICFjdHguaXNDYW5jZWxSZXF1ZXN0ZWQoKSAmJiBjYikge1xuICAgICAgICAgIHJldHVybiBjYigpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgY29uc3QgcGFnZXMgPSB0aGlzLnJldHJpZXZlRE9NUGFnZXMoKS5tYXAocGFnZSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaW5uZXJXaWR0aCwgaW5uZXJIZWlnaHQgfSA9IHdpbmRvdztcbiAgICAgICAgY29uc3QgYnJvd3NlckJCb3ggPSBwYWdlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICAvLyBhbnkgcGFydCBvZiB0aGUgcGFnZSBpcyBpbiB0aGUgd2luZG93XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgaW5XaW5kb3c6ICEoXG4gICAgICAgICAgICBicm93c2VyQkJveC5sZWZ0ID4gaW5uZXJXaWR0aCB8fFxuICAgICAgICAgICAgYnJvd3NlckJCb3gucmlnaHQgPCAwIHx8XG4gICAgICAgICAgICBicm93c2VyQkJveC50b3AgPiBpbm5lckhlaWdodCB8fFxuICAgICAgICAgICAgYnJvd3NlckJCb3guYm90dG9tIDwgMFxuICAgICAgICAgICksXG4gICAgICAgICAgcGFnZSxcbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgY29uc3QgcmVuZGVyUGFnZSA9IGFzeW5jIChpOiBudW1iZXIpID0+IHtcbiAgICAgICAgYXdhaXQgYW5pbWF0aW9uRnJhbWUoKTtcbiAgICAgICAgaWYgKGN0eC5pc0NhbmNlbFJlcXVlc3RlZCgpKSB7XG4gICAgICAgICAgLy8gY29uc29sZS5sb2coJ2NhbmNlbCBzdGFnZScsIFJlcGFpbnRTdGFnZS5MYXlvdXQsIGkpO1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcGFnZSA9IHBhZ2VzW2ldLnBhZ2U7XG4gICAgICAgIGNvbnN0IGJyb3dzZXJCQm94ID0gcGFnZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgY29uc3QgdiA9IHRoaXMuZ2V0RG9tVmlld3BvcnQod2luZG93LCBicm93c2VyQkJveCk7XG5cbiAgICAgICAgY29uc3QgbmVlZENhbGMgPSAoc3RhZ2U6IFJlcGFpbnRTdGFnZSkgPT5cbiAgICAgICAgICB0aGlzLmRvY0tlcm5lbC5uZWVkX3JlcGFpbnQoaSwgdi54LCB2LnksIHYud2lkdGgsIHYuaGVpZ2h0LCBzdGFnZSk7XG4gICAgICAgIGNvbnN0IHJlcGFpbnQgPSAoc3RhZ2U6IFJlcGFpbnRTdGFnZSkgPT5cbiAgICAgICAgICB0aGlzLmRvY0tlcm5lbC5yZXBhaW50KGksIHYueCwgdi55LCB2LndpZHRoLCB2LmhlaWdodCwgc3RhZ2UpO1xuICAgICAgICBjb25zdCBjYWxjID0gKHN0YWdlOiBSZXBhaW50U3RhZ2UpID0+IHtcbiAgICAgICAgICBpZiAoY3R4LmlzQ2FuY2VsUmVxdWVzdGVkKCkpIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBjb25kT3JFeGl0KG5lZWRDYWxjKHN0YWdlKSwgKCkgPT4gcmVwYWludChzdGFnZSkpO1xuICAgICAgICB9O1xuXG4gICAgICAgIGF3YWl0IGNhbGMoUmVwYWludFN0YWdlLkxheW91dCk7XG5cbiAgICAgICAgY29uc3Qgd1NjYWxlID1cbiAgICAgICAgICAoYnJvd3NlckJCb3gud2lkdGhcbiAgICAgICAgICAgID8gTnVtYmVyLnBhcnNlRmxvYXQocGFnZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtd2lkdGgnKSEpIC8gYnJvd3NlckJCb3gud2lkdGhcbiAgICAgICAgICAgIDogMSkgKiB0aGlzLmRvbVNjYWxlO1xuICAgICAgICBjb25zdCBoU2NhbGUgPVxuICAgICAgICAgIChicm93c2VyQkJveC5oZWlnaHRcbiAgICAgICAgICAgID8gTnVtYmVyLnBhcnNlRmxvYXQocGFnZS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGVpZ2h0JykhKSAvIGJyb3dzZXJCQm94LmhlaWdodFxuICAgICAgICAgICAgOiAxKSAqIHRoaXMuZG9tU2NhbGU7XG4gICAgICAgIHYueCAqPSB3U2NhbGU7XG4gICAgICAgIHYueSAqPSBoU2NhbGU7XG4gICAgICAgIHYueSAtPSAxMDA7XG4gICAgICAgIHYud2lkdGggKj0gd1NjYWxlO1xuICAgICAgICB2LmhlaWdodCAqPSBoU2NhbGU7XG4gICAgICAgIHYuaGVpZ2h0ICs9IDIwMDtcblxuICAgICAgICBhd2FpdCBjYWxjKFJlcGFpbnRTdGFnZS5TdmcpO1xuICAgICAgICBhd2FpdCBjYWxjKFJlcGFpbnRTdGFnZS5TZW1hbnRpY3MpO1xuICAgICAgICBpZiAoY3R4LmlzQ2FuY2VsUmVxdWVzdGVkKCkpIHtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZygnY2FuY2VsIHN0YWdlJywgUmVwYWludFN0YWdlLlNlbWFudGljcywgaSk7XG4gICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobmVlZENhbGMoUmVwYWludFN0YWdlLlByZXBhcmVDYW52YXMpKSB7XG4gICAgICAgICAgY29uc3QgY2FsY0NhbnZhc0FmdGVyUHJlcGFyaW5nID0gYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgcmVwYWludChSZXBhaW50U3RhZ2UuUHJlcGFyZUNhbnZhcyk7XG4gICAgICAgICAgICBpZiAoY3R4LmlzQ2FuY2VsUmVxdWVzdGVkKCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjYWxjKFJlcGFpbnRTdGFnZS5DYW52YXMpO1xuICAgICAgICAgIH07XG4gICAgICAgICAgY2FsY0NhbnZhc0FmdGVyUHJlcGFyaW5nKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgYXdhaXQgY2FsYyhSZXBhaW50U3RhZ2UuQ2FudmFzKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIGNvbnN0IHJlbmRlclBhZ2VzID0gYXN5bmMgKGluV2luZG93OiBib29sZWFuKSA9PiB7XG4gICAgICAgIGZvciAobGV0IGlkeCA9IDA7IGlkeCA8IHBhZ2VzLmxlbmd0aDsgKytpZHgpIHtcbiAgICAgICAgICBpZiAoY3R4LmlzQ2FuY2VsUmVxdWVzdGVkKCkpIHtcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdjYW5jZWwgcGFnZScsIFJlcGFpbnRTdGFnZS5MYXlvdXQsIGlkeCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChwYWdlc1tpZHhdLmluV2luZG93ID09PSBpbldpbmRvdykge1xuICAgICAgICAgICAgYXdhaXQgcmVuZGVyUGFnZShpZHgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgdGhpcy5jYW5jZWxBbnl3YXkkZG9tKCk7XG5cbiAgICAgIGF3YWl0IHJlbmRlclBhZ2VzKHRydWUpO1xuICAgICAgYXdhaXQgcmVuZGVyUGFnZXMoZmFsc2UpO1xuICAgICAgaWYgKGN0eC5pc0NhbmNlbFJlcXVlc3RlZCgpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIC8vIGNvbnNvbGUubG9nKCdmaW5pc2hlZCcsIFJlcGFpbnRTdGFnZS5MYXlvdXQpO1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGNsYXNzIFR5cHN0RG9tRG9jdW1lbnQgZXh0ZW5kcyBwcm92aWRlRG9jKFxuICBjb21wb3NlRG9jKFxuICAgIFR5cHN0RG9jdW1lbnRDb250ZXh0IGFzIEdDb25zdHJ1Y3RvcjxUeXBzdERvY3VtZW50Q29udGV4dDxJbml0RG9tRG9jQXJncz4+LFxuICAgIHByb3ZpZGVEb21Eb2MsXG4gICksXG4pIHsgfVxuIl19","import { TypstDefaultParams, kObject } from './internal.types.mjs';\nimport { RenderView } from './render/canvas/view.mjs';\nimport { LazyWasmModule } from './wasm.mjs';\nimport { buildComponent } from './init.mjs';\nimport { TypstDomDocument } from './dom.mjs';\n/**\n * The session of a Typst document.\n * @property {string} backgroundColor - The background color of the Typst\n * document.\n * @property {number} pixelPerPt - The pixel per point scale up the image.\n *\n */\nexport class RenderSession {\n    plugin;\n    /**\n     * @internal\n     */\n    [kObject];\n    /**\n     * @internal\n     */\n    constructor(\n    /**\n     * @internal\n     */\n    plugin, o) {\n        this.plugin = plugin;\n        this[kObject] = o;\n    }\n    /**\n     * @deprecated set in {@link RenderToCanvasOptions} instead\n     *\n     * Set the background color of the Typst document.\n     * @param {string} t - The background color in format of `^#?[0-9a-f]{6}$`\n     *\n     * Note: Default to `#ffffff`.\n     *\n     * Note: Only available in canvas rendering mode.\n     */\n    set backgroundColor(t) {\n        if (t !== undefined) {\n            this[kObject].background_color = t;\n        }\n    }\n    /**\n     * Get the background color of the Typst document.\n     *\n     * Note: Default to `#ffffff`.\n     *\n     * Note: Only available in canvas rendering mode.\n     */\n    get backgroundColor() {\n        return this[kObject].background_color;\n    }\n    /**\n     * Set the pixel per point scale up the canvas panel.\n     *\n     * Note: Default to `3`.\n     *\n     * Note: Only available in canvas rendering mode.\n     */\n    set pixelPerPt(t) {\n        if (t !== undefined) {\n            this[kObject].pixel_per_pt = t;\n        }\n    }\n    /**\n     * @deprecated set in {@link RenderToCanvasOptions} instead\n     *\n     * Get the pixel per point scale up the canvas panel.\n     *\n     * Note: Default to `3`.\n     *\n     * Note: Only available in canvas rendering mode.\n     */\n    get pixelPerPt() {\n        return this[kObject].pixel_per_pt;\n    }\n    /**\n     * Reset state\n     */\n    reset() {\n        this.plugin.resetSession(this);\n    }\n    /**\n     * @deprecated\n     * use {@link docWidth} instead\n     */\n    get doc_width() {\n        return this[kObject].doc_width;\n    }\n    get docWidth() {\n        return this[kObject].doc_width;\n    }\n    /**\n     * @deprecated\n     * use {@link docHeight} instead\n     */\n    get doc_height() {\n        return this[kObject].doc_height;\n    }\n    get docHeight() {\n        return this[kObject].doc_height;\n    }\n    retrievePagesInfo() {\n        const pages_info = this[kObject].pages_info;\n        const pageInfos = [];\n        const pageCount = pages_info.page_count;\n        for (let i = 0; i < pageCount; i++) {\n            const pageAst = pages_info.page(i);\n            pageInfos.push({\n                pageOffset: pageAst.page_off,\n                width: pageAst.width_pt,\n                height: pageAst.height_pt,\n            });\n        }\n        return pageInfos;\n    }\n    getSourceLoc(path) {\n        return this[kObject].source_span(path);\n    }\n    /**\n     * See {@link TypstRenderer#renderSvg} for more details.\n     */\n    renderSvg(options) {\n        return this.plugin.renderSvg({\n            renderSession: this,\n            ...options,\n        });\n    }\n    /**\n     * See {@link TypstRenderer#renderToSvg} for more details.\n     */\n    renderToSvg(options) {\n        return this.plugin.renderToSvg({\n            renderSession: this,\n            ...options,\n        });\n    }\n    /**\n     * See {@link TypstRenderer#renderCanvas} for more details.\n     */\n    renderCanvas(options) {\n        return this.plugin.renderCanvas({\n            renderSession: this,\n            ...options,\n        });\n    }\n    /**\n     * See {@link TypstRenderer#manipulateData} for more details.\n     */\n    manipulateData(opts) {\n        this.plugin.manipulateData({\n            renderSession: this,\n            ...opts,\n        });\n    }\n    /**\n     * See {@link TypstRenderer#renderSvgDiff} for more details.\n     */\n    renderSvgDiff(opts) {\n        return this.plugin.renderSvgDiff({\n            renderSession: this,\n            ...opts,\n        });\n    }\n    /**\n     * @deprecated\n     * use {@link getSourceLoc} instead\n     */\n    get_source_loc(path) {\n        return this[kObject].source_span(path);\n    }\n    /**\n     * @deprecated\n     * use {@link renderSvgDiff} instead\n     */\n    render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y) {\n        return this[kObject].render_in_window(rect_lo_x, rect_lo_y, rect_hi_x, rect_hi_y);\n    }\n    /**\n     * @deprecated\n     * use {@link manipulateData} instead\n     */\n    merge_delta(data) {\n        this.plugin.manipulateData({\n            renderSession: this,\n            action: 'merge',\n            data,\n        });\n    }\n}\n/**\n * @internal\n */\nvar ManageStatus;\n(function (ManageStatus) {\n    ManageStatus[ManageStatus[\"Delete\"] = 0] = \"Delete\";\n    ManageStatus[ManageStatus[\"New\"] = 1] = \"New\";\n    ManageStatus[ManageStatus[\"Update\"] = 2] = \"Update\";\n})(ManageStatus || (ManageStatus = {}));\nexport class TypstWorker {\n    plugin;\n    /**\n     * @internal\n     */\n    [kObject];\n    /**\n     * @internal\n     */\n    constructor(\n    /**\n     * @internal\n     */\n    plugin, o) {\n        this.plugin = plugin;\n        this[kObject] = o;\n    }\n    /**\n     * See {@link TypstRenderer#manipulateData} for more details.\n     */\n    manipulateData(action, data) {\n        return this[kObject].manipulate_data(action, data);\n    }\n    /**\n     * @internal\n     */\n    managedCanvasElemList = new Map();\n    /**\n     * @internal\n     */\n    canvasCounter = Math.random();\n    /**\n     * You must submit all canvas in pages to ensure synchronization with the background worker\n     *\n     * See {@link TypstRenderer#renderCanvas} for more details.\n     */\n    renderCanvas(canvasElemList) {\n        const m = this.managedCanvasElemList;\n        for (const [_, elem] of m) {\n            elem[0] = ManageStatus.Delete;\n        }\n        for (const elem of canvasElemList) {\n            const canvas = elem.canvas;\n            let elemId = canvas.dataset.manageId;\n            let action = ManageStatus.Update;\n            if (!elemId) {\n                elemId = this.canvasCounter.toFixed(5);\n                this.canvasCounter += 1;\n                canvas.dataset.manageId = elemId;\n                action = ManageStatus.New;\n            }\n            let prev = m.get(elemId);\n            if (prev && prev[0] !== ManageStatus.Delete) {\n                throw new Error('cannot update a canvas for two times in batch');\n            }\n            m.set(elemId, [action, { ...elem }]);\n        }\n        const entries = Array.from(m.entries());\n        const actions = new Uint8Array(entries.length);\n        const elements = new Array(entries.length);\n        const options = entries.map(([key, [action, elem]], index) => {\n            if (!action) {\n                m.delete(key);\n            }\n            actions[index] = action;\n            elements[index] = elem.canvas;\n            return this.plugin.canvasOptionsToRust(elem);\n        });\n        return this[kObject].render_canvas(actions, elements, options);\n    }\n    async retrievePagesInfo() {\n        const pages_info = await this[kObject].get_pages_info();\n        console.log(pages_info);\n        const pageInfos = [];\n        const pageCount = pages_info.page_count;\n        for (let i = 0; i < pageCount; i++) {\n            const pageAst = pages_info.page(i);\n            pageInfos.push({\n                pageOffset: pageAst.page_off,\n                width: pageAst.width_pt,\n                height: pageAst.height_pt,\n            });\n        }\n        return pageInfos;\n    }\n}\nconst gRendererModule = (module) => new LazyWasmModule(async (bin) => {\n    return await module.default(bin);\n});\n/**\n * create a Typst renderer.\n * @returns {TypstRenderer} - The Typst renderer.\n * @example\n * ```typescript\n * import { createTypstRenderer } from 'typst';\n * const renderer = createTypstRenderer();\n * await renderer.init();\n * await renderer.render({\n *   container: document.getElementById('container'),\n *   artifactContent: '{ ... }',\n * });\n * ```\n */\nexport function createTypstRenderer() {\n    return new TypstRendererDriver();\n}\nexport async function rendererBuildInfo() {\n    const renderModule = await import('@myriaddreamin/typst-ts-renderer');\n    return renderModule.renderer_build_info();\n}\nlet warnOnceCanvasSet = true;\n/** @internal */\nexport class TypstRendererDriver {\n    renderer;\n    rendererJs;\n    constructor() { }\n    async init(options) {\n        this.rendererJs = await (options?.getWrapper?.() || import('@myriaddreamin/typst-ts-renderer'));\n        const TypstRendererBuilder = this.rendererJs.TypstRendererBuilder;\n        this.renderer = await buildComponent(options, gRendererModule(this.rendererJs), TypstRendererBuilder, {});\n    }\n    loadGlyphPack(_pack) {\n        // this.renderer.load_glyph_pack(pack);\n        return Promise.resolve();\n    }\n    createOptionsToRust(options) {\n        const rustOptions = new this.rendererJs.CreateSessionOptions();\n        if (options.format !== undefined) {\n            rustOptions.format = options.format;\n        }\n        if (options.artifactContent !== undefined) {\n            rustOptions.artifact_content = options.artifactContent;\n        }\n        return rustOptions;\n    }\n    canvasOptionsToRust(options) {\n        const rustOptions = new this.rendererJs.RenderPageImageOptions();\n        if (options.pageOffset === undefined) {\n            throw new Error('pageOffset is required in reflexo v0.5.0');\n        }\n        else {\n            rustOptions.page_off = options.pageOffset;\n        }\n        if (options.cacheKey !== undefined) {\n            rustOptions.cache_key = options.cacheKey;\n        }\n        if (options.backgroundColor !== undefined) {\n            rustOptions.background_color = options.backgroundColor;\n        }\n        if (options.pixelPerPt !== undefined) {\n            rustOptions.pixel_per_pt = options.pixelPerPt;\n        }\n        if (options.dataSelection !== undefined) {\n            let encoded = 0;\n            if (options.dataSelection.body) {\n                encoded |= 1 << 0;\n            }\n            else if (options.canvas && warnOnceCanvasSet) {\n                warnOnceCanvasSet = false;\n                console.warn('dataSelection.body is not set but providing canvas for body');\n            }\n            if (options.dataSelection.text || options.dataSelection.annotation) {\n                console.error('dataSelection.text and dataSelection.annotation are deprecated');\n            }\n            if (options.dataSelection.semantics) {\n                encoded |= 1 << 3;\n            }\n            rustOptions.data_selection = encoded;\n        }\n        return rustOptions;\n    }\n    retrievePagesInfoFromSession(session) {\n        return session.retrievePagesInfo();\n    }\n    /**\n     * Render a Typst document to canvas.\n     */\n    renderCanvas(options) {\n        return this.withinOptionSession(options, async (sessionRef) => {\n            return this.renderer.render_page_to_canvas(sessionRef[kObject], options.canvas || undefined, this.canvasOptionsToRust(options));\n        });\n    }\n    // async renderPdf(artifactContent: string): Promise<Uint8Array> {\n    // return this.renderer.render_to_pdf(artifactContent);\n    // }\n    async inAnimationFrame(fn) {\n        return new Promise((resolve, reject) => {\n            requestAnimationFrame(() => {\n                try {\n                    resolve(fn());\n                }\n                catch (e) {\n                    reject(e);\n                }\n            });\n        });\n    }\n    async renderDisplayLayer(session, canvasList, options) {\n        const pages_info = session[kObject].pages_info;\n        const page_count = pages_info.page_count;\n        const doRender = async (i, page_off) => {\n            const canvas = canvasList[i];\n            const ctx = canvas.getContext('2d');\n            if (!ctx) {\n                throw new Error('canvas context is null');\n            }\n            return await this.renderCanvas({\n                ...options,\n                canvas: ctx,\n                renderSession: session,\n                pageOffset: page_off,\n            });\n        };\n        const t = performance.now();\n        const textContentList = await (async () => {\n            const results = [];\n            for (let i = 0; i < page_count; i++) {\n                results.push(await this.inAnimationFrame(() => doRender(i, i)));\n            }\n            return results;\n        })();\n        const t2 = performance.now();\n        console.log(`display layer used: render = ${(t2 - t).toFixed(1)}ms`);\n        return textContentList;\n    }\n    renderTextLayer(layerList, textSourceList) {\n        const t2 = performance.now();\n        layerList.forEach((layer, i) => {\n            layer.innerHTML = textSourceList[i].htmlSemantics[0];\n        });\n        const t3 = performance.now();\n        console.log(`text layer used: render = ${(t3 - t2).toFixed(1)}ms`);\n    }\n    async render(options) {\n        if ('format' in options) {\n            if (options.format !== 'vector') {\n                const artifactFormats = ['serde_json', 'js', 'ir'];\n                if (artifactFormats.includes(options.format)) {\n                    // deprecated\n                    throw new Error(`deprecated format ${options.format}, please use vector format`);\n                }\n            }\n        }\n        return this.renderToCanvas(options);\n    }\n    async renderDom(options) {\n        if ('format' in options) {\n            if (options.format !== 'vector') {\n                const artifactFormats = ['serde_json', 'js', 'ir'];\n                if (artifactFormats.includes(options.format)) {\n                    // deprecated\n                    throw new Error(`deprecated format ${options.format}, please use vector format`);\n                }\n            }\n        }\n        return this.withinOptionSession(options, async (sessionRef) => {\n            const t = new TypstDomDocument({\n                ...options,\n                renderMode: 'dom',\n                hookedElem: options.container,\n                kModule: sessionRef,\n                renderer: this,\n            });\n            t;\n            await t.impl.mountDom(options.pixelPerPt);\n            return t;\n        });\n    }\n    async renderToCanvas(options) {\n        let session;\n        let renderPageResults;\n        const mountContainer = options.container;\n        mountContainer.style.visibility = 'hidden';\n        const doRenderDisplayLayer = async (canvasList, resetLayout) => {\n            try {\n                renderPageResults = await this.renderDisplayLayer(session, canvasList, options);\n                resetLayout();\n            }\n            finally {\n                mountContainer.style.visibility = 'visible';\n            }\n        };\n        return this.withinOptionSession(options, async (sessionRef) => {\n            session = sessionRef;\n            if (session[kObject].pages_info.page_count === 0) {\n                throw new Error(`No page found in session`);\n            }\n            if (options.pixelPerPt !== undefined && options.pixelPerPt <= 0) {\n                throw new Error('Invalid typst.RenderOptions.pixelPerPt, should be a positive number ' +\n                    options.pixelPerPt);\n            }\n            let backgroundColor = options.backgroundColor;\n            if (backgroundColor !== undefined) {\n                if (!/^#[0-9a-f]{6}$/.test(backgroundColor)) {\n                    throw new Error('Invalid typst.backgroundColor color for matching ^#?[0-9a-f]{6}$ ' + backgroundColor);\n                }\n            }\n            session.pixelPerPt = options.pixelPerPt ?? TypstDefaultParams.PIXEL_PER_PT;\n            session.backgroundColor = backgroundColor ?? '#ffffff';\n            const t = performance.now();\n            const pageView = new RenderView(this.retrievePagesInfoFromSession(session), mountContainer, options);\n            const t2 = performance.now();\n            console.log(`layer used: retrieve = ${(t2 - t).toFixed(1)}ms`);\n            await doRenderDisplayLayer(pageView.canvasList, () => pageView.resetLayout());\n            this.renderTextLayer(pageView.textLayerList, renderPageResults);\n            return;\n        });\n    }\n    createModule(b) {\n        return Promise.resolve(new RenderSession(this, this.renderer.create_session(b &&\n            this.createOptionsToRust({\n                format: 'vector',\n                artifactContent: b,\n            }))));\n    }\n    async createWorkerV0(worker) {\n        return new TypstWorker(this, await this.renderer.create_worker(worker));\n    }\n    workerBridge() {\n        return this.renderer.create_worker_bridge();\n    }\n    renderSvg(options, container) {\n        if (options instanceof RenderSession || container) {\n            throw new Error('removed api, please use renderToSvg({ renderSession, container }) instead');\n        }\n        return this.withinOptionSession(options, async (sessionRef) => {\n            let parts = undefined;\n            if (options.data_selection) {\n                parts = 0;\n                if (options.data_selection.body) {\n                    parts |= 1 << 0;\n                }\n                if (options.data_selection.defs) {\n                    parts |= 1 << 1;\n                }\n                if (options.data_selection.css) {\n                    parts |= 1 << 2;\n                }\n                if (options.data_selection.js) {\n                    parts |= 1 << 3;\n                }\n            }\n            return Promise.resolve(this.renderer.svg_data(sessionRef[kObject], parts));\n        });\n    }\n    renderSvgDiff(options) {\n        if (!options.window) {\n            return this.renderer.render_svg_diff(options.renderSession[kObject], 0, 0, 1e33, 1e33);\n        }\n        return this.renderer.render_svg_diff(options.renderSession[kObject], options.window.lo.x, options.window.lo.y, options.window.hi.x, options.window.hi.y);\n    }\n    renderToSvg(options) {\n        return this.withinOptionSession(options, async (sessionRef) => {\n            return Promise.resolve(this.renderer.render_svg(sessionRef[kObject], options.container));\n        });\n    }\n    getCustomV1(options) {\n        return Promise.resolve(this.renderer.get_customs(options.renderSession[kObject]));\n    }\n    resetSession(session) {\n        return this.renderer.reset(session[kObject]);\n    }\n    manipulateData(opts) {\n        return this.renderer.manipulate_data(opts.renderSession[kObject], opts.action ?? 'reset', opts.data);\n    }\n    withinOptionSession(options, fn) {\n        function isRenderByContentOption(options) {\n            return 'artifactContent' in options;\n        }\n        if ('renderSession' in options) {\n            return fn(options.renderSession);\n        }\n        if (isRenderByContentOption(options)) {\n            // todo: remove any\n            return this.runWithSession(options, fn);\n        }\n        throw new Error('Invalid render options, should be one of RenderByContentOptions|RenderBySessionOptions');\n    }\n    async runWithSession(arg1, arg2) {\n        let options = arg1;\n        let fn = arg2;\n        if (!arg2) {\n            options = undefined;\n            fn = arg1;\n        }\n        const session = this.renderer.create_session(\n        /* moved */ options && this.createOptionsToRust(options));\n        try {\n            const res = await fn(new RenderSession(this, session));\n            session.free();\n            return res;\n        }\n        catch (e) {\n            session.free();\n            throw e;\n        }\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyZXIubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3JlbmRlcmVyLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFJQSxPQUFPLEVBQWdDLGtCQUFrQixFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBYWpHLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN0RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBQzVDLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDNUMsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0sV0FBVyxDQUFDO0FBZTdDOzs7Ozs7R0FNRztBQUNILE1BQU0sT0FBTyxhQUFhO0lBYWQ7SUFaVjs7T0FFRztJQUNJLENBQUMsT0FBTyxDQUFDLENBQXNCO0lBRXRDOztPQUVHO0lBQ0g7SUFDRTs7T0FFRztJQUNLLE1BQXFCLEVBQzdCLENBQXNCO1FBRGQsV0FBTSxHQUFOLE1BQU0sQ0FBZTtRQUc3QixJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3BCLENBQUM7SUFFRDs7Ozs7Ozs7O09BU0c7SUFDSCxJQUFJLGVBQWUsQ0FBQyxDQUFxQjtRQUN2QyxJQUFJLENBQUMsS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsZ0JBQWdCLEdBQUcsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7SUFDSCxDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsSUFBSSxlQUFlO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGdCQUFnQixDQUFDO0lBQ3hDLENBQUM7SUFFRDs7Ozs7O09BTUc7SUFDSCxJQUFJLFVBQVUsQ0FBQyxDQUFxQjtRQUNsQyxJQUFJLENBQUMsS0FBSyxTQUFTLEVBQUUsQ0FBQztZQUNwQixJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsWUFBWSxHQUFH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IEB0cy1pZ25vcmVcbmltcG9ydCB0eXBlICogYXMgdHlwc3QgZnJvbSAnQG15cmlhZGRyZWFtaW4vdHlwc3QtdHMtcmVuZGVyZXInO1xuXG5pbXBvcnQgdHlwZSB7IEluaXRPcHRpb25zIH0gZnJvbSAnLi9vcHRpb25zLmluaXQubWpzJztcbmltcG9ydCB7IFBhZ2VJbmZvLCBSZW5kZXJDYW52YXNSZXN1bHQsIFR5cHN0RGVmYXVsdFBhcmFtcywga09iamVjdCB9IGZyb20gJy4vaW50ZXJuYWwudHlwZXMubWpzJztcbmltcG9ydCB7XG4gIENyZWF0ZVNlc3Npb25PcHRpb25zLFxuICBSZW5kZXJUb0NhbnZhc09wdGlvbnMsXG4gIFJlbmRlck9wdGlvbnMsXG4gIFJlbmRlckNhbnZhc09wdGlvbnMsXG4gIFJlbmRlclRvU3ZnT3B0aW9ucyxcbiAgTWFuaXB1bGF0ZURhdGFPcHRpb25zLFxuICBSZW5kZXJTdmdPcHRpb25zLFxuICBSZW5kZXJJblNlc3Npb25PcHRpb25zLFxuICBNb3VudERvbU9wdGlvbnMsXG4gIE9mZnNjcmVlblJlbmRlckNhbnZhc09wdGlvbnMsXG59IGZyb20gJy4vb3B0aW9ucy5yZW5kZXIubWpzJztcbmltcG9ydCB7IFJlbmRlclZpZXcgfSBmcm9tICcuL3JlbmRlci9jYW52YXMvdmlldy5tanMnO1xuaW1wb3J0IHsgTGF6eVdhc21Nb2R1bGUgfSBmcm9tICcuL3dhc20ubWpzJztcbmltcG9ydCB7IGJ1aWxkQ29tcG9uZW50IH0gZnJvbSAnLi9pbml0Lm1qcyc7XG5pbXBvcnQgeyBUeXBzdERvbURvY3VtZW50IH0gZnJvbSAnLi9kb20ubWpzJztcblxuLyoqXG4gKiBUaGUgcmVzdWx0IG9mIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50LlxuICogQHR5cGVkZWYge09iamVjdH0gUmVuZGVyUmVzdWx0XG4gKiBAcHJvcGVydHkge251bWJlcn0gd2lkdGggLSBUaGUgd2lkdGggb2YgdGhlIHJlbmRlcmVkIFR5cHN0IGRvY3VtZW50IChzaW5nbGUgcGFnZSkuXG4gKiBAcHJvcGVydHkge251bWJlcn0gaGVpZ2h0IC0gVGhlIGhlaWdodCBvZiB0aGUgcmVuZGVyZWQgVHlwc3QgZG9jdW1lbnQgKHNpbmdsZSBwYWdlKS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSZW5kZXJSZXN1bHQge1xuICB3aWR0aDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbn1cblxudHlwZSBDb250ZXh0ZWRSZW5kZXJPcHRpb25zPFQ+ID0gVCB8IFJlbmRlck9wdGlvbnM8VD47XG5cbi8qKlxuICogVGhlIHNlc3Npb24gb2YgYSBUeXBzdCBkb2N1bWVudC5cbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBiYWNrZ3JvdW5kQ29sb3IgLSBUaGUgYmFja2dyb3VuZCBjb2xvciBvZiB0aGUgVHlwc3RcbiAqIGRvY3VtZW50LlxuICogQHByb3BlcnR5IHtudW1iZXJ9IHBpeGVsUGVyUHQgLSBUaGUgcGl4ZWwgcGVyIHBvaW50IHNjYWxlIHVwIHRoZSBpbWFnZS5cbiAqXG4gKi9cbmV4cG9ydCBjbGFzcyBSZW5kZXJTZXNzaW9uIHtcbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgcHVibGljIFtrT2JqZWN0XTogdHlwc3QuUmVuZGVyU2Vzc2lvbjtcblxuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBwcml2YXRlIHBsdWdpbjogVHlwc3RSZW5kZXJlcixcbiAgICBvOiB0eXBzdC5SZW5kZXJTZXNzaW9uLFxuICApIHtcbiAgICB0aGlzW2tPYmplY3RdID0gbztcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZCBzZXQgaW4ge0BsaW5rIFJlbmRlclRvQ2FudmFzT3B0aW9uc30gaW5zdGVhZFxuICAgKlxuICAgKiBTZXQgdGhlIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIFR5cHN0IGRvY3VtZW50LlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdCAtIFRoZSBiYWNrZ3JvdW5kIGNvbG9yIGluIGZvcm1hdCBvZiBgXiM/WzAtOWEtZl17Nn0kYFxuICAgKlxuICAgKiBOb3RlOiBEZWZhdWx0IHRvIGAjZmZmZmZmYC5cbiAgICpcbiAgICogTm90ZTogT25seSBhdmFpbGFibGUgaW4gY2FudmFzIHJlbmRlcmluZyBtb2RlLlxuICAgKi9cbiAgc2V0IGJhY2tncm91bmRDb2xvcih0OiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICBpZiAodCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzW2tPYmplY3RdLmJhY2tncm91bmRfY29sb3IgPSB0O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIFR5cHN0IGRvY3VtZW50LlxuICAgKlxuICAgKiBOb3RlOiBEZWZhdWx0IHRvIGAjZmZmZmZmYC5cbiAgICpcbiAgICogTm90ZTogT25seSBhdmFpbGFibGUgaW4gY2FudmFzIHJlbmRlcmluZyBtb2RlLlxuICAgKi9cbiAgZ2V0IGJhY2tncm91bmRDb2xvcigpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmJhY2tncm91bmRfY29sb3I7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBwaXhlbCBwZXIgcG9pbnQgc2NhbGUgdXAgdGhlIGNhbnZhcyBwYW5lbC5cbiAgICpcbiAgICogTm90ZTogRGVmYXVsdCB0byBgM2AuXG4gICAqXG4gICAqIE5vdGU6IE9ubHkgYXZhaWxhYmxlIGluIGNhbnZhcyByZW5kZXJpbmcgbW9kZS5cbiAgICovXG4gIHNldCBwaXhlbFBlclB0KHQ6IG51bWJlciB8IHVuZGVmaW5lZCkge1xuICAgIGlmICh0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXNba09iamVjdF0ucGl4ZWxfcGVyX3B0ID0gdDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWQgc2V0IGluIHtAbGluayBSZW5kZXJUb0NhbnZhc09wdGlvbnN9IGluc3RlYWRcbiAgICpcbiAgICogR2V0IHRoZSBwaXhlbCBwZXIgcG9pbnQgc2NhbGUgdXAgdGhlIGNhbnZhcyBwYW5lbC5cbiAgICpcbiAgICogTm90ZTogRGVmYXVsdCB0byBgM2AuXG4gICAqXG4gICAqIE5vdGU6IE9ubHkgYXZhaWxhYmxlIGluIGNhbnZhcyByZW5kZXJpbmcgbW9kZS5cbiAgICovXG4gIGdldCBwaXhlbFBlclB0KCk6IG51bWJlciB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0ucGl4ZWxfcGVyX3B0O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IHN0YXRlXG4gICAqL1xuICByZXNldCgpOiB2b2lkIHtcbiAgICB0aGlzLnBsdWdpbi5yZXNldFNlc3Npb24odGhpcyk7XG4gIH1cblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogdXNlIHtAbGluayBkb2NXaWR0aH0gaW5zdGVhZFxuICAgKi9cbiAgZ2V0IGRvY193aWR0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmRvY193aWR0aDtcbiAgfVxuXG4gIGdldCBkb2NXaWR0aCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmRvY193aWR0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAZGVwcmVjYXRlZFxuICAgKiB1c2Uge0BsaW5rIGRvY0hlaWdodH0gaW5zdGVhZFxuICAgKi9cbiAgZ2V0IGRvY19oZWlnaHQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5kb2NfaGVpZ2h0O1xuICB9XG5cbiAgZ2V0IGRvY0hlaWdodCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLmRvY19oZWlnaHQ7XG4gIH1cblxuICByZXRyaWV2ZVBhZ2VzSW5mbygpOiBQYWdlSW5mb1tdIHtcbiAgICBjb25zdCBwYWdlc19pbmZvID0gdGhpc1trT2JqZWN0XS5wYWdlc19pbmZvO1xuICAgIGNvbnN0IHBhZ2VJbmZvczogUGFnZUluZm9bXSA9IFtdO1xuICAgIGNvbnN0IHBhZ2VDb3VudCA9IHBhZ2VzX2luZm8ucGFnZV9jb3VudDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VDb3VudDsgaSsrKSB7XG4gICAgICBjb25zdCBwYWdlQXN0ID0gcGFnZXNfaW5mby5wYWdlKGkpO1xuICAgICAgcGFnZUluZm9zLnB1c2goe1xuICAgICAgICBwYWdlT2Zmc2V0OiBwYWdlQXN0LnBhZ2Vfb2ZmLFxuICAgICAgICB3aWR0aDogcGFnZUFzdC53aWR0aF9wdCxcbiAgICAgICAgaGVpZ2h0OiBwYWdlQXN0LmhlaWdodF9wdCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBwYWdlSW5mb3M7XG4gIH1cblxuICBnZXRTb3VyY2VMb2MocGF0aDogVWludDMyQXJyYXkpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiAodGhpc1trT2JqZWN0XSBhcyB0eXBzdC5SZW5kZXJTZXNzaW9uKS5zb3VyY2Vfc3BhbihwYXRoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWUge0BsaW5rIFR5cHN0UmVuZGVyZXIjcmVuZGVyU3ZnfSBmb3IgbW9yZSBkZXRhaWxzLlxuICAgKi9cbiAgcmVuZGVyU3ZnKG9wdGlvbnM6IENvbnRleHRlZFJlbmRlck9wdGlvbnM8UmVuZGVyU3ZnT3B0aW9ucz4pOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiB0aGlzLnBsdWdpbi5yZW5kZXJTdmcoe1xuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlclRvU3ZnfSBmb3IgbW9yZSBkZXRhaWxzLlxuICAgKi9cbiAgcmVuZGVyVG9Tdmcob3B0aW9uczogQ29udGV4dGVkUmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+KTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlclRvU3ZnKHtcbiAgICAgIHJlbmRlclNlc3Npb246IHRoaXMsXG4gICAgICAuLi5vcHRpb25zLFxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RSZW5kZXJlciNyZW5kZXJDYW52YXN9IGZvciBtb3JlIGRldGFpbHMuXG4gICAqL1xuICByZW5kZXJDYW52YXMob3B0aW9uczogQ29udGV4dGVkUmVuZGVyT3B0aW9uczxSZW5kZXJDYW52YXNPcHRpb25zPik6IFByb21pc2U8UmVuZGVyQ2FudmFzUmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlckNhbnZhcyh7XG4gICAgICByZW5kZXJTZXNzaW9uOiB0aGlzLFxuICAgICAgLi4ub3B0aW9ucyxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWUge0BsaW5rIFR5cHN0UmVuZGVyZXIjbWFuaXB1bGF0ZURhdGF9IGZvciBtb3JlIGRldGFpbHMuXG4gICAqL1xuICBtYW5pcHVsYXRlRGF0YShvcHRzOiBNYW5pcHVsYXRlRGF0YU9wdGlvbnMpIHtcbiAgICB0aGlzLnBsdWdpbi5tYW5pcHVsYXRlRGF0YSh7XG4gICAgICByZW5kZXJTZXNzaW9uOiB0aGlzLFxuICAgICAgLi4ub3B0cyxcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWUge0BsaW5rIFR5cHN0UmVuZGVyZXIjcmVuZGVyU3ZnRGlmZn0gZm9yIG1vcmUgZGV0YWlscy5cbiAgICovXG4gIHJlbmRlclN2Z0RpZmYob3B0czogUmVuZGVyU3ZnT3B0aW9ucyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMucGx1Z2luLnJlbmRlclN2Z0RpZmYoe1xuICAgICAgcmVuZGVyU2Vzc2lvbjogdGhpcyxcbiAgICAgIC4uLm9wdHMsXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogdXNlIHtAbGluayBnZXRTb3VyY2VMb2N9IGluc3RlYWRcbiAgICovXG4gIGdldF9zb3VyY2VfbG9jKHBhdGg6IFVpbnQzMkFycmF5KTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gKHRoaXNba09iamVjdF0gYXMgdHlwc3QuUmVuZGVyU2Vzc2lvbikuc291cmNlX3NwYW4ocGF0aCk7XG4gIH1cblxuICAvKipcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogdXNlIHtAbGluayByZW5kZXJTdmdEaWZmfSBpbnN0ZWFkXG4gICAqL1xuICByZW5kZXJfaW5fd2luZG93KHJlY3RfbG9feDogbnVtYmVyLCByZWN0X2xvX3k6IG51bWJlciwgcmVjdF9oaV94OiBudW1iZXIsIHJlY3RfaGlfeTogbnVtYmVyKSB7XG4gICAgcmV0dXJuIHRoaXNba09iamVjdF0ucmVuZGVyX2luX3dpbmRvdyhyZWN0X2xvX3gsIHJlY3RfbG9feSwgcmVjdF9oaV94LCByZWN0X2hpX3kpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBkZXByZWNhdGVkXG4gICAqIHVzZSB7QGxpbmsgbWFuaXB1bGF0ZURhdGF9IGluc3RlYWRcbiAgICovXG4gIG1lcmdlX2RlbHRhKGRhdGE6IFVpbnQ4QXJyYXkpIHtcbiAgICB0aGlzLnBsdWdpbi5tYW5pcHVsYXRlRGF0YSh7XG4gICAgICByZW5kZXJTZXNzaW9uOiB0aGlzLFxuICAgICAgYWN0aW9uOiAnbWVyZ2UnLFxuICAgICAgZGF0YSxcbiAgICB9KTtcbiAgfVxufVxuXG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5jb25zdCBlbnVtIE1hbmFnZVN0YXR1cyB7XG4gIERlbGV0ZSxcbiAgTmV3LFxuICBVcGRhdGUsXG59XG5cbmV4cG9ydCBjbGFzcyBUeXBzdFdvcmtlciB7XG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIHB1YmxpYyBba09iamVjdF06IHR5cHN0LlR5cHN0V29ya2VyO1xuXG4gIC8qKlxuICAgKiBAaW50ZXJuYWxcbiAgICovXG4gIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHByaXZhdGUgcGx1Z2luOiBUeXBzdFJlbmRlcmVyRHJpdmVyLFxuICAgIG86IHR5cHN0LlR5cHN0V29ya2VyLFxuICApIHtcbiAgICB0aGlzW2tPYmplY3RdID0gbztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWUge0BsaW5rIFR5cHN0UmVuZGVyZXIjbWFuaXB1bGF0ZURhdGF9IGZvciBtb3JlIGRldGFpbHMuXG4gICAqL1xuICBtYW5pcHVsYXRlRGF0YShhY3Rpb246IHN0cmluZywgZGF0YTogVWludDhBcnJheSk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiB0aGlzW2tPYmplY3RdLm1hbmlwdWxhdGVfZGF0YShhY3Rpb24sIGRhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIEBpbnRlcm5hbFxuICAgKi9cbiAgbWFuYWdlZENhbnZhc0VsZW1MaXN0ID0gbmV3IE1hcDxzdHJpbmcsIFtNYW5hZ2VTdGF0dXMsIE9mZnNjcmVlblJlbmRlckNhbnZhc09wdGlvbnNdPigpO1xuICAvKipcbiAgICogQGludGVybmFsXG4gICAqL1xuICBjYW52YXNDb3VudGVyID0gTWF0aC5yYW5kb20oKTtcbiAgLyoqXG4gICAqIFlvdSBtdXN0IHN1Ym1pdCBhbGwgY2FudmFzIGluIHBhZ2VzIHRvIGVuc3VyZSBzeW5jaHJvbml6YXRpb24gd2l0aCB0aGUgYmFja2dyb3VuZCB3b3JrZXJcbiAgICpcbiAgICogU2VlIHtAbGluayBUeXBzdFJlbmRlcmVyI3JlbmRlckNhbnZhc30gZm9yIG1vcmUgZGV0YWlscy5cbiAgICovXG4gIHJlbmRlckNhbnZhcyhjYW52YXNFbGVtTGlzdDogT2Zmc2NyZWVuUmVuZGVyQ2FudmFzT3B0aW9uc1tdKTogUHJvbWlzZTxSZW5kZXJDYW52YXNSZXN1bHRbXT4ge1xuICAgIGNvbnN0IG0gPSB0aGlzLm1hbmFnZWRDYW52YXNFbGVtTGlzdDtcbiAgICBmb3IgKGNvbnN0IFtfLCBlbGVtXSBvZiBtKSB7XG4gICAgICBlbGVtWzBdID0gTWFuYWdlU3RhdHVzLkRlbGV0ZTtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IGVsZW0gb2YgY2FudmFzRWxlbUxpc3QpIHtcbiAgICAgIGNvbnN0IGNhbnZhcyA9IGVsZW0uY2FudmFzO1xuICAgICAgbGV0IGVsZW1JZCA9IGNhbnZhcy5kYXRhc2V0Lm1hbmFnZUlkO1xuICAgICAgbGV0IGFjdGlvbiA9IE1hbmFnZVN0YXR1cy5VcGRhdGU7XG4gICAgICBpZiAoIWVsZW1JZCkge1xuICAgICAgICBlbGVtSWQgPSB0aGlzLmNhbnZhc0NvdW50ZXIudG9GaXhlZCg1KTtcbiAgICAgICAgdGhpcy5jYW52YXNDb3VudGVyICs9IDE7XG4gICAgICAgIGNhbnZhcy5kYXRhc2V0Lm1hbmFnZUlkID0gZWxlbUlkO1xuICAgICAgICBhY3Rpb24gPSBNYW5hZ2VTdGF0dXMuTmV3O1xuICAgICAgfVxuXG4gICAgICBsZXQgcHJldiA9IG0uZ2V0KGVsZW1JZCk7XG4gICAgICBpZiAocHJldiAmJiBwcmV2WzBdICE9PSBNYW5hZ2VTdGF0dXMuRGVsZXRlKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignY2Fubm90IHVwZGF0ZSBhIGNhbnZhcyBmb3IgdHdvIHRpbWVzIGluIGJhdGNoJyk7XG4gICAgICB9XG5cbiAgICAgIG0uc2V0KGVsZW1JZCwgW2FjdGlvbiwgeyAuLi5lbGVtIH1dKTtcbiAgICB9XG5cbiAgICBjb25zdCBlbnRyaWVzID0gQXJyYXkuZnJvbShtLmVudHJpZXMoKSk7XG4gICAgY29uc3QgYWN0aW9ucyA9IG5ldyBVaW50OEFycmF5KGVudHJpZXMubGVuZ3RoKTtcbiAgICBjb25zdCBlbGVtZW50cyA9IG5ldyBBcnJheShlbnRyaWVzLmxlbmd0aCk7XG4gICAgY29uc3Qgb3B0aW9ucyA9IGVudHJpZXMubWFwKChba2V5LCBbYWN0aW9uLCBlbGVtXV0sIGluZGV4KSA9PiB7XG4gICAgICBpZiAoIWFjdGlvbikge1xuICAgICAgICBtLmRlbGV0ZShrZXkpO1xuICAgICAgfVxuXG4gICAgICBhY3Rpb25zW2luZGV4XSA9IGFjdGlvbjtcbiAgICAgIGVsZW1lbnRzW2luZGV4XSA9IGVsZW0uY2FudmFzO1xuICAgICAgcmV0dXJuIHRoaXMucGx1Z2luLmNhbnZhc09wdGlvbnNUb1J1c3QoZWxlbSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpc1trT2JqZWN0XS5yZW5kZXJfY2FudmFzKGFjdGlvbnMsIGVsZW1lbnRzLCBvcHRpb25zKTtcbiAgfVxuXG4gIGFzeW5jIHJldHJpZXZlUGFnZXNJbmZvKCk6IFByb21pc2U8UGFnZUluZm9bXT4ge1xuICAgIGNvbnN0IHBhZ2VzX2luZm8gPSBhd2FpdCB0aGlzW2tPYmplY3RdLmdldF9wYWdlc19pbmZvKCk7XG4gICAgY29uc29sZS5sb2cocGFnZXNfaW5mbyk7XG4gICAgY29uc3QgcGFnZUluZm9zOiBQYWdlSW5mb1tdID0gW107XG4gICAgY29uc3QgcGFnZUNvdW50ID0gcGFnZXNfaW5mby5wYWdlX2NvdW50O1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcGFnZUNvdW50OyBpKyspIHtcbiAgICAgIGNvbnN0IHBhZ2VBc3QgPSBwYWdlc19pbmZvLnBhZ2UoaSk7XG4gICAgICBwYWdlSW5mb3MucHVzaCh7XG4gICAgICAgIHBhZ2VPZmZzZXQ6IHBhZ2VBc3QucGFnZV9vZmYsXG4gICAgICAgIHdpZHRoOiBwYWdlQXN0LndpZHRoX3B0LFxuICAgICAgICBoZWlnaHQ6IHBhZ2VBc3QuaGVpZ2h0X3B0LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHBhZ2VJbmZvcztcbiAgfVxufVxuXG4vKipcbiAqIEBkZXByZWNhdGVkXG4gKiB1c2Uge0BsaW5rIFR5cHN0UmVuZGVyZXJ9IGluc3RlYWRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUeXBzdFN2Z1JlbmRlcmVyIHtcbiAgLyoqXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIHN2Zy5cbiAgICogQHBhcmFtIHtSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz59IG9wdGlvbnMgLSBUaGUgb3B0aW9ucyBmb3JcbiAgICogcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQgdG8gc3BlY2lmaWVkIGNvbnRhaW5lci5cbiAgICogQHJldHVybnMge3ZvaWR9IC0gVGhlIHJlc3VsdCBvZiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudC5cbiAgICogQGV4YW1wbGVcbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiBsZXQgZmV0Y2hEb2MgPSAocGF0aCkgPT4gZmV0Y2gocGF0aCkudGhlbihcbiAgICogICByZXNwb25zZSA9PiBuZXcgVWludDhBcnJheShyZXNwb25zZS5hcnJheUJ1ZmZlcigpKSlcbiAgICogcmVuZGVyZXIucmVuZGVyVG9Tdmcoe1xuICAgKiAgIGNvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhaW5lcicpLFxuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIHJlbmRlclRvU3ZnKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9TdmdPcHRpb25zPik6IFByb21pc2U8Ym9vbGVhbj47XG59XG5cblxuLyoqXG4gKiBUaGUgaW50ZXJmYWNlIG9mIFR5cHN0IHJlbmRlcmVyLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFR5cHN0UmVuZGVyZXIgZXh0ZW5kcyBUeXBzdFN2Z1JlbmRlcmVyIHtcbiAgLyoqXG4gICAqIEluaXRpYWxpemUgdGhlIHR5cHN0IHJlbmRlcmVyLlxuICAgKiBAcGFyYW0ge1BhcnRpYWw8SW5pdE9wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yIGluaXRpYWxpemluZyB0aGVcbiAgICogdHlwc3QgcmVuZGVyZXIuXG4gICAqL1xuICBpbml0KG9wdGlvbnM/OiBQYXJ0aWFsPEluaXRPcHRpb25zPik6IFByb21pc2U8dm9pZD47XG5cbiAgLyoqXG4gICAqIExvYWQgYSBnbHlwaCBwYWNrIGZvciBhbGwgb2YgdGhlIFR5cHN0IGRvY3VtZW50cyB0byByZW5kZXIuXG4gICAqIE5vdGU6IHRoaXMgZnVuY3Rpb24gaXMgc3RpbGwgdW5kZXIgZGV2ZWxvcG1lbnQuXG4gICAqIEBwYXJhbSBwYWNrXG4gICAqL1xuICBsb2FkR2x5cGhQYWNrKHBhY2s6IHVua25vd24pOiBQcm9taXNlPHZvaWQ+O1xuXG4gIC8qKlxuICAgKiBSZXNldCBzdGF0ZVxuICAgKi9cbiAgcmVzZXRTZXNzaW9uKHNlc3Npb246IFJlbmRlclNlc3Npb24pOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBwYWdlIGluZm9ybWF0aW9uIG9mIGN1cnJlbnQgc2VsZWN0ZWQgZG9jdW1lbnRcbiAgICovXG4gIHJldHJpZXZlUGFnZXNJbmZvRnJvbVNlc3Npb24oc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbik6IFBhZ2VJbmZvW107XG5cbiAgLyoqXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIGNhbnZhcy5cbiAgICovXG4gIHJlbmRlckNhbnZhcyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlckNhbnZhc09wdGlvbnM+KTogUHJvbWlzZTxSZW5kZXJDYW52YXNSZXN1bHQ+O1xuXG4gIC8qKlxuICAgKiBSZW5kZXIgYSBUeXBzdCBkb2N1bWVudCB0byBjYW52YXMuXG4gICAqIEBwYXJhbSB7UmVuZGVyT3B0aW9uczxSZW5kZXJUb0NhbnZhc09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXG4gICAqIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50IHRvIHNwZWNpZmllZCBjb250YWluZXIuXG4gICAqIEByZXR1cm5zIHt2b2lkfSAtIFRoZSByZXN1bHQgb2YgcmVuZGVyaW5nIGEgVHlwc3QgZG9jdW1lbnQuXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogbGV0IGZldGNoRG9jID0gKHBhdGgpID0+IGZldGNoKHBhdGgpLnRoZW4oXG4gICAqICAgcmVzcG9uc2UgPT4gbmV3IFVpbnQ4QXJyYXkocmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkpXG4gICAqIHJlbmRlcmVyLnJlbmRlclRvQ2FudmFzKHtcbiAgICogICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcbiAgICogICBwaXhlbFBlclB0OiAzLFxuICAgKiAgIGJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLFxuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIHJlbmRlclRvQ2FudmFzKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9DYW52YXNPcHRpb25zPik6IFByb21pc2U8dm9pZD47XG5cbiAgLyoqXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIChub24taW5jcmVtZW50YWwpIHN2ZyBzdHJpbmcuXG4gICAqIEBwYXJhbSB7UmVuZGVyT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPn0gb3B0aW9ucyAtIFRoZSBvcHRpb25zIGZvclxuICAgKiByZW5kZXJpbmcgYSBUeXBzdCBkb2N1bWVudCB0byBzcGVjaWZpZWQgY29udGFpbmVyLlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSAtIFRoZSByZW5kZXJlZCBjb250ZW50LlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGB0eXBlc2NyaXB0XG4gICAqIGxldCBmZXRjaERvYyA9IChwYXRoKSA9PiBmZXRjaChwYXRoKS50aGVuKFxuICAgKiAgIHJlc3BvbnNlID0+IG5ldyBVaW50OEFycmF5KHJlc3BvbnNlLmFycmF5QnVmZmVyKCkpKVxuICAgKiBjb25zdCBzdmcgPSByZW5kZXJlci5yZW5kZXJTdmcoe1xuICAgKiAgIGFydGlmYWN0Q29udGVudDogYXdhaXQgZmV0Y2hEb2MoJ3R5cHN0LW1haW4uc2lyLmluJyksXG4gICAqIH0pO1xuICAgKiBgYGBcbiAgICovXG4gIHJlbmRlclN2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclN2Z09wdGlvbnM+KTogUHJvbWlzZTxzdHJpbmc+O1xuXG4gIC8qKlxuICAgKiBSZW5kZXIgYSBUeXBzdCBkb2N1bWVudCB0byBzdmcuXG4gICAqIEBwYXJhbSB7UmVuZGVyT3B0aW9uczxSZW5kZXJUb1N2Z09wdGlvbnM+fSBvcHRpb25zIC0gVGhlIG9wdGlvbnMgZm9yXG4gICAqIHJlbmRlcmluZyBhIFR5cHN0IGRvY3VtZW50IHRvIHNwZWNpZmllZCBjb250YWluZXIuXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogbGV0IGZldGNoRG9jID0gKHBhdGgpID0+IGZldGNoKHBhdGgpLnRoZW4oXG4gICAqICAgcmVzcG9uc2UgPT4gbmV3IFVpbnQ4QXJyYXkocmVzcG9uc2UuYXJyYXlCdWZmZXIoKSkpXG4gICAqIHJlbmRlcmVyLnJlbmRlclRvU3ZnKHtcbiAgICogICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcbiAgICogICBhcnRpZmFjdENvbnRlbnQ6IGF3YWl0IGZldGNoRG9jKCd0eXBzdC1tYWluLnNpci5pbicpLFxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqL1xuICByZW5kZXJUb1N2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvU3ZnT3B0aW9ucz4pOiBQcm9taXNlPGJvb2xlYW4+O1xuXG4gIC8qKlxuICAgKiBSZXR1cm4gc2VsZWN0ZWQgY3VycmVudCBzdmdcbiAgICovXG4gIGdldEN1c3RvbVYxKG9wdGlvbnM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8e30+KTogUHJvbWlzZTxhbnk+O1xuXG4gIC8qKlxuICAgKiBleHBlcmltZW50YWxcbiAgICovXG4gIHJlbmRlclN2Z0RpZmYob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IHN0cmluZztcblxuICAvKipcbiAgICogTWFuaXB1bGF0ZSB0aGUgVHlwc3QgZG9jdW1lbnQgaW4gdGhlIHNlc3Npb24uXG4gICAqIFNlZSB7QGxpbmsgTWFuaXB1bGF0ZURhdGFPcHRpb25zfSBmb3IgbW9yZSBkZXRhaWxzLlxuICAgKiBAcGFyYW0ge1JlbmRlclNlc3Npb259IHNlc3Npb24gLSBUaGUgVHlwc3QgZG9jdW1lbnQgc2Vzc2lvbiB0aGF0IGhhcyBiZWVuXG4gICAqIGNyZWF0ZWQgYnkgVHlwc3RSZW5kZXJlci5cbiAgICogQHBhcmFtIHtNYW5pcHVsYXRlRGF0YU9wdGlvbnN9IG9wdHMgLSBUaGUgb3B0aW9ucyBmb3IgbWFuaXB1bGF0aW5nIHRoZVxuICAgKiBUeXBzdCBkb2N1bWVudCBpbiB0aGUgc2Vzc2lvbi5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogcmVzZXQgdGhlIGRhdGEgdG8gdGhlIGluaXRpYWwgc3RhdGUuXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHJlbmRlcmVyLmNyZWF0ZVNlc3Npb24oLi4uKTtcbiAgICogYXdhaXQgcmVuZGVyZXIubWFuaXB1bGF0ZURhdGEoc2Vzc2lvbiwge1xuICAgKiAgIGFjdGlvbjogJ3Jlc2V0JyxcbiAgICogICBkYXRhOiBuZXcgVWludDhBcnJheSguLi4pLFxuICAgKiB9KTtcbiAgICogYGBgXG4gICAqIEBleGFtcGxlXG4gICAqIG1lcmdlIHRoZSBkYXRhIHRvIHRoZSBjdXJyZW50IHN0YXRlLlxuICAgKiBgYGB0eXBlc2NyaXB0XG4gICAqIGNvbnN0IHNlc3Npb24gPSBhd2FpdCByZW5kZXJlci5jcmVhdGVTZXNzaW9uKC4uLik7XG4gICAqIC8vLyByZXNldCB0aGUgZGF0YSB0byB0aGUgaW5pdGlhbCBzdGF0ZVxuICAgKiBhd2FpdCByZW5kZXJlci5tYW5pcHVsYXRlRGF0YShzZXNzaW9uLCBkYXRhKCdyZXNldCcpKTtcbiAgICogLy8vIG1lcmdlIHRoZSBkYXRhIHRvIHRoZSBjdXJyZW50IHN0YXRlXG4gICAqIGF3YWl0IHJlbmRlcmVyLm1hbmlwdWxhdGVEYXRhKHNlc3Npb24sIGRhdGEoJ21lcmdlJykpO1xuICAgKiAvLy8gaW5jcmVtZW50YWxseSBtZXJnZSB0aGUgZGF0YSBhZ2FpblxuICAgKiBhd2FpdCByZW5kZXJlci5tYW5pcHVsYXRlRGF0YShzZXNzaW9uLCBkYXRhKCdtZXJnZScpKTtcbiAgICogYGBgXG4gICAqL1xuICBtYW5pcHVsYXRlRGF0YShvcHRzOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPE1hbmlwdWxhdGVEYXRhT3B0aW9ucz4pOiB2b2lkO1xuXG4gIC8qKlxuICAgKiBSdW4gYSBmdW5jdGlvbiB3aXRoIGEgc2Vzc2lvbiwgYW5kIHRoZSBzZXNzaW9uIGlzIG9ubHkgYXZhaWxhYmxlIGR1cmluZ1xuICAgKiB0aGUgZnVuY3Rpb24gY2FsbC5cbiAgICpcbiAgICogdGhlIGxpZmV0aW1lIG9mIHNlc3Npb24gaXMgcXVpdGUgYnVnLXByb25lLCBzbyB3ZSBjdXJyZW50IGRvZXMgbm90IG1ha2UgaXRcbiAgICogbG9uZ2VyIGxpdmUgdGhhbiB0aGUgZnVuY3Rpb24gY2FsbC5cbiAgICogQHBhcmFtIHtmdW5jdGlvbn0gZm4gLSBUaGUgZnVuY3Rpb24gdG8gcnVuIHdpdGggYSBzZXNzaW9uLlxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxUPn0gLSBUaGUgcmVzdWx0IG9mIHRoZSBmdW5jdGlvbi5cbiAgICogQGV4YW1wbGVcbiAgICogcnVuIGEgZnVuY3Rpb24gd2l0aCBhbiBzZXNzaW9uIHdpdGggZW1wdHkgc3RhdGUuXG4gICAqXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogY29uc3QgcmVzID0gYXdhaXQgcmVuZGVyZXIucnVuV2l0aFNlc3Npb24oYXN5bmMgc2Vzc2lvbiA9PiB7XG4gICAqICAgYXdhaXQgcmVuZGVyZXIubWFuaXB1bGF0ZURhdGEoc2Vzc2lvbiwgZGF0YSgncmVzZXQnKSk7XG4gICAqICAgcmV0dXJuIGF3YWl0IHJlbmRlcmVyLnJlbmRlclRvQ2FudmFzKHtcbiAgICogICAgIHJlbmRlclNlc3Npb246IHNlc3Npb24sXG4gICAqICAgICBjb250YWluZXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250YWluZXInKSxcbiAgICogICAgIGJhY2tncm91bmRDb2xvcjogJyNmZmZmZmYnLFxuICAgKiAgIH0pO1xuICAgKiB9KTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqIHJ1biBhIGZ1bmN0aW9uIHdpdGggYW4gc2Vzc2lvbiB3aXRoIGluaXRpYWwgc3RhdGUuXG4gICAqXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogY29uc3QgcmVzID0gYXdhaXQgcmVuZGVyZXIucnVuV2l0aFNlc3Npb24oe1xuICAgKiAgIGZvcm1hdDogJ3ZlY3RvcicsXG4gICAqICAgYXJ0aWZhY3RDb250ZW50OiBuZXcgVWludDhBcnJheSguLi4pLFxuICAgKiB9LCB3b3JrV2l0aFNlc3Npb24oc2Vzc2lvbikpO1xuICAgKiBgYGBcbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICogbGVhayB0aGUgbGlmZSBzcGFuIG9mIHNlc3Npb24gKG5lZWQgdHlwZXNjcmlwdCA+PSB2NS4yKVxuICAgKlxuICAgKiBgYGB0eXBlc2NyaXB0XG4gICAqIGNsYXNzIFN0YWNrZWRTZXNzaW9uIHtcbiAgICogICBzZXNzaW9uOiBSZW5kZXJTZXNzaW9uO1xuICAgKiAgIHByaXZhdGUgcmVzb2x2ZTogKHNlc3Npb246IFJlbmRlclNlc3Npb24pID0+IHZvaWQ7XG4gICAqICAgW1N5bWJvbC5kaXNwb3NlXSgpIHtcbiAgICogICAgIHRoaXMucmVzb2x2ZSgpO1xuICAgKiAgIH1cbiAgICogICBzdGF0aWMgYXN5bmMgY3JlYXRlKCkge1xuICAgKiAgICAgcmV0dXJuIG5ldyBQcm9taXNlPFN0YWNrZWRTZXNzaW9uPihyZXNvbHZlID0+IHtcbiAgICogICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHJlbmRlcmVyLnJ1bldpdGhTZXNzaW9uKHNlc3Npb24gPT4ge1xuICAgKiAgICAgICBjb25zdCBzdGFja2VkU2Vzc2lvbiA9IG5ldyBTdGFja2VkU2Vzc2lvbigpO1xuICAgKiAgICAgICBzdGFja2VkU2Vzc2lvbi5zZXNzaW9uID0gc2Vzc2lvbjtcbiAgICogICAgICAgc3RhY2tlZFNlc3Npb24ucmVzb2x2ZSA9IHJlc29sdmU7XG4gICAqICAgICAgIHJldHVybiBzdGFja2VkU2Vzc2lvbjtcbiAgICogICAgIH0pO1xuICAgKiAgIH1cbiAgICogfVxuICAgKlxuICAgKiB7XG4gICAqICAgYXdhaXQgdXNpbmcgc2Vzc2lvbiA9IFN0YWNrZWRTZXNzaW9uLmNyZWF0ZSgpO1xuICAgKiAgIC8vLyBkbyBzb21ldGhpbmcgd2l0aCBzZXNzaW9uXG4gICAqIH1cbiAgICogYGBgXG4gICAqL1xuICBydW5XaXRoU2Vzc2lvbjxUPihmbjogKHNlc3Npb246IFJlbmRlclNlc3Npb24pID0+IFByb21pc2U8VD4pOiBQcm9taXNlPFQ+O1xuICBydW5XaXRoU2Vzc2lvbjxUPihcbiAgICBvcHRpb25zOiBDcmVhdGVTZXNzaW9uT3B0aW9ucyxcbiAgICBmbjogKHNlc3Npb246IFJlbmRlclNlc3Npb24pID0+IFByb21pc2U8VD4sXG4gICk6IFByb21pc2U8VD47XG5cbiAgY3JlYXRlV29ya2VyVjAod29ya2VyOiBXb3JrZXIpOiBQcm9taXNlPFR5cHN0V29ya2VyPjtcblxuICByZW5kZXJEb20ob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxNb3VudERvbU9wdGlvbnM+KTogUHJvbWlzZTxUeXBzdERvbURvY3VtZW50PjtcblxuICAvKipcbiAgICogYWxpYXMgdG8ge0BsaW5rIFR5cHN0UmVuZGVyZXIjcmVuZGVyVG9DYW52YXN9LCB3aWxsIHJlbW92ZSBpbiB2MC41LjBcbiAgICogQGRlcHJlY2F0ZWRcbiAgICogdXNlIHtAbGluayByZW5kZXJUb0NhbnZhc30gaW5zdGVhZFxuICAgKi9cbiAgcmVuZGVyKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9DYW52YXNPcHRpb25zPik6IFByb21pc2U8dm9pZD47XG59XG5cbmNvbnN0IGdSZW5kZXJlck1vZHVsZSA9IChtb2R1bGU6IHR5cGVvZiB0eXBzdCkgPT5cbiAgbmV3IExhenlXYXNtTW9kdWxlKGFzeW5jIChiaW4/OiBhbnkpID0+IHtcbiAgICByZXR1cm4gYXdhaXQgbW9kdWxlLmRlZmF1bHQoYmluKTtcbiAgfSk7XG5cbi8qKlxuICogY3JlYXRlIGEgVHlwc3QgcmVuZGVyZXIuXG4gKiBAcmV0dXJucyB7VHlwc3RSZW5kZXJlcn0gLSBUaGUgVHlwc3QgcmVuZGVyZXIuXG4gKiBAZXhhbXBsZVxuICogYGBgdHlwZXNjcmlwdFxuICogaW1wb3J0IHsgY3JlYXRlVHlwc3RSZW5kZXJlciB9IGZyb20gJ3R5cHN0JztcbiAqIGNvbnN0IHJlbmRlcmVyID0gY3JlYXRlVHlwc3RSZW5kZXJlcigpO1xuICogYXdhaXQgcmVuZGVyZXIuaW5pdCgpO1xuICogYXdhaXQgcmVuZGVyZXIucmVuZGVyKHtcbiAqICAgY29udGFpbmVyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFpbmVyJyksXG4gKiAgIGFydGlmYWN0Q29udGVudDogJ3sgLi4uIH0nLFxuICogfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVR5cHN0UmVuZGVyZXIoKTogVHlwc3RSZW5kZXJlciB7XG4gIHJldHVybiBuZXcgVHlwc3RSZW5kZXJlckRyaXZlcigpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcmVuZGVyZXJCdWlsZEluZm8oKTogUHJvbWlzZTxhbnk+IHtcbiAgY29uc3QgcmVuZGVyTW9kdWxlID0gYXdhaXQgaW1wb3J0KCdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy1yZW5kZXJlcicpO1xuICByZXR1cm4gcmVuZGVyTW9kdWxlLnJlbmRlcmVyX2J1aWxkX2luZm8oKTtcbn1cblxubGV0IHdhcm5PbmNlQ2FudmFzU2V0ID0gdHJ1ZTtcblxuLyoqIEBpbnRlcm5hbCAqL1xuZXhwb3J0IGNsYXNzIFR5cHN0UmVuZGVyZXJEcml2ZXIge1xuICByZW5kZXJlcjogdHlwc3QuVHlwc3RSZW5kZXJlcjtcbiAgcmVuZGVyZXJKczogdHlwZW9mIHR5cHN0O1xuXG4gIGNvbnN0cnVjdG9yKCkgeyB9XG5cbiAgYXN5bmMgaW5pdChvcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLnJlbmRlcmVySnMgPSBhd2FpdCAob3B0aW9ucz8uZ2V0V3JhcHBlcj8uKCkgfHwgaW1wb3J0KCdAbXlyaWFkZHJlYW1pbi90eXBzdC10cy1yZW5kZXJlcicpKTtcbiAgICBjb25zdCBUeXBzdFJlbmRlcmVyQnVpbGRlciA9IHRoaXMucmVuZGVyZXJKcy5UeXBzdFJlbmRlcmVyQnVpbGRlcjtcbiAgICB0aGlzLnJlbmRlcmVyID0gYXdhaXQgYnVpbGRDb21wb25lbnQoXG4gICAgICBvcHRpb25zLFxuICAgICAgZ1JlbmRlcmVyTW9kdWxlKHRoaXMucmVuZGVyZXJKcyksXG4gICAgICBUeXBzdFJlbmRlcmVyQnVpbGRlcixcbiAgICAgIHt9LFxuICAgICk7XG4gIH1cblxuICBsb2FkR2x5cGhQYWNrKF9wYWNrOiB1bmtub3duKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gdGhpcy5yZW5kZXJlci5sb2FkX2dseXBoX3BhY2socGFjayk7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVPcHRpb25zVG9SdXN0KG9wdGlvbnM6IFBhcnRpYWw8Q3JlYXRlU2Vzc2lvbk9wdGlvbnM+KTogdHlwc3QuQ3JlYXRlU2Vzc2lvbk9wdGlvbnMge1xuICAgIGNvbnN0IHJ1c3RPcHRpb25zID0gbmV3IHRoaXMucmVuZGVyZXJKcy5DcmVhdGVTZXNzaW9uT3B0aW9ucygpO1xuXG4gICAgaWYgKG9wdGlvbnMuZm9ybWF0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJ1c3RPcHRpb25zLmZvcm1hdCA9IG9wdGlvbnMuZm9ybWF0O1xuICAgIH1cblxuICAgIGlmIChvcHRpb25zLmFydGlmYWN0Q29udGVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBydXN0T3B0aW9ucy5hcnRpZmFjdF9jb250ZW50ID0gb3B0aW9ucy5hcnRpZmFjdENvbnRlbnQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJ1c3RPcHRpb25zO1xuICB9XG5cbiAgY2FudmFzT3B0aW9uc1RvUnVzdChvcHRpb25zOiBSZW5kZXJDYW52YXNPcHRpb25zKTogdHlwc3QuUmVuZGVyUGFnZUltYWdlT3B0aW9ucyB7XG4gICAgY29uc3QgcnVzdE9wdGlvbnMgPSBuZXcgdGhpcy5yZW5kZXJlckpzLlJlbmRlclBhZ2VJbWFnZU9wdGlvbnMoKTtcbiAgICBpZiAob3B0aW9ucy5wYWdlT2Zmc2V0ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigncGFnZU9mZnNldCBpcyByZXF1aXJlZCBpbiByZWZsZXhvIHYwLjUuMCcpO1xuICAgIH0gZWxzZSB7XG4gICAgICBydXN0T3B0aW9ucy5wYWdlX29mZiA9IG9wdGlvbnMucGFnZU9mZnNldDtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuY2FjaGVLZXkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcnVzdE9wdGlvbnMuY2FjaGVfa2V5ID0gb3B0aW9ucy5jYWNoZUtleTtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuYmFja2dyb3VuZENvbG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHJ1c3RPcHRpb25zLmJhY2tncm91bmRfY29sb3IgPSBvcHRpb25zLmJhY2tncm91bmRDb2xvcjtcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMucGl4ZWxQZXJQdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBydXN0T3B0aW9ucy5waXhlbF9wZXJfcHQgPSBvcHRpb25zLnBpeGVsUGVyUHQ7XG4gICAgfVxuICAgIGlmIChvcHRpb25zLmRhdGFTZWxlY3Rpb24gIT09IHVuZGVmaW5lZCkge1xuICAgICAgbGV0IGVuY29kZWQgPSAwO1xuICAgICAgaWYgKG9wdGlvbnMuZGF0YVNlbGVjdGlvbi5ib2R5KSB7XG4gICAgICAgIGVuY29kZWQgfD0gMSA8PCAwO1xuICAgICAgfSBlbHNlIGlmIChvcHRpb25zLmNhbnZhcyAmJiB3YXJuT25jZUNhbnZhc1NldCkge1xuICAgICAgICB3YXJuT25jZUNhbnZhc1NldCA9IGZhbHNlO1xuICAgICAgICBjb25zb2xlLndhcm4oJ2RhdGFTZWxlY3Rpb24uYm9keSBpcyBub3Qgc2V0IGJ1dCBwcm92aWRpbmcgY2FudmFzIGZvciBib2R5Jyk7XG4gICAgICB9XG4gICAgICBpZiAob3B0aW9ucy5kYXRhU2VsZWN0aW9uLnRleHQgfHwgb3B0aW9ucy5kYXRhU2VsZWN0aW9uLmFubm90YXRpb24pIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignZGF0YVNlbGVjdGlvbi50ZXh0IGFuZCBkYXRhU2VsZWN0aW9uLmFubm90YXRpb24gYXJlIGRlcHJlY2F0ZWQnKTtcbiAgICAgIH1cbiAgICAgIGlmIChvcHRpb25zLmRhdGFTZWxlY3Rpb24uc2VtYW50aWNzKSB7XG4gICAgICAgIGVuY29kZWQgfD0gMSA8PCAzO1xuICAgICAgfVxuICAgICAgcnVzdE9wdGlvbnMuZGF0YV9zZWxlY3Rpb24gPSBlbmNvZGVkO1xuICAgIH1cbiAgICByZXR1cm4gcnVzdE9wdGlvbnM7XG4gIH1cblxuICByZXRyaWV2ZVBhZ2VzSW5mb0Zyb21TZXNzaW9uKHNlc3Npb246IFJlbmRlclNlc3Npb24pOiBQYWdlSW5mb1tdIHtcbiAgICByZXR1cm4gc2Vzc2lvbi5yZXRyaWV2ZVBhZ2VzSW5mbygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbmRlciBhIFR5cHN0IGRvY3VtZW50IHRvIGNhbnZhcy5cbiAgICovXG4gIHJlbmRlckNhbnZhcyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlckNhbnZhc09wdGlvbnM+KTogUHJvbWlzZTxSZW5kZXJDYW52YXNSZXN1bHQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyZXIucmVuZGVyX3BhZ2VfdG9fY2FudmFzKFxuICAgICAgICBzZXNzaW9uUmVmW2tPYmplY3RdLFxuICAgICAgICBvcHRpb25zLmNhbnZhcyB8fCB1bmRlZmluZWQsXG4gICAgICAgIHRoaXMuY2FudmFzT3B0aW9uc1RvUnVzdChvcHRpb25zKSxcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICAvLyBhc3luYyByZW5kZXJQZGYoYXJ0aWZhY3RDb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPFVpbnQ4QXJyYXk+IHtcbiAgLy8gcmV0dXJuIHRoaXMucmVuZGVyZXIucmVuZGVyX3RvX3BkZihhcnRpZmFjdENvbnRlbnQpO1xuICAvLyB9XG5cbiAgcHJpdmF0ZSBhc3luYyBpbkFuaW1hdGlvbkZyYW1lPFQ+KGZuOiAoKSA9PiBQcm9taXNlPFQ+KTogUHJvbWlzZTxUPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzb2x2ZShmbigpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlbmRlckRpc3BsYXlMYXllcihcbiAgICBzZXNzaW9uOiBSZW5kZXJTZXNzaW9uLFxuICAgIGNhbnZhc0xpc3Q6IEhUTUxDYW52YXNFbGVtZW50W10sXG4gICAgb3B0aW9uczogUmVuZGVyVG9DYW52YXNPcHRpb25zLFxuICApOiBQcm9taXNlPFJlbmRlckNhbnZhc1Jlc3VsdFtdPiB7XG4gICAgY29uc3QgcGFnZXNfaW5mbyA9IHNlc3Npb25ba09iamVjdF0ucGFnZXNfaW5mbztcbiAgICBjb25zdCBwYWdlX2NvdW50ID0gcGFnZXNfaW5mby5wYWdlX2NvdW50O1xuXG4gICAgY29uc3QgZG9SZW5kZXIgPSBhc3luYyAoaTogbnVtYmVyLCBwYWdlX29mZjogbnVtYmVyKSA9PiB7XG4gICAgICBjb25zdCBjYW52YXMgPSBjYW52YXNMaXN0W2ldO1xuICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICBpZiAoIWN0eCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NhbnZhcyBjb250ZXh0IGlzIG51bGwnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLnJlbmRlckNhbnZhcyh7XG4gICAgICAgIC4uLm9wdGlvbnMsXG4gICAgICAgIGNhbnZhczogY3R4LFxuICAgICAgICByZW5kZXJTZXNzaW9uOiBzZXNzaW9uLFxuICAgICAgICBwYWdlT2Zmc2V0OiBwYWdlX29mZixcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICBjb25zdCB0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgY29uc3QgdGV4dENvbnRlbnRMaXN0ID0gYXdhaXQgKGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdHM6IFJlbmRlckNhbnZhc1Jlc3VsdFtdID0gW107XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHBhZ2VfY291bnQ7IGkrKykge1xuICAgICAgICByZXN1bHRzLnB1c2goYXdhaXQgdGhpcy5pbkFuaW1hdGlvbkZyYW1lKCgpID0+IGRvUmVuZGVyKGksIGkpKSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHRzO1xuICAgIH0pKCk7XG4gICAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcblxuICAgIGNvbnNvbGUubG9nKGBkaXNwbGF5IGxheWVyIHVzZWQ6IHJlbmRlciA9ICR7KHQyIC0gdCkudG9GaXhlZCgxKX1tc2ApO1xuXG4gICAgcmV0dXJuIHRleHRDb250ZW50TGlzdDtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyVGV4dExheWVyKGxheWVyTGlzdDogSFRNTERpdkVsZW1lbnRbXSwgdGV4dFNvdXJjZUxpc3Q6IFJlbmRlckNhbnZhc1Jlc3VsdFtdKSB7XG4gICAgY29uc3QgdDIgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBsYXllckxpc3QuZm9yRWFjaCgobGF5ZXIsIGkpID0+IHtcbiAgICAgIGxheWVyLmlubmVySFRNTCA9IHRleHRTb3VyY2VMaXN0W2ldLmh0bWxTZW1hbnRpY3NbMF07XG4gICAgfSk7XG4gICAgY29uc3QgdDMgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBjb25zb2xlLmxvZyhgdGV4dCBsYXllciB1c2VkOiByZW5kZXIgPSAkeyh0MyAtIHQyKS50b0ZpeGVkKDEpfW1zYCk7XG4gIH1cblxuICBhc3luYyByZW5kZXIob3B0aW9uczogUmVuZGVyT3B0aW9uczxSZW5kZXJUb0NhbnZhc09wdGlvbnM+KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCdmb3JtYXQnIGluIG9wdGlvbnMpIHtcbiAgICAgIGlmIChvcHRpb25zLmZvcm1hdCAhPT0gJ3ZlY3RvcicpIHtcbiAgICAgICAgY29uc3QgYXJ0aWZhY3RGb3JtYXRzID0gWydzZXJkZV9qc29uJywgJ2pzJywgJ2lyJ10gYXMgY29uc3Q7XG4gICAgICAgIGlmIChhcnRpZmFjdEZvcm1hdHMuaW5jbHVkZXMob3B0aW9ucy5mb3JtYXQgYXMgYW55KSkge1xuICAgICAgICAgIC8vIGRlcHJlY2F0ZWRcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYGRlcHJlY2F0ZWQgZm9ybWF0ICR7b3B0aW9ucy5mb3JtYXR9LCBwbGVhc2UgdXNlIHZlY3RvciBmb3JtYXRgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlbmRlclRvQ2FudmFzKG9wdGlvbnMpO1xuICB9XG5cbiAgYXN5bmMgcmVuZGVyRG9tKG9wdGlvbnM6IFJlbmRlckluU2Vzc2lvbk9wdGlvbnM8TW91bnREb21PcHRpb25zPik6IFByb21pc2U8VHlwc3REb21Eb2N1bWVudD4ge1xuICAgIGlmICgnZm9ybWF0JyBpbiBvcHRpb25zKSB7XG4gICAgICBpZiAob3B0aW9ucy5mb3JtYXQgIT09ICd2ZWN0b3InKSB7XG4gICAgICAgIGNvbnN0IGFydGlmYWN0Rm9ybWF0cyA9IFsnc2VyZGVfanNvbicsICdqcycsICdpciddIGFzIGNvbnN0O1xuICAgICAgICBpZiAoYXJ0aWZhY3RGb3JtYXRzLmluY2x1ZGVzKG9wdGlvbnMuZm9ybWF0IGFzIGFueSkpIHtcbiAgICAgICAgICAvLyBkZXByZWNhdGVkXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBkZXByZWNhdGVkIGZvcm1hdCAke29wdGlvbnMuZm9ybWF0fSwgcGxlYXNlIHVzZSB2ZWN0b3IgZm9ybWF0YCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy53aXRoaW5PcHRpb25TZXNzaW9uKG9wdGlvbnMsIGFzeW5jIHNlc3Npb25SZWYgPT4ge1xuICAgICAgY29uc3QgdCA9IG5ldyBUeXBzdERvbURvY3VtZW50KHtcbiAgICAgICAgLi4ub3B0aW9ucyxcbiAgICAgICAgcmVuZGVyTW9kZTogJ2RvbScsXG4gICAgICAgIGhvb2tlZEVsZW06IG9wdGlvbnMuY29udGFpbmVyLFxuICAgICAgICBrTW9kdWxlOiBzZXNzaW9uUmVmLFxuICAgICAgICByZW5kZXJlcjogdGhpcyxcbiAgICAgIH0pO1xuICAgICAgdDtcbiAgICAgIGF3YWl0IHQuaW1wbC5tb3VudERvbShvcHRpb25zLnBpeGVsUGVyUHQpO1xuICAgICAgcmV0dXJuIHQ7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyByZW5kZXJUb0NhbnZhcyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclRvQ2FudmFzT3B0aW9ucz4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBsZXQgc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbjtcbiAgICBsZXQgcmVuZGVyUGFnZVJlc3VsdHM6IFJlbmRlckNhbnZhc1Jlc3VsdFtdO1xuICAgIGNvbnN0IG1vdW50Q29udGFpbmVyID0gb3B0aW9ucy5jb250YWluZXI7XG4gICAgbW91bnRDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICdoaWRkZW4nO1xuXG4gICAgY29uc3QgZG9SZW5kZXJEaXNwbGF5TGF5ZXIgPSBhc3luYyAoXG4gICAgICBjYW52YXNMaXN0OiBIVE1MQ2FudmFzRWxlbWVudFtdLFxuICAgICAgcmVzZXRMYXlvdXQ6ICgpID0+IHZvaWQsXG4gICAgKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICByZW5kZXJQYWdlUmVzdWx0cyA9IGF3YWl0IHRoaXMucmVuZGVyRGlzcGxheUxheWVyKHNlc3Npb24sIGNhbnZhc0xpc3QsIG9wdGlvbnMpO1xuICAgICAgICByZXNldExheW91dCgpO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgbW91bnRDb250YWluZXIuc3R5bGUudmlzaWJpbGl0eSA9ICd2aXNpYmxlJztcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIHRoaXMud2l0aGluT3B0aW9uU2Vzc2lvbihvcHRpb25zLCBhc3luYyBzZXNzaW9uUmVmID0+IHtcbiAgICAgIHNlc3Npb24gPSBzZXNzaW9uUmVmO1xuICAgICAgaWYgKHNlc3Npb25ba09iamVjdF0ucGFnZXNfaW5mby5wYWdlX2NvdW50ID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgTm8gcGFnZSBmb3VuZCBpbiBzZXNzaW9uYCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChvcHRpb25zLnBpeGVsUGVyUHQgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLnBpeGVsUGVyUHQgPD0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgJ0ludmFsaWQgdHlwc3QuUmVuZGVyT3B0aW9ucy5waXhlbFBlclB0LCBzaG91bGQgYmUgYSBwb3NpdGl2ZSBudW1iZXIgJyArXG4gICAgICAgICAgb3B0aW9ucy5waXhlbFBlclB0LFxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICBsZXQgYmFja2dyb3VuZENvbG9yID0gb3B0aW9ucy5iYWNrZ3JvdW5kQ29sb3I7XG4gICAgICBpZiAoYmFja2dyb3VuZENvbG9yICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKCEvXiNbMC05YS1mXXs2fSQvLnRlc3QoYmFja2dyb3VuZENvbG9yKSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgICdJbnZhbGlkIHR5cHN0LmJhY2tncm91bmRDb2xvciBjb2xvciBmb3IgbWF0Y2hpbmcgXiM/WzAtOWEtZl17Nn0kICcgKyBiYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBzZXNzaW9uLnBpeGVsUGVyUHQgPSBvcHRpb25zLnBpeGVsUGVyUHQgPz8gVHlwc3REZWZhdWx0UGFyYW1zLlBJWEVMX1BFUl9QVDtcbiAgICAgIHNlc3Npb24uYmFja2dyb3VuZENvbG9yID0gYmFja2dyb3VuZENvbG9yID8/ICcjZmZmZmZmJztcblxuICAgICAgY29uc3QgdCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuXG4gICAgICBjb25zdCBwYWdlVmlldyA9IG5ldyBSZW5kZXJWaWV3KFxuICAgICAgICB0aGlzLnJldHJpZXZlUGFnZXNJbmZvRnJvbVNlc3Npb24oc2Vzc2lvbiksXG4gICAgICAgIG1vdW50Q29udGFpbmVyLFxuICAgICAgICBvcHRpb25zLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHQyID0gcGVyZm9ybWFuY2Uubm93KCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGBsYXllciB1c2VkOiByZXRyaWV2ZSA9ICR7KHQyIC0gdCkudG9GaXhlZCgxKX1tc2ApO1xuXG4gICAgICBhd2FpdCBkb1JlbmRlckRpc3BsYXlMYXllcihwYWdlVmlldy5jYW52YXNMaXN0LCAoKSA9PiBwYWdlVmlldy5yZXNldExheW91dCgpKTtcbiAgICAgIHRoaXMucmVuZGVyVGV4dExheWVyKHBhZ2VWaWV3LnRleHRMYXllckxpc3QsIHJlbmRlclBhZ2VSZXN1bHRzKTtcblxuICAgICAgcmV0dXJuO1xuICAgIH0pO1xuICB9XG5cbiAgY3JlYXRlTW9kdWxlKGI/OiBVaW50OEFycmF5KTogUHJvbWlzZTxSZW5kZXJTZXNzaW9uPiB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShcbiAgICAgIG5ldyBSZW5kZXJTZXNzaW9uKFxuICAgICAgICB0aGlzLFxuICAgICAgICB0aGlzLnJlbmRlcmVyLmNyZWF0ZV9zZXNzaW9uKFxuICAgICAgICAgIGIgJiZcbiAgICAgICAgICB0aGlzLmNyZWF0ZU9wdGlvbnNUb1J1c3Qoe1xuICAgICAgICAgICAgZm9ybWF0OiAndmVjdG9yJyxcbiAgICAgICAgICAgIGFydGlmYWN0Q29udGVudDogYixcbiAgICAgICAgICB9KSxcbiAgICAgICAgKSxcbiAgICAgICksXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZVdvcmtlclYwKHdvcmtlcjogV29ya2VyKSB7XG4gICAgcmV0dXJuIG5ldyBUeXBzdFdvcmtlcih0aGlzLCBhd2FpdCB0aGlzLnJlbmRlcmVyLmNyZWF0ZV93b3JrZXIod29ya2VyKSk7XG4gIH1cblxuICB3b3JrZXJCcmlkZ2UoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIuY3JlYXRlX3dvcmtlcl9icmlkZ2UoKTtcbiAgfVxuXG4gIHJlbmRlclN2ZyhvcHRpb25zOiBSZW5kZXJPcHRpb25zPFJlbmRlclN2Z09wdGlvbnM+LCBjb250YWluZXI/OiBhbnkpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGlmIChvcHRpb25zIGluc3RhbmNlb2YgUmVuZGVyU2Vzc2lvbiB8fCBjb250YWluZXIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcigncmVtb3ZlZCBhcGksIHBsZWFzZSB1c2UgcmVuZGVyVG9TdmcoeyByZW5kZXJTZXNzaW9uLCBjb250YWluZXIgfSkgaW5zdGVhZCcpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLndpdGhpbk9wdGlvblNlc3Npb24ob3B0aW9ucywgYXN5bmMgc2Vzc2lvblJlZiA9PiB7XG4gICAgICBsZXQgcGFydHM6IG51bWJlciB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcbiAgICAgIGlmIChvcHRpb25zLmRhdGFfc2VsZWN0aW9uKSB7XG4gICAgICAgIHBhcnRzID0gMDtcbiAgICAgICAgaWYgKG9wdGlvbnMuZGF0YV9zZWxlY3Rpb24uYm9keSkge1xuICAgICAgICAgIHBhcnRzIHw9IDEgPDwgMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhX3NlbGVjdGlvbi5kZWZzKSB7XG4gICAgICAgICAgcGFydHMgfD0gMSA8PCAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRpb25zLmRhdGFfc2VsZWN0aW9uLmNzcykge1xuICAgICAgICAgIHBhcnRzIHw9IDEgPDwgMjtcbiAgICAgICAgfVxuICAgICAgICBpZiAob3B0aW9ucy5kYXRhX3NlbGVjdGlvbi5qcykge1xuICAgICAgICAgIHBhcnRzIHw9IDEgPDwgMztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMucmVuZGVyZXIuc3ZnX2RhdGEoc2Vzc2lvblJlZltrT2JqZWN0XSwgcGFydHMpKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlclN2Z0RpZmYob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczxSZW5kZXJTdmdPcHRpb25zPik6IHN0cmluZyB7XG4gICAgaWYgKCFvcHRpb25zLndpbmRvdykge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyZXIucmVuZGVyX3N2Z19kaWZmKFxuICAgICAgICAob3B0aW9ucy5yZW5kZXJTZXNzaW9uIGFzIGFueSlba09iamVjdF0sXG4gICAgICAgIDAsXG4gICAgICAgIDAsXG4gICAgICAgIDFlMzMsXG4gICAgICAgIDFlMzMsXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlbmRlcmVyLnJlbmRlcl9zdmdfZGlmZihcbiAgICAgIChvcHRpb25zLnJlbmRlclNlc3Npb24gYXMgYW55KVtrT2JqZWN0XSxcbiAgICAgIG9wdGlvbnMud2luZG93LmxvLngsXG4gICAgICBvcHRpb25zLndpbmRvdy5sby55LFxuICAgICAgb3B0aW9ucy53aW5kb3cuaGkueCxcbiAgICAgIG9wdGlvbnMud2luZG93LmhpLnksXG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlclRvU3ZnKG9wdGlvbnM6IFJlbmRlck9wdGlvbnM8UmVuZGVyVG9TdmdPcHRpb25zPik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLndpdGhpbk9wdGlvblNlc3Npb24ob3B0aW9ucywgYXN5bmMgc2Vzc2lvblJlZiA9PiB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMucmVuZGVyZXIucmVuZGVyX3N2ZyhzZXNzaW9uUmVmW2tPYmplY3RdLCBvcHRpb25zLmNvbnRhaW5lcikpO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0Q3VzdG9tVjEob3B0aW9uczogUmVuZGVySW5TZXNzaW9uT3B0aW9uczx7fT4pOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy5yZW5kZXJlci5nZXRfY3VzdG9tcyhvcHRpb25zLnJlbmRlclNlc3Npb25ba09iamVjdF0pKTtcbiAgfVxuXG4gIHJlc2V0U2Vzc2lvbihzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKTogdm9pZCB7XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyZXIucmVzZXQoc2Vzc2lvbltrT2JqZWN0XSk7XG4gIH1cblxuICBtYW5pcHVsYXRlRGF0YShvcHRzOiBSZW5kZXJJblNlc3Npb25PcHRpb25zPE1hbmlwdWxhdGVEYXRhT3B0aW9ucz4pOiB2b2lkIHtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJlci5tYW5pcHVsYXRlX2RhdGEoXG4gICAgICAob3B0cy5yZW5kZXJTZXNzaW9uIGFzIGFueSlba09iamVjdF0gYXMgdHlwc3QuUmVuZGVyU2Vzc2lvbixcbiAgICAgIG9wdHMuYWN0aW9uID8/ICdyZXNldCcsXG4gICAgICBvcHRzLmRhdGEsXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgd2l0aGluT3B0aW9uU2Vzc2lvbjxUPihcbiAgICBvcHRpb25zOiBSZW5kZXJPcHRpb25zPGFueT4sXG4gICAgZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+LFxuICApOiBQcm9taXNlPFQ+IHtcbiAgICBmdW5jdGlvbiBpc1JlbmRlckJ5Q29udGVudE9wdGlvbihvcHRpb25zOiBSZW5kZXJPcHRpb25zPGFueT4pOiBvcHRpb25zIGlzIENyZWF0ZVNlc3Npb25PcHRpb25zIHtcbiAgICAgIHJldHVybiAnYXJ0aWZhY3RDb250ZW50JyBpbiBvcHRpb25zO1xuICAgIH1cblxuICAgIGlmICgncmVuZGVyU2Vzc2lvbicgaW4gb3B0aW9ucykge1xuICAgICAgcmV0dXJuIGZuKG9wdGlvbnMucmVuZGVyU2Vzc2lvbiBhcyBSZW5kZXJTZXNzaW9uKTtcbiAgICB9XG5cbiAgICBpZiAoaXNSZW5kZXJCeUNvbnRlbnRPcHRpb24ob3B0aW9ucykpIHtcbiAgICAgIC8vIHRvZG86IHJlbW92ZSBhbnlcbiAgICAgIHJldHVybiB0aGlzLnJ1bldpdGhTZXNzaW9uKG9wdGlvbnMgYXMgYW55LCBmbiBhcyBhbnkpO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICdJbnZhbGlkIHJlbmRlciBvcHRpb25zLCBzaG91bGQgYmUgb25lIG9mIFJlbmRlckJ5Q29udGVudE9wdGlvbnN8UmVuZGVyQnlTZXNzaW9uT3B0aW9ucycsXG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIHJ1bldpdGhTZXNzaW9uPFQ+KGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPik6IFByb21pc2U8VD47XG4gIHJ1bldpdGhTZXNzaW9uPFQ+KFxuICAgIG9wdGlvbnM6IENyZWF0ZVNlc3Npb25PcHRpb25zLFxuICAgIGZuOiAoc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gUHJvbWlzZTxUPixcbiAgKTogUHJvbWlzZTxUPjtcbiAgYXN5bmMgcnVuV2l0aFNlc3Npb248VD4oYXJnMTogYW55LCBhcmcyPzogYW55KTogUHJvbWlzZTxUPiB7XG4gICAgbGV0IG9wdGlvbnM6IFBhcnRpYWw8Q3JlYXRlU2Vzc2lvbk9wdGlvbnM+IHwgdW5kZWZpbmVkID0gYXJnMTtcbiAgICBsZXQgZm46IChzZXNzaW9uOiBSZW5kZXJTZXNzaW9uKSA9PiBQcm9taXNlPFQ+ID0gYXJnMjtcblxuICAgIGlmICghYXJnMikge1xuICAgICAgb3B0aW9ucyA9IHVuZGVmaW5lZDtcbiAgICAgIGZuID0gYXJnMTtcbiAgICB9XG5cbiAgICBjb25zdCBzZXNzaW9uID0gdGhpcy5yZW5kZXJlci5jcmVhdGVfc2Vzc2lvbihcbiAgICAgIC8qIG1vdmVkICovIG9wdGlvbnMgJiYgdGhpcy5jcmVhdGVPcHRpb25zVG9SdXN0KG9wdGlvbnMpLFxuICAgICk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZuKG5ldyBSZW5kZXJTZXNzaW9uKHRoaXMsIHNlc3Npb24pKTtcbiAgICAgIHNlc3Npb24uZnJlZSgpO1xuICAgICAgcmV0dXJuIHJlcztcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBzZXNzaW9uLmZyZWUoKTtcbiAgICAgIHRocm93IGU7XG4gICAgfVxuICB9XG59XG4iXX0=","export class MemoryAccessModel {\n    mTimes = new Map();\n    mData = new Map();\n    constructor() { }\n    reset() {\n        this.mTimes.clear();\n        this.mData.clear();\n    }\n    insertFile(path, data, mtime) {\n        this.mTimes.set(path, mtime);\n        this.mData.set(path, data);\n    }\n    removeFile(path) {\n        this.mTimes.delete(path);\n        this.mData.delete(path);\n    }\n    getMTime(path) {\n        if (!path.startsWith('/@memory/')) {\n            return undefined;\n        }\n        if (this.mTimes.has(path)) {\n            return this.mTimes.get(path);\n        }\n        return undefined;\n    }\n    isFile() {\n        return true;\n    }\n    getRealPath(path) {\n        return path;\n    }\n    readAll(path) {\n        if (!path.startsWith('/@memory/')) {\n            return undefined;\n        }\n        if (this.mData.has(path)) {\n            return this.mData.get(path);\n        }\n        return undefined;\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVtb3J5Lm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9mcy9tZW1vcnkubXRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE1BQU0sT0FBTyxpQkFBaUI7SUFDNUIsTUFBTSxHQUFrQyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQ2xELEtBQUssR0FBd0MsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUN2RCxnQkFBZSxDQUFDO0lBRWhCLEtBQUs7UUFDSCxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQ3BCLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDckIsQ0FBQztJQUVELFVBQVUsQ0FBQyxJQUFZLEVBQUUsSUFBZ0IsRUFBRSxLQUFXO1FBQ3BELElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUVELFVBQVUsQ0FBQyxJQUFZO1FBQ3JCLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3pCLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzFCLENBQUM7SUFFRCxRQUFRLENBQUMsSUFBWTtRQUNuQixJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1lBQ2xDLE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUM7UUFFRCxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDMUIsT0FBTyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMvQixDQUFDO1FBQ0QsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztJQUVELE1BQU07UUFDSixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxXQUFXLENBQUMsSUFBWTtRQUN0QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxPQUFPLENBQUMsSUFBWTtRQUNsQixJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDO1lBQ2xDLE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUM7UUFFRCxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDekIsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUM5QixDQUFDO1FBRUQsT0FBTyxTQUFTLENBQUM7SUFDbkIsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRnNBY2Nlc3NNb2RlbCB9IGZyb20gJy4uL2ludGVybmFsLnR5cGVzLm1qcyc7XG5pbXBvcnQgeyBXcml0YWJsZUFjY2Vzc01vZGVsIH0gZnJvbSAnLi9pbmRleC5tanMnO1xuXG5leHBvcnQgY2xhc3MgTWVtb3J5QWNjZXNzTW9kZWwgaW1wbGVtZW50cyBGc0FjY2Vzc01vZGVsLCBXcml0YWJsZUFjY2Vzc01vZGVsIHtcbiAgbVRpbWVzOiBNYXA8c3RyaW5nLCBEYXRlIHwgdW5kZWZpbmVkPiA9IG5ldyBNYXAoKTtcbiAgbURhdGE6IE1hcDxzdHJpbmcsIFVpbnQ4QXJyYXkgfCB1bmRlZmluZWQ+ID0gbmV3IE1hcCgpO1xuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5tVGltZXMuY2xlYXIoKTtcbiAgICB0aGlzLm1EYXRhLmNsZWFyKCk7XG4gIH1cblxuICBpbnNlcnRGaWxlKHBhdGg6IHN0cmluZywgZGF0YTogVWludDhBcnJheSwgbXRpbWU6IERhdGUpIHtcbiAgICB0aGlzLm1UaW1lcy5zZXQocGF0aCwgbXRpbWUpO1xuICAgIHRoaXMubURhdGEuc2V0KHBhdGgsIGRhdGEpO1xuICB9XG5cbiAgcmVtb3ZlRmlsZShwYXRoOiBzdHJpbmcpIHtcbiAgICB0aGlzLm1UaW1lcy5kZWxldGUocGF0aCk7XG4gICAgdGhpcy5tRGF0YS5kZWxldGUocGF0aCk7XG4gIH1cblxuICBnZXRNVGltZShwYXRoOiBzdHJpbmcpOiBEYXRlIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAoIXBhdGguc3RhcnRzV2l0aCgnL0BtZW1vcnkvJykpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubVRpbWVzLmhhcyhwYXRoKSkge1xuICAgICAgcmV0dXJuIHRoaXMubVRpbWVzLmdldChwYXRoKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuXG4gIGlzRmlsZSgpOiBib29sZWFuIHwgdW5kZWZpbmVkIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGdldFJlYWxQYXRoKHBhdGg6IHN0cmluZyk6IHN0cmluZyB8IHVuZGVmaW5lZCB7XG4gICAgcmV0dXJuIHBhdGg7XG4gIH1cblxuICByZWFkQWxsKHBhdGg6IHN0cmluZyk6IFVpbnQ4QXJyYXkgfCB1bmRlZmluZWQge1xuICAgIGlmICghcGF0aC5zdGFydHNXaXRoKCcvQG1lbW9yeS8nKSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5tRGF0YS5oYXMocGF0aCkpIHtcbiAgICAgIHJldHVybiB0aGlzLm1EYXRhLmdldChwYXRoKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG59XG4iXX0=","export class FetchPackageRegistry {\n    am;\n    cache = new Map();\n    constructor(\n    /**\n     * @internal\n     * Access model for internal use only\n     */\n    am) {\n        this.am = am;\n    }\n    resolvePath(path) {\n        return `https://packages.typst.org/preview/${path.name}-${path.version}.tar.gz`;\n    }\n    pullPackageData(path) {\n        const request = new XMLHttpRequest();\n        request.overrideMimeType('text/plain; charset=x-user-defined');\n        request.open('GET', this.resolvePath(path), false);\n        request.send(null);\n        if (request.status === 200 &&\n            (request.response instanceof String || typeof request.response === 'string')) {\n            return Uint8Array.from(request.response, (c) => c.charCodeAt(0));\n        }\n        return undefined;\n    }\n    resolve(spec, context) {\n        if (spec.namespace !== 'preview') {\n            return undefined;\n        }\n        /// Check cache\n        const path = this.resolvePath(spec);\n        if (this.cache.has(path)) {\n            return this.cache.get(path)();\n        }\n        /// Fetch data\n        const data = this.pullPackageData(spec);\n        if (!data) {\n            return undefined;\n        }\n        /// Extract package bundle to the underlying access model `this.am`\n        const previewDir = `/@memory/fetch/packages/${spec.namespace}/${spec.name}/${spec.version}`;\n        const entries = [];\n        context.untar(data, (path, data, mtime) => {\n            entries.push([previewDir + '/' + path, data, new Date(mtime)]);\n        });\n        const cacheClosure = () => {\n            for (const [path, data, mtime] of entries) {\n                this.am.insertFile(path, data, mtime);\n            }\n            /// Return the resolved directory to the package\n            /// It is then used to access the package data by the access model `this.am`\n            return previewDir;\n        };\n        this.cache.set(path, cacheClosure);\n        /// Trigger write out\n        return cacheClosure();\n    }\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFja2FnZS5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZnMvcGFja2FnZS5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsTUFBTSxPQUFPLG9CQUFvQjtJQU9uQjtJQU5aLEtBQUssR0FBMEMsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUN6RDtJQUNFOzs7T0FHRztJQUNPLEVBQXVCO1FBQXZCLE9BQUUsR0FBRixFQUFFLENBQXFCO0lBQ2hDLENBQUM7SUFFSixXQUFXLENBQUMsSUFBaUI7UUFDM0IsT0FBTyxzQ0FBc0MsSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsT0FBTyxTQUFTLENBQUM7SUFDbEYsQ0FBQztJQUVELGVBQWUsQ0FBQyxJQUFpQjtRQUMvQixNQUFNLE9BQU8sR0FBRyxJQUFJLGNBQWMsRUFBRSxDQUFDO1FBQ3JDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDO1FBQy9ELE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbkQsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVuQixJQUNFLE9BQU8sQ0FBQyxNQUFNLEtBQUssR0FBRztZQUN0QixDQUFDLE9BQU8sQ0FBQyxRQUFRLFlBQVksTUFBTSxJQUFJLE9BQU8sT0FBTyxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUMsRUFDNUUsQ0FBQztZQUNELE9BQU8sVUFBVSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBUyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0UsQ0FBQztRQUNELE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRCxPQUFPLENBQUMsSUFBaUIsRUFBRSxPQUE4QjtRQUN2RCxJQUFJLElBQUksQ0FBQyxTQUFTLEtBQUssU0FBUyxFQUFFLENBQUM7WUFDakMsT0FBTyxTQUFTLENBQUM7UUFDbkIsQ0FBQztRQUVELGVBQWU7UUFDZixNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BDLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUN6QixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBRSxFQUFFLENBQUM7UUFDakMsQ0FBQztRQUVELGNBQWM7UUFDZCxNQUFNLElBQUksR0FBRyxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUNWLE9BQU8sU0FBUyxDQUFDO1FBQ25CLENBQUM7UUFFRCxtRUFBbUU7UUFDbkUsTUFBTSxVQUFVLEdBQUcsMkJBQTJCLElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLElBQUksSUFBSSxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDNUYsTUFBTSxPQUFPLEdBQWlDLEVBQUUsQ0FBQztRQUNqRCxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxDQUFDLElBQVksRUFBRSxJQUFnQixFQUFFLEtBQWEsRUFBRSxFQUFFO1lBQ3BFLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLEdBQUcsR0FBRyxHQUFHLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ2pFLENBQUMsQ0FBQyxDQUFDO1FBQ0gsTUFBTSxZQUFZLEdBQUcsR0FBRyxFQUFFO1lBQ3hCLEtBQUssTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUksT0FBTyxFQUFFLENBQUM7Z0JBQzFDLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDeEMsQ0FBQztZQUVELGdEQUFnRDtZQUNoRCw0RUFBNEU7WUFDNUUsT0FBTyxVQUFVLENBQUM7UUFDcEIsQ0FBQyxDQUFDO1FBQ0YsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLFlBQVksQ0FBQyxDQUFDO1FBRW5DLHFCQUFxQjtRQUNyQixPQUFPLFlBQVksRUFBRSxDQUFDO0lBQ3hCLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFBhY2thZ2VSZWdpc3RyeSwgUGFja2FnZVJlc29sdmVDb250ZXh0LCBQYWNrYWdlU3BlYyB9IGZyb20gJy4uL2ludGVybmFsLnR5cGVzLm1qcyc7XG5pbXBvcnQgeyBXcml0YWJsZUFjY2Vzc01vZGVsIH0gZnJvbSAnLi9pbmRleC5tanMnO1xuXG5leHBvcnQgY2xhc3MgRmV0Y2hQYWNrYWdlUmVnaXN0cnkgaW1wbGVtZW50cyBQYWNrYWdlUmVnaXN0cnkge1xuICBjYWNoZTogTWFwPHN0cmluZywgKCkgPT4gc3RyaW5nIHwgdW5kZWZpbmVkPiA9IG5ldyBNYXAoKTtcbiAgY29uc3RydWN0b3IoXG4gICAgLyoqIFxuICAgICAqIEBpbnRlcm5hbCBcbiAgICAgKiBBY2Nlc3MgbW9kZWwgZm9yIGludGVybmFsIHVzZSBvbmx5XG4gICAgICovXG4gICAgcHJvdGVjdGVkIGFtOiBXcml0YWJsZUFjY2Vzc01vZGVsXG4gICkge31cblxuICByZXNvbHZlUGF0aChwYXRoOiBQYWNrYWdlU3BlYyk6IHN0cmluZyB7XG4gICAgcmV0dXJuIGBodHRwczovL3BhY2thZ2VzLnR5cHN0Lm9yZy9wcmV2aWV3LyR7cGF0aC5uYW1lfS0ke3BhdGgudmVyc2lvbn0udGFyLmd6YDtcbiAgfVxuXG4gIHB1bGxQYWNrYWdlRGF0YShwYXRoOiBQYWNrYWdlU3BlYyk6IFVpbnQ4QXJyYXkgfCB1bmRlZmluZWQge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICByZXF1ZXN0Lm92ZXJyaWRlTWltZVR5cGUoJ3RleHQvcGxhaW47IGNoYXJzZXQ9eC11c2VyLWRlZmluZWQnKTtcbiAgICByZXF1ZXN0Lm9wZW4oJ0dFVCcsIHRoaXMucmVzb2x2ZVBhdGgocGF0aCksIGZhbHNlKTtcbiAgICByZXF1ZXN0LnNlbmQobnVsbCk7XG5cbiAgICBpZiAoXG4gICAgICByZXF1ZXN0LnN0YXR1cyA9PT0gMjAwICYmXG4gICAgICAocmVxdWVzdC5yZXNwb25zZSBpbnN0YW5jZW9mIFN0cmluZyB8fCB0eXBlb2YgcmVxdWVzdC5yZXNwb25zZSA9PT0gJ3N0cmluZycpXG4gICAgKSB7XG4gICAgICByZXR1cm4gVWludDhBcnJheS5mcm9tKHJlcXVlc3QucmVzcG9uc2UsIChjOiBzdHJpbmcpID0+IGMuY2hhckNvZGVBdCgwKSk7XG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICByZXNvbHZlKHNwZWM6IFBhY2thZ2VTcGVjLCBjb250ZXh0OiBQYWNrYWdlUmVzb2x2ZUNvbnRleHQpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIGlmIChzcGVjLm5hbWVzcGFjZSAhPT0gJ3ByZXZpZXcnKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vLyBDaGVjayBjYWNoZVxuICAgIGNvbnN0IHBhdGggPSB0aGlzLnJlc29sdmVQYXRoKHNwZWMpO1xuICAgIGlmICh0aGlzLmNhY2hlLmhhcyhwYXRoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuY2FjaGUuZ2V0KHBhdGgpISgpO1xuICAgIH1cblxuICAgIC8vLyBGZXRjaCBkYXRhXG4gICAgY29uc3QgZGF0YSA9IHRoaXMucHVsbFBhY2thZ2VEYXRhKHNwZWMpO1xuICAgIGlmICghZGF0YSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICAvLy8gRXh0cmFjdCBwYWNrYWdlIGJ1bmRsZSB0byB0aGUgdW5kZXJseWluZyBhY2Nlc3MgbW9kZWwgYHRoaXMuYW1gXG4gICAgY29uc3QgcHJldmlld0RpciA9IGAvQG1lbW9yeS9mZXRjaC9wYWNrYWdlcy8ke3NwZWMubmFtZXNwYWNlfS8ke3NwZWMubmFtZX0vJHtzcGVjLnZlcnNpb259YDtcbiAgICBjb25zdCBlbnRyaWVzOiBbc3RyaW5nLCBVaW50OEFycmF5LCBEYXRlXVtdID0gW107XG4gICAgY29udGV4dC51bnRhcihkYXRhLCAocGF0aDogc3RyaW5nLCBkYXRhOiBVaW50OEFycmF5LCBtdGltZTogbnVtYmVyKSA9PiB7XG4gICAgICBlbnRyaWVzLnB1c2goW3ByZXZpZXdEaXIgKyAnLycgKyBwYXRoLCBkYXRhLCBuZXcgRGF0ZShtdGltZSldKTtcbiAgICB9KTtcbiAgICBjb25zdCBjYWNoZUNsb3N1cmUgPSAoKSA9PiB7XG4gICAgICBmb3IgKGNvbnN0IFtwYXRoLCBkYXRhLCBtdGltZV0gb2YgZW50cmllcykge1xuICAgICAgICB0aGlzLmFtLmluc2VydEZpbGUocGF0aCwgZGF0YSwgbXRpbWUpO1xuICAgICAgfVxuXG4gICAgICAvLy8gUmV0dXJuIHRoZSByZXNvbHZlZCBkaXJlY3RvcnkgdG8gdGhlIHBhY2thZ2VcbiAgICAgIC8vLyBJdCBpcyB0aGVuIHVzZWQgdG8gYWNjZXNzIHRoZSBwYWNrYWdlIGRhdGEgYnkgdGhlIGFjY2VzcyBtb2RlbCBgdGhpcy5hbWBcbiAgICAgIHJldHVybiBwcmV2aWV3RGlyO1xuICAgIH07XG4gICAgdGhpcy5jYWNoZS5zZXQocGF0aCwgY2FjaGVDbG9zdXJlKTtcblxuICAgIC8vLyBUcmlnZ2VyIHdyaXRlIG91dFxuICAgIHJldHVybiBjYWNoZUNsb3N1cmUoKTtcbiAgfVxufVxuIl19","/** @internal */\nexport function randstr(prefix) {\n    return Math.random()\n        .toString(36)\n        .replace('0.', prefix || '');\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMubWpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL3V0aWxzLm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxnQkFBZ0I7QUFDaEIsTUFBTSxVQUFVLE9BQU8sQ0FBQyxNQUFlO0lBQ3JDLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRTtTQUNqQixRQUFRLENBQUMsRUFBRSxDQUFDO1NBQ1osT0FBTyxDQUFDLElBQUksRUFBRSxNQUFNLElBQUksRUFBRSxDQUFDLENBQUM7QUFDakMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBAaW50ZXJuYWwgKi9cbmV4cG9ydCBmdW5jdGlvbiByYW5kc3RyKHByZWZpeD86IHN0cmluZyk6IHN0cmluZyB7XG4gIHJldHVybiBNYXRoLnJhbmRvbSgpXG4gICAgLnRvU3RyaW5nKDM2KVxuICAgIC5yZXBsYWNlKCcwLicsIHByZWZpeCB8fCAnJyk7XG59XG4iXX0=","import { withPackageRegistry, withAccessModel, preloadFontAssets, disableDefaultFontAssets, loadFonts, } from '../options.init.mjs';\nimport { loadFontSync } from '../init.mjs';\nimport { MemoryAccessModel } from '../fs/index.mjs';\nimport { FetchPackageRegistry } from '../fs/package.mjs';\nimport { randstr } from '../utils.mjs';\nimport { CompileFormatEnum } from '../compiler.mjs';\nconst isNode = \n// @ts-ignore\ntypeof process !== 'undefined' && process.versions != null && process.versions.node != null;\n/**\n * Convenient util class for compiling documents, which is a wrapper of the\n * {@link TypstCompiler} and {@link TypstRenderer}.\n *\n * Note: the interface of this class is less stable than {@link TypstCompiler}\n * and {@link TypstRenderer}.\n *\n * @example\n * Use the *global shared* compiler instance:\n *\n * ```typescript\n * import { $typst } from '@myriaddreamin/typst.ts';\n * ```\n *\n * Note: if you want to compile multiple documents, you should create a new\n * instance for each compilation work or maintain the shared state on the\n * utility instance `$typst` carefully, because the compilation process will\n * change the state of that.\n *\n * @example\n * Create an instance of utility:\n *\n * ```typescript\n * const $typst = new TypstSnippet({\n *   // optional renderer instance\n *   renderer: enableRendering ?? (() => {\n *     return createGlobalRenderer(createTypstRenderer,\n *       undefined, initOptions);\n *   }),\n *   compiler() => {\n *     return createGlobalCompiler(createTypstCompiler,\n *       initOptions);\n *   }\n * });\n * ```\n */\nexport class TypstSnippet {\n    /** @internal */\n    mainFilePath;\n    /** @internal */\n    cc;\n    /** @internal */\n    fr;\n    /** @internal */\n    ex;\n    /**\n     * Create a new instance of {@link TypstSnippet}.\n     * @param cc the compiler instance, see {@link PromiseJust} and {@link TypstCompiler}.\n     * @param ex the renderer instance, see {@link PromiseJust} and {@link TypstRenderer}.\n     *\n     * @example\n     *\n     * Passes a global shared compiler instance that get initialized lazily:\n     * ```typescript\n     * const $typst = new TypstSnippet(() => {\n     *  return createGlobalCompiler(createTypstCompiler, initOptions);\n     * });\n     *\n     */\n    constructor(options) {\n        this.cc = options?.compiler || TypstSnippet.buildLocalCompiler;\n        this.fr = options?.fontResolver || TypstSnippet.buildLocalFontResolver;\n        this.ex = options?.renderer || TypstSnippet.buildLocalRenderer;\n        this.mainFilePath = '/main.typ';\n        this.providers = [];\n    }\n    /**\n     * Set lazy initialized compiler instance for the utility instance.\n     * @param cc the compiler instance, see {@link PromiseJust} and {@link TypstCompiler}.\n     */\n    setCompiler(cc) {\n        this.cc = cc;\n    }\n    async getFontResolver() {\n        return (typeof this.fr === 'function' ? (this.fr = await this.fr()) : this.fr);\n    }\n    /**\n     * Get an initialized compiler instance from the utility instance.\n     */\n    async getCompiler() {\n        return (typeof this.cc === 'function' ? (this.cc = await this.cc()) : this.cc);\n    }\n    async getCompilerReset() {\n        const compiler = await this.getCompiler();\n        await compiler.reset();\n        return compiler;\n    }\n    /**\n     * Set lazy initialized renderer instance for the utility instance.\n     * @param ex the renderer instance, see {@link PromiseJust} and {@link TypstRenderer}.\n     */\n    setRenderer(ex) {\n        this.ex = ex;\n    }\n    /**\n     * Get an initialized renderer instance from the utility instance.\n     */\n    async getRenderer() {\n        return typeof this.ex === 'function' ? (this.ex = await this.ex()) : this.ex;\n    }\n    providers;\n    /**\n     * add providers for bullding the compiler or renderer component.\n     */\n    use(...providers) {\n        if (!this.providers) {\n            throw new Error('already prepare uses for instances');\n        }\n        this.providers.push(...providers);\n    }\n    /**\n     * todo: add docs\n     */\n    static preloadFontFromUrl(fontUrl) {\n        return TypstSnippet.preloadFonts([fontUrl]);\n    }\n    /**\n     * todo: add docs\n     */\n    static preloadFontData(fontData) {\n        return TypstSnippet.preloadFonts([fontData]);\n    }\n    /**\n     * todo: add docs\n     */\n    static preloadFonts(userFonts) {\n        return {\n            key: 'access-model',\n            forRoles: ['compiler'],\n            provides: [loadFonts(userFonts)],\n        };\n    }\n    /**\n     * don't load any default font assets.\n     * todo: add docs\n     */\n    static disableDefaultFontAssets() {\n        return {\n            key: 'access-model',\n            forRoles: ['compiler'],\n            provides: [disableDefaultFontAssets()],\n        };\n    }\n    /**\n     * todo: add docs\n     */\n    static preloadFontAssets(options) {\n        return {\n            key: 'access-model',\n            forRoles: ['compiler'],\n            provides: [preloadFontAssets(options)],\n        };\n    }\n    /**\n     * Set accessl model for the compiler instance\n     * @example\n     *\n     * use memory access model\n     *\n     * ```typescript\n     * const m = new MemoryAccessModel();\n     * $typst.use(TypstSnippet.withAccessModel(m));\n     * ```\n     */\n    static withAccessModel(accessModel) {\n        return {\n            key: 'access-model',\n            forRoles: ['compiler'],\n            provides: [withAccessModel(accessModel)],\n        };\n    }\n    /**\n     * Set package registry for the compiler instance\n     * @example\n     *\n     * use a customized package registry\n     *\n     * ```typescript\n     * const n = new NodeFetchPackageRegistry();\n     * $typst.use(TypstSnippet.withPackageRegistry(n));\n     * ```\n     */\n    static withPackageRegistry(registry) {\n        return {\n            key: 'package-registry',\n            forRoles: ['compiler'],\n            provides: [withPackageRegistry(registry)],\n        };\n    }\n    /**\n     * Retrieve an access model to store the data of fetched files.\n     * Provide a PackageRegistry instance for the compiler instance.\n     *\n     * @example\n     *\n     * use default (memory) access model\n     *\n     * ```typescript\n     * $typst.use(await TypstSnippet.fetchPackageRegistry());\n     * ```\n     *\n     * @example\n     *\n     * use external access model\n     *\n     * ```typescript\n     * const m = new MemoryAccessModel();\n     * $typst.use(TypstSnippet.withAccessModel(m), await TypstSnippet.fetchPackageRegistry(m));\n     * ```\n     */\n    static fetchPackageRegistry(accessModel) {\n        const m = accessModel || new MemoryAccessModel();\n        const provides = [\n            ...(accessModel ? [] : [withAccessModel(m)]),\n            withPackageRegistry(new FetchPackageRegistry(m)),\n        ];\n        return {\n            key: 'package-registry$fetch',\n            forRoles: ['compiler'],\n            provides,\n        };\n    }\n    /**\n     * Retrieve a fetcher for fetching package data.\n     * Provide a PackageRegistry instance for the compiler instance.\n     * @example\n     *\n     * use a customized fetcher\n     *\n     * ```typescript\n     * import request from 'sync-request-curl';\n     * const m = new MemoryAccessModel();\n     * $typst.use(TypstSnippet.withAccessModel(m), await TypstSnippet.fetchPackageBy(m, (_, httpUrl) => {\n     *   const response = request('GET', this.resolvePath(path), {\n     *     insecure: true,\n     *   });\n     *\n     *   if (response.statusCode === 200) {\n     *     return response.getBody(undefined);\n     *   }\n     *   return undefined;\n     * }));\n     * ```\n     */\n    static fetchPackageBy(accessModel, fetcher) {\n        class HttpPackageRegistry extends FetchPackageRegistry {\n            pullPackageData(path) {\n                return fetcher(path, this.resolvePath(path));\n            }\n        }\n        return {\n            key: 'package-registry$lambda',\n            forRoles: ['compiler'],\n            provides: [withPackageRegistry(new HttpPackageRegistry(accessModel))],\n        };\n    }\n    /** @internal */\n    ccOptions;\n    /**\n     * Set compiler init options for initializing global instance {@link $typst}.\n     * See {@link InitOptions}.\n     */\n    setCompilerInitOptions(options) {\n        this.requireIsUninitialized('compiler', this.cc);\n        this.ccOptions = options;\n    }\n    /** @internal */\n    exOptions;\n    /**\n     * Set renderer init options for initializing global instance {@link $typst}.\n     * See {@link InitOptions}.\n     */\n    setRendererInitOptions(options) {\n        this.requireIsUninitialized('renderer', this.ex);\n        this.exOptions = options;\n    }\n    /**\n     * Set shared main file path.\n     */\n    setMainFilePath(path) {\n        this.mainFilePath = path;\n    }\n    /**\n     * Get shared main file path.\n     */\n    getMainFilePath() {\n        return this.mainFilePath;\n    }\n    removeTmp(opts) {\n        if (opts.mainFilePath.startsWith('/tmp/')) {\n            return this.unmapShadow(opts.mainFilePath);\n        }\n        return Promise.resolve();\n    }\n    /**\n     * Adds a font to the compiler.\n     *\n     * @example\n     *\n     * ```typescript\n     * const fonts = await fetch('fontInfo.json').then(res => res.json());\n     * $typst.addFonts(fonts.map(font => $typst.loadFont(font.url)));\n     * ```\n     *\n     * @param fontInfos the font infos to add.\n     */\n    async setFonts(fontInfos) {\n        const fb = await this.getFontResolver();\n        for (const font of fontInfos) {\n            await fb.addLazyFont(font, 'blob' in font ? font.blob : loadFontSync(font), font);\n        }\n        const compiler = await this.getCompiler();\n        await fb.build(async (fonts) => compiler.setFonts(fonts));\n    }\n    /**\n     * Add a source file to the compiler.\n     * See {@link TypstCompiler#addSource}.\n     */\n    async addSource(path, content) {\n        (await this.getCompiler()).addSource(path, content);\n    }\n    /**\n     * Reset the shadow files.\n     * Note: this function is independent to the {@link reset} function.\n     * See {@link TypstCompiler#resetShadow}.\n     */\n    async resetShadow() {\n        (await this.getCompiler()).resetShadow();\n    }\n    /**\n     * Add a shadow file to the compiler.\n     * See {@link TypstCompiler#mapShadow}.\n     */\n    async mapShadow(path, content) {\n        (await this.getCompiler()).mapShadow(path, content);\n    }\n    /**\n     * Remove a shadow file from the compiler.\n     * See {@link TypstCompiler#unmapShadow}.\n     */\n    async unmapShadow(path) {\n        (await this.getCompiler()).unmapShadow(path);\n    }\n    /**\n     * Compile the document to vector (IR) format.\n     * See {@link SweetCompileOptions}.\n     */\n    async vector(o) {\n        const opts = await this.getCompileOptions(o);\n        const compiler = await this.getCompilerReset();\n        return compiler\n            .compile(opts)\n            .then(res => res.result)\n            .finally(() => this.removeTmp(opts));\n    }\n    /**\n     * Compile the document to PDF format.\n     * See {@link SweetCompileOptions}.\n     */\n    async pdf(o) {\n        const opts = await this.getCompileOptions(o);\n        opts.format = CompileFormatEnum.pdf;\n        const compiler = await this.getCompilerReset();\n        return compiler\n            .compile(opts)\n            .then(res => res.result)\n            .finally(() => this.removeTmp(opts));\n    }\n    /**\n     * Compile the document to SVG format.\n     * See {@link SweetRenderOptions} and {@link RenderSvgOptions}.\n     */\n    async svg(o) {\n        return this.transientRender(o, (renderer, renderSession) => renderer.renderSvg({\n            ...o,\n            renderSession,\n        }));\n    }\n    /**\n     * Compile the document to canvas operations.\n     * See {@link SweetRenderOptions} and {@link RenderToCanvasOptions}.\n     */\n    async canvas(container, o) {\n        return this.transientRender(o, (renderer, renderSession) => renderer.renderToCanvas({\n            container,\n            ...o,\n            renderSession,\n        }));\n    }\n    /**\n     * Get semantic tokens for the document.\n     */\n    async query(o) {\n        const opts = await this.getCompileOptions(o);\n        const compiler = await this.getCompilerReset();\n        return compiler\n            .query({\n            ...o,\n            ...opts,\n        })\n            .finally(() => this.removeTmp(opts));\n    }\n    /**\n     * Get token legend for semantic tokens.\n     */\n    async getSemanticTokenLegend() {\n        const compiler = await this.getCompilerReset();\n        return compiler.getSemanticTokenLegend();\n    }\n    /**\n     * Get semantic tokens for the document.\n     * See {@link SweetCompileOptions}.\n     * See {@link TypstCompiler#getSemanticTokens}.\n     */\n    async getSemanticTokens(o) {\n        const opts = await this.getCompileOptions(o);\n        const compiler = await this.getCompilerReset();\n        return compiler\n            .getSemanticTokens({\n            mainFilePath: opts.mainFilePath,\n            resultId: o.resultId,\n        })\n            .finally(() => this.removeTmp(opts));\n    }\n    async getCompileOptions(opts) {\n        if (opts === undefined) {\n            return { mainFilePath: this.mainFilePath, diagnostics: 'none' };\n        }\n        else if (typeof opts === 'string') {\n            throw new Error(`please specify opts as {mainContent: '...'} or {mainFilePath: '...'}`);\n        }\n        else if ('mainFilePath' in opts) {\n            return { ...opts, diagnostics: 'none' };\n        }\n        else {\n            const destFile = `/tmp/${randstr()}.typ`;\n            await this.addSource(destFile, opts.mainContent);\n            return { mainFilePath: destFile, inputs: opts.inputs, diagnostics: 'none' };\n        }\n    }\n    async getVector(o) {\n        if (o && 'vectorData' in o) {\n            return o.vectorData;\n        }\n        const opts = await this.getCompileOptions(o);\n        return (await this.getCompiler())\n            .compile(opts)\n            .then(res => res.result)\n            .finally(() => this.removeTmp(opts));\n    }\n    async transientRender(opts, f) {\n        const rr = await this.getRenderer();\n        if (!rr) {\n            throw new Error('does not provide renderer instance');\n        }\n        const data = await this.getVector(opts);\n        return await rr.runWithSession(async (session) => {\n            rr.manipulateData({\n                renderSession: session,\n                action: 'reset',\n                data,\n            });\n            return f(rr, session);\n        });\n    }\n    prepareUseOnce = undefined;\n    async prepareUse() {\n        if (this.prepareUseOnce) {\n            return this.prepareUseOnce;\n        }\n        return (this.prepareUseOnce = this.doPrepareUse());\n    }\n    async doPrepareUse() {\n        if (!this.providers) {\n            return;\n        }\n        const providers = await Promise.all(this.providers.map(p => (typeof p === 'function' ? p() : p)));\n        this.providers = [];\n        if ($typst == this &&\n            !providers.some(p => p.key.includes('package-registry') || p.key.includes('access-model'))) {\n            // Note: the default fetch backend always adds a withAccessModel(mem)\n            if (isNode) {\n                const escapeImport = new Function('m', 'return import(m)');\n                try {\n                    const m = new MemoryAccessModel();\n                    const { default: request } = await escapeImport('sync-request');\n                    $typst.use(TypstSnippet.withAccessModel(m), TypstSnippet.fetchPackageBy(m, (_, path) => {\n                        const response = request('GET', path);\n                        if (response.statusCode === 200) {\n                            return response.getBody(undefined);\n                        }\n                        return undefined;\n                    }));\n                }\n                catch (e) { }\n            }\n            else {\n                $typst.use(TypstSnippet.fetchPackageRegistry());\n            }\n        }\n        const providers2 = await Promise.all(this.providers.map(p => (typeof p === 'function' ? p() : p)));\n        const ccOptions = (this.ccOptions ||= {});\n        const ccBeforeBuild = (ccOptions.beforeBuild ||= []);\n        const exOptions = (this.exOptions ||= {});\n        const exBeforeBuild = (exOptions.beforeBuild ||= []);\n        for (const provider of [...providers, ...providers2]) {\n            if (provider.forRoles.includes('compiler')) {\n                this.requireIsUninitialized('compiler', this.cc);\n                ccBeforeBuild.push(...provider.provides);\n            }\n            if (provider.forRoles.includes('renderer')) {\n                this.requireIsUninitialized('renderer', this.ex);\n                exBeforeBuild.push(...provider.provides);\n            }\n        }\n        this.providers = undefined;\n    }\n    requireIsUninitialized(role, c, e) {\n        if (c && typeof c !== 'function') {\n            throw new Error(`${role} has been initialized: ${c}`);\n        }\n    }\n    /** @internal */\n    static async buildLocalCompiler() {\n        const { createTypstCompiler } = (await import(\n        // @ts-ignore\n        '@myriaddreamin/typst.ts/compiler'));\n        await this.prepareUse();\n        const compiler = createTypstCompiler();\n        await compiler.init(this.ccOptions);\n        return compiler;\n    }\n    /** @internal */\n    static async buildLocalFontResolver() {\n        const { createTypstFontBuilder } = (await import(\n        // @ts-ignore\n        '@myriaddreamin/typst.ts/compiler'));\n        await this.prepareUse();\n        const fonts = createTypstFontBuilder();\n        await fonts.init(this.ccOptions);\n        return fonts;\n    }\n    /** @internal */\n    static async buildGlobalCompiler() {\n        // lazy import compile module\n        const { createGlobalCompiler } = (await import(\n        // @ts-ignore\n        '@myriaddreamin/typst.ts/contrib/global-compiler'));\n        const { createTypstCompiler } = (await import(\n        // @ts-ignore\n        '@myriaddreamin/typst.ts/compiler'));\n        await this.prepareUse();\n        return createGlobalCompiler(createTypstCompiler, this.ccOptions);\n    }\n    /** @internal */\n    static async buildLocalRenderer() {\n        const { createTypstRenderer } = (await import(\n        // @ts-ignore\n        '@myriaddreamin/typst.ts/renderer'));\n        await this.prepareUse();\n        const renderer = createTypstRenderer();\n        await renderer.init(this.exOptions);\n        return renderer;\n    }\n    /** @internal */\n    static async buildGlobalRenderer() {\n        // lazy import renderer module\n        const { createGlobalRenderer } = (await import(\n        // @ts-ignore\n        '@myriaddreamin/typst.ts/contrib/global-renderer'));\n        const { createTypstRenderer } = (await import(\n        // @ts-ignore\n        '@myriaddreamin/typst.ts/renderer'));\n        await this.prepareUse();\n        return createGlobalRenderer(createTypstRenderer, this.exOptions);\n    }\n}\n/**\n * The lazy initialized global shared instance of {@link TypstSnippet}. See\n * {@link TypstSnippet} for more details.\n */\nexport const $typst = new TypstSnippet({\n    compiler: TypstSnippet.buildGlobalCompiler,\n    renderer: TypstSnippet.buildGlobalRenderer,\n});\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic25pcHBldC5tanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29udHJpYi9zbmlwcGV0Lm10cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQ0wsbUJBQW1CLEVBQ25CLGVBQWUsRUFHZixpQkFBaUIsRUFDakIsd0JBQXdCLEVBQ3hCLFNBQVMsR0FFVixNQUFNLHFCQUFxQixDQUFDO0FBQzdCLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFHM0MsT0FBTyxFQUFFLGlCQUFpQixFQUE0QixNQUFNLGlCQUFpQixDQUFDO0FBQzlFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBT3pELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFDdkMsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUJBQWlCLENBQUM7QUE4RXBELE1BQU0sTUFBTTtBQUNWLGFBQWE7QUFDYixPQUFPLE9BQU8sS0FBSyxXQUFXLElBQUksT0FBTyxDQUFDLFFBQVEsSUFBSSxJQUFJLElBQUksT0FBTyxDQUFDLFFBQVEsQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDO0FBRTlGOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztHQW1DRztBQUNILE1BQU0sT0FBTyxZQUFZO0lBQ3ZCLGdCQUFnQjtJQUNSLFlBQVksQ0FBUztJQUM3QixnQkFBZ0I7SUFDUixFQUFFLENBQThCO0lBQ3hDLGdCQUFnQjtJQUNSLEVBQUUsQ0FBaUM7SUFDM0MsZ0JBQWdCO0lBQ1IsRUFBRSxDQUE4QjtJQUV4Qzs7Ozs7Ozs7Ozs7OztPQWFHO0lBQ0gsWUFBWSxPQUlYO1FBQ0MsSUFBSSxDQUFDLEVBQUUsR0FBRyxPQUFPLEVBQUUsUUFBUSxJQUFJLFlBQVksQ0FBQyxrQkFBa0IsQ0FBQztRQUMvRCxJQUFJLENBQUMsRUFBRSxHQUFHLE9BQU8sRUFBRSxZQUFZLElBQUksWUFBWSxDQUFDLHNC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QyxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUN4QixNQUFNLFFBQVEsR0FBRyxtQkFBbUIsRUFBRSxDQUFDO1FBQ3ZDLE1BQU0sUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDcEMsT0FBTyxRQUFRLENBQUM7SUFDbEIsQ0FBQztJQUVELGdCQUFnQjtJQUNoQixNQUFNLENBQUMsS0FBSyxDQUFDLG1CQUFtQjtRQUM5Qiw4QkFBOEI7UUFDOUIsTUFBTSxFQUFFLG9CQUFvQixFQUFFLEdBQUcsQ0FBQyxNQUFNLE1BQU07UUFDNUMsYUFBYTtRQUNiLGlEQUFpRCxDQUNsRCxDQUFrRCxDQUFDO1FBQ3BELE1BQU0sRUFBRSxtQkFBbUIsRUFBRSxHQUFHLENBQUMsTUFBTSxNQUFNO1FBQzNDLGFBQWE7UUFDYixrQ0FBa0MsQ0FDbkMsQ0FBNEMsQ0FBQztRQUU5QyxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUN4QixPQUFPLG9CQUFvQixDQUFDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztJQUNuRSxDQUFDO0NBQ0Y7QUFFRDs7O0dBR0c7QUFDSCxNQUFNLENBQUMsTUFBTSxNQUFNLEdBQUcsSUFBSSxZQUFZLENBQUM7SUFDckMsUUFBUSxFQUFFLFlBQVksQ0FBQyxtQkFBbUI7SUFDMUMsUUFBUSxFQUFFLFlBQVksQ0FBQyxtQkFBbUI7Q0FDM0MsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDb21waWxlT3B0aW9ucywgVHlwc3RDb21waWxlciwgVHlwc3RGb250QnVpbGRlciB9IGZyb20gJy4uL2NvbXBpbGVyLm1qcyc7XG5pbXBvcnQge1xuICB3aXRoUGFja2FnZVJlZ2lzdHJ5LFxuICB3aXRoQWNjZXNzTW9kZWwsXG4gIHR5cGUgQmVmb3JlQnVpbGRGbixcbiAgdHlwZSBJbml0T3B0aW9ucyxcbiAgcHJlbG9hZEZvbnRBc3NldHMsXG4gIGRpc2FibGVEZWZhdWx0Rm9udEFzc2V0cyxcbiAgbG9hZEZvbnRzLFxuICBMb2FkUmVtb3RlQXNzZXRzT3B0aW9ucyxcbn0gZnJvbSAnLi4vb3B0aW9ucy5pbml0Lm1qcyc7XG5pbXBvcnQgeyBsb2FkRm9udFN5bmMgfSBmcm9tICcuLi9pbml0Lm1qcyc7XG5pbXBvcnQgdHlwZSB7IFR5cHN0UmVuZGVyZXIsIFJlbmRlclNlc3Npb24gfSBmcm9tICcuLi9yZW5kZXJlci5tanMnO1xuaW1wb3J0IHR5cGUgeyBSZW5kZXJUb0NhbnZhc09wdGlvbnMsIFJlbmRlclN2Z09wdGlvbnMgfSBmcm9tICcuLi9vcHRpb25zLnJlbmRlci5tanMnO1xuaW1wb3J0IHsgTWVtb3J5QWNjZXNzTW9kZWwsIHR5cGUgV3JpdGFibGVBY2Nlc3NNb2RlbCB9IGZyb20gJy4uL2ZzL2luZGV4Lm1qcyc7XG5pbXBvcnQgeyBGZXRjaFBhY2thZ2VSZWdpc3RyeSB9IGZyb20gJy4uL2ZzL3BhY2thZ2UubWpzJztcbmltcG9ydCB7XG4gIFBhY2thZ2VSZWdpc3RyeSxcbiAgUGFja2FnZVNwZWMsXG4gIFNlbWFudGljVG9rZW5zLFxuICBTZW1hbnRpY1Rva2Vuc0xlZ2VuZCxcbn0gZnJvbSAnLi4vaW50ZXJuYWwudHlwZXMubWpzJztcbmltcG9ydCB7IHJhbmRzdHIgfSBmcm9tICcuLi91dGlscy5tanMnO1xuaW1wb3J0IHsgQ29tcGlsZUZvcm1hdEVudW0gfSBmcm9tICcuLi9jb21waWxlci5tanMnO1xuXG4vKipcbiAqIFNvbWUgZnVuY3Rpb24gdGhhdCByZXR1cm5zIGEgcHJvbWlzZSBvZiB2YWx1ZSBvciBqdXN0IHRoYXQgdmFsdWUuXG4gKi9cbnR5cGUgUHJvbWlzZUp1c3Q8VD4gPSAoKCkgPT4gUHJvbWlzZTxUPikgfCBUO1xuXG5pbnRlcmZhY2UgQ29tcGlsZU9wdGlvbnNDb21tb24ge1xuICAvKipcbiAgICogVGhlIHJvb3Qgb2YgdGhlIG1haW4gZmlsZS5cbiAgICovXG4gIHJvb3Q/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBBZGRzIGEgc3RyaW5nIGtleS12YWx1ZSBwYWlyIHZpc2libGUgdGhyb3VnaCBgc3lzLmlucHV0c2BcbiAgICpcbiAgICogTm90ZTogcGFzcyBge31gIHRvIGNsZWFyIGBzeXMuaW5wdXRzYFxuICAgKlxuICAgKiBOb3RlOiBXaGVuIHBhc3NpbmcgYHVuZGVmaW5lZGAsIGNvbXBpbGVyIHdpbGwgdXNlIGxhc3Qgc2V0IGBzeXMuaW5wdXRzYC5cbiAgICpcbiAgICogTm90ZTogVGhpcyBtZWFucyB5b3Ugc2hvdWxkIGFsd2F5cyBzcGVjaWZ5IGlucHV0cyB3aGVuIHVzaW5nIGNvbXBpbGVyIGZvciBjb25jdXJyZW50IHRhc2tzLlxuICAgKi9cbiAgaW5wdXRzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbn1cblxuLyoqXG4gKiBUaGUgc3dlZXQgb3B0aW9ucyBmb3IgY29tcGlsaW5nIGFuZCByZW5kZXJpbmcgdGhlIGRvY3VtZW50LlxuICovXG5leHBvcnQgdHlwZSBTd2VldENvbXBpbGVPcHRpb25zID0gKFxuICB8IHtcbiAgICAvKipcbiAgICAgKiBUaGUgcGF0aCBvZiB0aGUgbWFpbiBmaWxlLlxuICAgICAqL1xuICAgIG1haW5GaWxlUGF0aDogc3RyaW5nO1xuICB9XG4gIHwge1xuICAgIC8qKlxuICAgICAqIFRoZSBzb3VyY2UgY29udGVudCBvZiB0aGUgbWFpbiBmaWxlLlxuICAgICAqL1xuICAgIG1haW5Db250ZW50OiBzdHJpbmc7XG4gIH1cbikgJlxuICBDb21waWxlT3B0aW9uc0NvbW1vbjtcblxuLyoqXG4gKiBUaGUgc3dlZXQgb3B0aW9ucyBmb3IgY29tcGlsaW5nIGFuZCByZW5kZXJpbmcgdGhlIGRvY3VtZW50LlxuICovXG5leHBvcnQgdHlwZSBTd2VldFJlbmRlck9wdGlvbnMgPVxuICB8IFN3ZWV0Q29tcGlsZU9wdGlvbnNcbiAgfCB7XG4gICAgLyoqXG4gICAgICogVGhlIGFydGlmYWN0IGRhdGEgaW4gdmVjdG9yIGZvcm1hdC5cbiAgICAgKi9cbiAgICB2ZWN0b3JEYXRhOiBVaW50OEFycmF5O1xuICB9O1xuXG5leHBvcnQgdHlwZSBTd2VldExhenlGb250ID0ge1xuICBpbmZvOiBhbnk7XG59ICYgKFxuICAgIHwge1xuICAgICAgYmxvYjogKGluZGV4OiBudW1iZXIpID0+IFVpbnQ4QXJyYXk7XG4gICAgfVxuICAgIHwge1xuICAgICAgdXJsOiBzdHJpbmc7XG4gICAgfVxuICApO1xuXG50eXBlIFJvbGUgPSAnY29tcGlsZXInIHwgJ3JlbmRlcmVyJztcblxuLyoqXG4gKiBUaGUgc3dlZXQgc25pcHBldCBwcm92aWRlciBmb3IgYnVsbGRpbmcgdGhlIGNvbXBpbGVyIG9yIHJlbmRlcmVyIGNvbXBvbmVudC5cbiAqIFNlZSB7QGxpbmsgVHlwc3RTbmlwcGV0I3VzZX0gZm9yIG1vcmUgZGV0YWlscy5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBUeXBzdFNuaXBwZXRQcm92aWRlciB7XG4gIGtleTogc3RyaW5nO1xuICBmb3JSb2xlczogUm9sZVtdO1xuICBwcm92aWRlczogQmVmb3JlQnVpbGRGbltdO1xufVxuXG5jb25zdCBpc05vZGUgPVxuICAvLyBAdHMtaWdub3JlXG4gIHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzLnZlcnNpb25zICE9IG51bGwgJiYgcHJvY2Vzcy52ZXJzaW9ucy5ub2RlICE9IG51bGw7XG5cbi8qKlxuICogQ29udmVuaWVudCB1dGlsIGNsYXNzIGZvciBjb21waWxpbmcgZG9jdW1lbnRzLCB3aGljaCBpcyBhIHdyYXBwZXIgb2YgdGhlXG4gKiB7QGxpbmsgVHlwc3RDb21waWxlcn0gYW5kIHtAbGluayBUeXBzdFJlbmRlcmVyfS5cbiAqXG4gKiBOb3RlOiB0aGUgaW50ZXJmYWNlIG9mIHRoaXMgY2xhc3MgaXMgbGVzcyBzdGFibGUgdGhhbiB7QGxpbmsgVHlwc3RDb21waWxlcn1cbiAqIGFuZCB7QGxpbmsgVHlwc3RSZW5kZXJlcn0uXG4gKlxuICogQGV4YW1wbGVcbiAqIFVzZSB0aGUgKmdsb2JhbCBzaGFyZWQqIGNvbXBpbGVyIGluc3RhbmNlOlxuICpcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGltcG9ydCB7ICR0eXBzdCB9IGZyb20gJ0BteXJpYWRkcmVhbWluL3R5cHN0LnRzJztcbiAqIGBgYFxuICpcbiAqIE5vdGU6IGlmIHlvdSB3YW50IHRvIGNvbXBpbGUgbXVsdGlwbGUgZG9jdW1lbnRzLCB5b3Ugc2hvdWxkIGNyZWF0ZSBhIG5ld1xuICogaW5zdGFuY2UgZm9yIGVhY2ggY29tcGlsYXRpb24gd29yayBvciBtYWludGFpbiB0aGUgc2hhcmVkIHN0YXRlIG9uIHRoZVxuICogdXRpbGl0eSBpbnN0YW5jZSBgJHR5cHN0YCBjYXJlZnVsbHksIGJlY2F1c2UgdGhlIGNvbXBpbGF0aW9uIHByb2Nlc3Mgd2lsbFxuICogY2hhbmdlIHRoZSBzdGF0ZSBvZiB0aGF0LlxuICpcbiAqIEBleGFtcGxlXG4gKiBDcmVhdGUgYW4gaW5zdGFuY2Ugb2YgdXRpbGl0eTpcbiAqXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjb25zdCAkdHlwc3QgPSBuZXcgVHlwc3RTbmlwcGV0KHtcbiAqICAgLy8gb3B0aW9uYWwgcmVuZGVyZXIgaW5zdGFuY2VcbiAqICAgcmVuZGVyZXI6IGVuYWJsZVJlbmRlcmluZyA/PyAoKCkgPT4ge1xuICogICAgIHJldHVybiBjcmVhdGVHbG9iYWxSZW5kZXJlcihjcmVhdGVUeXBzdFJlbmRlcmVyLFxuICogICAgICAgdW5kZWZpbmVkLCBpbml0T3B0aW9ucyk7XG4gKiAgIH0pLFxuICogICBjb21waWxlcigpID0+IHtcbiAqICAgICByZXR1cm4gY3JlYXRlR2xvYmFsQ29tcGlsZXIoY3JlYXRlVHlwc3RDb21waWxlcixcbiAqICAgICAgIGluaXRPcHRpb25zKTtcbiAqICAgfVxuICogfSk7XG4gKiBgYGBcbiAqL1xuZXhwb3J0IGNsYXNzIFR5cHN0U25pcHBldCB7XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHJpdmF0ZSBtYWluRmlsZVBhdGg6IHN0cmluZztcbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBwcml2YXRlIGNjPzogUHJvbWlzZUp1c3Q8VHlwc3RDb21waWxlcj47XG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHJpdmF0ZSBmcj86IFByb21pc2VKdXN0PFR5cHN0Rm9udEJ1aWxkZXI+O1xuICAvKiogQGludGVybmFsICovXG4gIHByaXZhdGUgZXg/OiBQcm9taXNlSnVzdDxUeXBzdFJlbmRlcmVyPjtcblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIHtAbGluayBUeXBzdFNuaXBwZXR9LlxuICAgKiBAcGFyYW0gY2MgdGhlIGNvbXBpbGVyIGluc3RhbmNlLCBzZWUge0BsaW5rIFByb21pc2VKdXN0fSBhbmQge0BsaW5rIFR5cHN0Q29tcGlsZXJ9LlxuICAgKiBAcGFyYW0gZXggdGhlIHJlbmRlcmVyIGluc3RhbmNlLCBzZWUge0BsaW5rIFByb21pc2VKdXN0fSBhbmQge0BsaW5rIFR5cHN0UmVuZGVyZXJ9LlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiBQYXNzZXMgYSBnbG9iYWwgc2hhcmVkIGNvbXBpbGVyIGluc3RhbmNlIHRoYXQgZ2V0IGluaXRpYWxpemVkIGxhemlseTpcbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiBjb25zdCAkdHlwc3QgPSBuZXcgVHlwc3RTbmlwcGV0KCgpID0+IHtcbiAgICogIHJldHVybiBjcmVhdGVHbG9iYWxDb21waWxlcihjcmVhdGVUeXBzdENvbXBpbGVyLCBpbml0T3B0aW9ucyk7XG4gICAqIH0pO1xuICAgKlxuICAgKi9cbiAgY29uc3RydWN0b3Iob3B0aW9ucz86IHtcbiAgICBjb21waWxlcj86IFByb21pc2VKdXN0PFR5cHN0Q29tcGlsZXI+O1xuICAgIGZvbnRSZXNvbHZlcj86IFByb21pc2VKdXN0PFR5cHN0Rm9udEJ1aWxkZXI+O1xuICAgIHJlbmRlcmVyPzogUHJvbWlzZUp1c3Q8VHlwc3RSZW5kZXJlcj47XG4gIH0pIHtcbiAgICB0aGlzLmNjID0gb3B0aW9ucz8uY29tcGlsZXIgfHwgVHlwc3RTbmlwcGV0LmJ1aWxkTG9jYWxDb21waWxlcjtcbiAgICB0aGlzLmZyID0gb3B0aW9ucz8uZm9udFJlc29sdmVyIHx8IFR5cHN0U25pcHBldC5idWlsZExvY2FsRm9udFJlc29sdmVyO1xuICAgIHRoaXMuZXggPSBvcHRpb25zPy5yZW5kZXJlciB8fCBUeXBzdFNuaXBwZXQuYnVpbGRMb2NhbFJlbmRlcmVyO1xuICAgIHRoaXMubWFpbkZpbGVQYXRoID0gJy9tYWluLnR5cCc7XG4gICAgdGhpcy5wcm92aWRlcnMgPSBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgbGF6eSBpbml0aWFsaXplZCBjb21waWxlciBpbnN0YW5jZSBmb3IgdGhlIHV0aWxpdHkgaW5zdGFuY2UuXG4gICAqIEBwYXJhbSBjYyB0aGUgY29tcGlsZXIgaW5zdGFuY2UsIHNlZSB7QGxpbmsgUHJvbWlzZUp1c3R9IGFuZCB7QGxpbmsgVHlwc3RDb21waWxlcn0uXG4gICAqL1xuICBzZXRDb21waWxlcihjYzogUHJvbWlzZUp1c3Q8VHlwc3RDb21waWxlcj4pIHtcbiAgICB0aGlzLmNjID0gY2M7XG4gIH1cblxuICBhc3luYyBnZXRGb250UmVzb2x2ZXIoKSB7XG4gICAgcmV0dXJuICh0eXBlb2YgdGhpcy5mciA9PT0gJ2Z1bmN0aW9uJyA/ICh0aGlzLmZyID0gYXdhaXQgdGhpcy5mcigpKSA6IHRoaXMuZnIpITtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYW4gaW5pdGlhbGl6ZWQgY29tcGlsZXIgaW5zdGFuY2UgZnJvbSB0aGUgdXRpbGl0eSBpbnN0YW5jZS5cbiAgICovXG4gIGFzeW5jIGdldENvbXBpbGVyKCkge1xuICAgIHJldHVybiAodHlwZW9mIHRoaXMuY2MgPT09ICdmdW5jdGlvbicgPyAodGhpcy5jYyA9IGF3YWl0IHRoaXMuY2MoKSkgOiB0aGlzLmNjKSE7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldENvbXBpbGVyUmVzZXQoKSB7XG4gICAgY29uc3QgY29tcGlsZXIgPSBhd2FpdCB0aGlzLmdldENvbXBpbGVyKCk7XG4gICAgYXdhaXQgY29tcGlsZXIucmVzZXQoKTtcbiAgICByZXR1cm4gY29tcGlsZXI7XG4gIH1cblxuICAvKipcbiAgICogU2V0IGxhenkgaW5pdGlhbGl6ZWQgcmVuZGVyZXIgaW5zdGFuY2UgZm9yIHRoZSB1dGlsaXR5IGluc3RhbmNlLlxuICAgKiBAcGFyYW0gZXggdGhlIHJlbmRlcmVyIGluc3RhbmNlLCBzZWUge0BsaW5rIFByb21pc2VKdXN0fSBhbmQge0BsaW5rIFR5cHN0UmVuZGVyZXJ9LlxuICAgKi9cbiAgc2V0UmVuZGVyZXIoZXg6IFByb21pc2VKdXN0PFR5cHN0UmVuZGVyZXI+KSB7XG4gICAgdGhpcy5leCA9IGV4O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbiBpbml0aWFsaXplZCByZW5kZXJlciBpbnN0YW5jZSBmcm9tIHRoZSB1dGlsaXR5IGluc3RhbmNlLlxuICAgKi9cbiAgYXN5bmMgZ2V0UmVuZGVyZXIoKTogUHJvbWlzZTxUeXBzdFJlbmRlcmVyPiB7XG4gICAgcmV0dXJuIHR5cGVvZiB0aGlzLmV4ID09PSAnZnVuY3Rpb24nID8gKHRoaXMuZXggPSBhd2FpdCB0aGlzLmV4KCkpIDogdGhpcy5leCE7XG4gIH1cblxuICBwcml2YXRlIHByb3ZpZGVycz86IFByb21pc2VKdXN0PFR5cHN0U25pcHBldFByb3ZpZGVyPltdO1xuICAvKipcbiAgICogYWRkIHByb3ZpZGVycyBmb3IgYnVsbGRpbmcgdGhlIGNvbXBpbGVyIG9yIHJlbmRlcmVyIGNvbXBvbmVudC5cbiAgICovXG4gIHVzZSguLi5wcm92aWRlcnM6IFByb21pc2VKdXN0PFR5cHN0U25pcHBldFByb3ZpZGVyPltdKSB7XG4gICAgaWYgKCF0aGlzLnByb3ZpZGVycykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdhbHJlYWR5IHByZXBhcmUgdXNlcyBmb3IgaW5zdGFuY2VzJyk7XG4gICAgfVxuICAgIHRoaXMucHJvdmlkZXJzLnB1c2goLi4ucHJvdmlkZXJzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiB0b2RvOiBhZGQgZG9jc1xuICAgKi9cbiAgc3RhdGljIHByZWxvYWRGb250RnJvbVVybChmb250VXJsOiBzdHJpbmcpOiBUeXBzdFNuaXBwZXRQcm92aWRlciB7XG4gICAgcmV0dXJuIFR5cHN0U25pcHBldC5wcmVsb2FkRm9udHMoW2ZvbnRVcmxdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiB0b2RvOiBhZGQgZG9jc1xuICAgKi9cbiAgc3RhdGljIHByZWxvYWRGb250RGF0YShmb250RGF0YTogVWludDhBcnJheSk6IFR5cHN0U25pcHBldFByb3ZpZGVyIHtcbiAgICByZXR1cm4gVHlwc3RTbmlwcGV0LnByZWxvYWRGb250cyhbZm9udERhdGFdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiB0b2RvOiBhZGQgZG9jc1xuICAgKi9cbiAgc3RhdGljIHByZWxvYWRGb250cyh1c2VyRm9udHM6IChzdHJpbmcgfCBVaW50OEFycmF5KVtdKTogVHlwc3RTbmlwcGV0UHJvdmlkZXIge1xuICAgIHJldHVybiB7XG4gICAgICBrZXk6ICdhY2Nlc3MtbW9kZWwnLFxuICAgICAgZm9yUm9sZXM6IFsnY29tcGlsZXInXSxcbiAgICAgIHByb3ZpZGVzOiBbbG9hZEZvbnRzKHVzZXJGb250cyldLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogZG9uJ3QgbG9hZCBhbnkgZGVmYXVsdCBmb250IGFzc2V0cy5cbiAgICogdG9kbzogYWRkIGRvY3NcbiAgICovXG4gIHN0YXRpYyBkaXNhYmxlRGVmYXVsdEZvbnRBc3NldHMoKTogVHlwc3RTbmlwcGV0UHJvdmlkZXIge1xuICAgIHJldHVybiB7XG4gICAgICBrZXk6ICdhY2Nlc3MtbW9kZWwnLFxuICAgICAgZm9yUm9sZXM6IFsnY29tcGlsZXInXSxcbiAgICAgIHByb3ZpZGVzOiBbZGlzYWJsZURlZmF1bHRGb250QXNzZXRzKCldLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogdG9kbzogYWRkIGRvY3NcbiAgICovXG4gIHN0YXRpYyBwcmVsb2FkRm9udEFzc2V0cyhvcHRpb25zPzogTG9hZFJlbW90ZUFzc2V0c09wdGlvbnMpOiBUeXBzdFNuaXBwZXRQcm92aWRlciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGtleTogJ2FjY2Vzcy1tb2RlbCcsXG4gICAgICBmb3JSb2xlczogWydjb21waWxlciddLFxuICAgICAgcHJvdmlkZXM6IFtwcmVsb2FkRm9udEFzc2V0cyhvcHRpb25zKV0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgYWNjZXNzbCBtb2RlbCBmb3IgdGhlIGNvbXBpbGVyIGluc3RhbmNlXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHVzZSBtZW1vcnkgYWNjZXNzIG1vZGVsXG4gICAqXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogY29uc3QgbSA9IG5ldyBNZW1vcnlBY2Nlc3NNb2RlbCgpO1xuICAgKiAkdHlwc3QudXNlKFR5cHN0U25pcHBldC53aXRoQWNjZXNzTW9kZWwobSkpO1xuICAgKiBgYGBcbiAgICovXG4gIHN0YXRpYyB3aXRoQWNjZXNzTW9kZWwoYWNjZXNzTW9kZWw6IFdyaXRhYmxlQWNjZXNzTW9kZWwpOiBUeXBzdFNuaXBwZXRQcm92aWRlciB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGtleTogJ2FjY2Vzcy1tb2RlbCcsXG4gICAgICBmb3JSb2xlczogWydjb21waWxlciddLFxuICAgICAgcHJvdmlkZXM6IFt3aXRoQWNjZXNzTW9kZWwoYWNjZXNzTW9kZWwpXSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCBwYWNrYWdlIHJlZ2lzdHJ5IGZvciB0aGUgY29tcGlsZXIgaW5zdGFuY2VcbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdXNlIGEgY3VzdG9taXplZCBwYWNrYWdlIHJlZ2lzdHJ5XG4gICAqXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogY29uc3QgbiA9IG5ldyBOb2RlRmV0Y2hQYWNrYWdlUmVnaXN0cnkoKTtcbiAgICogJHR5cHN0LnVzZShUeXBzdFNuaXBwZXQud2l0aFBhY2thZ2VSZWdpc3RyeShuKSk7XG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIHdpdGhQYWNrYWdlUmVnaXN0cnkocmVnaXN0cnk6IFBhY2thZ2VSZWdpc3RyeSk6IFR5cHN0U25pcHBldFByb3ZpZGVyIHtcbiAgICByZXR1cm4ge1xuICAgICAga2V5OiAncGFja2FnZS1yZWdpc3RyeScsXG4gICAgICBmb3JSb2xlczogWydjb21waWxlciddLFxuICAgICAgcHJvdmlkZXM6IFt3aXRoUGFja2FnZVJlZ2lzdHJ5KHJlZ2lzdHJ5KV0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZSBhbiBhY2Nlc3MgbW9kZWwgdG8gc3RvcmUgdGhlIGRhdGEgb2YgZmV0Y2hlZCBmaWxlcy5cbiAgICogUHJvdmlkZSBhIFBhY2thZ2VSZWdpc3RyeSBpbnN0YW5jZSBmb3IgdGhlIGNvbXBpbGVyIGluc3RhbmNlLlxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKlxuICAgKiB1c2UgZGVmYXVsdCAobWVtb3J5KSBhY2Nlc3MgbW9kZWxcbiAgICpcbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiAkdHlwc3QudXNlKGF3YWl0IFR5cHN0U25pcHBldC5mZXRjaFBhY2thZ2VSZWdpc3RyeSgpKTtcbiAgICogYGBgXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqXG4gICAqIHVzZSBleHRlcm5hbCBhY2Nlc3MgbW9kZWxcbiAgICpcbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiBjb25zdCBtID0gbmV3IE1lbW9yeUFjY2Vzc01vZGVsKCk7XG4gICAqICR0eXBzdC51c2UoVHlwc3RTbmlwcGV0LndpdGhBY2Nlc3NNb2RlbChtKSwgYXdhaXQgVHlwc3RTbmlwcGV0LmZldGNoUGFja2FnZVJlZ2lzdHJ5KG0pKTtcbiAgICogYGBgXG4gICAqL1xuICBzdGF0aWMgZmV0Y2hQYWNrYWdlUmVnaXN0cnkoYWNjZXNzTW9kZWw/OiBXcml0YWJsZUFjY2Vzc01vZGVsKTogVHlwc3RTbmlwcGV0UHJvdmlkZXIge1xuICAgIGNvbnN0IG0gPSBhY2Nlc3NNb2RlbCB8fCBuZXcgTWVtb3J5QWNjZXNzTW9kZWwoKTtcbiAgICBjb25zdCBwcm92aWRlcyA9IFtcbiAgICAgIC4uLihhY2Nlc3NNb2RlbCA/IFtdIDogW3dpdGhBY2Nlc3NNb2RlbChtKV0pLFxuICAgICAgd2l0aFBhY2thZ2VSZWdpc3RyeShuZXcgRmV0Y2hQYWNrYWdlUmVnaXN0cnkobSkpLFxuICAgIF07XG4gICAgcmV0dXJuIHtcbiAgICAgIGtleTogJ3BhY2thZ2UtcmVnaXN0cnkkZmV0Y2gnLFxuICAgICAgZm9yUm9sZXM6IFsnY29tcGlsZXInXSxcbiAgICAgIHByb3ZpZGVzLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmUgYSBmZXRjaGVyIGZvciBmZXRjaGluZyBwYWNrYWdlIGRhdGEuXG4gICAqIFByb3ZpZGUgYSBQYWNrYWdlUmVnaXN0cnkgaW5zdGFuY2UgZm9yIHRoZSBjb21waWxlciBpbnN0YW5jZS5cbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogdXNlIGEgY3VzdG9taXplZCBmZXRjaGVyXG4gICAqXG4gICAqIGBgYHR5cGVzY3JpcHRcbiAgICogaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3luYy1yZXF1ZXN0LWN1cmwnO1xuICAgKiBjb25zdCBtID0gbmV3IE1lbW9yeUFjY2Vzc01vZGVsKCk7XG4gICAqICR0eXBzdC51c2UoVHlwc3RTbmlwcGV0LndpdGhBY2Nlc3NNb2RlbChtKSwgYXdhaXQgVHlwc3RTbmlwcGV0LmZldGNoUGFja2FnZUJ5KG0sIChfLCBodHRwVXJsKSA9PiB7XG4gICAqICAgY29uc3QgcmVzcG9uc2UgPSByZXF1ZXN0KCdHRVQnLCB0aGlzLnJlc29sdmVQYXRoKHBhdGgpLCB7XG4gICAqICAgICBpbnNlY3VyZTogdHJ1ZSxcbiAgICogICB9KTtcbiAgICpcbiAgICogICBpZiAocmVzcG9uc2Uuc3RhdHVzQ29kZSA9PT0gMjAwKSB7XG4gICAqICAgICByZXR1cm4gcmVzcG9uc2UuZ2V0Qm9keSh1bmRlZmluZWQpO1xuICAgKiAgIH1cbiAgICogICByZXR1cm4gdW5kZWZpbmVkO1xuICAgKiB9KSk7XG4gICAqIGBgYFxuICAgKi9cbiAgc3RhdGljIGZldGNoUGFja2FnZUJ5KFxuICAgIGFjY2Vzc01vZGVsOiBXcml0YWJsZUFjY2Vzc01vZGVsLFxuICAgIGZldGNoZXI6IChwYXRoOiBQYWNrYWdlU3BlYywgZGVmYXVsdEh0dHBVcmw6IHN0cmluZykgPT4gVWludDhBcnJheSB8IHVuZGVmaW5lZCxcbiAgKTogVHlwc3RTbmlwcGV0UHJvdmlkZXIge1xuICAgIGNsYXNzIEh0dHBQYWNrYWdlUmVnaXN0cnkgZXh0ZW5kcyBGZXRjaFBhY2thZ2VSZWdpc3RyeSB7XG4gICAgICBwdWxsUGFja2FnZURhdGEocGF0aDogUGFja2FnZVNwZWMpOiBVaW50OEFycmF5IHwgdW5kZWZpbmVkIHtcbiAgICAgICAgcmV0dXJuIGZldGNoZXIocGF0aCwgdGhpcy5yZXNvbHZlUGF0aChwYXRoKSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICBrZXk6ICdwYWNrYWdlLXJlZ2lzdHJ5JGxhbWJkYScsXG4gICAgICBmb3JSb2xlczogWydjb21waWxlciddLFxuICAgICAgcHJvdmlkZXM6IFt3aXRoUGFja2FnZVJlZ2lzdHJ5KG5ldyBIdHRwUGFja2FnZVJlZ2lzdHJ5KGFjY2Vzc01vZGVsKSldLFxuICAgIH07XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIGNjT3B0aW9uczogUGFydGlhbDxJbml0T3B0aW9ucz47XG4gIC8qKlxuICAgKiBTZXQgY29tcGlsZXIgaW5pdCBvcHRpb25zIGZvciBpbml0aWFsaXppbmcgZ2xvYmFsIGluc3RhbmNlIHtAbGluayAkdHlwc3R9LlxuICAgKiBTZWUge0BsaW5rIEluaXRPcHRpb25zfS5cbiAgICovXG4gIHNldENvbXBpbGVySW5pdE9wdGlvbnMob3B0aW9uczogUGFydGlhbDxJbml0T3B0aW9ucz4pIHtcbiAgICB0aGlzLnJlcXVpcmVJc1VuaW5pdGlhbGl6ZWQoJ2NvbXBpbGVyJywgdGhpcy5jYyk7XG4gICAgdGhpcy5jY09wdGlvbnMgPSBvcHRpb25zO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBleE9wdGlvbnM6IFBhcnRpYWw8SW5pdE9wdGlvbnM+O1xuICAvKipcbiAgICogU2V0IHJlbmRlcmVyIGluaXQgb3B0aW9ucyBmb3IgaW5pdGlhbGl6aW5nIGdsb2JhbCBpbnN0YW5jZSB7QGxpbmsgJHR5cHN0fS5cbiAgICogU2VlIHtAbGluayBJbml0T3B0aW9uc30uXG4gICAqL1xuICBzZXRSZW5kZXJlckluaXRPcHRpb25zKG9wdGlvbnM6IFBhcnRpYWw8SW5pdE9wdGlvbnM+KSB7XG4gICAgdGhpcy5yZXF1aXJlSXNVbmluaXRpYWxpemVkKCdyZW5kZXJlcicsIHRoaXMuZXgpO1xuICAgIHRoaXMuZXhPcHRpb25zID0gb3B0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgc2hhcmVkIG1haW4gZmlsZSBwYXRoLlxuICAgKi9cbiAgc2V0TWFpbkZpbGVQYXRoKHBhdGg6IHN0cmluZykge1xuICAgIHRoaXMubWFpbkZpbGVQYXRoID0gcGF0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc2hhcmVkIG1haW4gZmlsZSBwYXRoLlxuICAgKi9cbiAgZ2V0TWFpbkZpbGVQYXRoKCkge1xuICAgIHJldHVybiB0aGlzLm1haW5GaWxlUGF0aDtcbiAgfVxuXG4gIHJlbW92ZVRtcChvcHRzOiBDb21waWxlT3B0aW9ucyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChvcHRzLm1haW5GaWxlUGF0aC5zdGFydHNXaXRoKCcvdG1wLycpKSB7XG4gICAgICByZXR1cm4gdGhpcy51bm1hcFNoYWRvdyhvcHRzLm1haW5GaWxlUGF0aCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBmb250IHRvIHRoZSBjb21waWxlci5cbiAgICpcbiAgICogQGV4YW1wbGVcbiAgICpcbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiBjb25zdCBmb250cyA9IGF3YWl0IGZldGNoKCdmb250SW5mby5qc29uJykudGhlbihyZXMgPT4gcmVzLmpzb24oKSk7XG4gICAqICR0eXBzdC5hZGRGb250cyhmb250cy5tYXAoZm9udCA9PiAkdHlwc3QubG9hZEZvbnQoZm9udC51cmwpKSk7XG4gICAqIGBgYFxuICAgKlxuICAgKiBAcGFyYW0gZm9udEluZm9zIHRoZSBmb250IGluZm9zIHRvIGFkZC5cbiAgICovXG4gIGFzeW5jIHNldEZvbnRzKGZvbnRJbmZvczogU3dlZXRMYXp5Rm9udFtdKSB7XG4gICAgY29uc3QgZmIgPSBhd2FpdCB0aGlzLmdldEZvbnRSZXNvbHZlcigpO1xuICAgIGZvciAoY29uc3QgZm9udCBvZiBmb250SW5mb3MpIHtcbiAgICAgIGF3YWl0IGZiLmFkZExhenlGb250KGZvbnQsICdibG9iJyBpbiBmb250ID8gZm9udC5ibG9iIDogbG9hZEZvbnRTeW5jKGZvbnQpLCBmb250KTtcbiAgICB9XG4gICAgY29uc3QgY29tcGlsZXIgPSBhd2FpdCB0aGlzLmdldENvbXBpbGVyKCk7XG4gICAgYXdhaXQgZmIuYnVpbGQoYXN5bmMgZm9udHMgPT4gY29tcGlsZXIuc2V0Rm9udHMoZm9udHMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgYSBzb3VyY2UgZmlsZSB0byB0aGUgY29tcGlsZXIuXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RDb21waWxlciNhZGRTb3VyY2V9LlxuICAgKi9cbiAgYXN5bmMgYWRkU291cmNlKHBhdGg6IHN0cmluZywgY29udGVudDogc3RyaW5nKSB7XG4gICAgKGF3YWl0IHRoaXMuZ2V0Q29tcGlsZXIoKSkuYWRkU291cmNlKHBhdGgsIGNvbnRlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IHRoZSBzaGFkb3cgZmlsZXMuXG4gICAqIE5vdGU6IHRoaXMgZnVuY3Rpb24gaXMgaW5kZXBlbmRlbnQgdG8gdGhlIHtAbGluayByZXNldH0gZnVuY3Rpb24uXG4gICAqIFNlZSB7QGxpbmsgVHlwc3RDb21waWxlciNyZXNldFNoYWRvd30uXG4gICAqL1xuICBhc3luYyByZXNldFNoYWRvdygpIHtcbiAgICAoYXdhaXQgdGhpcy5nZXRDb21waWxlcigpKS5yZXNldFNoYWRvdygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhIHNoYWRvdyBmaWxlIHRvIHRoZSBjb21waWxlci5cbiAgICogU2VlIHtAbGluayBUeXBzdENvbXBpbGVyI21hcFNoYWRvd30uXG4gICAqL1xuICBhc3luYyBtYXBTaGFkb3cocGF0aDogc3RyaW5nLCBjb250ZW50OiBVaW50OEFycmF5KSB7XG4gICAgKGF3YWl0IHRoaXMuZ2V0Q29tcGlsZXIoKSkubWFwU2hhZG93KHBhdGgsIGNvbnRlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZSBhIHNoYWRvdyBmaWxlIGZyb20gdGhlIGNvbXBpbGVyLlxuICAgKiBTZWUge0BsaW5rIFR5cHN0Q29tcGlsZXIjdW5tYXBTaGFkb3d9LlxuICAgKi9cbiAgYXN5bmMgdW5tYXBTaGFkb3cocGF0aDogc3RyaW5nKSB7XG4gICAgKGF3YWl0IHRoaXMuZ2V0Q29tcGlsZXIoKSkudW5tYXBTaGFkb3cocGF0aCk7XG4gIH1cblxuICAvKipcbiAgICogQ29tcGlsZSB0aGUgZG9jdW1lbnQgdG8gdmVjdG9yIChJUikgZm9ybWF0LlxuICAgKiBTZWUge0BsaW5rIFN3ZWV0Q29tcGlsZU9wdGlvbnN9LlxuICAgKi9cbiAgYXN5bmMgdmVjdG9yKG8/OiBTd2VldENvbXBpbGVPcHRpb25zKSB7XG4gICAgY29uc3Qgb3B0cyA9IGF3YWl0IHRoaXMuZ2V0Q29tcGlsZU9wdGlvbnMobyk7XG4gICAgY29uc3QgY29tcGlsZXIgPSBhd2FpdCB0aGlzLmdldENvbXBpbGVyUmVzZXQoKTtcbiAgICByZXR1cm4gY29tcGlsZXJcbiAgICAgIC5jb21waWxlKG9wdHMpXG4gICAgICAudGhlbihyZXMgPT4gcmVzLnJlc3VsdClcbiAgICAgIC5maW5hbGx5KCgpID0+IHRoaXMucmVtb3ZlVG1wKG9wdHMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21waWxlIHRoZSBkb2N1bWVudCB0byBQREYgZm9ybWF0LlxuICAgKiBTZWUge0BsaW5rIFN3ZWV0Q29tcGlsZU9wdGlvbnN9LlxuICAgKi9cbiAgYXN5bmMgcGRmKG8/OiBTd2VldENvbXBpbGVPcHRpb25zKSB7XG4gICAgY29uc3Qgb3B0cyA9IGF3YWl0IHRoaXMuZ2V0Q29tcGlsZU9wdGlvbnMobyk7XG4gICAgb3B0cy5mb3JtYXQgPSBDb21waWxlRm9ybWF0RW51bS5wZGY7XG4gICAgY29uc3QgY29tcGlsZXIgPSBhd2FpdCB0aGlzLmdldENvbXBpbGVyUmVzZXQoKTtcbiAgICByZXR1cm4gY29tcGlsZXJcbiAgICAgIC5jb21waWxlKG9wdHMpXG4gICAgICAudGhlbihyZXMgPT4gcmVzLnJlc3VsdClcbiAgICAgIC5maW5hbGx5KCgpID0+IHRoaXMucmVtb3ZlVG1wKG9wdHMpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21waWxlIHRoZSBkb2N1bWVudCB0byBTVkcgZm9ybWF0LlxuICAgKiBTZWUge0BsaW5rIFN3ZWV0UmVuZGVyT3B0aW9uc30gYW5kIHtAbGluayBSZW5kZXJTdmdPcHRpb25zfS5cbiAgICovXG4gIGFzeW5jIHN2ZyhvPzogU3dlZXRSZW5kZXJPcHRpb25zICYgUmVuZGVyU3ZnT3B0aW9ucykge1xuICAgIHJldHVybiB0aGlzLnRyYW5zaWVudFJlbmRlcihvLCAocmVuZGVyZXIsIHJlbmRlclNlc3Npb24pID0+XG4gICAgICByZW5kZXJlci5yZW5kZXJTdmcoe1xuICAgICAgICAuLi5vLFxuICAgICAgICByZW5kZXJTZXNzaW9uLFxuICAgICAgfSksXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb21waWxlIHRoZSBkb2N1bWVudCB0byBjYW52YXMgb3BlcmF0aW9ucy5cbiAgICogU2VlIHtAbGluayBTd2VldFJlbmRlck9wdGlvbnN9IGFuZCB7QGxpbmsgUmVuZGVyVG9DYW52YXNPcHRpb25zfS5cbiAgICovXG4gIGFzeW5jIGNhbnZhcyhcbiAgICBjb250YWluZXI6IEhUTUxFbGVtZW50LFxuICAgIG8/OiBTd2VldFJlbmRlck9wdGlvbnMgJiBPbWl0PFJlbmRlclRvQ2FudmFzT3B0aW9ucywgJ2NvbnRhaW5lcic+LFxuICApIHtcbiAgICByZXR1cm4gdGhpcy50cmFuc2llbnRSZW5kZXIobywgKHJlbmRlcmVyLCByZW5kZXJTZXNzaW9uKSA9PlxuICAgICAgcmVuZGVyZXIucmVuZGVyVG9DYW52YXMoe1xuICAgICAgICBjb250YWluZXIsXG4gICAgICAgIC4uLm8sXG4gICAgICAgIHJlbmRlclNlc3Npb24sXG4gICAgICB9KSxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZW1hbnRpYyB0b2tlbnMgZm9yIHRoZSBkb2N1bWVudC5cbiAgICovXG4gIGFzeW5jIHF1ZXJ5PFQ+KG86IFN3ZWV0Q29tcGlsZU9wdGlvbnMgJiB7IHNlbGVjdG9yOiBzdHJpbmc7IGZpZWxkPzogc3RyaW5nIH0pOiBQcm9taXNlPFQ+IHtcbiAgICBjb25zdCBvcHRzID0gYXdhaXQgdGhpcy5nZXRDb21waWxlT3B0aW9ucyhvKTtcbiAgICBjb25zdCBjb21waWxlciA9IGF3YWl0IHRoaXMuZ2V0Q29tcGlsZXJSZXNldCgpO1xuICAgIHJldHVybiBjb21waWxlclxuICAgICAgLnF1ZXJ5PFQ+KHtcbiAgICAgICAgLi4ubyxcbiAgICAgICAgLi4ub3B0cyxcbiAgICAgIH0pXG4gICAgICAuZmluYWxseSgoKSA9PiB0aGlzLnJlbW92ZVRtcChvcHRzKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRva2VuIGxlZ2VuZCBmb3Igc2VtYW50aWMgdG9rZW5zLlxuICAgKi9cbiAgYXN5bmMgZ2V0U2VtYW50aWNUb2tlbkxlZ2VuZCgpOiBQcm9taXNlPFNlbWFudGljVG9rZW5zTGVnZW5kPiB7XG4gICAgY29uc3QgY29tcGlsZXIgPSBhd2FpdCB0aGlzLmdldENvbXBpbGVyUmVzZXQoKTtcbiAgICByZXR1cm4gY29tcGlsZXIuZ2V0U2VtYW50aWNUb2tlbkxlZ2VuZCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZW1hbnRpYyB0b2tlbnMgZm9yIHRoZSBkb2N1bWVudC5cbiAgICogU2VlIHtAbGluayBTd2VldENvbXBpbGVPcHRpb25zfS5cbiAgICogU2VlIHtAbGluayBUeXBzdENvbXBpbGVyI2dldFNlbWFudGljVG9rZW5zfS5cbiAgICovXG4gIGFzeW5jIGdldFNlbWFudGljVG9rZW5zKG86IFN3ZWV0Q29tcGlsZU9wdGlvbnMgJiB7IHJlc3VsdElkPzogc3RyaW5nIH0pOiBQcm9taXNlPFNlbWFudGljVG9rZW5zPiB7XG4gICAgY29uc3Qgb3B0cyA9IGF3YWl0IHRoaXMuZ2V0Q29tcGlsZU9wdGlvbnMobyk7XG4gICAgY29uc3QgY29tcGlsZXIgPSBhd2FpdCB0aGlzLmdldENvbXBpbGVyUmVzZXQoKTtcbiAgICByZXR1cm4gY29tcGlsZXJcbiAgICAgIC5nZXRTZW1hbnRpY1Rva2Vucyh7XG4gICAgICAgIG1haW5GaWxlUGF0aDogb3B0cy5tYWluRmlsZVBhdGgsXG4gICAgICAgIHJlc3VsdElkOiBvLnJlc3VsdElkLFxuICAgICAgfSlcbiAgICAgIC5maW5hbGx5KCgpID0+IHRoaXMucmVtb3ZlVG1wKG9wdHMpKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q29tcGlsZU9wdGlvbnMoXG4gICAgb3B0cz86IFN3ZWV0Q29tcGlsZU9wdGlvbnMsXG4gICk6IFByb21pc2U8Q29tcGlsZU9wdGlvbnM8Q29tcGlsZUZvcm1hdEVudW0sICdub25lJz4+IHtcbiAgICBpZiAob3B0cyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4geyBtYWluRmlsZVBhdGg6IHRoaXMubWFpbkZpbGVQYXRoLCBkaWFnbm9zdGljczogJ25vbmUnIH07XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygb3B0cyA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgcGxlYXNlIHNwZWNpZnkgb3B0cyBhcyB7bWFpbkNvbnRlbnQ6ICcuLi4nfSBvciB7bWFpbkZpbGVQYXRoOiAnLi4uJ31gKTtcbiAgICB9IGVsc2UgaWYgKCdtYWluRmlsZVBhdGgnIGluIG9wdHMpIHtcbiAgICAgIHJldHVybiB7IC4uLm9wdHMsIGRpYWdub3N0aWNzOiAnbm9uZScgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgZGVzdEZpbGUgPSBgL3RtcC8ke3JhbmRzdHIoKX0udHlwYDtcbiAgICAgIGF3YWl0IHRoaXMuYWRkU291cmNlKGRlc3RGaWxlLCBvcHRzLm1haW5Db250ZW50KTtcbiAgICAgIHJldHVybiB7IG1haW5GaWxlUGF0aDogZGVzdEZpbGUsIGlucHV0czogb3B0cy5pbnB1dHMsIGRpYWdub3N0aWNzOiAnbm9uZScgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFZlY3RvcihvPzogU3dlZXRSZW5kZXJPcHRpb25zKTogUHJvbWlzZTxVaW50OEFycmF5PiB7XG4gICAgaWYgKG8gJiYgJ3ZlY3RvckRhdGEnIGluIG8pIHtcbiAgICAgIHJldHVybiBvLnZlY3RvckRhdGE7XG4gICAgfVxuXG4gICAgY29uc3Qgb3B0cyA9IGF3YWl0IHRoaXMuZ2V0Q29tcGlsZU9wdGlvbnMobyk7XG4gICAgcmV0dXJuIChhd2FpdCB0aGlzLmdldENvbXBpbGVyKCkpXG4gICAgICAuY29tcGlsZShvcHRzKVxuICAgICAgLnRoZW4ocmVzID0+IHJlcy5yZXN1bHQhKVxuICAgICAgLmZpbmFsbHkoKCkgPT4gdGhpcy5yZW1vdmVUbXAob3B0cykpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB0cmFuc2llbnRSZW5kZXI8VD4oXG4gICAgb3B0czogU3dlZXRSZW5kZXJPcHRpb25zIHwgdW5kZWZpbmVkLFxuICAgIGY6IChycjogVHlwc3RSZW5kZXJlciwgc2Vzc2lvbjogUmVuZGVyU2Vzc2lvbikgPT4gVCxcbiAgKTogUHJvbWlzZTxUPiB7XG4gICAgY29uc3QgcnIgPSBhd2FpdCB0aGlzLmdldFJlbmRlcmVyKCk7XG4gICAgaWYgKCFycikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdkb2VzIG5vdCBwcm92aWRlIHJlbmRlcmVyIGluc3RhbmNlJyk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLmdldFZlY3RvcihvcHRzKTtcbiAgICByZXR1cm4gYXdhaXQgcnIucnVuV2l0aFNlc3Npb24oYXN5bmMgc2Vzc2lvbiA9PiB7XG4gICAgICByci5tYW5pcHVsYXRlRGF0YSh7XG4gICAgICAgIHJlbmRlclNlc3Npb246IHNlc3Npb24sXG4gICAgICAgIGFjdGlvbjogJ3Jlc2V0JyxcbiAgICAgICAgZGF0YSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGYocnIsIHNlc3Npb24pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJlcGFyZVVzZU9uY2U6IFByb21pc2U8dm9pZD4gfCB1bmRlZmluZWQgPSB1bmRlZmluZWQ7XG4gIHByaXZhdGUgYXN5bmMgcHJlcGFyZVVzZSgpIHtcbiAgICBpZiAodGhpcy5wcmVwYXJlVXNlT25jZSkge1xuICAgICAgcmV0dXJuIHRoaXMucHJlcGFyZVVzZU9uY2U7XG4gICAgfVxuICAgIHJldHVybiAodGhpcy5wcmVwYXJlVXNlT25jZSA9IHRoaXMuZG9QcmVwYXJlVXNlKCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBkb1ByZXBhcmVVc2UoKSB7XG4gICAgaWYgKCF0aGlzLnByb3ZpZGVycykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHByb3ZpZGVycyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgdGhpcy5wcm92aWRlcnMubWFwKHAgPT4gKHR5cGVvZiBwID09PSAnZnVuY3Rpb24nID8gcCgpIDogcCkpLFxuICAgICk7XG4gICAgdGhpcy5wcm92aWRlcnMgPSBbXTtcblxuICAgIGlmIChcbiAgICAgICR0eXBzdCA9PSB0aGlzICYmXG4gICAgICAhcHJvdmlkZXJzLnNvbWUocCA9PiBwLmtleS5pbmNsdWRlcygncGFja2FnZS1yZWdpc3RyeScpIHx8IHAua2V5LmluY2x1ZGVzKCdhY2Nlc3MtbW9kZWwnKSlcbiAgICApIHtcbiAgICAgIC8vIE5vdGU6IHRoZSBkZWZhdWx0IGZldGNoIGJhY2tlbmQgYWx3YXlzIGFkZHMgYSB3aXRoQWNjZXNzTW9kZWwobWVtKVxuICAgICAgaWYgKGlzTm9kZSkge1xuICAgICAgICBjb25zdCBlc2NhcGVJbXBvcnQgPSBuZXcgRnVuY3Rpb24oJ20nLCAncmV0dXJuIGltcG9ydChtKScpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IG0gPSBuZXcgTWVtb3J5QWNjZXNzTW9kZWwoKTtcbiAgICAgICAgICBjb25zdCB7IGRlZmF1bHQ6IHJlcXVlc3QgfSA9IGF3YWl0IGVzY2FwZUltcG9ydCgnc3luYy1yZXF1ZXN0Jyk7XG5cbiAgICAgICAgICAkdHlwc3QudXNlKFxuICAgICAgICAgICAgVHlwc3RTbmlwcGV0LndpdGhBY2Nlc3NNb2RlbChtKSxcbiAgICAgICAgICAgIFR5cHN0U25pcHBldC5mZXRjaFBhY2thZ2VCeShtLCAoXzogdW5rbm93biwgcGF0aDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gcmVxdWVzdCgnR0VUJywgcGF0aCk7XG5cbiAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1c0NvZGUgPT09IDIwMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5nZXRCb2R5KHVuZGVmaW5lZCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgICk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHsgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgJHR5cHN0LnVzZShUeXBzdFNuaXBwZXQuZmV0Y2hQYWNrYWdlUmVnaXN0cnkoKSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgcHJvdmlkZXJzMiA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgdGhpcy5wcm92aWRlcnMubWFwKHAgPT4gKHR5cGVvZiBwID09PSAnZnVuY3Rpb24nID8gcCgpIDogcCkpLFxuICAgICk7XG5cbiAgICBjb25zdCBjY09wdGlvbnMgPSAodGhpcy5jY09wdGlvbnMgfHw9IHt9KTtcbiAgICBjb25zdCBjY0JlZm9yZUJ1aWxkID0gKGNjT3B0aW9ucy5iZWZvcmVCdWlsZCB8fD0gW10pO1xuXG4gICAgY29uc3QgZXhPcHRpb25zID0gKHRoaXMuZXhPcHRpb25zIHx8PSB7fSk7XG4gICAgY29uc3QgZXhCZWZvcmVCdWlsZCA9IChleE9wdGlvbnMuYmVmb3JlQnVpbGQgfHw9IFtdKTtcblxuICAgIGZvciAoY29uc3QgcHJvdmlkZXIgb2YgWy4uLnByb3ZpZGVycywgLi4ucHJvdmlkZXJzMl0pIHtcbiAgICAgIGlmIChwcm92aWRlci5mb3JSb2xlcy5pbmNsdWRlcygnY29tcGlsZXInKSkge1xuICAgICAgICB0aGlzLnJlcXVpcmVJc1VuaW5pdGlhbGl6ZWQoJ2NvbXBpbGVyJywgdGhpcy5jYyk7XG4gICAgICAgIGNjQmVmb3JlQnVpbGQucHVzaCguLi5wcm92aWRlci5wcm92aWRlcyk7XG4gICAgICB9XG4gICAgICBpZiAocHJvdmlkZXIuZm9yUm9sZXMuaW5jbHVkZXMoJ3JlbmRlcmVyJykpIHtcbiAgICAgICAgdGhpcy5yZXF1aXJlSXNVbmluaXRpYWxpemVkKCdyZW5kZXJlcicsIHRoaXMuZXgpO1xuICAgICAgICBleEJlZm9yZUJ1aWxkLnB1c2goLi4ucHJvdmlkZXIucHJvdmlkZXMpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aGlzLnByb3ZpZGVycyA9IHVuZGVmaW5lZDtcbiAgfVxuXG4gIHByaXZhdGUgcmVxdWlyZUlzVW5pbml0aWFsaXplZDxUPihyb2xlOiBzdHJpbmcsIGM6IFByb21pc2VKdXN0PFQ+LCBlPzogUHJvbWlzZUp1c3Q8VD4pIHtcbiAgICBpZiAoYyAmJiB0eXBlb2YgYyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke3JvbGV9IGhhcyBiZWVuIGluaXRpYWxpemVkOiAke2N9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBzdGF0aWMgYXN5bmMgYnVpbGRMb2NhbENvbXBpbGVyKHRoaXM6IFR5cHN0U25pcHBldCkge1xuICAgIGNvbnN0IHsgY3JlYXRlVHlwc3RDb21waWxlciB9ID0gKGF3YWl0IGltcG9ydChcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICdAbXlyaWFkZHJlYW1pbi90eXBzdC50cy9jb21waWxlcidcbiAgICApKSBhcyBhbnkgYXMgdHlwZW9mIGltcG9ydCgnLi4vY29tcGlsZXIubWpzJyk7XG5cbiAgICBhd2FpdCB0aGlzLnByZXBhcmVVc2UoKTtcbiAgICBjb25zdCBjb21waWxlciA9IGNyZWF0ZVR5cHN0Q29tcGlsZXIoKTtcbiAgICBhd2FpdCBjb21waWxlci5pbml0KHRoaXMuY2NPcHRpb25zKTtcbiAgICByZXR1cm4gY29tcGlsZXI7XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBhc3luYyBidWlsZExvY2FsRm9udFJlc29sdmVyKHRoaXM6IFR5cHN0U25pcHBldCkge1xuICAgIGNvbnN0IHsgY3JlYXRlVHlwc3RGb250QnVpbGRlciB9ID0gKGF3YWl0IGltcG9ydChcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICdAbXlyaWFkZHJlYW1pbi90eXBzdC50cy9jb21waWxlcidcbiAgICApKSBhcyBhbnkgYXMgdHlwZW9mIGltcG9ydCgnLi4vY29tcGlsZXIubWpzJyk7XG5cbiAgICBhd2FpdCB0aGlzLnByZXBhcmVVc2UoKTtcbiAgICBjb25zdCBmb250cyA9IGNyZWF0ZVR5cHN0Rm9udEJ1aWxkZXIoKTtcbiAgICBhd2FpdCBmb250cy5pbml0KHRoaXMuY2NPcHRpb25zKTtcbiAgICByZXR1cm4gZm9udHM7XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBhc3luYyBidWlsZEdsb2JhbENvbXBpbGVyKHRoaXM6IFR5cHN0U25pcHBldCkge1xuICAgIC8vIGxhenkgaW1wb3J0IGNvbXBpbGUgbW9kdWxlXG4gICAgY29uc3QgeyBjcmVhdGVHbG9iYWxDb21waWxlciB9ID0gKGF3YWl0IGltcG9ydChcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICdAbXlyaWFkZHJlYW1pbi90eXBzdC50cy9jb250cmliL2dsb2JhbC1jb21waWxlcidcbiAgICApKSBhcyBhbnkgYXMgdHlwZW9mIGltcG9ydCgnLi9nbG9iYWwtY29tcGlsZXIubWpzJyk7XG4gICAgY29uc3QgeyBjcmVhdGVUeXBzdENvbXBpbGVyIH0gPSAoYXdhaXQgaW1wb3J0KFxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgJ0BteXJpYWRkcmVhbWluL3R5cHN0LnRzL2NvbXBpbGVyJ1xuICAgICkpIGFzIGFueSBhcyB0eXBlb2YgaW1wb3J0KCcuLi9jb21waWxlci5tanMnKTtcblxuICAgIGF3YWl0IHRoaXMucHJlcGFyZVVzZSgpO1xuICAgIHJldHVybiBjcmVhdGVHbG9iYWxDb21waWxlcihjcmVhdGVUeXBzdENvbXBpbGVyLCB0aGlzLmNjT3B0aW9ucyk7XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIHN0YXRpYyBhc3luYyBidWlsZExvY2FsUmVuZGVyZXIodGhpczogVHlwc3RTbmlwcGV0KSB7XG4gICAgY29uc3QgeyBjcmVhdGVUeXBzdFJlbmRlcmVyIH0gPSAoYXdhaXQgaW1wb3J0KFxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgJ0BteXJpYWRkcmVhbWluL3R5cHN0LnRzL3JlbmRlcmVyJ1xuICAgICkpIGFzIGFueSBhcyB0eXBlb2YgaW1wb3J0KCcuLi9yZW5kZXJlci5tanMnKTtcblxuICAgIGF3YWl0IHRoaXMucHJlcGFyZVVzZSgpO1xuICAgIGNvbnN0IHJlbmRlcmVyID0gY3JlYXRlVHlwc3RSZW5kZXJlcigpO1xuICAgIGF3YWl0IHJlbmRlcmVyLmluaXQodGhpcy5leE9wdGlvbnMpO1xuICAgIHJldHVybiByZW5kZXJlcjtcbiAgfVxuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgc3RhdGljIGFzeW5jIGJ1aWxkR2xvYmFsUmVuZGVyZXIodGhpczogVHlwc3RTbmlwcGV0KSB7XG4gICAgLy8gbGF6eSBpbXBvcnQgcmVuZGVyZXIgbW9kdWxlXG4gICAgY29uc3QgeyBjcmVhdGVHbG9iYWxSZW5kZXJlciB9ID0gKGF3YWl0IGltcG9ydChcbiAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICdAbXlyaWFkZHJlYW1pbi90eXBzdC50cy9jb250cmliL2dsb2JhbC1yZW5kZXJlcidcbiAgICApKSBhcyBhbnkgYXMgdHlwZW9mIGltcG9ydCgnLi9nbG9iYWwtcmVuZGVyZXIubWpzJyk7XG4gICAgY29uc3QgeyBjcmVhdGVUeXBzdFJlbmRlcmVyIH0gPSAoYXdhaXQgaW1wb3J0KFxuICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgJ0BteXJpYWRkcmVhbWluL3R5cHN0LnRzL3JlbmRlcmVyJ1xuICAgICkpIGFzIGFueSBhcyB0eXBlb2YgaW1wb3J0KCcuLi9yZW5kZXJlci5tanMnKTtcblxuICAgIGF3YWl0IHRoaXMucHJlcGFyZVVzZSgpO1xuICAgIHJldHVybiBjcmVhdGVHbG9iYWxSZW5kZXJlcihjcmVhdGVUeXBzdFJlbmRlcmVyLCB0aGlzLmV4T3B0aW9ucyk7XG4gIH1cbn1cblxuLyoqXG4gKiBUaGUgbGF6eSBpbml0aWFsaXplZCBnbG9iYWwgc2hhcmVkIGluc3RhbmNlIG9mIHtAbGluayBUeXBzdFNuaXBwZXR9LiBTZWVcbiAqIHtAbGluayBUeXBzdFNuaXBwZXR9IGZvciBtb3JlIGRldGFpbHMuXG4gKi9cbmV4cG9ydCBjb25zdCAkdHlwc3QgPSBuZXcgVHlwc3RTbmlwcGV0KHtcbiAgY29tcGlsZXI6IFR5cHN0U25pcHBldC5idWlsZEdsb2JhbENvbXBpbGVyLFxuICByZW5kZXJlcjogVHlwc3RTbmlwcGV0LmJ1aWxkR2xvYmFsUmVuZGVyZXIsXG59KTtcbiJdfQ==","/// <reference lib=\"webworker\" />\nexport { };\nimport { createTypstCompiler } from '@myriaddreamin/typst.ts/compiler';\nimport { createTypstRenderer } from '@myriaddreamin/typst.ts/renderer';\nimport { TypstSnippet } from '@myriaddreamin/typst.ts/dist/esm/contrib/snippet.mjs';\n\ndeclare const self: DedicatedWorkerGlobalScope;\n\ntype OutputFormat = 'pdf' | 'svg' | 'canvas';\n\ntype CompileMessage = {\n    id: string;\n    type: 'compile';\n    payload: {\n        mainFilePath: string;\n        sources: Record<string, string | Uint8Array>;\n        format: OutputFormat;\n        pdfOptions?: {\n            pdfStandard?: string;\n            pdfTags?: boolean;\n            creationTimestamp?: number;\n        };\n    };\n};\n\ntype PingMessage = {\n    id: string;\n    type: 'ping';\n};\n\ntype InboundMessage = CompileMessage | PingMessage;\n\ntype DoneResponse = {\n    id: string;\n    type: 'done';\n    result: {\n        format: OutputFormat;\n        output: Uint8Array | string;\n        diagnostics?: any[];\n    };\n};\n\ntype PongResponse = {\n    id: string;\n    type: 'pong';\n};\n\ntype ErrorResponse = {\n    id: string;\n    type: 'error';\n    error: string;\n};\n\nlet compiler: any = null;\nlet renderer: any = null;\nlet initialized = false;\n\nconst defaultFonts = [\n    'DejaVuSansMono-Bold.ttf',\n    'DejaVuSansMono-BoldOblique.ttf',\n    'DejaVuSansMono-Oblique.ttf',\n    'DejaVuSansMono.ttf',\n    'LibertinusSerif-Bold.otf',\n    'LibertinusSerif-BoldItalic.otf',\n    'LibertinusSerif-Italic.otf',\n    'LibertinusSerif-Regular.otf',\n    'LibertinusSerif-Semibold.otf',\n    'LibertinusSerif-SemiboldItalic.otf',\n    'NewCM10-Bold.otf',\n    'NewCM10-BoldItalic.otf',\n    'NewCM10-Italic.otf',\n    'NewCM10-Regular.otf',\n    'NewCMMath-Bold.otf',\n    'NewCMMath-Book.otf',\n    'NewCMMath-Regular.otf',\n];\n\nasync function loadFonts(baseUrl: string = `/assets/fonts`) {\n    const fontPaths: string[] = [];\n\n    try {\n        const indexResponse = await fetch(`${baseUrl}/fonts.json`);\n        if (indexResponse.ok) {\n            const fontList = await indexResponse.json();\n            fontPaths.push(...fontList.map((font: string) => `${baseUrl}/${font}`));\n        }\n    } catch {\n        console.warn('fonts.json not found, using default font list');\n        fontPaths.push(...defaultFonts.map(font => `${baseUrl}/${font}`));\n    }\n\n    const fontPromises = fontPaths.map(async (path) => {\n        try {\n            const response = await fetch(path);\n            if (!response.ok) {\n                console.warn(`Failed to fetch font: ${path}`);\n                return null;\n            }\n            const buffer = await response.arrayBuffer();\n            return new Uint8Array(buffer);\n        } catch (err) {\n            console.warn(`Error loading font ${path}:`, err);\n            return null;\n        }\n    });\n    const fonts = await Promise.all(fontPromises);\n    return fonts.filter((f) => f !== null) as Uint8Array[];\n}\n\nasync function ensureInit() {\n    if (initialized) return;\n\n    const fonts = await loadFonts();\n    const packageRegistry = TypstSnippet.fetchPackageRegistry();\n\n    compiler = createTypstCompiler();\n\n    // TODO (fabawi): this is hard-coded for now. **NOT NEEDED ANYMORE**\n    // Need to add mechanism for re-initializing when pdf options change\n    // compiler.setPdfOpts({\n    //     pdf_standard: '\"2.0\"',\n    //     pdf_tags: false,\n    //     creation_timestamp: Math.floor(Date.now() / 1000)\n    // });\n\n    await compiler.init({\n        getModule: () => `/core/typst-ts-web-compiler/pkg/typst_ts_web_compiler_bg.wasm`,\n        beforeBuild: [\n            ...packageRegistry.provides,\n            async (_: any, { builder }: any) => {\n                for (const font of fonts) {\n                    await builder.add_raw_font(font);\n                }\n            }\n        ],\n    });\n\n    renderer = createTypstRenderer();\n    await renderer.init({\n        getModule: () => `/core/typst-ts-renderer/pkg/typst_ts_renderer_bg.wasm`,\n        beforeBuild: [\n            async (_: any, { builder }: any) => {\n                for (const font of fonts) {\n                    await builder.add_raw_font(font);\n                }\n            }\n        ],\n    });\n\n    initialized = true;\n}\n\nfunction getFormatArg(format: string): number {\n    switch (format) {\n        case 'vector':\n            return 0;\n        case 'pdf':\n            return 1;\n        default:\n            throw new Error(`Unsupported format: ${format}`);\n    }\n}\n\nself.addEventListener('message', async (e: MessageEvent<InboundMessage>) => {\n    const data = e.data;\n    const { id, type } = data;\n    try {\n        if (type === 'ping') {\n            const resp: PongResponse = { id, type: 'pong' };\n            self.postMessage(resp);\n            return;\n        }\n        await ensureInit();\n\n        const { payload } = data as CompileMessage;\n        const { mainFilePath, sources, format, pdfOptions } = payload;\n\n        compiler.resetShadow();\n        for (const [path, content] of Object.entries(sources)) {\n            const absolutePath = path.startsWith('/') ? path : `/${path}`;\n            if (typeof content === 'string') {\n                compiler.addSource(absolutePath, content);\n            } else {\n                compiler.mapShadow(absolutePath, content);\n            }\n        }\n        const absoluteMainPath =\n            mainFilePath.startsWith('/') ? mainFilePath : `/${mainFilePath}`;\n        let output: Uint8Array | string;\n        let diagnostics: any[] = [];\n\n        if (format === 'pdf') {\n            const pdfStandard = pdfOptions?.pdfStandard || '\"1.7\"';\n            const pdfTags = pdfOptions?.pdfTags !== undefined ? pdfOptions.pdfTags : true;\n            const creationTimestamp = pdfOptions?.creationTimestamp || Math.floor(Date.now() / 1000);\n\n            compiler.setPdfOptsForNextCompile({\n                pdf_standard: pdfStandard,\n                pdf_tags: pdfTags,\n                creation_timestamp: creationTimestamp\n            });\n\n            const compileResult = await compiler.compile({\n                mainFilePath: absoluteMainPath,\n                format: getFormatArg('pdf'),\n            });\n            console.log('[Typst Worker] Compile result:', compileResult);\n            console.log('[Typst Worker] Diagnostics:', compileResult.diagnostics);\n            output = compileResult.result as Uint8Array;\n            diagnostics = compileResult.diagnostics || [];\n            \n            if (!output || output.byteLength === 0) {\n                console.error('[Typst Worker] No output from compiler!');\n                throw new Error('Compiler returned empty output');\n            }\n        } else {\n            const compileResult = await compiler.compile({\n                mainFilePath: absoluteMainPath,\n                format: 'vector',\n            });\n            diagnostics = compileResult.diagnostics || [];\n\n            if (!compileResult.result || compileResult.result.byteLength === 0) {\n                const transferList: Transferable[] = [];\n                const resp: DoneResponse = {\n                    id,\n                    type: 'done',\n                    result: { format, output: new Uint8Array(0), diagnostics },\n                };\n                self.postMessage(resp, transferList);\n                return;\n            }\n\n            output = await renderer.renderSvg({\n                artifactContent: compileResult.result,\n            });\n        }\n\n        const transferList: Transferable[] =\n            output instanceof Uint8Array ? [output.buffer as ArrayBuffer] : [];\n        const resp: DoneResponse = {\n            id,\n            type: 'done',\n            result: { format, output, diagnostics },\n        };\n        self.postMessage(resp, transferList);\n    } catch (err: unknown) {\n        const message =\n            typeof err === 'object' && err && 'message' in err\n                ? String((err as any).message)\n                : String(err);\n        const resp: ErrorResponse = { id, type: 'error', error: message };\n        self.postMessage(resp);\n    }\n});\n"],"names":["ComponentBuilder","__publicField","fetcher","builder","fonts","escapeImport","fetchBuilder","FileSystemCache","cache","cachedFetcher","input","init","timeout","fontsToLoad","font","fontLists","loadFontSync","options","hooks","buildCtx","fn","buildComponent","gModule","Builder","_a","xhr","c","kObject","TypstDefaultParams","_textFonts","_cjkFonts","_emojiFonts","disableDefaultFontAssets","loadFonts","preloadFontAssets","_resolveAssets","_b","defaultPrefix","assetUrlPrefix","key","u","prefix","asset","f","userFonts","assetFonts","loader","_","ref","withPackageRegistry","packageRegistry","resolve","spec","withAccessModel","accessModel","ctx","path","lastModified","once","called","res","LazyWasmModule","initFn","module","CompileFormatEnum","IncrementalServer","s","enable","createTypstFontBuilder","TypstFontBuilderDriver","TypstWorld","world","opts","getDiagnosticsArg","gCompilerModule","bin","createTypstCompiler","TypstCompilerDriver","font_buffer","info","blob","cb","result","_TypstCompilerDriver","TypstCompilerBuilder","compilerOptions","beforeBuild","hasPreloadRemoteFonts","hasSpecifiedAssets","hasDisableAssets","convertInputs","srv","mainFilePath","source","content","inputs","diagnostics","RenderView","pageInfos","container","createOver","i","pageAst","commonDiv","width","height","canvas","semanticLayer","textLayer","textLayerParent","canvasDiv","containerWidth","originalScale","currentScale","PreviewMode","TypstDocumentContext","renderMode","previewMode","isContentPreview","retrieveDOMState","disposeList","x","mode","acc","facade","factors","wheelEventHandler","event","_c","_d","prevScaleRatio","scrollFactor","scrollX","scrollY","svg","scaleRatio","dataHeight","scaledHeight","svgWidth","svgHeight","svgUpdateEvent","eventName","doUpdate","t0","ctoken","needRerender","t1","t2","d","e","y","change","pushChange","provideDoc","Base","color","partialRendering","page","outline","composeDoc","mixins","mixin","TypstCancellationToken","resolveT","resolveX","animationFrame","TrackMode","RepaintStage","provideDomDoc","args","tmpl","pixelPerPt","data","task","cachedWindow","cachedBoundingRect","left","top","right","bottom","rect","domState","cancel","condOrExit","needFrame","pages","innerWidth","innerHeight","browserBBox","renderPage","v","needCalc","stage","repaint","calc","wScale","hScale","renderPages","inWindow","idx","TypstDomDocument","RenderSession","plugin","o","t","pages_info","pageCount","rect_lo_x","rect_lo_y","rect_hi_x","rect_hi_y","ManageStatus","TypstWorker","action","canvasElemList","m","elem","elemId","prev","entries","actions","elements","index","gRendererModule","createTypstRenderer","TypstRendererDriver","warnOnceCanvasSet","TypstRendererBuilder","_pack","rustOptions","encoded","session","sessionRef","reject","canvasList","page_count","doRender","page_off","textContentList","results","layerList","textSourceList","layer","t3","renderPageResults","mountContainer","doRenderDisplayLayer","resetLayout","backgroundColor","pageView","b","worker","parts","isRenderByContentOption","arg1","arg2","MemoryAccessModel","mtime","FetchPackageRegistry","am","request","context","previewDir","cacheClosure","randstr","isNode","TypstSnippet","cc","compiler","ex","providers","fontUrl","fontData","registry","provides","HttpPackageRegistry","fontInfos","fb","renderer","renderSession","destFile","rr","p","$typst","response","providers2","ccOptions","ccBeforeBuild","exOptions","exBeforeBuild","provider","role","createGlobalCompiler","createGlobalRenderer","initialized","defaultFonts","baseUrl","fontPaths","indexResponse","fontList","fontPromises","buffer","err","ensureInit","getFormatArg","format","id","type","resp","payload","sources","pdfOptions","absolutePath","absoluteMainPath","output","pdfStandard","pdfTags","creationTimestamp","compileResult","transferList","message"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13]}