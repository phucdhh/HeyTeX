{"id": "0", "text": "# üöÄ HeyTeX: The LaTeX & Typst Editor\n\n![License](https://img.shields.io/badge/license-AGPL--3.0-blue.svg)\n![Status](https://img.shields.io/badge/status-Alpha-orange.svg)\n![Build](https://img.shields.io/badge/build-passing-brightgreen.svg)\n![Wasm](https://img.shields.io/badge/powered%20by-WebAssembly-purple)\n\n**HeyTeX** l√† m·ªôt n·ªÅn t·∫£ng bi√™n t·∫≠p t√†i li·ªáu khoa h·ªçc tr·ª±c tuy·∫øn m√£ ngu·ªìn m·ªü, mang ƒë·∫øn tr·∫£i nghi·ªám gi·ªëng **Visual Studio Code** ngay tr√™n tr√¨nh duy·ªát.\n\nƒêi·ªÉm ƒë·∫∑c bi·ªát c·ªßa d·ª± √°n l√† kh·∫£ nƒÉng h·ªó tr·ª£ song song hai \"ƒë·ªông c∆°\" (engines): **LaTeX** (server-side TeXLive) v√† **Typst** (client-side Wasm), k·∫øt h·ª£p v·ªõi kh·∫£ nƒÉng l√†m vi·ªác nh√≥m th·ªùi gian th·ª±c (Real-time Collaboration).", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "1", "text": "ƒêi·ªÉm ƒë·∫∑c bi·ªát c·ªßa d·ª± √°n l√† kh·∫£ nƒÉng h·ªó tr·ª£ song song hai \"ƒë·ªông c∆°\" (engines): **LaTeX** (server-side TeXLive) v√† **Typst** (client-side Wasm), k·∫øt h·ª£p v·ªõi kh·∫£ nƒÉng l√†m vi·ªác nh√≥m th·ªùi gian th·ª±c (Real-time Collaboration).\n\n## ‚ú® T√≠nh NƒÉng Ch√≠nh (Key Features)\n\n### 1. üñ•Ô∏è Giao di·ªán IDE th√¢n thi·ªán (VS Code-like UI)\n*   S·ª≠ d·ª•ng **Monaco Editor** (l√µi c·ªßa VS Code) ƒë·ªÉ mang l·∫°i tr·∫£i nghi·ªám g√µ m√£ quen thu·ªôc.\n*   H·ªó tr·ª£ IntelliSense, t·ª± ƒë·ªông ho√†n th√†nh (Auto-completion), v√† Snippets cho c·∫£ LaTeX v√† Typst.\n*   Giao di·ªán thay ƒë·ªïi ƒë∆∞·ª£c (Dark Mode/ Light Mode) v√† t√πy ch·ªânh theme.", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "2", "text": "### 2. ‚ö° Dual-Engine Compilation (Hybrid)\nH·ªá th·ªëng bi√™n d·ªãch s·ª≠ d·ª•ng m√¥ h√¨nh h·ªón h·ª£p ƒë·ªÉ c√¢n b·∫±ng hi·ªáu nƒÉng v√† kh·∫£ nƒÉng t∆∞∆°ng th√≠ch:\n*   **LaTeX Project:** Bi√™n d·ªãch b·∫±ng TeXLive tr√™n server (server-side TeXLive)\n*   **Typst Project:** T√≠ch h·ª£p **Typst Wasm Renderer** ch·∫°y tr√™n tr√¨nh duy·ªát ƒë·ªÉ c√≥ ph·∫£n h·ªìi nhanh (client-side Wasm).", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "3", "text": "### 3. ü§ù Bi√™n t·∫≠p C·ªông t√°c Th·ªùi gian th·ª±c (Real-time Collaboration)\n*   Cho ph√©p nhi·ªÅu ng∆∞·ªùi d√πng c√πng ch·ªânh s·ª≠a m·ªôt t√†i li·ªáu c√πng l√∫c.\n*   Hi·ªÉn th·ªã con tr·ªè chu·ªôt c·ªßa ng∆∞·ªùi kh√°c theo th·ªùi gian th·ª±c.\n*   S·ª≠ d·ª•ng thu·∫≠t to√°n **CRDT** (Conflict-free Replicated Data Types) qua **Yjs** ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh to√†n v·∫πn d·ªØ li·ªáu.\n\n### 4. üîÑ SyncTeX & Live Preview\n*   **PDF Viewer t√≠ch h·ª£p:** Xem tr∆∞·ªõc k·∫øt qu·∫£ ngay b√™n c·∫°nh m√£ ngu·ªìn.\n*   **Reverse Sync (SyncTeX):** Click ƒë√∫p v√†o PDF ƒë·ªÉ nh·∫£y ƒë·∫øn d√≤ng code t∆∞∆°ng ·ª©ng v√† ng∆∞·ª£c l·∫°i.", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "4", "text": "### 4. üîÑ SyncTeX & Live Preview\n*   **PDF Viewer t√≠ch h·ª£p:** Xem tr∆∞·ªõc k·∫øt qu·∫£ ngay b√™n c·∫°nh m√£ ngu·ªìn.\n*   **Reverse Sync (SyncTeX):** Click ƒë√∫p v√†o PDF ƒë·ªÉ nh·∫£y ƒë·∫øn d√≤ng code t∆∞∆°ng ·ª©ng v√† ng∆∞·ª£c l·∫°i.\n\n### 5. üìÇ Qu·∫£n l√Ω D·ª± √°n Th√¥ng minh\n*   H·ªó tr·ª£ c·∫•u tr√∫c th∆∞ m·ª•c ƒëa c·∫•p.\n*   Import h√¨nh ·∫£nh/t√†i li·ªáu b·∫±ng c√°ch K√©o & Th·∫£ (Drag & Drop).\n\n---\n\n## üèóÔ∏è Ki·∫øn tr√∫c & C√¥ng ngh·ªá (Tech Stack)", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "5", "text": "### 5. üìÇ Qu·∫£n l√Ω D·ª± √°n Th√¥ng minh\n*   H·ªó tr·ª£ c·∫•u tr√∫c th∆∞ m·ª•c ƒëa c·∫•p.\n*   Import h√¨nh ·∫£nh/t√†i li·ªáu b·∫±ng c√°ch K√©o & Th·∫£ (Drag & Drop).\n\n---\n\n## üèóÔ∏è Ki·∫øn tr√∫c & C√¥ng ngh·ªá (Tech Stack)\n\n### Frontend\n*   **Framework:** [React.js](https://reactjs.org/) + [Vite](https://vitejs.dev/)\n*   **Editor Core:** [Monaco Editor](https://microsoft.github.io/monaco-editor/)\n*   **State Management:** [Zustand](https://github.com/pmndrs/zustand)\n*   **UI Components:** [Tailwind CSS](https://tailwindcss.com/) + [Shadcn/UI](https://ui.shadcn.com/)", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "6", "text": "### Frontend\n*   **Framework:** [React.js](https://reactjs.org/) + [Vite](https://vitejs.dev/)\n*   **Editor Core:** [Monaco Editor](https://microsoft.github.io/monaco-editor/)\n*   **State Management:** [Zustand](https://github.com/pmndrs/zustand)\n*   **UI Components:** [Tailwind CSS](https://tailwindcss.com/) + [Shadcn/UI](https://ui.shadcn.com/)\n\n### Compilation Engines (The Core)\n*   **LaTeX:** `texlive` (Server-side TeXLive; not a Wasm build).\n*   **Typst:** `@typst/compiler` (Official Wasm compiler, runs client-side).\n\n### Real-time Backend (Collab)\n*   **Protocol:** WebSocket.\n*   **Library:** [Yjs](https://github.com/yjs/yjs) (CRDT framework) + `y-websocket`.\n*   **Server:** Node.js (Express) ho·∫∑c Go (Gin).", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "7", "text": "### Compilation Engines (The Core)\n*   **LaTeX:** `texlive` (Server-side TeXLive; not a Wasm build).\n*   **Typst:** `@typst/compiler` (Official Wasm compiler, runs client-side).\n\n### Real-time Backend (Collab)\n*   **Protocol:** WebSocket.\n*   **Library:** [Yjs](https://github.com/yjs/yjs) (CRDT framework) + `y-websocket`.\n*   **Server:** Node.js (Express) ho·∫∑c Go (Gin).\n\n### Database & Storage\n*   **Metadata:** PostgreSQL (L∆∞u th√¥ng tin user, project setting).\n*   **File Storage:** AWS S3 / MinIO (L∆∞u tr·ªØ ·∫£nh, file assets).\n\n---\n\n## üõ†Ô∏è H∆∞·ªõng d·∫´n C√†i ƒë·∫∑t (Development)\n\n### Y√™u c·∫ßu\n*   Node.js >= 18.0.0\n*   Yarn ho·∫∑c NPM\n*   Docker (t√πy ch·ªçn cho backend)", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "8", "text": "### Database & Storage\n*   **Metadata:** PostgreSQL (L∆∞u th√¥ng tin user, project setting).\n*   **File Storage:** AWS S3 / MinIO (L∆∞u tr·ªØ ·∫£nh, file assets).\n\n---\n\n## üõ†Ô∏è H∆∞·ªõng d·∫´n C√†i ƒë·∫∑t (Development)\n\n### Y√™u c·∫ßu\n*   Node.js >= 18.0.0\n*   Yarn ho·∫∑c NPM\n*   Docker (t√πy ch·ªçn cho backend)\n\n### B∆∞·ªõc 1: Clone Repository\n```bash\ngit clone https://github.com/phucdhh/HeyTeX.git\ncd HeyTeX\n```\n\n### B∆∞·ªõc 2: C√†i ƒë·∫∑t Dependencies\n```bash\n# C√†i ƒë·∫∑t cho Frontend\ncd client\nnpm install\n\n# C√†i ƒë·∫∑t cho Backend (Collab Server)\ncd ../server\nnpm install\n```", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "9", "text": "### B∆∞·ªõc 1: Clone Repository\n```bash\ngit clone https://github.com/phucdhh/HeyTeX.git\ncd HeyTeX\n```\n\n### B∆∞·ªõc 2: C√†i ƒë·∫∑t Dependencies\n```bash\n# C√†i ƒë·∫∑t cho Frontend\ncd client\nnpm install\n\n# C√†i ƒë·∫∑t cho Backend (Collab Server)\ncd ../server\nnpm install\n```\n\n### B∆∞·ªõc 3: C·∫•u h√¨nh M√¥i tr∆∞·ªùng\nT·∫°o file .env trong th∆∞ m·ª•c client v√† server d·ª±a tr√™n file .env.example. ƒê·∫£m b·∫£o c·∫•u h√¨nh ƒë∆∞·ªùng d·∫´n t·ªõi TeXlyre Wasm assets.\n\n### B∆∞·ªõc 4: Ch·∫°y D·ª± √°n\n\n**macOS:**\n```bash\n# Setup l·∫ßn ƒë·∫ßu\n./setup-mac.sh\n\n# Services t·ª± ƒë·ªông start v·ªõi LaunchDaemon (sau khi reboot)\n# Xem chi ti·∫øt: LAUNCHDAEMON.md\n\n# Ho·∫∑c start th·ªß c√¥ng\n./start-services.sh\n```", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "10", "text": "### B∆∞·ªõc 4: Ch·∫°y D·ª± √°n\n\n**macOS:**\n```bash\n# Setup l·∫ßn ƒë·∫ßu\n./setup-mac.sh\n\n# Services t·ª± ƒë·ªông start v·ªõi LaunchDaemon (sau khi reboot)\n# Xem chi ti·∫øt: LAUNCHDAEMON.md\n\n# Ho·∫∑c start th·ªß c√¥ng\n./start-services.sh\n```\n\n**Development:**\n```bash\n# Terminal 1: Backend\ncd server && npm run dev\n\n# Terminal 2: Frontend  \ncd client && npm run dev\n```\n\nüìñ Xem th√™m: [SCRIPTS.md](SCRIPTS.md) - Danh s√°ch scripts & configs\n\n## Roadmap & ƒê·ªÅ xu·∫•t M·ªü r·ªông\nD∆∞·ªõi ƒë√¢y l√† c√°c t√≠nh nƒÉng d·ª± ki·∫øn s·∫Ω ph√°t tri·ªÉn th√™m:\n\n- [ ] T√≠ch h·ª£p Git: Commit, Push v√† Pull code tr·ª±c ti·∫øp t·ª´ GitHub/GitLab.", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "11", "text": "# Terminal 2: Frontend  \ncd client && npm run dev\n```\n\nüìñ Xem th√™m: [SCRIPTS.md](SCRIPTS.md) - Danh s√°ch scripts & configs\n\n## Roadmap & ƒê·ªÅ xu·∫•t M·ªü r·ªông\nD∆∞·ªõi ƒë√¢y l√† c√°c t√≠nh nƒÉng d·ª± ki·∫øn s·∫Ω ph√°t tri·ªÉn th√™m:\n\n- [ ] T√≠ch h·ª£p Git: Commit, Push v√† Pull code tr·ª±c ti·∫øp t·ª´ GitHub/GitLab.\n\n- [ ] AI Assistant: T√≠ch h·ª£p LLM (nh∆∞ OpenAI/Gemini) ƒë·ªÉ gi·∫£i th√≠ch l·ªói LaTeX ho·∫∑c g·ª£i √Ω vi·∫øt c√¥ng th·ª©c.\n\n- [ ] Offline Mode (PWA): Cho ph√©p bi√™n t·∫≠p v√† bi√™n d·ªãch c∆° b·∫£n ngay c·∫£ khi m·∫•t m·∫°ng (Service Workers).\n\n- [ ] Template Gallery: Th∆∞ vi·ªán m·∫´u cho b√°o c√°o, CV, lu·∫≠n vƒÉn (c·∫£ LaTeX v√† Typst).", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "12", "text": "- [ ] AI Assistant: T√≠ch h·ª£p LLM (nh∆∞ OpenAI/Gemini) ƒë·ªÉ gi·∫£i th√≠ch l·ªói LaTeX ho·∫∑c g·ª£i √Ω vi·∫øt c√¥ng th·ª©c.\n\n- [ ] Offline Mode (PWA): Cho ph√©p bi√™n t·∫≠p v√† bi√™n d·ªãch c∆° b·∫£n ngay c·∫£ khi m·∫•t m·∫°ng (Service Workers).\n\n- [ ] Template Gallery: Th∆∞ vi·ªán m·∫´u cho b√°o c√°o, CV, lu·∫≠n vƒÉn (c·∫£ LaTeX v√† Typst).\n\n- [ ] Export Options: Xu·∫•t ra PDF, HTML, v√† ePub.\n\n## üí° C√°c ƒë·ªÅ xu·∫•t cho ki·∫øn tr√∫c c·ªßa HeyTeX", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "13", "text": "- [ ] Template Gallery: Th∆∞ vi·ªán m·∫´u cho b√°o c√°o, CV, lu·∫≠n vƒÉn (c·∫£ LaTeX v√† Typst).\n\n- [ ] Export Options: Xu·∫•t ra PDF, HTML, v√† ePub.\n\n## üí° C√°c ƒë·ªÅ xu·∫•t cho ki·∫øn tr√∫c c·ªßa HeyTeX\n\n1.  **X·ª≠ l√Ω WebAssembly (Wasm):**\n    *   File `.wasm` ch·ªß y·∫øu li√™n quan ƒë·∫øn **Typst** (client-side). B·∫°n n√™n s·ª≠ d·ª•ng **Service Workers** ƒë·ªÉ cache file n√†y ngay l·∫ßn t·∫£i ƒë·∫ßu ti√™n, gi√∫p ng∆∞·ªùi d√πng kh√¥ng ph·∫£i t·∫£i l·∫°i m·ªói l·∫ßn F5 trang.\n    *   S·ª≠ d·ª•ng **Web Workers** ƒë·ªÉ ch·∫°y qu√° tr√¨nh bi√™n d·ªãch Typst ·ªü m·ªôt lu·ªìng ri√™ng (background thread), tr√°nh l√†m ƒë∆° giao di·ªán UI khi ƒëang bi√™n d·ªãch t√†i li·ªáu l·ªõn.", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "14", "text": "2.  **C∆° ch·∫ø l∆∞u tr·ªØ (Persistence):**\n    *   V√¨ b·∫°n cho ph√©p c·ªông t√°c (collaboration), b·∫°n kh√¥ng th·ªÉ ch·ªâ l∆∞u file c·ª•c b·ªô tr√™n tr√¨nh duy·ªát. B·∫°n c·∫ßn m·ªôt c∆° ch·∫ø ƒë·ªÉ ƒë·ªìng b·ªô tr·∫°ng th√°i `Yjs` (t·ª´ RAM) v√†o Database ƒë·ªãnh k·ª≥ (Persistence Layer) ƒë·ªÉ d·ªØ li·ªáu kh√¥ng b·ªã m·∫•t khi t·∫•t c·∫£ ng∆∞·ªùi d√πng tho√°t kh·ªèi ph√≤ng.\n\n3.  **Typst Optimization:**\n    *   Typst c√≥ t√≠nh nƒÉng **Incremental Compilation** (Bi√™n d·ªãch tƒÉng d·∫ßn). H√£y ƒë·∫£m b·∫£o frontend c·ªßa b·∫°n ch·ªâ g·ª≠i ph·∫ßn \"delta\" (ph·∫ßn thay ƒë·ªïi) cho b·ªô bi√™n d·ªãch Wasm thay v√¨ g·ª≠i to√†n b·ªô n·ªôi dung file m·ªói l·∫ßn g√µ ph√≠m.", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "15", "text": "3.  **Typst Optimization:**\n    *   Typst c√≥ t√≠nh nƒÉng **Incremental Compilation** (Bi√™n d·ªãch tƒÉng d·∫ßn). H√£y ƒë·∫£m b·∫£o frontend c·ªßa b·∫°n ch·ªâ g·ª≠i ph·∫ßn \"delta\" (ph·∫ßn thay ƒë·ªïi) cho b·ªô bi√™n d·ªãch Wasm thay v√¨ g·ª≠i to√†n b·ªô n·ªôi dung file m·ªói l·∫ßn g√µ ph√≠m.\n\n4.  **B·∫£o m·∫≠t:**\n    *   M·∫∑c d√π bi√™n d·ªãch di·ªÖn ra ·ªü ph√≠a client (tr√¨nh duy·ªát), nh∆∞ng vi·ªác upload ·∫£nh ho·∫∑c file PDF ƒë·∫ßu ra v·∫´n c·∫ßn ki·ªÉm so√°t ch·∫∑t ch·∫Ω quy·ªÅn truy c·∫≠p (ACL) tr√™n S3/MinIO.\n\n## ü§ù ƒê√≥ng g√≥p (Contributing)\nCh√∫ng t√¥i hoan ngh√™nh m·ªçi ƒë√≥ng g√≥p! Vui l√≤ng ƒë·ªçc file CONTRIBUTING.md ƒë·ªÉ bi·∫øt quy tr√¨nh Pull Request.", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "16", "text": "## ü§ù ƒê√≥ng g√≥p (Contributing)\nCh√∫ng t√¥i hoan ngh√™nh m·ªçi ƒë√≥ng g√≥p! Vui l√≤ng ƒë·ªçc file CONTRIBUTING.md ƒë·ªÉ bi·∫øt quy tr√¨nh Pull Request.\n\n## üìö C√°c d·ª± √°n tham kh·∫£o (References)\n\nHeyTeX ƒë∆∞·ª£c x√¢y d·ª±ng d·ª±a tr√™n c√°c d·ª± √°n m√£ ngu·ªìn m·ªü sau:\n\n- **[TeXlyre](https://github.com/texlyre/texlyre)** - Web-based LaTeX editor with WebAssembly\n- **[TeXlyre Infrastructure](https://github.com/texlyre/texlyre-infrastructure)** - Docker deployment infrastructure\n- **[WASM LaTeX Tools](https://github.com/SwiftLaTeX/wasm-latex-tools)** - WebAssembly compilation tools\n- **[TeXlyre Documentation](https://texlyre.github.io/)** - Official documentation\n\n## üìÑ License", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "17", "text": "- **[TeXlyre](https://github.com/texlyre/texlyre)** - Web-based LaTeX editor with WebAssembly\n- **[TeXlyre Infrastructure](https://github.com/texlyre/texlyre-infrastructure)** - Docker deployment infrastructure\n- **[WASM LaTeX Tools](https://github.com/SwiftLaTeX/wasm-latex-tools)** - WebAssembly compilation tools\n- **[TeXlyre Documentation](https://texlyre.github.io/)** - Official documentation\n\n## üìÑ License\n\nD·ª± √°n n√†y ƒë∆∞·ª£c c·∫•p ph√©p d∆∞·ªõi [GNU Affero General Public License v3.0 (AGPL-3.0)](LICENSE).\n\nAGPL-3.0 y√™u c·∫ßu:\n- C√¥ng khai m√£ ngu·ªìn khi tri·ªÉn khai d·ªãch v·ª• tr·ª±c tuy·∫øn\n- C√°c s·∫£n ph·∫©m ph√°i sinh ph·∫£i s·ª≠ d·ª•ng c√πng gi·∫•y ph√©p\n- B·∫£o v·ªá quy·ªÅn t·ª± do ph·∫ßn m·ªÅm cho c·ªông ƒë·ªìng", "metadata": {"file_path": "README.md", "file_name": "README.md", "creation_date": "2025-12-07", "last_modified_date": "2025-12-20"}}
{"id": "18", "text": "# HeyTeX - H∆∞·ªõng D·∫´n Deploy v·ªõi TeXLive Server-side Compilation\n\n## üéØ T·ªïng Quan Thay ƒê·ªïi\n\nHeyTeX gi·ªù ƒë√¢y s·ª≠ d·ª•ng **TeXLive server-side compilation** thay v√¨ SwiftTeX WASM ƒë·ªÉ c√≥ ƒë·ªô t∆∞∆°ng th√≠ch cao h∆°n v√† h·ªó tr·ª£ ƒë·∫ßy ƒë·ªß c√°c packages LaTeX.\n\n### ∆Øu ƒêi·ªÉm\n- ‚úÖ **ƒê·ªô t∆∞∆°ng th√≠ch cao**: TeXLive full h·ªó tr·ª£ ƒë·∫ßy ƒë·ªß packages\n- ‚úÖ **D·ªÖ c√†i th√™m packages**: Ch·ªâ c·∫ßn apt/tlmgr trong Docker\n- ‚úÖ **Compilation queue**: Qu·∫£n l√Ω t·∫£i server hi·ªáu qu·∫£\n- ‚úÖ **Gi·ªõi h·∫°n concurrent**: Max 10 bi√™n d·ªãch ƒë·ªìng th·ªùi (tu·ª≥ ch·ªânh ƒë∆∞·ª£c)\n- ‚úÖ **UI feedback**: Hi·ªÉn th·ªã s·ªë ng∆∞·ªùi ƒëang bi√™n d·ªãch/ch·ªù\n\n### Ki·∫øn Tr√∫c M·ªõi", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "19", "text": "### Ki·∫øn Tr√∫c M·ªõi\n\n```\n‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      HTTP API        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n‚îÇ   Frontend  ‚îÇ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂   ‚îÇ   Backend API    ‚îÇ\n‚îÇ   (React)   ‚îÇ                      ‚îÇ   (Node + TS)    ‚îÇ\n‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                              ‚îÇ\n                                              ‚îÇ Queue Manager\n                                              ‚ñº\n                                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                                     ‚îÇ Compilation      ‚îÇ\n                                     ‚îÇ Queue Service    ‚îÇ\n                                     ‚îÇ (Max 10 jobs)    ‚îÇ\n                                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n                                              ‚îÇ\n                                              ‚îÇ exec xelatex\n                                              ‚ñº\n                                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê\n                                     ‚îÇ   TeXLive Full   ‚îÇ\n                                     ‚îÇ   (in Docker)    ‚îÇ\n                                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò\n```\n\n## üìã Y√™u C·∫ßu H·ªá Th·ªëng", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "20", "text": "## üìã Y√™u C·∫ßu H·ªá Th·ªëng\n\n### Ph·∫ßn C·ª©ng\n- **CPU**: 4+ cores (khuy·∫øn ngh·ªã 8 cores cho 10 concurrent compilations)\n- **RAM**: 24GB (Mac Mini M2 hi·ªán t·∫°i l√† l√Ω t∆∞·ªüng)\n- **Disk**: 20GB+ (TeXLive full ~6GB)\n\n### Ph·∫ßn M·ªÅm\n- Docker & Docker Compose\n- Node.js 20+ (n·∫øu ch·∫°y local)\n- PostgreSQL 15+\n- MinIO\n\n## üöÄ H∆∞·ªõng D·∫´n Deploy\n\n### 1. Clone Repository\n\n```bash\ncd /Users/mac/heytex\n```\n\n### 2. C·∫•u H√¨nh Environment\n\n```bash\n# Copy file .env m·∫´u\ncp .env.example .env\n\n# Ch·ªânh s·ª≠a c√°c bi·∫øn m√¥i tr∆∞·ªùng\nnano .env\n```\n\nC√°c bi·∫øn quan tr·ªçng:\n```env\n# Database\nPOSTGRES_PASSWORD=your_secure_password\n\n# MinIO\nMINIO_ROOT_PASSWORD=your_minio_password", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "21", "text": "## üöÄ H∆∞·ªõng D·∫´n Deploy\n\n### 1. Clone Repository\n\n```bash\ncd /Users/mac/heytex\n```\n\n### 2. C·∫•u H√¨nh Environment\n\n```bash\n# Copy file .env m·∫´u\ncp .env.example .env\n\n# Ch·ªânh s·ª≠a c√°c bi·∫øn m√¥i tr∆∞·ªùng\nnano .env\n```\n\nC√°c bi·∫øn quan tr·ªçng:\n```env\n# Database\nPOSTGRES_PASSWORD=your_secure_password\n\n# MinIO\nMINIO_ROOT_PASSWORD=your_minio_password\n\n# JWT Secret\nJWT_SECRET=your-super-secret-jwt-key-change-this\n\n# CORS (n·∫øu frontend kh√°c domain)\nCORS_ORIGIN=http://localhost:5173\n```\n\n### 3. Build v√† Kh·ªüi ƒê·ªông Services\n\n```bash\n# Build t·∫•t c·∫£ images\ndocker-compose build\n\n# Kh·ªüi ƒë·ªông t·∫•t c·∫£ services\ndocker-compose up -d\n\n# Ki·ªÉm tra logs\ndocker-compose logs -f backend\n```\n\n### 4. Kh·ªüi T·∫°o Database", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "22", "text": "# MinIO\nMINIO_ROOT_PASSWORD=your_minio_password\n\n# JWT Secret\nJWT_SECRET=your-super-secret-jwt-key-change-this\n\n# CORS (n·∫øu frontend kh√°c domain)\nCORS_ORIGIN=http://localhost:5173\n```\n\n### 3. Build v√† Kh·ªüi ƒê·ªông Services\n\n```bash\n# Build t·∫•t c·∫£ images\ndocker-compose build\n\n# Kh·ªüi ƒë·ªông t·∫•t c·∫£ services\ndocker-compose up -d\n\n# Ki·ªÉm tra logs\ndocker-compose logs -f backend\n```\n\n### 4. Kh·ªüi T·∫°o Database\n\n```bash\n# V√†o container backend\ndocker exec -it heytex-backend sh\n\n# Ch·∫°y migration\nnpx prisma migrate deploy\n\n# T·∫°o MinIO buckets (n·∫øu c·∫ßn)\n```\n\n### 5. Ki·ªÉm Tra Services\n\n```bash\n# Backend health check\ncurl http://localhost:5433/health\n\n# Queue stats\ncurl http://localhost:5433/api/compile/stats\n\n# PostgreSQL\npsql -h localhost -U heytex -d heytex", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "23", "text": "### 4. Kh·ªüi T·∫°o Database\n\n```bash\n# V√†o container backend\ndocker exec -it heytex-backend sh\n\n# Ch·∫°y migration\nnpx prisma migrate deploy\n\n# T·∫°o MinIO buckets (n·∫øu c·∫ßn)\n```\n\n### 5. Ki·ªÉm Tra Services\n\n```bash\n# Backend health check\ncurl http://localhost:5433/health\n\n# Queue stats\ncurl http://localhost:5433/api/compile/stats\n\n# PostgreSQL\npsql -h localhost -U heytex -d heytex\n\n# MinIO console\nopen http://localhost:9001\n```\n\n## üèóÔ∏è C·∫•u Tr√∫c Docker\n\n### Services\n\n1. **postgres**: PostgreSQL 15 database\n   - Port: 5432\n   - Volume: `postgres_data`\n\n2. **minio**: Object storage cho files/assets\n   - Port: 5434 (API), 9001 (Console)\n   - Volume: `minio_data`", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "24", "text": "# PostgreSQL\npsql -h localhost -U heytex -d heytex\n\n# MinIO console\nopen http://localhost:9001\n```\n\n## üèóÔ∏è C·∫•u Tr√∫c Docker\n\n### Services\n\n1. **postgres**: PostgreSQL 15 database\n   - Port: 5432\n   - Volume: `postgres_data`\n\n2. **minio**: Object storage cho files/assets\n   - Port: 5434 (API), 9001 (Console)\n   - Volume: `minio_data`\n\n3. **backend**: Node.js API + TeXLive\n   - Port: 5433\n   - TeXLive Full included\n   - Compilation queue v·ªõi max 10 concurrent\n   - Volume: `compile_temp` cho temporary files\n\n4. **frontend**: React app (optional)\n   - Port: 5173 (ho·∫∑c 80)\n   - Nginx serve static files\n\n## ‚öôÔ∏è Tu·ª≥ Ch·ªânh Compilation Queue\n\n### Thay ƒê·ªïi Max Concurrent Jobs\n\nM·ªü file `server/src/services/CompilationQueue.ts`:", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "25", "text": "3. **backend**: Node.js API + TeXLive\n   - Port: 5433\n   - TeXLive Full included\n   - Compilation queue v·ªõi max 10 concurrent\n   - Volume: `compile_temp` cho temporary files\n\n4. **frontend**: React app (optional)\n   - Port: 5173 (ho·∫∑c 80)\n   - Nginx serve static files\n\n## ‚öôÔ∏è Tu·ª≥ Ch·ªânh Compilation Queue\n\n### Thay ƒê·ªïi Max Concurrent Jobs\n\nM·ªü file `server/src/services/CompilationQueue.ts`:\n\n```typescript\nprivate readonly maxConcurrent: number = 10; // Thay ƒë·ªïi s·ªë n√†y\n```\n\nKhuy·∫øn ngh·ªã:\n- **Mac Mini M2 24GB**: 10 jobs\n- **Server 32GB RAM**: 12-15 jobs\n- **Server 64GB RAM**: 20+ jobs\n\n### Thay ƒê·ªïi Cleanup Timeout\n\n```typescript\n// Cleanup sau 30 ph√∫t -> Thay ƒë·ªïi\nsetTimeout(() => {\n    this.cleanupJob(job.id);\n}, 30 * 60 * 1000); // milliseconds\n```", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "26", "text": "```typescript\nprivate readonly maxConcurrent: number = 10; // Thay ƒë·ªïi s·ªë n√†y\n```\n\nKhuy·∫øn ngh·ªã:\n- **Mac Mini M2 24GB**: 10 jobs\n- **Server 32GB RAM**: 12-15 jobs\n- **Server 64GB RAM**: 20+ jobs\n\n### Thay ƒê·ªïi Cleanup Timeout\n\n```typescript\n// Cleanup sau 30 ph√∫t -> Thay ƒë·ªïi\nsetTimeout(() => {\n    this.cleanupJob(job.id);\n}, 30 * 60 * 1000); // milliseconds\n```\n\n## üîç Monitoring\n\n### Xem Queue Stats\n\n```bash\n# Real-time queue status\ncurl http://localhost:5433/api/compile/stats\n\n# Output:\n{\n  \"success\": true,\n  \"stats\": {\n    \"compiling\": 3,\n    \"queued\": 5,\n    \"total\": 8,\n    \"available\": 7\n  }\n}\n```\n\n### Logs\n\n```bash\n# Backend logs\ndocker-compose logs -f backend\n\n# Compilation errors\ndocker exec heytex-backend cat /tmp/heytex-compile/<job-id>/compile.log", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "27", "text": "## üîç Monitoring\n\n### Xem Queue Stats\n\n```bash\n# Real-time queue status\ncurl http://localhost:5433/api/compile/stats\n\n# Output:\n{\n  \"success\": true,\n  \"stats\": {\n    \"compiling\": 3,\n    \"queued\": 5,\n    \"total\": 8,\n    \"available\": 7\n  }\n}\n```\n\n### Logs\n\n```bash\n# Backend logs\ndocker-compose logs -f backend\n\n# Compilation errors\ndocker exec heytex-backend cat /tmp/heytex-compile/<job-id>/compile.log\n\n# PostgreSQL logs\ndocker-compose logs -f postgres\n```\n\n## üõ†Ô∏è Development\n\n### Ch·∫°y Local (Kh√¥ng Docker)\n\n```bash\n# Backend\ncd server\nnpm install\nnpm run dev\n\n# C√†i TeXLive local\nbrew install texlive  # macOS\n# ho·∫∑c apt-get install texlive-full  # Ubuntu\n\n# Frontend\ncd client\nnpm install\nnpm run dev\n```\n\n### Test Compilation API", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "28", "text": "# Compilation errors\ndocker exec heytex-backend cat /tmp/heytex-compile/<job-id>/compile.log\n\n# PostgreSQL logs\ndocker-compose logs -f postgres\n```\n\n## üõ†Ô∏è Development\n\n### Ch·∫°y Local (Kh√¥ng Docker)\n\n```bash\n# Backend\ncd server\nnpm install\nnpm run dev\n\n# C√†i TeXLive local\nbrew install texlive  # macOS\n# ho·∫∑c apt-get install texlive-full  # Ubuntu\n\n# Frontend\ncd client\nnpm install\nnpm run dev\n```\n\n### Test Compilation API\n\n```bash\n# Submit job\ncurl -X POST http://localhost:5433/api/compile \\\n  -H \"Authorization: Bearer YOUR_JWT_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"fileName\": \"test.tex\",\n    \"content\": \"\\\\documentclass{article}\\\\begin{document}Hello World\\\\end{document}\"\n  }'\n\n# Check status\ncurl http://localhost:5433/api/compile/JOB_ID \\\n  -H \"Authorization: Bearer YOUR_JWT_TOKEN\"", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "29", "text": "### Test Compilation API\n\n```bash\n# Submit job\ncurl -X POST http://localhost:5433/api/compile \\\n  -H \"Authorization: Bearer YOUR_JWT_TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"fileName\": \"test.tex\",\n    \"content\": \"\\\\documentclass{article}\\\\begin{document}Hello World\\\\end{document}\"\n  }'\n\n# Check status\ncurl http://localhost:5433/api/compile/JOB_ID \\\n  -H \"Authorization: Bearer YOUR_JWT_TOKEN\"\n\n# Download PDF\ncurl http://localhost:5433/api/compile/JOB_ID/pdf \\\n  -H \"Authorization: Bearer YOUR_JWT_TOKEN\" \\\n  -o output.pdf\n```\n\n## üìä Performance Tips\n\n### 1. TƒÉng RAM cho Docker Desktop (macOS)\n\n```bash\n# Settings > Resources > Memory\n# Khuy·∫øn ngh·ªã: 16GB+ cho Mac Mini M2 24GB\n```\n\n### 2. T·ªëi ∆Øu TeXLive Installation", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "30", "text": "# Download PDF\ncurl http://localhost:5433/api/compile/JOB_ID/pdf \\\n  -H \"Authorization: Bearer YOUR_JWT_TOKEN\" \\\n  -o output.pdf\n```\n\n## üìä Performance Tips\n\n### 1. TƒÉng RAM cho Docker Desktop (macOS)\n\n```bash\n# Settings > Resources > Memory\n# Khuy·∫øn ngh·ªã: 16GB+ cho Mac Mini M2 24GB\n```\n\n### 2. T·ªëi ∆Øu TeXLive Installation\n\nTrong `server/Dockerfile`, c√≥ th·ªÉ ch·ªçn c√†i m·ªôt s·ªë packages thay v√¨ `texlive-full`:\n\n```dockerfile\n# Thay v√¨ texlive-full (6GB):\nRUN apt-get install -y \\\n    texlive-base \\\n    texlive-xetex \\\n    texlive-fonts-recommended \\\n    texlive-latex-extra\n```\n\n### 3. Database Connection Pool\n\nFile `server/src/lib/prisma.ts` - tƒÉng connection pool:", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "31", "text": "### 2. T·ªëi ∆Øu TeXLive Installation\n\nTrong `server/Dockerfile`, c√≥ th·ªÉ ch·ªçn c√†i m·ªôt s·ªë packages thay v√¨ `texlive-full`:\n\n```dockerfile\n# Thay v√¨ texlive-full (6GB):\nRUN apt-get install -y \\\n    texlive-base \\\n    texlive-xetex \\\n    texlive-fonts-recommended \\\n    texlive-latex-extra\n```\n\n### 3. Database Connection Pool\n\nFile `server/src/lib/prisma.ts` - tƒÉng connection pool:\n\n```typescript\ndatasources: {\n  db: {\n    url: process.env.DATABASE_URL\n    // Th√™m:\n    // poolSize: 20\n  }\n}\n```\n\n## üîí Security\n\n### Production Checklist\n\n- [ ] ƒê·ªïi t·∫•t c·∫£ passwords trong `.env`\n- [ ] Set `NODE_ENV=production`\n- [ ] Enable HTTPS v·ªõi reverse proxy (nginx/traefik)\n- [ ] Gi·ªõi h·∫°n rate limiting cho API\n- [ ] Backup database ƒë·ªãnh k·ª≥\n- [ ] Monitor disk space cho `compile_temp`", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "32", "text": "```typescript\ndatasources: {\n  db: {\n    url: process.env.DATABASE_URL\n    // Th√™m:\n    // poolSize: 20\n  }\n}\n```\n\n## üîí Security\n\n### Production Checklist\n\n- [ ] ƒê·ªïi t·∫•t c·∫£ passwords trong `.env`\n- [ ] Set `NODE_ENV=production`\n- [ ] Enable HTTPS v·ªõi reverse proxy (nginx/traefik)\n- [ ] Gi·ªõi h·∫°n rate limiting cho API\n- [ ] Backup database ƒë·ªãnh k·ª≥\n- [ ] Monitor disk space cho `compile_temp`\n\n### Reverse Proxy v·ªõi Nginx\n\n```nginx\n# /etc/nginx/sites-available/heytex\nserver {\n    listen 80;\n    server_name heytex.yourdomain.com;\n\n    location / {\n        proxy_pass http://localhost:5173;\n    }\n\n    location /api {\n        proxy_pass http://localhost:5433;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n    }\n}\n```\n\n## üêõ Troubleshooting\n\n### Backend kh√¥ng start", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "33", "text": "### Reverse Proxy v·ªõi Nginx\n\n```nginx\n# /etc/nginx/sites-available/heytex\nserver {\n    listen 80;\n    server_name heytex.yourdomain.com;\n\n    location / {\n        proxy_pass http://localhost:5173;\n    }\n\n    location /api {\n        proxy_pass http://localhost:5433;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection 'upgrade';\n    }\n}\n```\n\n## üêõ Troubleshooting\n\n### Backend kh√¥ng start\n\n```bash\n# Check logs\ndocker-compose logs backend\n\n# Common issues:\n# 1. PostgreSQL ch∆∞a ready\ndocker-compose ps postgres\n\n# 2. Port conflict\nlsof -i :5433\n\n# 3. TeXLive installation failed\ndocker exec heytex-backend xelatex --version\n```\n\n### Compilation fails\n\n```bash\n# V√†o container\ndocker exec -it heytex-backend bash\n\n# Test xelatex\necho \"\\\\documentclass{article}\\\\begin{document}Test\\\\end{document}\" > test.tex\nxelatex test.tex", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "34", "text": "# Common issues:\n# 1. PostgreSQL ch∆∞a ready\ndocker-compose ps postgres\n\n# 2. Port conflict\nlsof -i :5433\n\n# 3. TeXLive installation failed\ndocker exec heytex-backend xelatex --version\n```\n\n### Compilation fails\n\n```bash\n# V√†o container\ndocker exec -it heytex-backend bash\n\n# Test xelatex\necho \"\\\\documentclass{article}\\\\begin{document}Test\\\\end{document}\" > test.tex\nxelatex test.tex\n\n# Check packages\ntlmgr list --installed\n```\n\n### Database migration errors\n\n```bash\n# Reset database\ndocker-compose down -v\ndocker-compose up -d postgres\ndocker exec -it heytex-backend npx prisma migrate reset\n```\n\n## üìù Notes", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "35", "text": "### Compilation fails\n\n```bash\n# V√†o container\ndocker exec -it heytex-backend bash\n\n# Test xelatex\necho \"\\\\documentclass{article}\\\\begin{document}Test\\\\end{document}\" > test.tex\nxelatex test.tex\n\n# Check packages\ntlmgr list --installed\n```\n\n### Database migration errors\n\n```bash\n# Reset database\ndocker-compose down -v\ndocker-compose up -d postgres\ndocker exec -it heytex-backend npx prisma migrate reset\n```\n\n## üìù Notes\n\n- **Typst projects**: V·∫´n s·ª≠ d·ª•ng WASM client-side compilation (kh√¥ng ƒë·ªïi)\n- **LaTeX projects**: T·ª± ƒë·ªông s·ª≠ d·ª•ng server-side TeXLive compilation\n- **Cleanup**: Temporary files t·ª± ƒë·ªông xo√° sau 30 ph√∫t\n- **Queue**: Frontend t·ª± ƒë·ªông poll stats m·ªói 3 gi√¢y\n\n## üîÑ Migration t·ª´ WASM", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "36", "text": "## üìù Notes\n\n- **Typst projects**: V·∫´n s·ª≠ d·ª•ng WASM client-side compilation (kh√¥ng ƒë·ªïi)\n- **LaTeX projects**: T·ª± ƒë·ªông s·ª≠ d·ª•ng server-side TeXLive compilation\n- **Cleanup**: Temporary files t·ª± ƒë·ªông xo√° sau 30 ph√∫t\n- **Queue**: Frontend t·ª± ƒë·ªông poll stats m·ªói 3 gi√¢y\n\n## üîÑ Migration t·ª´ WASM\n\nN·∫øu ƒëang c√≥ project WASM c≈©, kh√¥ng c·∫ßn migration. Frontend t·ª± ƒë·ªông detect v√† s·ª≠ d·ª•ng ƒë√∫ng compilation method d·ª±a tr√™n `project.engine` field.\n\n## üìû Support\n\n- Issues: GitHub Issues\n- Docs: `/documents/` folder\n- Logs: Docker logs ho·∫∑c `/tmp/heytex-*.log`\n\n---\n\n**C·∫≠p nh·∫≠t**: December 2025 - TeXLive Server-side Compilation Implementation", "metadata": {"file_path": "DEPLOYMENT.md", "file_name": "DEPLOYMENT.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "37", "text": "# üìù T√≥m T·∫Øt Thay ƒê·ªïi: Chuy·ªÉn Sang TeXLive Server-side Compilation\n\n## üéØ M·ª•c Ti√™u ƒê·∫°t ƒê∆∞·ª£c\n\nChuy·ªÉn t·ª´ SwiftTeX WASM (client-side) sang TeXLive server-side compilation ƒë·ªÉ:\n- ‚úÖ Gi·∫£m l·ªói bi√™n d·ªãch do gi·ªõi h·∫°n c·ªßa WASM\n- ‚úÖ H·ªó tr·ª£ ƒë·∫ßy ƒë·ªß packages LaTeX\n- ‚úÖ D·ªÖ c√†i th√™m packages (ch·ªâ c·∫ßn update Dockerfile)\n- ‚úÖ Qu·∫£n l√Ω t·∫£i server v·ªõi queue system\n- ‚úÖ Hi·ªÉn th·ªã tr·∫°ng th√°i queue cho user\n\n## üì¶ Files ƒê√£ T·∫°o M·ªõi\n\n### Backend\n1. **`server/src/services/CompilationQueue.ts`**\n   - Service qu·∫£n l√Ω queue compilation\n   - Max 10 concurrent jobs (configurable)\n   - Auto cleanup after 30 minutes\n   - Support xelatex compilation", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "38", "text": "## üì¶ Files ƒê√£ T·∫°o M·ªõi\n\n### Backend\n1. **`server/src/services/CompilationQueue.ts`**\n   - Service qu·∫£n l√Ω queue compilation\n   - Max 10 concurrent jobs (configurable)\n   - Auto cleanup after 30 minutes\n   - Support xelatex compilation\n\n2. **`server/src/routes/compile.ts`**\n   - `POST /api/compile` - Submit job\n   - `GET /api/compile/:jobId` - Get status\n   - `GET /api/compile/:jobId/pdf` - Download PDF\n   - `GET /api/compile/:jobId/log` - Get compilation log\n   - `GET /api/compile/stats` - Queue statistics\n\n3. **`server/Dockerfile`**\n   - Ubuntu 22.04 base\n   - Node.js 20\n   - TeXLive Full installation\n   - XeTeX, fonts, CJK support\n\n4. **`server/.dockerignore`**\n   - Optimize Docker build context", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "39", "text": "3. **`server/Dockerfile`**\n   - Ubuntu 22.04 base\n   - Node.js 20\n   - TeXLive Full installation\n   - XeTeX, fonts, CJK support\n\n4. **`server/.dockerignore`**\n   - Optimize Docker build context\n\n### Frontend\n5. **`client/src/api/compilation.ts`**\n   - API client cho compilation service\n   - Methods: submitJob, getJobStatus, getPDF, getLog, getStats\n   - Support polling v·ªõi callback\n\n### Docker Infrastructure\n6. **`docker-compose.yml`**\n   - PostgreSQL service\n   - MinIO service\n   - Backend service v·ªõi TeXLive\n   - Frontend service (optional)\n   - Health checks cho t·∫•t c·∫£ services\n\n7. **`client/Dockerfile`**\n   - Multi-stage build\n   - Nginx serve static files\n\n8. **`client/nginx.conf`**\n   - SPA routing\n   - Gzip compression\n   - Cache headers", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "40", "text": "### Docker Infrastructure\n6. **`docker-compose.yml`**\n   - PostgreSQL service\n   - MinIO service\n   - Backend service v·ªõi TeXLive\n   - Frontend service (optional)\n   - Health checks cho t·∫•t c·∫£ services\n\n7. **`client/Dockerfile`**\n   - Multi-stage build\n   - Nginx serve static files\n\n8. **`client/nginx.conf`**\n   - SPA routing\n   - Gzip compression\n   - Cache headers\n\n### Documentation\n9. **`DEPLOYMENT.md`**\n   - H∆∞·ªõng d·∫´n deploy ƒë·∫ßy ƒë·ªß\n   - Monitoring v√† troubleshooting\n   - Performance tips\n   - Security checklist\n\n## üîß Files ƒê√£ S·ª≠a ƒê·ªïi\n\n### Backend\n1. **`server/src/index.ts`**\n   - Th√™m import `compileRoutes`\n   - Mount route: `app.use('/api/compile', compileRoutes)`", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "41", "text": "### Documentation\n9. **`DEPLOYMENT.md`**\n   - H∆∞·ªõng d·∫´n deploy ƒë·∫ßy ƒë·ªß\n   - Monitoring v√† troubleshooting\n   - Performance tips\n   - Security checklist\n\n## üîß Files ƒê√£ S·ª≠a ƒê·ªïi\n\n### Backend\n1. **`server/src/index.ts`**\n   - Th√™m import `compileRoutes`\n   - Mount route: `app.use('/api/compile', compileRoutes)`\n\n### Frontend\n2. **`client/src/pages/EditorPage.tsx`**\n   - Update `handleCompile()` function:\n     - LaTeX: G·ªçi API compilation (server-side)\n     - Typst: V·∫´n d√πng WASM (client-side)\n   - Th√™m state `queueStats`\n   - Th√™m useEffect ƒë·ªÉ poll queue stats (m·ªói 3s)\n   - Update UI n√∫t bi√™n d·ªãch:\n     - Hi·ªÉn th·ªã s·ªë ng∆∞·ªùi ƒëang compile/waiting\n     - Disable khi queue ƒë·∫ßy (available === 0)\n     - Tooltip khi disabled\n\n## üîÑ Lu·ªìng Ho·∫°t ƒê·ªông M·ªõi\n\n### LaTeX Compilation Flow", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "42", "text": "## üîÑ Lu·ªìng Ho·∫°t ƒê·ªông M·ªõi\n\n### LaTeX Compilation Flow\n\n```\n1. User clicks \"Bi√™n d·ªãch\"\n   ‚Üì\n2. Frontend g·ªçi POST /api/compile\n   - G·ª≠i fileName, content, projectId\n   ‚Üì\n3. Backend t·∫°o CompilationJob\n   - Th√™m v√†o queue\n   - Return jobId\n   ‚Üì\n4. Frontend poll GET /api/compile/:jobId\n   - M·ªói 1 gi√¢y\n   - Update UI v·ªõi queue position\n   ‚Üì\n5. Backend x·ª≠ l√Ω job (khi c√≥ slot)\n   - T·∫°o temp directory\n   - Vi·∫øt .tex file\n   - Ch·∫°y xelatex 3 l·∫ßn\n   - Ki·ªÉm tra PDF output\n   ‚Üì\n6. Job completed\n   ‚Üì\n7. Frontend download PDF\n   - GET /api/compile/:jobId/pdf\n   - Hi·ªÉn th·ªã trong viewer\n```\n\n### Typst Compilation Flow\n```\nKh√¥ng ƒë·ªïi - v·∫´n d√πng WASM client-side\n```\n\n## üìä Queue Management", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "43", "text": "### Typst Compilation Flow\n```\nKh√¥ng ƒë·ªïi - v·∫´n d√πng WASM client-side\n```\n\n## üìä Queue Management\n\n### Limits\n- **Max concurrent**: 10 jobs (Mac Mini M2 24GB RAM)\n- **Queue size**: Unlimited (ch·ªâ gi·ªõi h·∫°n b·ªüi RAM)\n- **Cleanup**: Auto xo√° sau 30 ph√∫t\n\n### Stats Available\n```json\n{\n  \"compiling\": 3,    // S·ªë jobs ƒëang compile\n  \"queued\": 5,       // S·ªë jobs ƒëang ch·ªù\n  \"total\": 8,        // T·ªïng jobs active\n  \"available\": 7     // Slots c√≤n tr·ªëng\n}\n```\n\n### UI Indicators\n- üü¢ Green dot: Jobs ƒëang compile\n- üü° Yellow dot: Jobs ƒëang ch·ªù\n- ‚ùå Disabled button: Khi available === 0\n\n## üöÄ C√°ch Deploy\n\n### Quick Start\n```bash\n# 1. Clone repo\ncd /Users/mac/heytex", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "44", "text": "### UI Indicators\n- üü¢ Green dot: Jobs ƒëang compile\n- üü° Yellow dot: Jobs ƒëang ch·ªù\n- ‚ùå Disabled button: Khi available === 0\n\n## üöÄ C√°ch Deploy\n\n### Quick Start\n```bash\n# 1. Clone repo\ncd /Users/mac/heytex\n\n# 2. Setup environment\ncp .env.example .env\nnano .env  # Ch·ªânh c√°c passwords\n\n# 3. Build v√† start\ndocker-compose build\ndocker-compose up -d\n\n# 4. Check health\ncurl http://localhost:5433/health\ncurl http://localhost:5433/api/compile/stats\n\n# 5. Migrate database\ndocker exec -it heytex-backend npx prisma migrate deploy\n```\n\n### Development\n```bash\n# Backend local\ncd server\nnpm install\nnpm run dev\n\n# Frontend local\ncd client\nnpm install\nnpm run dev\n```\n\n## üîç Testing\n\n### Test Compilation API\n```bash\n# Get token first\nTOKEN=\"your_jwt_token\"", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "45", "text": "# 4. Check health\ncurl http://localhost:5433/health\ncurl http://localhost:5433/api/compile/stats\n\n# 5. Migrate database\ndocker exec -it heytex-backend npx prisma migrate deploy\n```\n\n### Development\n```bash\n# Backend local\ncd server\nnpm install\nnpm run dev\n\n# Frontend local\ncd client\nnpm install\nnpm run dev\n```\n\n## üîç Testing\n\n### Test Compilation API\n```bash\n# Get token first\nTOKEN=\"your_jwt_token\"\n\n# Submit job\ncurl -X POST http://localhost:5433/api/compile \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"fileName\": \"test.tex\",\n    \"content\": \"\\\\documentclass{article}\\\\begin{document}Hello World\\\\end{document}\"\n  }'\n\n# Returns: {\"jobId\": \"uuid\", \"status\": \"queued\", ...}\n\n# Check status\ncurl http://localhost:5433/api/compile/UUID \\\n  -H \"Authorization: Bearer $TOKEN\"", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "46", "text": "# Submit job\ncurl -X POST http://localhost:5433/api/compile \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"fileName\": \"test.tex\",\n    \"content\": \"\\\\documentclass{article}\\\\begin{document}Hello World\\\\end{document}\"\n  }'\n\n# Returns: {\"jobId\": \"uuid\", \"status\": \"queued\", ...}\n\n# Check status\ncurl http://localhost:5433/api/compile/UUID \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# Download PDF\ncurl http://localhost:5433/api/compile/UUID/pdf \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -o output.pdf\n```", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "47", "text": "# Returns: {\"jobId\": \"uuid\", \"status\": \"queued\", ...}\n\n# Check status\ncurl http://localhost:5433/api/compile/UUID \\\n  -H \"Authorization: Bearer $TOKEN\"\n\n# Download PDF\ncurl http://localhost:5433/api/compile/UUID/pdf \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -o output.pdf\n```\n\n### Test Queue System\n```bash\n# G·ª≠i nhi·ªÅu jobs c√πng l√∫c ƒë·ªÉ test queue\nfor i in {1..15}; do\n  curl -X POST http://localhost:5433/api/compile \\\n    -H \"Authorization: Bearer $TOKEN\" \\\n    -H \"Content-Type: application/json\" \\\n    -d \"{\\\"fileName\\\":\\\"test$i.tex\\\",\\\"content\\\":\\\"\\\\\\\\documentclass{article}\\\\\\\\begin{document}Test $i\\\\\\\\end{document}\\\"}\" &\ndone\n\n# Check stats\ncurl http://localhost:5433/api/compile/stats\n```\n\n## ‚öôÔ∏è Configuration", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "48", "text": "# Check stats\ncurl http://localhost:5433/api/compile/stats\n```\n\n## ‚öôÔ∏è Configuration\n\n### Thay ƒê·ªïi Max Concurrent\nFile: `server/src/services/CompilationQueue.ts`\n```typescript\nprivate readonly maxConcurrent: number = 10; // Change this\n```\n\nKhuy·∫øn ngh·ªã theo RAM:\n- 24GB RAM ‚Üí 10 jobs\n- 32GB RAM ‚Üí 12-15 jobs\n- 64GB RAM ‚Üí 20+ jobs\n\n### Thay ƒê·ªïi Poll Interval\nFile: `client/src/pages/EditorPage.tsx`\n```typescript\nconst interval = setInterval(updateStats, 3000); // milliseconds\n```\n\n### Thay ƒê·ªïi Cleanup Time\nFile: `server/src/services/CompilationQueue.ts`\n```typescript\nsetTimeout(() => {\n    this.cleanupJob(job.id);\n}, 30 * 60 * 1000); // 30 minutes in milliseconds\n```\n\n## üìà Performance Notes", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "49", "text": "### Thay ƒê·ªïi Poll Interval\nFile: `client/src/pages/EditorPage.tsx`\n```typescript\nconst interval = setInterval(updateStats, 3000); // milliseconds\n```\n\n### Thay ƒê·ªïi Cleanup Time\nFile: `server/src/services/CompilationQueue.ts`\n```typescript\nsetTimeout(() => {\n    this.cleanupJob(job.id);\n}, 30 * 60 * 1000); // 30 minutes in milliseconds\n```\n\n## üìà Performance Notes\n\n### Resource Usage (per job)\n- **CPU**: ~50-100% of 1 core (xelatex)\n- **RAM**: ~500MB-1GB average\n- **Disk**: ~10-50MB temporary files\n- **Time**: 2-10 seconds average\n\n### Bottlenecks\n- **CPU**: XeLaTeX is CPU-intensive\n- **Disk I/O**: Reading/writing temp files\n- **Network**: Uploading large PDFs\n\n### Optimization Tips\n1. Use SSD for `/tmp/heytex-compile`\n2. Increase Docker RAM allocation\n3. Use texlive-medium instead of texlive-full\n4. Enable gzip compression for PDF downloads", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "50", "text": "### Bottlenecks\n- **CPU**: XeLaTeX is CPU-intensive\n- **Disk I/O**: Reading/writing temp files\n- **Network**: Uploading large PDFs\n\n### Optimization Tips\n1. Use SSD for `/tmp/heytex-compile`\n2. Increase Docker RAM allocation\n3. Use texlive-medium instead of texlive-full\n4. Enable gzip compression for PDF downloads\n\n## üêõ Known Issues\n\n### 1. TeXLive Installation Size\n- `texlive-full` is ~6GB\n- Solution: Install only needed packages\n\n### 2. Compilation Timeout\n- Very large documents may timeout\n- Solution: Increase timeout in CompilationQueue\n\n### 3. Concurrent Limit\n- Hardcoded to 10\n- Solution: Make it configurable via ENV\n\n## üîú Future Improvements\n\n### Short Term\n- [ ] Make maxConcurrent configurable via ENV\n- [ ] Add compilation timeout\n- [ ] WebSocket real-time updates (thay v√¨ polling)\n- [ ] Compression cho PDF downloads", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "51", "text": "### 1. TeXLive Installation Size\n- `texlive-full` is ~6GB\n- Solution: Install only needed packages\n\n### 2. Compilation Timeout\n- Very large documents may timeout\n- Solution: Increase timeout in CompilationQueue\n\n### 3. Concurrent Limit\n- Hardcoded to 10\n- Solution: Make it configurable via ENV\n\n## üîú Future Improvements\n\n### Short Term\n- [ ] Make maxConcurrent configurable via ENV\n- [ ] Add compilation timeout\n- [ ] WebSocket real-time updates (thay v√¨ polling)\n- [ ] Compression cho PDF downloads\n\n### Long Term\n- [ ] Distributed compilation (multiple workers)\n- [ ] Redis queue (thay v√¨ in-memory)\n- [ ] Package caching ƒë·ªÉ tƒÉng t·ªëc\n- [ ] Metrics v√† monitoring dashboard\n\n## üìö Related Files", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "52", "text": "### 3. Concurrent Limit\n- Hardcoded to 10\n- Solution: Make it configurable via ENV\n\n## üîú Future Improvements\n\n### Short Term\n- [ ] Make maxConcurrent configurable via ENV\n- [ ] Add compilation timeout\n- [ ] WebSocket real-time updates (thay v√¨ polling)\n- [ ] Compression cho PDF downloads\n\n### Long Term\n- [ ] Distributed compilation (multiple workers)\n- [ ] Redis queue (thay v√¨ in-memory)\n- [ ] Package caching ƒë·ªÉ tƒÉng t·ªëc\n- [ ] Metrics v√† monitoring dashboard\n\n## üìö Related Files\n\n- **Backend**: `server/src/services/CompilationQueue.ts`\n- **API Routes**: `server/src/routes/compile.ts`\n- **Frontend API**: `client/src/api/compilation.ts`\n- **Frontend UI**: `client/src/pages/EditorPage.tsx`\n- **Docker**: `docker-compose.yml`, `server/Dockerfile`\n- **Docs**: `DEPLOYMENT.md`\n\n## üéâ K·∫øt Lu·∫≠n", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "53", "text": "## üìö Related Files\n\n- **Backend**: `server/src/services/CompilationQueue.ts`\n- **API Routes**: `server/src/routes/compile.ts`\n- **Frontend API**: `client/src/api/compilation.ts`\n- **Frontend UI**: `client/src/pages/EditorPage.tsx`\n- **Docker**: `docker-compose.yml`, `server/Dockerfile`\n- **Docs**: `DEPLOYMENT.md`\n\n## üéâ K·∫øt Lu·∫≠n\n\nMigration ho√†n t·∫•t th√†nh c√¥ng! H·ªá th·ªëng gi·ªù ƒë√¢y:\n- ‚úÖ Stable h∆°n v·ªõi TeXLive full\n- ‚úÖ Scalable v·ªõi queue management\n- ‚úÖ User-friendly v·ªõi queue status UI\n- ‚úÖ Production-ready v·ªõi Docker\n- ‚úÖ Well-documented v·ªõi DEPLOYMENT.md\n\n---\n\n**Author**: GitHub Copilot  \n**Date**: December 15, 2025  \n**Version**: 1.0.0", "metadata": {"file_path": "MIGRATION_SUMMARY.md", "file_name": "MIGRATION_SUMMARY.md", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "54", "text": "module.exports = {\n  apps: [\n    {\n      name: 'heytex-backend',\n      cwd: '/Users/mac/heytex/server',\n      // Use the compiled production bundle to avoid runtime tsx/interpreter issues\n      script: '/Users/mac/heytex/server/dist/index.js',\n      interpreter: 'node',\n      // Run single instance in fork mode for predictable startup and port binding\n      instances: 1,\n      exec_mode: 'fork',\n      autorestart: true,\n      watch: false,\n      max_memory_restart: '500M',\n      error_file: '/tmp/heytex-backend-error.log',\n      out_file: '/tmp/heytex-backend.log',\n      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n      env: {\n        NODE_ENV: 'production',\n      },\n    },\n    {\n      name: 'heytex-texlive',\n      cwd: '/Users/mac/heytex',\n      script: 'texlive-server.js',\n      interpreter: 'node',\n      instances: 1,\n      autorestart: true,", "metadata": {"file_path": "ecosystem.config.js", "file_name": "ecosystem.config.js", "creation_date": "2025-12-12", "last_modified_date": "2025-12-19"}}
{"id": "55", "text": "error_file: '/tmp/heytex-backend-error.log',\n      out_file: '/tmp/heytex-backend.log',\n      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n      env: {\n        NODE_ENV: 'production',\n      },\n    },\n    {\n      name: 'heytex-texlive',\n      cwd: '/Users/mac/heytex',\n      script: 'texlive-server.js',\n      interpreter: 'node',\n      instances: 1,\n      autorestart: true,\n      watch: false,\n      max_memory_restart: '300M',\n      env: {\n        PORT: '5435',\n      },\n      error_file: '/tmp/texlive-server-error.log',\n      out_file: '/tmp/texlive-server.log',\n      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n    },\n    {\n      name: 'heytex-minio',\n      cwd: '/Users/mac/heytex',\n      script: 'minio',", "metadata": {"file_path": "ecosystem.config.js", "file_name": "ecosystem.config.js", "creation_date": "2025-12-12", "last_modified_date": "2025-12-19"}}
{"id": "56", "text": "instances: 1,\n      autorestart: true,\n      watch: false,\n      max_memory_restart: '300M',\n      env: {\n        PORT: '5435',\n      },\n      error_file: '/tmp/texlive-server-error.log',\n      out_file: '/tmp/texlive-server.log',\n      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n    },\n    {\n      name: 'heytex-minio',\n      cwd: '/Users/mac/heytex',\n      script: 'minio',\n      args: 'server data/minio --address :5434 --console-address :5437',\n      interpreter: 'none',\n      exec_mode: 'fork',\n      instances: 1,\n      autorestart: true,\n      watch: false,\n      max_memory_restart: '500M',\n      env: {\n        MINIO_ROOT_USER: 'heytex_admin',\n        MINIO_ROOT_PASSWORD: 'heytex_minio_2024',\n      },\n      error_file: '/tmp/minio-error.log',", "metadata": {"file_path": "ecosystem.config.js", "file_name": "ecosystem.config.js", "creation_date": "2025-12-12", "last_modified_date": "2025-12-19"}}
{"id": "57", "text": "script: 'minio',\n      args: 'server data/minio --address :5434 --console-address :5437',\n      interpreter: 'none',\n      exec_mode: 'fork',\n      instances: 1,\n      autorestart: true,\n      watch: false,\n      max_memory_restart: '500M',\n      env: {\n        MINIO_ROOT_USER: 'heytex_admin',\n        MINIO_ROOT_PASSWORD: 'heytex_minio_2024',\n      },\n      error_file: '/tmp/minio-error.log',\n      out_file: '/tmp/minio.log',\n      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n    },\n  ],\n};", "metadata": {"file_path": "ecosystem.config.js", "file_name": "ecosystem.config.js", "creation_date": "2025-12-12", "last_modified_date": "2025-12-19"}}
{"id": "58", "text": "version: '3.8'\n\nservices:\n  # PostgreSQL Database\n  postgres:\n    image: postgres:15-alpine\n    container_name: heytex-postgres\n    restart: unless-stopped\n    environment:\n      POSTGRES_USER: ${POSTGRES_USER:-heytex}\n      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-heytex123}\n      POSTGRES_DB: ${POSTGRES_DB:-heytex}\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    ports:\n      - \"${POSTGRES_PORT:-5432}:5432\"\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U ${POSTGRES_USER:-heytex}\"]\n      interval: 10s\n      timeout: 5s\n      retries: 5", "metadata": {"file_path": "docker-compose.yml", "file_name": "docker-compose.yml", "creation_date": "2025-12-15", "last_modified_date": "2025-12-16"}}
{"id": "59", "text": "# MinIO Object Storage\n  minio:\n    image: minio/minio:latest\n    container_name: heytex-minio\n    restart: unless-stopped\n    command: server /data --console-address \":9001\"\n    environment:\n      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-heytex}\n      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-heytex123}\n    volumes:\n      - minio_data:/data\n    ports:\n      - \"${MINIO_PORT:-5434}:9000\"\n      - \"${MINIO_CONSOLE_PORT:-9001}:9001\"\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:9000/minio/health/live\"]\n      interval: 30s\n      timeout: 20s\n      retries: 3\n\n  # Backend Server v·ªõi TeXLive\n  backend:\n    build:\n      context: ./server\n      dockerfile: Dockerfile\n    container_name: heytex-backend\n    restart: unless-stopped\n    depends_on:\n      postgres:", "metadata": {"file_path": "docker-compose.yml", "file_name": "docker-compose.yml", "creation_date": "2025-12-15", "last_modified_date": "2025-12-16"}}
{"id": "60", "text": "# Backend Server v·ªõi TeXLive\n  backend:\n    build:\n      context: ./server\n      dockerfile: Dockerfile\n    container_name: heytex-backend\n    restart: unless-stopped\n    depends_on:\n      postgres:\n        condition: service_healthy\n      minio:\n        condition: service_healthy\n    environment:\n      NODE_ENV: production\n      DATABASE_URL: postgresql://${POSTGRES_USER:-heytex}:${POSTGRES_PASSWORD:-heytex123}@postgres:5432/${POSTGRES_DB:-heytex}\n      JWT_SECRET: ${JWT_SECRET:-your-super-secret-jwt-key-change-this}\n      PORT: 5433\n      MINIO_ENDPOINT: minio\n      MINIO_PORT: 9000\n      MINIO_USE_SSL: \"false\"\n      MINIO_ACCESS_KEY: ${MINIO_ROOT_USER:-heytex}", "metadata": {"file_path": "docker-compose.yml", "file_name": "docker-compose.yml", "creation_date": "2025-12-15", "last_modified_date": "2025-12-16"}}
{"id": "61", "text": "postgresql://${POSTGRES_USER:-heytex}:${POSTGRES_PASSWORD:-heytex123}@postgres:5432/${POSTGRES_DB:-heytex}\n      JWT_SECRET: ${JWT_SECRET:-your-super-secret-jwt-key-change-this}\n      PORT: 5433\n      MINIO_ENDPOINT: minio\n      MINIO_PORT: 9000\n      MINIO_USE_SSL: \"false\"\n      MINIO_ACCESS_KEY: ${MINIO_ROOT_USER:-heytex}\n      MINIO_SECRET_KEY: ${MINIO_ROOT_PASSWORD:-heytex123}\n      MINIO_BUCKET_ASSETS: heytex-assets\n      MINIO_BUCKET_PROJECTS: heytex-projects\n      CORS_ORIGIN: ${CORS_ORIGIN:-http://localhost:5173}\n    volumes:\n      - compile_temp:/tmp/heytex-compile\n    ports:\n      - \"${BACKEND_PORT:-5433}:5433\"\n    healthcheck:", "metadata": {"file_path": "docker-compose.yml", "file_name": "docker-compose.yml", "creation_date": "2025-12-15", "last_modified_date": "2025-12-16"}}
{"id": "62", "text": "MINIO_SECRET_KEY: ${MINIO_ROOT_PASSWORD:-heytex123}\n      MINIO_BUCKET_ASSETS: heytex-assets\n      MINIO_BUCKET_PROJECTS: heytex-projects\n      CORS_ORIGIN: ${CORS_ORIGIN:-http://localhost:5173}\n    volumes:\n      - compile_temp:/tmp/heytex-compile\n    ports:\n      - \"${BACKEND_PORT:-5433}:5433\"\n    healthcheck:\n      test: [\"CMD\", \"node\", \"-e\", \"require('http').get('http://localhost:5433/health', (r) => { process.exit(r.statusCode === 200 ? 0 : 1); })\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3", "metadata": {"file_path": "docker-compose.yml", "file_name": "docker-compose.yml", "creation_date": "2025-12-15", "last_modified_date": "2025-12-16"}}
{"id": "63", "text": "0 : 1); })\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # Frontend (optional - c√≥ th·ªÉ ch·∫°y v·ªõi Vite dev server ri√™ng)\n  frontend:\n    build:\n      context: ./client\n      dockerfile: Dockerfile\n      args:\n        VITE_USE_WASM_LATEX: ${VITE_USE_WASM_LATEX:-false}\n    container_name: heytex-frontend\n    restart: unless-stopped\n    depends_on:\n      - backend\n    environment:\n      VITE_API_URL: ${VITE_API_URL:-http://localhost:5433}\n      VITE_SOCKET_URL: ${VITE_SOCKET_URL:-http://localhost:5433}\n      # Prefer server-side LaTeX compilation by default\n      VITE_USE_WASM_LATEX: ${VITE_USE_WASM_LATEX:-false}\n    ports:\n      - \"${FRONTEND_PORT:-5176}:80\"\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:80\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3", "metadata": {"file_path": "docker-compose.yml", "file_name": "docker-compose.yml", "creation_date": "2025-12-15", "last_modified_date": "2025-12-16"}}
{"id": "64", "text": "volumes:\n  postgres_data:\n    driver: local\n  minio_data:\n    driver: local\n  compile_temp:\n    driver: local\n\nnetworks:\n  default:\n    name: heytex-network", "metadata": {"file_path": "docker-compose.yml", "file_name": "docker-compose.yml", "creation_date": "2025-12-15", "last_modified_date": "2025-12-16"}}
{"id": "65", "text": "import dotenv from 'dotenv';\ndotenv.config();\n\nexport const config = {\n    port: parseInt(process.env.PORT || '3001'),\n    nodeEnv: process.env.NODE_ENV || 'development',\n\n    jwt: {\n        secret: process.env.JWT_SECRET || 'default_secret',\n        expiresIn: process.env.JWT_EXPIRES_IN || '7d',\n    },\n\n    minio: {\n        endPoint: process.env.MINIO_ENDPOINT || '127.0.0.1',\n        port: parseInt(process.env.MINIO_PORT || '9000'),\n        accessKey: process.env.MINIO_ACCESS_KEY || '',\n        secretKey: process.env.MINIO_SECRET_KEY || '',\n        useSSL: process.env.MINIO_USE_SSL === 'true',\n        bucketAssets: process.env.MINIO_BUCKET_ASSETS || 'heytex-assets',\n        bucketProjects: process.env.MINIO_BUCKET_PROJECTS || 'heytex-projects',\n    },\n\n    cors: {\n        origin: process.env.CORS_ORIGIN || 'http://localhost:5173',\n    },\n};", "metadata": {"file_path": "/Users/mac/heytex/server/src/config/index.ts", "file_name": "index.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "66", "text": "import express from 'express';\nimport cors from 'cors';\nimport helmet from 'helmet';\nimport { createServer } from 'http';\nimport { config } from './config/index';\nimport { prisma } from './lib/prisma';\nimport { setupCollaborationServer } from './websocket/collab';\n\n// Import routes\nimport authRoutes from './routes/auth';\nimport projectRoutes from './routes/projects';\nimport fileRoutes from './routes/files';\n\nconst app = express();\nconst httpServer = createServer(app);\n\n// Setup WebSocket collaboration server\nconst io = setupCollaborationServer(httpServer);\n\n// Middleware\napp.use(helmet({\n    crossOriginResourcePolicy: { policy: 'cross-origin' },\n}));\napp.use(cors({\n    origin: config.cors.origin,\n    credentials: true,\n}));\napp.use(express.json({ limit: '50mb' }));\napp.use(express.urlencoded({ extended: true, limit: '50mb' }));\n\n// Handle malformed JSON bodies gracefully (prevent crash)\napp.use((err: any, req: express.Request, res: express.Response, next: express.NextFunction) => {\n    if (err && err instanceof SyntaxError && 'body' in err) {\n        console.warn('[Express] Invalid JSON received:', err.message);\n        return res.status(400).json({ error: 'Invalid JSON body' });\n    }\n    return next(err);\n});\n\n// Health check\napp.get('/health', (req, res) => {\n    res.json({ status: 'ok', timestamp: new Date().toISOString() });\n});\n\n// API routes\nimport texlyreRoutes from './routes/texlyre';\nimport compileRoutes from './routes/compile';\nimport storageRoutes from './routes/storage';\n\napp.use('/api/auth', authRoutes);\napp.use('/api/projects', projectRoutes);\napp.use('/api/files', fileRoutes);\napp.use('/api/texlyre', texlyreRoutes);\napp.use('/api/compile', compileRoutes);\napp.use('/api/storage', storageRoutes);\n\n// Error handling middleware\napp.use((err: Error, req: express.Request, res: express.Response, next: express.NextFunction) => {\n    console.error('Error:', err);\n    res.status(500).json({ error: 'Internal server error' });\n});", "metadata": {"file_path": "/Users/mac/heytex/server/src/index.ts", "file_name": "index.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-19"}}
{"id": "67", "text": "// 404 handler\napp.use((req, res) => {\n    res.status(404).json({ error: 'Not found' });\n});\n\n// Graceful shutdown\nprocess.on('SIGTERM', async () => {\n    console.log('SIGTERM received. Shutting down gracefully...');\n    await prisma.$disconnect();\n    process.exit(0);\n});\n\nprocess.on('SIGINT', async () => {\n    console.log('SIGINT received. Shutting down gracefully...');\n    await prisma.$disconnect();\n    process.exit(0);\n});\n\n// Global exception handlers to keep process alive and log errors for PM2\nprocess.on('uncaughtException', (err) => {\n    console.error('[Process] uncaughtException:', err);\n    // don't exit immediately; PM2 will restart if needed\n});\n\nprocess.on('unhandledRejection', (reason) => {\n    console.error('[Process] unhandledRejection:', reason);\n});\n\n// Start server\nhttpServer.listen(config.port, () => {\n    console.log(`\nüöÄ HeyTeX Server is running!\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìç HTTP:      http://localhost:${config.port}\nüîå WebSocket: ws://localhost:${config.port}/collab\nüåç CORS:      ${config.cors.origin}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n  `);\n});\n\nexport { app, httpServer, io };", "metadata": {"file_path": "/Users/mac/heytex/server/src/index.ts", "file_name": "index.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-19"}}
{"id": "68", "text": "import * as Minio from 'minio';\nimport { config } from '../config/index';\n\nexport const minioClient = new Minio.Client({\n    endPoint: config.minio.endPoint,\n    port: config.minio.port,\n    useSSL: config.minio.useSSL,\n    accessKey: config.minio.accessKey,\n    secretKey: config.minio.secretKey,\n});\n\nexport async function uploadFile(\n    bucket: string,\n    objectName: string,\n    buffer: Buffer,\n    mimeType: string\n): Promise<string> {\n    await minioClient.putObject(bucket, objectName, buffer, buffer.length, {\n        'Content-Type': mimeType,\n    });\n    return objectName;\n}\n\nexport async function getFileUrl(bucket: string, objectName: string): Promise<string> {\n    return await minioClient.presignedGetObject(bucket, objectName, 24 * 60 * 60); // 24 hours\n}\n\nexport async function deleteFile(bucket: string, objectName: string): Promise<void> {\n    await minioClient.removeObject(bucket, objectName);\n}", "metadata": {"file_path": "/Users/mac/heytex/server/src/lib/minio.ts", "file_name": "minio.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "69", "text": "import { PrismaClient } from '@prisma/client';\n\nexport const prisma = new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['query', 'error', 'warn'] : ['error'],\n});", "metadata": {"file_path": "/Users/mac/heytex/server/src/lib/prisma.ts", "file_name": "prisma.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "70", "text": "import { Request, Response, NextFunction } from 'express';\nimport jwt from 'jsonwebtoken';\nimport { config } from '../config/index';\nimport { prisma } from '../lib/prisma';\n\nexport interface AuthRequest extends Request {\n    userId?: string;\n    user?: {\n        id: string;\n        email: string;\n        name: string;\n    };\n}\n\nexport async function authMiddleware(\n    req: AuthRequest,\n    res: Response,\n    next: NextFunction\n): Promise<void> {\n    try {\n        const authHeader = req.headers.authorization;\n\n        if (!authHeader || !authHeader.startsWith('Bearer ')) {\n            res.status(401).json({ error: 'Unauthorized: No token provided' });\n            return;\n        }\n\n        const token = authHeader.split(' ')[1];\n\n        const decoded = jwt.verify(token, config.jwt.secret) as { userId: string };\n\n        const user = await prisma.user.findUnique({\n            where: { id: decoded.userId },\n            select: { id: true, email: true, name: true },\n        });\n\n        if (!user) {\n            res.status(401).json({ error: 'Unauthorized: User not found' });\n            return;\n        }\n\n        req.userId = user.id;\n        req.user = user;\n        next();\n    } catch (error) {\n        res.status(401).json({ error: 'Unauthorized: Invalid token' });\n    }\n}\n\nexport function optionalAuth(\n    req: AuthRequest,\n    res: Response,\n    next: NextFunction\n): void {\n    const authHeader = req.headers.authorization;\n\n    if (!authHeader || !authHeader.startsWith('Bearer ')) {\n        next();\n        return;\n    }\n\n    authMiddleware(req, res, next);\n}", "metadata": {"file_path": "/Users/mac/heytex/server/src/middleware/auth.ts", "file_name": "auth.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "71", "text": "import { Router, Request, Response } from 'express';\nimport bcrypt from 'bcryptjs';\nimport jwt from 'jsonwebtoken';\nimport { prisma } from '../lib/prisma';\nimport { config } from '../config/index';\nimport { authMiddleware, AuthRequest } from '../middleware/auth';\n\nconst router = Router();\n\n// Register\nrouter.post('/register', async (req: Request, res: Response): Promise<void> => {\n    try {\n        const { email, password, name } = req.body;\n\n        if (!email || !password || !name) {\n            res.status(400).json({ error: 'Email, password, and name are required' });\n            return;\n        }\n\n        const existingUser = await prisma.user.findUnique({ where: { email } });\n        if (existingUser) {\n            res.status(400).json({ error: 'Email already registered' });\n            return;\n        }\n\n        const hashedPassword = await bcrypt.hash(password, 12);\n\n        const user = await prisma.user.create({\n            data: {\n                email,\n                password: hashedPassword,\n                name,\n            },\n            select: {\n                id: true,\n                email: true,\n                name: true,\n                createdAt: true,\n            },\n        });\n\n        // @ts-ignore - JWT types are complex\n        const token = jwt.sign(\n            { userId: user.id },\n            config.jwt.secret,\n            { expiresIn: config.jwt.expiresIn }\n        );\n\n        res.status(201).json({ user, token });\n    } catch (error) {\n        console.error('Registration error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Login\nrouter.post('/login', async (req: Request, res: Response): Promise<void> => {\n    try {\n        const { email, password } = req.body;\n\n        if (!email || !password) {\n            res.status(400).json({ error: 'Email and password are required' });\n            return;\n        }\n\n        const user = await prisma.user.findUnique({ where: { email } });\n        if (!user) {\n            res.status(401).json({ error: 'Invalid credentials' });\n            return;\n        }", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/auth.ts", "file_name": "auth.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "72", "text": "const user = await prisma.user.findUnique({ where: { email } });\n        if (!user) {\n            res.status(401).json({ error: 'Invalid credentials' });\n            return;\n        }\n\n        const isValidPassword = await bcrypt.compare(password, user.password);\n        if (!isValidPassword) {\n            res.status(401).json({ error: 'Invalid credentials' });\n            return;\n        }\n\n        // @ts-ignore - JWT types are complex\n        const token = jwt.sign(\n            { userId: user.id },\n            config.jwt.secret,\n            { expiresIn: config.jwt.expiresIn }\n        );\n\n        res.json({\n            user: {\n                id: user.id,\n                email: user.email,\n                name: user.name,\n            },\n            token,\n        });\n    } catch (error) {\n        console.error('Login error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Get current user\nrouter.get('/me', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const user = await prisma.user.findUnique({\n            where: { id: req.userId },\n            select: {\n                id: true,\n                email: true,\n                name: true,\n                avatar: true,\n                createdAt: true,\n            },\n        });\n\n        if (!user) {\n            res.status(404).json({ error: 'User not found' });\n            return;\n        }\n\n        res.json({ user });\n    } catch (error) {\n        console.error('Get user error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Update profile\nrouter.patch('/me', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { name, avatar } = req.body;\n\n        const user = await prisma.user.update({\n            where: { id: req.userId },\n            data: {\n                ...(name && { name }),\n                ...(avatar && { avatar }),\n            },\n            select: {\n                id: true,\n                email: true,\n                name: true,\n                avatar: true,\n            },\n        });", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/auth.ts", "file_name": "auth.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "73", "text": "res.json({ user });\n    } catch (error) {\n        console.error('Update user error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\nexport default router;", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/auth.ts", "file_name": "auth.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "74", "text": "/**\n * Compilation Routes\n * API endpoints ƒë·ªÉ bi√™n d·ªãch LaTeX documents v·ªõi queue management\n */\n\nimport { Router, Request, Response } from 'express';\nimport { compilationQueue } from '../services/CompilationQueue';\nimport { authMiddleware, AuthRequest } from '../middleware/auth';\n\nconst router = Router();\n\n/**\n * POST /api/compile\n * T·∫°o compilation job m·ªõi\n * Body: { fileName: string, content: string, projectId?: string }\n */\nrouter.post('/', async (req: Request, res: Response): Promise<void> => {\n    try {\n        const { fileName, content, projectId } = req.body;\n        const userId = 'test-user'; // Temporary for testing\n\n        if (!fileName || !content) {\n            res.status(400).json({ error: 'fileName and content are required' });\n            return;\n        }\n\n        // Validate fileName is .tex\n        if (!fileName.endsWith('.tex')) {\n            res.status(400).json({ error: 'Only .tex files are supported' });\n            return;\n        }\n\n        // Th√™m job v√†o queue\n        const jobId = await compilationQueue.addJob(\n            userId,\n            projectId || 'unknown',\n            fileName,\n            content\n        );\n\n        // L·∫•y stats hi·ªán t·∫°i\n        const stats = compilationQueue.getStats();\n        const job = compilationQueue.getJob(jobId);\n\n        res.status(201).json({\n            success: true,\n            jobId,\n            status: job?.status,\n            queuePosition: job?.queuePosition,\n            stats: {\n                compiling: stats.compiling,\n                queued: stats.queued,\n            },\n        });\n    } catch (error) {\n        console.error('[Compile API] Error creating job:', error);\n        res.status(500).json({ error: 'Failed to create compilation job' });\n    }\n});\n\n/**\n * GET /api/compile/stats\n * L·∫•y th·ªëng k√™ queue hi·ªán t·∫°i (public endpoint ƒë·ªÉ frontend hi·ªÉn th·ªã)\n */\nrouter.get('/stats', async (req: Request, res: Response): Promise<void> => {\n    try {\n        const stats = compilationQueue.getStats();", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/compile.ts", "file_name": "compile.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "75", "text": "res.json({\n            success: true,\n            stats: {\n                compiling: stats.compiling,\n                queued: stats.queued,\n                total: stats.total,\n                available: Math.max(0, 10 - stats.compiling), // 10 l√† max concurrent\n            },\n        });\n    } catch (error) {\n        console.error('[Compile API] Error getting stats:', error);\n        res.status(500).json({ error: 'Failed to get stats' });\n    }\n});\n\n/**\n * GET /api/compile/:jobId\n * L·∫•y th√¥ng tin v·ªÅ job\n */\nrouter.get('/:jobId', async (req: Request, res: Response): Promise<void> => {\n    try {\n        const { jobId } = req.params;\n\n        const job = compilationQueue.getJob(jobId);\n\n        if (!job) {\n            res.status(404).json({ error: 'Job not found' });\n            return;\n        }\n\n        // Skip auth check for testing\n        // if (job.userId !== userId) {\n        //     res.status(403).json({ error: 'Access denied' });\n        //     return;\n        // }\n\n        const stats = compilationQueue.getStats();\n\n        res.json({\n            success: true,\n            job: {\n                id: job.id,\n                status: job.status,\n                queuePosition: job.queuePosition,\n                createdAt: job.createdAt,\n                startedAt: job.startedAt,\n                completedAt: job.completedAt,\n                error: job.error,\n            },\n            stats: {\n                compiling: stats.compiling,\n                queued: stats.queued,\n            },\n        });\n    } catch (error) {\n        console.error('[Compile API] Error getting job:', error);\n        res.status(500).json({ error: 'Failed to get job status' });\n    }\n});\n\n/**\n * GET /api/compile/:jobId/pdf\n * Download PDF khi job ho√†n th√†nh\n */\nrouter.get('/:jobId/pdf', async (req: Request, res: Response): Promise<void> => {\n    try {\n        const { jobId } = req.params;\n\n        const job = compilationQueue.getJob(jobId);\n\n        if (!job) {\n            res.status(404).json({ error: 'Job not found' });\n            return;\n        }", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/compile.ts", "file_name": "compile.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "76", "text": "const job = compilationQueue.getJob(jobId);\n\n        if (!job) {\n            res.status(404).json({ error: 'Job not found' });\n            return;\n        }\n\n        // Skip auth check for testing\n        // if (job.userId !== userId) {\n        //     res.status(403).json({ error: 'Access denied' });\n        //     return;\n        // }\n\n        if (job.status !== 'completed') {\n            res.status(400).json({ \n                error: 'Job not completed yet',\n                status: job.status,\n            });\n            return;\n        }\n\n        const pdf = await compilationQueue.getPDF(jobId);\n\n        if (!pdf) {\n            res.status(404).json({ error: 'PDF not found' });\n            return;\n        }\n\n        res.setHeader('Content-Type', 'application/pdf');\n        res.setHeader('Content-Disposition', `inline; filename=\"${job.fileName.replace('.tex', '.pdf')}\"`);\n        res.send(pdf);\n    } catch (error) {\n        console.error('[Compile API] Error getting PDF:', error);\n        res.status(500).json({ error: 'Failed to get PDF' });\n    }\n});\n\n/**\n * GET /api/compile/:jobId/log\n * L·∫•y compilation log\n */\nrouter.get('/:jobId/log', async (req: Request, res: Response): Promise<void> => {\n    try {\n        const { jobId } = req.params;\n\n        const job = compilationQueue.getJob(jobId);\n\n        if (!job) {\n            res.status(404).json({ error: 'Job not found' });\n            return;\n        }\n\n        // Skip auth check for testing\n        // if (job.userId !== userId) {\n        //     res.status(403).json({ error: 'Access denied' });\n        //     return;\n        // }\n\n        const log = await compilationQueue.getLog(jobId);\n\n        if (!log) {\n            res.status(404).json({ error: 'Log not found' });\n            return;\n        }\n\n        res.setHeader('Content-Type', 'text/plain');\n        res.send(log);\n    } catch (error) {\n        console.error('[Compile API] Error getting log:', error);\n        res.status(500).json({ error: 'Failed to get log' });\n    }\n});", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/compile.ts", "file_name": "compile.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "77", "text": "export default router;", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/compile.ts", "file_name": "compile.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "78", "text": "import { Router, Response } from 'express';\nimport { prisma } from '../lib/prisma';\nimport { authMiddleware, AuthRequest } from '../middleware/auth';\nimport { uploadFile, getFileUrl, deleteFile } from '../lib/minio';\nimport { config } from '../config/index';\nimport { fileStorage } from '../services/FileStorage';\n\nconst router = Router();\n\n// Get all files for a project\nrouter.get('/project/:projectId', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { projectId } = req.params;\n\n        const project = await prisma.project.findFirst({\n            where: {\n                id: projectId,\n                OR: [\n                    { ownerId: req.userId },\n                    { collaborators: { some: { userId: req.userId } } },\n                ],\n            },\n        });\n\n        if (!project) {\n            res.status(404).json({ error: 'Project not found' });\n            return;\n        }\n\n        const files = await prisma.file.findMany({\n            where: { projectId },\n            orderBy: [{ isFolder: 'desc' }, { name: 'asc' }],\n        });\n\n        res.json({ files });\n    } catch (error) {\n        console.error('Get files error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Get single file content\nrouter.get('/:id', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { id } = req.params;\n\n        const file = await prisma.file.findUnique({\n            where: { id },\n            include: {\n                project: {\n                    select: {\n                        ownerId: true,\n                        collaborators: { select: { userId: true } },\n                    },\n                },\n            },\n        });\n\n        if (!file) {\n            res.status(404).json({ error: 'File not found' });\n            return;\n        }\n\n        const hasAccess =\n            file.project.ownerId === req.userId ||\n            file.project.collaborators.some(c => c.userId === req.userId);\n\n        if (!hasAccess) {\n            res.status(403).json({ error: 'Access denied' });\n            return;\n        }", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/files.ts", "file_name": "files.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "79", "text": "if (!hasAccess) {\n            res.status(403).json({ error: 'Access denied' });\n            return;\n        }\n\n        // If it's a binary file stored in MinIO, get presigned URL\n        if (!file.content && file.mimeType && !file.mimeType.startsWith('text/')) {\n            const url = await getFileUrl(\n                config.minio.bucketProjects,\n                `${file.projectId}/${file.path}`\n            );\n            res.json({ file: { ...file, url } });\n            return;\n        }\n\n        res.json({ file });\n    } catch (error) {\n        console.error('Get file error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Create new file or folder\nrouter.post('/', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { projectId, name, path, isFolder = false, content = '' } = req.body;\n\n        if (!projectId || !name || !path) {\n            res.status(400).json({ error: 'Project ID, name, and path are required' });\n            return;\n        }\n\n        const project = await prisma.project.findFirst({\n            where: {\n                id: projectId,\n                OR: [\n                    { ownerId: req.userId },\n                    { collaborators: { some: { userId: req.userId } } },\n                ],\n            },\n        });\n\n        if (!project) {\n            res.status(404).json({ error: 'Project not found' });\n            return;\n        }\n\n        const existingFile = await prisma.file.findUnique({\n            where: { projectId_path: { projectId, path } },\n        });\n\n        if (existingFile) {\n            res.status(400).json({ error: 'File already exists at this path' });\n            return;\n        }\n\n        const file = await prisma.file.create({\n            data: {\n                name,\n                path,\n                isFolder,\n                content: isFolder ? null : content,\n                projectId,\n            },\n        });", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/files.ts", "file_name": "files.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "80", "text": "const file = await prisma.file.create({\n            data: {\n                name,\n                path,\n                isFolder,\n                content: isFolder ? null : content,\n                projectId,\n            },\n        });\n\n        // Save to local file storage\n        try {\n            if (isFolder) {\n                await fileStorage.createFolder(project.ownerId, projectId, path);\n            } else {\n                await fileStorage.saveFile(project.ownerId, projectId, path, content);\n            }\n        } catch (storageError) {\n            console.error('[FileStorage] Failed to save file:', storageError);\n            // Continue even if storage fails - database is source of truth\n        }\n\n        res.status(201).json({ file });\n    } catch (error) {\n        console.error('Create file error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Update file content\nrouter.patch('/:id', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { id } = req.params;\n        const { content, name } = req.body;\n\n        const file = await prisma.file.findUnique({\n            where: { id },\n            include: {\n                project: {\n                    select: {\n                        ownerId: true,\n                        collaborators: { select: { userId: true, role: true } },\n                    },\n                },\n            },\n        });\n\n        if (!file) {\n            res.status(404).json({ error: 'File not found' });\n            return;\n        }\n\n        const hasEditAccess =\n            file.project.ownerId === req.userId ||\n            file.project.collaborators.some(\n                c => c.userId === req.userId && c.role !== 'VIEWER'\n            );\n\n        if (!hasEditAccess) {\n            res.status(403).json({ error: 'No edit access' });\n            return;\n        }\n\n        const updated = await prisma.file.update({\n            where: { id },\n            data: {\n                ...(content !== undefined && { content }),\n                ...(name && { name }),\n            },\n        });", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/files.ts", "file_name": "files.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "81", "text": "const updated = await prisma.file.update({\n            where: { id },\n            data: {\n                ...(content !== undefined && { content }),\n                ...(name && { name }),\n            },\n        });\n\n        // Update local file storage\n        try {\n            if (content !== undefined && !file.isFolder) {\n                await fileStorage.saveFile(file.project.ownerId, file.projectId, file.path, content);\n            }\n            if (name && name !== file.name) {\n                // Handle rename - update path if needed\n                const newPath = file.path.replace(file.name, name);\n                if (newPath !== file.path) {\n                    await fileStorage.renameFile(file.project.ownerId, file.projectId, file.path, newPath);\n                }\n            }\n        } catch (storageError) {\n            console.error('[FileStorage] Failed to update file:', storageError);\n        }\n\n        res.json({ file: updated });\n    } catch (error) {\n        console.error('Update file error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Delete file\nrouter.delete('/:id', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { id } = req.params;\n\n        const file = await prisma.file.findUnique({\n            where: { id },\n            include: {\n                project: {\n                    select: {\n                        ownerId: true,\n                        collaborators: { select: { userId: true, role: true } },\n                    },\n                },\n            },\n        });\n\n        if (!file) {\n            res.status(404).json({ error: 'File not found' });\n            return;\n        }\n\n        const hasEditAccess =\n            file.project.ownerId === req.userId ||\n            file.project.collaborators.some(\n                c => c.userId === req.userId && c.role !== 'VIEWER'\n            );\n\n        if (!hasEditAccess) {\n            res.status(403).json({ error: 'No edit access' });\n            return;\n        }", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/files.ts", "file_name": "files.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "82", "text": "if (!hasEditAccess) {\n            res.status(403).json({ error: 'No edit access' });\n            return;\n        }\n\n        // Delete from MinIO if it's a binary file\n        if (!file.content && file.mimeType) {\n            try {\n                await deleteFile(\n                    config.minio.bucketProjects,\n                    `${file.projectId}/${file.path}`\n                );\n            } catch (e) {\n                console.error('Failed to delete from MinIO:', e);\n            }\n        }\n\n        await prisma.file.delete({ where: { id } });\n\n        // Delete from local file storage\n        try {\n            if (file.isFolder) {\n                await fileStorage.deleteFolder(file.project.ownerId, file.projectId, file.path);\n            } else {\n                await fileStorage.deleteFile(file.project.ownerId, file.projectId, file.path);\n            }\n        } catch (storageError) {\n            console.error('[FileStorage] Failed to delete file:', storageError);\n        }\n\n        res.json({ message: 'File deleted successfully' });\n    } catch (error) {\n        console.error('Delete file error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Upload binary file\nrouter.post('/upload', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { projectId, path, name, mimeType, data } = req.body;\n\n        if (!projectId || !path || !name || !data) {\n            res.status(400).json({ error: 'Missing required fields' });\n            return;\n        }\n\n        const project = await prisma.project.findFirst({\n            where: {\n                id: projectId,\n                OR: [\n                    { ownerId: req.userId },\n                    { collaborators: { some: { userId: req.userId } } },\n                ],\n            },\n        });\n\n        if (!project) {\n            res.status(404).json({ error: 'Project not found' });\n            return;\n        }\n\n        // Decode base64 data\n        const buffer = Buffer.from(data, 'base64');\n\n        // Upload to MinIO\n        await uploadFile(\n            config.minio.bucketProjects,\n            `${projectId}/${path}`,\n            buffer,\n            mimeType || 'application/octet-stream'\n        );", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/files.ts", "file_name": "files.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "83", "text": "// Upload to MinIO\n        await uploadFile(\n            config.minio.bucketProjects,\n            `${projectId}/${path}`,\n            buffer,\n            mimeType || 'application/octet-stream'\n        );\n\n        // Create or update file record\n        const file = await prisma.file.upsert({\n            where: { projectId_path: { projectId, path } },\n            create: {\n                name,\n                path,\n                mimeType,\n                size: buffer.length,\n                projectId,\n                isFolder: false,\n            },\n            update: {\n                name,\n                mimeType,\n                size: buffer.length,\n            },\n        });\n\n        // Save to local file storage\n        try {\n            await fileStorage.saveFile(project.ownerId, projectId, path, buffer);\n        } catch (storageError) {\n            console.error('[FileStorage] Failed to save uploaded file:', storageError);\n        }\n\n        res.status(201).json({ file });\n    } catch (error) {\n        console.error('Upload file error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\nexport default router;", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/files.ts", "file_name": "files.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "84", "text": "import { Router, Response } from 'express';\nimport { prisma } from '../lib/prisma';\nimport { authMiddleware, AuthRequest } from '../middleware/auth';\nimport { Engine } from '@prisma/client';\nimport { fileStorage } from '../services/FileStorage';\n\nconst router = Router();\n\n// Get all projects for current user\nrouter.get('/', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const projects = await prisma.project.findMany({\n            where: {\n                OR: [\n                    { ownerId: req.userId },\n                    { collaborators: { some: { userId: req.userId } } },\n                ],\n            },\n            include: {\n                owner: { select: { id: true, name: true, email: true } },\n                _count: { select: { files: true, collaborators: true } },\n            },\n            orderBy: { updatedAt: 'desc' },\n        });\n\n        res.json({ projects });\n    } catch (error) {\n        console.error('Get projects error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Create new project\nrouter.post('/', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { name, description, engine = 'TYPST' } = req.body;\n\n        if (!name) {\n            res.status(400).json({ error: 'Project name is required' });\n            return;\n        }\n\n        const mainFile = engine === 'LATEX' ? 'main.tex' : 'main.typ';\n        const defaultContent = engine === 'LATEX'\n            ? `\\\\documentclass{article}\n\\\\usepackage[utf8]{inputenc}\n\n\\\\title{${name}}\n\\\\author{Your Name}\n\\\\date{\\\\today}\n\n\\\\begin{document}\n\n\\\\maketitle\n\n\\\\section{Introduction}\nHello, World! This is your first LaTeX document.\n\n\\\\end{document}`\n            : `#set document(title: \"${name}\", author: \"Your Name\")\n#set page(paper: \"a4\")\n#set text(font: \"New Computer Modern\", size: 11pt)\n\n= ${name}\n\n== Introduction", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/projects.ts", "file_name": "projects.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "85", "text": "= ${name}\n\n== Introduction\n\nHello, World! This is your first Typst document.\n\n#lorem(50)`;\n\n        const project = await prisma.project.create({\n            data: {\n                name,\n                description,\n                engine: engine as Engine,\n                mainFile,\n                ownerId: req.userId!,\n                files: {\n                    create: {\n                        name: mainFile,\n                        path: `/${mainFile}`,\n                        content: defaultContent,\n                        isFolder: false,\n                    },\n                },\n            },\n            include: {\n                owner: { select: { id: true, name: true, email: true } },\n                files: true,\n            },\n        });\n\n        // Create project directory structure\n        try {\n            await fileStorage.createProjectDir(req.userId!, project.id);\n            // Save main file to disk\n            await fileStorage.saveFile(req.userId!, project.id, `/${mainFile}`, defaultContent);\n            console.log(`[FileStorage] Created project structure for ${req.userId}/${project.id}`);\n        } catch (storageError) {\n            console.error('[FileStorage] Failed to create project directory:', storageError);\n            // Continue even if storage fails\n        }\n\n        res.status(201).json({ project });\n    } catch (error) {\n        console.error('Create project error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Get single project\nrouter.get('/:id', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { id } = req.params;\n\n        const project = await prisma.project.findFirst({\n            where: {\n                id,\n                OR: [\n                    { ownerId: req.userId },\n                    { collaborators: { some: { userId: req.userId } } },\n                ],\n            },\n            include: {\n                owner: { select: { id: true, name: true, email: true } },\n                files: { orderBy: [{ isFolder: 'desc' }, { name: 'asc' }] },\n                collaborators: {\n                    include: {\n                        user: { select: { id: true, name: true, email: true } },\n                    },\n                },\n            },\n        });", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/projects.ts", "file_name": "projects.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "86", "text": "if (!project) {\n            res.status(404).json({ error: 'Project not found' });\n            return;\n        }\n\n        res.json({ project });\n    } catch (error) {\n        console.error('Get project error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Update project\nrouter.patch('/:id', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { id } = req.params;\n        const { name, description, mainFile } = req.body;\n\n        const project = await prisma.project.findFirst({\n            where: { id, ownerId: req.userId },\n        });\n\n        if (!project) {\n            res.status(404).json({ error: 'Project not found or not authorized' });\n            return;\n        }\n\n        const updated = await prisma.project.update({\n            where: { id },\n            data: {\n                ...(name && { name }),\n                ...(description !== undefined && { description }),\n                ...(mainFile && { mainFile }),\n            },\n            include: {\n                owner: { select: { id: true, name: true, email: true } },\n            },\n        });\n\n        res.json({ project: updated });\n    } catch (error) {\n        console.error('Update project error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Delete project\nrouter.delete('/:id', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { id } = req.params;\n\n        const project = await prisma.project.findFirst({\n            where: { id, ownerId: req.userId },\n        });\n\n        if (!project) {\n            res.status(404).json({ error: 'Project not found or not authorized' });\n            return;\n        }\n\n        await prisma.project.delete({ where: { id } });\n\n        // Delete project directory from file storage\n        try {\n            await fileStorage.deleteProject(req.userId!, id);\n            console.log(`[FileStorage] Deleted project ${req.userId}/${id}`);\n        } catch (storageError) {\n            console.error('[FileStorage] Failed to delete project directory:', storageError);\n        }", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/projects.ts", "file_name": "projects.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "87", "text": "res.json({ message: 'Project deleted successfully' });\n    } catch (error) {\n        console.error('Delete project error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Add collaborator\nrouter.post('/:id/collaborators', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { id } = req.params;\n        const { email, role = 'EDITOR' } = req.body;\n\n        const project = await prisma.project.findFirst({\n            where: { id, ownerId: req.userId },\n        });\n\n        if (!project) {\n            res.status(404).json({ error: 'Project not found or not authorized' });\n            return;\n        }\n\n        const user = await prisma.user.findUnique({ where: { email } });\n        if (!user) {\n            res.status(404).json({ error: 'User not found' });\n            return;\n        }\n\n        if (user.id === req.userId) {\n            res.status(400).json({ error: 'Cannot add yourself as collaborator' });\n            return;\n        }\n\n        const collaborator = await prisma.projectCollaborator.create({\n            data: {\n                projectId: id,\n                userId: user.id,\n                role,\n            },\n            include: {\n                user: { select: { id: true, name: true, email: true } },\n            },\n        });\n\n        res.status(201).json({ collaborator });\n    } catch (error) {\n        console.error('Add collaborator error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Remove collaborator from project\nrouter.delete('/:id/collaborators/:userId', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { id, userId } = req.params;\n\n        const project = await prisma.project.findFirst({\n            where: { id, ownerId: req.userId },\n        });\n\n        if (!project) {\n            res.status(404).json({ error: 'Project not found or not authorized' });\n            return;\n        }", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/projects.ts", "file_name": "projects.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "88", "text": "if (!project) {\n            res.status(404).json({ error: 'Project not found or not authorized' });\n            return;\n        }\n\n        await prisma.projectCollaborator.deleteMany({\n            where: {\n                projectId: id,\n                userId: userId,\n            },\n        });\n\n        res.json({ message: 'Collaborator removed successfully' });\n    } catch (error) {\n        console.error('Remove collaborator error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\nexport default router;", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/projects.ts", "file_name": "projects.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "89", "text": "import { Router, Response } from 'express';\nimport { authMiddleware, AuthRequest } from '../middleware/auth';\nimport { fileStorage } from '../services/FileStorage';\nimport { prisma } from '../lib/prisma';\n\nconst router = Router();\n\n// Get user storage statistics\nrouter.get('/storage', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const userId = req.userId!;\n\n        // Get total storage size\n        const totalSize = await fileStorage.getUserStorageSize(userId);\n\n        // Get project count\n        const projects = await prisma.project.findMany({\n            where: { ownerId: userId },\n            select: { id: true, name: true },\n        });\n\n        // Get individual project sizes\n        const projectSizes = await Promise.all(\n            projects.map(async (project) => ({\n                projectId: project.id,\n                projectName: project.name,\n                size: await fileStorage.getProjectStorageSize(userId, project.id),\n            }))\n        );\n\n        res.json({\n            userId,\n            totalSize,\n            totalSizeMB: (totalSize / 1024 / 1024).toFixed(2),\n            projectCount: projects.length,\n            projects: projectSizes,\n        });\n    } catch (error) {\n        console.error('Get storage stats error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// Get project metadata\nrouter.get('/project/:projectId/metadata', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const { projectId } = req.params;\n        const userId = req.userId!;\n\n        // Verify user has access to project\n        const project = await prisma.project.findFirst({\n            where: {\n                id: projectId,\n                OR: [\n                    { ownerId: userId },\n                    { collaborators: { some: { userId } } },\n                ],\n            },\n        });\n\n        if (!project) {\n            res.status(404).json({ error: 'Project not found' });\n            return;\n        }\n\n        const metadata = await fileStorage.getProjectMetadata(project.ownerId, projectId);\n        const size = await fileStorage.getProjectStorageSize(project.ownerId, projectId);", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/storage.ts", "file_name": "storage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "90", "text": "const metadata = await fileStorage.getProjectMetadata(project.ownerId, projectId);\n        const size = await fileStorage.getProjectStorageSize(project.ownerId, projectId);\n\n        res.json({\n            projectId,\n            metadata,\n            size,\n            sizeMB: (size / 1024 / 1024).toFixed(2),\n        });\n    } catch (error) {\n        console.error('Get project metadata error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\n// List all projects in user directory\nrouter.get('/directory', authMiddleware, async (req: AuthRequest, res: Response): Promise<void> => {\n    try {\n        const userId = req.userId!;\n        const projectIds = await fileStorage.getUserProjects(userId);\n\n        // Get project details from database\n        const projects = await prisma.project.findMany({\n            where: {\n                id: { in: projectIds },\n                ownerId: userId,\n            },\n            select: {\n                id: true,\n                name: true,\n                engine: true,\n                createdAt: true,\n                updatedAt: true,\n            },\n        });\n\n        res.json({ projects });\n    } catch (error) {\n        console.error('List user directory error:', error);\n        res.status(500).json({ error: 'Internal server error' });\n    }\n});\n\nexport default router;", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/storage.ts", "file_name": "storage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "91", "text": "import { Router, Request, Response } from 'express';\nimport { exec } from 'child_process';\nimport path from 'path';\nimport fs from 'fs';\nimport { promisify } from 'util';\n\n// CommonJS __dirname is automatically available\n\nconst execAsync = promisify(exec);\nconst router = Router();\n\n// Map Kpathsea format IDs to format names\nconst FORMAT_MAP: Record<number, string> = {\n    1: 'pk',\n    3: 'tfm',\n    4: 'vf',\n    10: 'fmt',\n    20: 'map',\n    26: 'tex',\n    32: 'type1 fonts',\n    34: 'enc',\n    36: 'truetype fonts',\n    45: 'opentype fonts',\n    // Add others as needed\n};\n\n// Helper to run kpsewhich\nasync function findFile(filename: string, formatId: number): Promise<string | null> {\n    try {\n        const format = FORMAT_MAP[formatId];\n        const cmd = format\n            ? `kpsewhich --format=\"${format}\" \"${filename}\"`\n            : `kpsewhich \"${filename}\"`;\n\n        const { stdout } = await execAsync(cmd);\n        const filePath = stdout.trim();\n        return filePath && fs.existsSync(filePath) ? filePath : null;\n    } catch (e) {\n        return null;\n    }\n}\n\nasync function findPk(filename: string, dpi: number): Promise<string | null> {\n    try {\n        const cmd = `kpsewhich --format=pk --dpi=${dpi} \"${filename}\"`;\n        const { stdout } = await execAsync(cmd);\n        const filePath = stdout.trim();\n        return filePath && fs.existsSync(filePath) ? filePath : null;\n    } catch (e) {\n        return null;\n    }\n}\n\n// Route for standard files\nrouter.get('/pdftex/:format/:filename', async (req: Request, res: Response) => {\n    const format = parseInt(req.params.format);\n    const filename = req.params.filename;", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/texlyre.ts", "file_name": "texlyre.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "92", "text": "// Route for standard files\nrouter.get('/pdftex/:format/:filename', async (req: Request, res: Response) => {\n    const format = parseInt(req.params.format);\n    const filename = req.params.filename;\n\n    // Special case for our custom format file\n    if (filename === 'swiftlatexpdftex.fmt') {\n        const customPath = path.resolve(__dirname, '../../../../client/public/core/swiftlatex/pdftex/10/swiftlatexpdftex.fmt');\n        if (fs.existsSync(customPath)) {\n            res.setHeader('fileid', filename);\n            res.setHeader('Access-Control-Expose-Headers', 'fileid');\n            return res.sendFile(customPath);\n        }\n    }\n\n    const filePath = await findFile(filename, format);\n\n    if (filePath) {\n        res.setHeader('fileid', path.basename(filePath));\n        res.setHeader('Access-Control-Expose-Headers', 'fileid');\n        res.sendFile(filePath);\n    } else {\n        res.status(404).send('File not found');\n    }\n});\n\n// Route for XeTeX files\nrouter.get('/xetex/:format/:filename', async (req: Request, res: Response) => {\n    const format = parseInt(req.params.format);\n    const filename = req.params.filename;\n\n    console.log(`[XeTeX Route] Requested: ${filename}, format: ${format}`);\n\n    // Special case for our custom XeTeX format file\n    if (filename === 'swiftlatexxetex.fmt') {\n        const customPath = path.resolve(__dirname, '../../../client/public/core/swiftlatex/xetex/10/swiftlatexxetex.fmt');\n        console.log(`[XeTeX Route] Custom path: ${customPath}`);\n        console.log(`[XeTeX Route] File exists: ${fs.existsSync(customPath)}`);\n        \n        if (fs.existsSync(customPath)) {\n            res.setHeader('fileid', filename);\n            res.setHeader('Access-Control-Expose-Headers', 'fileid');\n            return res.sendFile(customPath);\n        }\n    }\n\n    const filePath = await findFile(filename, format);", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/texlyre.ts", "file_name": "texlyre.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "93", "text": "const filePath = await findFile(filename, format);\n\n    if (filePath) {\n        res.setHeader('fileid', path.basename(filePath));\n        res.setHeader('Access-Control-Expose-Headers', 'fileid');\n        res.sendFile(filePath);\n    } else {\n        console.log(`[XeTeX Route] File not found: ${filename}`);\n        res.status(404).send('File not found');\n    }\n});\n\n// Route for PK fonts\nrouter.get('/pdftex/pk/:dpi/:filename', async (req: Request, res: Response) => {\n    const dpi = parseInt(req.params.dpi);\n    const filename = req.params.filename;\n\n    const filePath = await findPk(filename, dpi);\n\n    if (filePath) {\n        res.setHeader('pkid', path.basename(filePath));\n        res.setHeader('Access-Control-Expose-Headers', 'pkid');\n        res.sendFile(filePath);\n    } else {\n        res.status(404).send('File not found');\n    }\n});\n\nexport default router;", "metadata": {"file_path": "/Users/mac/heytex/server/src/routes/texlyre.ts", "file_name": "texlyre.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "94", "text": "/**\n * Migration Script: Move existing projects to new file structure\n * Run: npx ts-node src/scripts/migrate-to-file-storage.ts\n */\n\nimport { prisma } from '../lib/prisma';\nimport { fileStorage } from '../services/FileStorage';\n\nasync function migrateProjects() {\n    console.log('üöÄ Starting migration to new file storage structure...\\n');\n\n    try {\n        // Get all projects\n        const projects = await prisma.project.findMany({\n            include: {\n                files: true,\n                owner: true,\n            },\n        });\n\n        console.log(`Found ${projects.length} projects to migrate\\n`);\n\n        let successCount = 0;\n        let failureCount = 0;\n\n        for (const project of projects) {\n            console.log(`\\nüìÅ Migrating project: ${project.name} (${project.id})`);\n            console.log(`   Owner: ${project.owner.email} (${project.ownerId})`);\n            console.log(`   Files: ${project.files.length}`);\n\n            try {\n                // Create project directory structure\n                await fileStorage.createProjectDir(project.ownerId, project.id);\n\n                // Migrate each file\n                for (const file of project.files) {\n                    if (file.isFolder) {\n                        // Create folder\n                        await fileStorage.createFolder(project.ownerId, project.id, file.path);\n                        console.log(`   ‚úì Created folder: ${file.path}`);\n                    } else if (file.content) {\n                        // Save text file\n                        await fileStorage.saveFile(project.ownerId, project.id, file.path, file.content);\n                        console.log(`   ‚úì Saved file: ${file.path} (${file.content.length} bytes)`);\n                    } else {\n                        console.log(`   ‚ö† Skipped binary file: ${file.path} (no content in DB)`);\n                    }\n                }\n\n                successCount++;\n                console.log(`   ‚úÖ Project migrated successfully`);\n            } catch (error) {\n                failureCount++;\n                console.error(`   ‚ùå Failed to migrate project:`, error);\n            }\n        }", "metadata": {"file_path": "/Users/mac/heytex/server/src/scripts/migrate-to-file-storage.ts", "file_name": "migrate-to-file-storage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "95", "text": "successCount++;\n                console.log(`   ‚úÖ Project migrated successfully`);\n            } catch (error) {\n                failureCount++;\n                console.error(`   ‚ùå Failed to migrate project:`, error);\n            }\n        }\n\n        console.log('\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');\n        console.log(`\\nüìä Migration Summary:`);\n        console.log(`   Total projects: ${projects.length}`);\n        console.log(`   ‚úÖ Successful: ${successCount}`);\n        console.log(`   ‚ùå Failed: ${failureCount}`);\n        console.log('\\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\\n');\n\n        // Display directory structure\n        console.log('üìÇ New directory structure:');\n        console.log('   users/');\n        \n        const users = [...new Set(projects.map(p => p.ownerId))];\n        for (const userId of users) {\n            const userProjects = projects.filter(p => p.ownerId === userId);\n            const user = userProjects[0]?.owner;\n            console.log(`   ‚îú‚îÄ ${userId}/ (${user?.email || 'unknown'})`);\n            \n            for (let i = 0; i < userProjects.length; i++) {\n                const isLast = i === userProjects.length - 1;\n                const prefix = isLast ? '‚îî‚îÄ' : '‚îú‚îÄ';\n                const project = userProjects[i];\n                console.log(`   ‚îÇ  ${prefix} ${project.id}/ (${project.name})`);\n                console.log(`   ‚îÇ  ${isLast ? ' ' : '‚îÇ'}  ‚îú‚îÄ files/`);\n                console.log(`   ‚îÇ  ${isLast ? ' ' : '‚îÇ'}  ‚îî‚îÄ metadata.json`);\n            }\n        }\n\n        console.log('\\n‚ú® Migration completed!\\n');\n    } catch (error) {\n        console.error('‚ùå Migration failed:', error);\n        throw error;\n    } finally {\n        await prisma.$disconnect();\n    }\n}", "metadata": {"file_path": "/Users/mac/heytex/server/src/scripts/migrate-to-file-storage.ts", "file_name": "migrate-to-file-storage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "96", "text": "console.log('\\n‚ú® Migration completed!\\n');\n    } catch (error) {\n        console.error('‚ùå Migration failed:', error);\n        throw error;\n    } finally {\n        await prisma.$disconnect();\n    }\n}\n\n// Run migration\nmigrateProjects()\n    .then(() => {\n        console.log('üëã Goodbye!');\n        process.exit(0);\n    })\n    .catch((error) => {\n        console.error('Fatal error:', error);\n        process.exit(1);\n    });", "metadata": {"file_path": "/Users/mac/heytex/server/src/scripts/migrate-to-file-storage.ts", "file_name": "migrate-to-file-storage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "97", "text": "/**\n * CompilationQueue Service\n * Qu·∫£n l√Ω queue bi√™n d·ªãch LaTeX v·ªõi gi·ªõi h·∫°n s·ªë l∆∞·ª£ng concurrent jobs\n */\n\nimport { exec } from 'child_process';\nimport { promisify } from 'util';\nimport fs from 'fs/promises';\nimport path from 'path';\nimport { v4 as uuidv4 } from 'uuid';\nimport os from 'os';\n\nconst execAsync = promisify(exec);\n\nexport interface CompilationJob {\n    id: string;\n    userId: string;\n    projectId: string;\n    fileName: string;\n    content: string;\n    status: 'queued' | 'compiling' | 'completed' | 'failed';\n    queuePosition?: number;\n    createdAt: Date;\n    startedAt?: Date;\n    completedAt?: Date;\n    pdfPath?: string;\n    logPath?: string;\n    error?: string;\n}\n\nexport interface QueueStats {\n    total: number;\n    compiling: number;\n    queued: number;\n    completed: number;\n    failed: number;\n}\n\nclass CompilationQueue {\n    private queue: CompilationJob[] = [];\n    private activeJobs: Map<string, CompilationJob> = new Map();\n    private completedJobs: Map<string, CompilationJob> = new Map();\n    private readonly maxConcurrent: number; // configurable via COMPILATION_MAX_CONCURRENT env var\n    private readonly tempDir: string = path.join(os.tmpdir(), 'heytex-compile');\n\n    constructor() {\n        // T·∫°o temp directory n·∫øu ch∆∞a t·ªìn t·∫°i\n        this.initTempDir();\n        // Configure max concurrent jobs from env or default to 10\n        const envVal = process.env.COMPILATION_MAX_CONCURRENT || process.env.MAX_CONCURRENT;\n        const parsed = envVal ? parseInt(envVal, 10) : NaN;\n        this.maxConcurrent = !isNaN(parsed) && parsed > 0 ? parsed : 10;\n    }\n\n    private async initTempDir() {\n        try {\n            await fs.mkdir(this.tempDir, { recursive: true });\n        } catch (error) {\n            console.error('Failed to create temp directory:', error);\n        }\n    }", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/CompilationQueue.ts", "file_name": "CompilationQueue.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-20"}}
{"id": "98", "text": "private async initTempDir() {\n        try {\n            await fs.mkdir(this.tempDir, { recursive: true });\n        } catch (error) {\n            console.error('Failed to create temp directory:', error);\n        }\n    }\n\n    /**\n     * Th√™m job m·ªõi v√†o queue\n     */\n    public async addJob(\n        userId: string,\n        projectId: string,\n        fileName: string,\n        content: string\n    ): Promise<string> {\n        const jobId = uuidv4();\n        const job: CompilationJob = {\n            id: jobId,\n            userId,\n            projectId,\n            fileName,\n            content,\n            status: 'queued',\n            createdAt: new Date(),\n        };\n\n        this.queue.push(job);\n        this.updateQueuePositions();\n\n        // B·∫Øt ƒë·∫ßu x·ª≠ l√Ω queue\n        this.processQueue();\n\n        return jobId;\n    }\n\n    /**\n     * L·∫•y th√¥ng tin job theo ID\n     */\n    public getJob(jobId: string): CompilationJob | undefined {\n        // T√¨m trong active jobs\n        if (this.activeJobs.has(jobId)) {\n            return this.activeJobs.get(jobId);\n        }\n\n        // T√¨m trong completed jobs\n        if (this.completedJobs.has(jobId)) {\n            return this.completedJobs.get(jobId);\n        }\n\n        // T√¨m trong queue\n        return this.queue.find(job => job.id === jobId);\n    }\n\n    /**\n     * L·∫•y th·ªëng k√™ queue\n     */\n    public getStats(): QueueStats {\n        return {\n            total: this.queue.length + this.activeJobs.size + this.completedJobs.size,\n            compiling: this.activeJobs.size,\n            queued: this.queue.length,\n            completed: Array.from(this.completedJobs.values()).filter(j => j.status === 'completed').length,\n            failed: Array.from(this.completedJobs.values()).filter(j => j.status === 'failed').length,\n        };\n    }\n\n    /**\n     * C·∫≠p nh·∫≠t queue position cho c√°c job ƒëang ch·ªù\n     */\n    private updateQueuePositions() {\n        this.queue.forEach((job, index) => {\n            job.queuePosition = index + 1;\n        });\n    }", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/CompilationQueue.ts", "file_name": "CompilationQueue.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-20"}}
{"id": "99", "text": "/**\n     * X·ª≠ l√Ω queue - ch·∫°y jobs n·∫øu c√≤n slot\n     */\n    private async processQueue() {\n        // N·∫øu ƒë√£ ƒë·∫ßy concurrent jobs, kh√¥ng l√†m g√¨\n        if (this.activeJobs.size >= this.maxConcurrent) {\n            return;\n        }\n\n        // L·∫•y job ƒë·∫ßu ti√™n trong queue\n        const job = this.queue.shift();\n        if (!job) {\n            return;\n        }\n\n        // Chuy·ªÉn sang tr·∫°ng th√°i compiling\n        job.status = 'compiling';\n        job.startedAt = new Date();\n        this.activeJobs.set(job.id, job);\n\n        // Compile trong background\n        this.compileJob(job).finally(() => {\n            // Sau khi xong, ti·∫øp t·ª•c x·ª≠ l√Ω queue\n            this.processQueue();\n        });\n\n        // C·∫≠p nh·∫≠t queue positions\n        this.updateQueuePositions();\n\n        // Ti·∫øp t·ª•c x·ª≠ l√Ω n·∫øu c√≤n slot\n        if (this.activeJobs.size < this.maxConcurrent) {\n            this.processQueue();\n        }\n    }\n\n    /**\n     * Bi√™n d·ªãch LaTeX job\n     */\n    private async compileJob(job: CompilationJob): Promise<void> {\n        const workDir = path.join(this.tempDir, job.id);\n\n        try {\n            // T·∫°o th∆∞ m·ª•c l√†m vi·ªác\n            await fs.mkdir(workDir, { recursive: true });\n\n            // Ghi file .tex\n            const texPath = path.join(workDir, job.fileName);\n            await fs.writeFile(texPath, job.content, 'utf-8');\n\n            console.log(`[CompilationQueue] Compiling job ${job.id} for user ${job.userId}`);", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/CompilationQueue.ts", "file_name": "CompilationQueue.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-20"}}
{"id": "100", "text": "console.log(`[CompilationQueue] Compiling job ${job.id} for user ${job.userId}`);\n\n            // Bi√™n d·ªãch v·ªõi xelatex (3 l·∫ßn ƒë·ªÉ resolve references)\n            const commands = [\n                `cd \"${workDir}\" && xelatex -interaction=nonstopmode -halt-on-error \"${job.fileName}\"`,\n                `cd \"${workDir}\" && xelatex -interaction=nonstopmode -halt-on-error \"${job.fileName}\"`,\n                `cd \"${workDir}\" && xelatex -interaction=nonstopmode -halt-on-error \"${job.fileName}\"`,\n            ];\n\n            for (const cmd of commands) {\n                try {\n                    const { stdout, stderr } = await execAsync(cmd, {\n                        cwd: workDir,\n                        maxBuffer: 10 * 1024 * 1024, // 10MB buffer\n                    });\n\n                    // Log output\n                    const logPath = path.join(workDir, 'compile.log');\n                    await fs.appendFile(logPath, `\\n=== Run ${commands.indexOf(cmd) + 1} ===\\n`);\n                    await fs.appendFile(logPath, stdout);\n                    if (stderr) {\n                        await fs.appendFile(logPath, '\\n=== STDERR ===\\n' + stderr);\n                    }\n                } catch (error: any) {\n                    // XeLaTeX c√≥ th·ªÉ return error code nh∆∞ng v·∫´n t·∫°o PDF\n                    // Ti·∫øp t·ª•c ƒë·ªÉ check PDF c√≥ t·ªìn t·∫°i kh√¥ng\n                    const logPath = path.join(workDir, 'compile.log');\n                    await fs.appendFile(logPath, `\\n=== Error in run ${commands.indexOf(cmd) + 1} ===\\n`);\n                    await fs.appendFile(logPath, error.stdout || '');\n                    await fs.appendFile(logPath, error.stderr || '');\n                }\n            }\n\n            // Ki·ªÉm tra PDF c√≥ ƒë∆∞·ª£c t·∫°o kh√¥ng\n            const pdfFileName = job.fileName.replace(/\\.tex$/, '.pdf');\n            const pdfPath = path.join(workDir, pdfFileName);\n            const logPath = path.join(workDir, job.fileName.replace(/\\.tex$/, '.log'));\n\n            const pdfExists = await fs.access(pdfPath).then(() => true).catch(() => false);", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/CompilationQueue.ts", "file_name": "CompilationQueue.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-20"}}
{"id": "101", "text": "const pdfExists = await fs.access(pdfPath).then(() => true).catch(() => false);\n\n            if (pdfExists) {\n                job.status = 'completed';\n                job.pdfPath = pdfPath;\n                job.logPath = logPath;\n                console.log(`[CompilationQueue] Job ${job.id} completed successfully`);\n            } else {\n                job.status = 'failed';\n                job.error = 'PDF was not generated';\n                job.logPath = logPath;\n                console.error(`[CompilationQueue] Job ${job.id} failed: PDF not generated`);\n            }\n\n        } catch (error: any) {\n            job.status = 'failed';\n            job.error = error.message || 'Unknown compilation error';\n            console.error(`[CompilationQueue] Job ${job.id} failed:`, error);\n        } finally {\n            job.completedAt = new Date();\n\n            // Chuy·ªÉn t·ª´ active sang completed\n            this.activeJobs.delete(job.id);\n            this.completedJobs.set(job.id, job);\n\n            // Cleanup sau 30 ph√∫t\n            setTimeout(() => {\n                this.cleanupJob(job.id);\n            }, 30 * 60 * 1000);\n        }\n    }\n\n    /**\n     * Cleanup job files\n     */\n    private async cleanupJob(jobId: string) {\n        try {\n            const workDir = path.join(this.tempDir, jobId);\n            await fs.rm(workDir, { recursive: true, force: true });\n            this.completedJobs.delete(jobId);\n            console.log(`[CompilationQueue] Cleaned up job ${jobId}`);\n        } catch (error) {\n            console.error(`[CompilationQueue] Failed to cleanup job ${jobId}:`, error);\n        }\n    }\n\n    /**\n     * L·∫•y PDF content c·ªßa job ƒë√£ ho√†n th√†nh\n     */\n    public async getPDF(jobId: string): Promise<Buffer | null> {\n        const job = this.completedJobs.get(jobId);\n        if (!job || !job.pdfPath) {\n            return null;\n        }\n\n        try {\n            return await fs.readFile(job.pdfPath);\n        } catch (error) {\n            console.error(`[CompilationQueue] Failed to read PDF for job ${jobId}:`, error);\n            return null;\n        }\n    }", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/CompilationQueue.ts", "file_name": "CompilationQueue.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-20"}}
{"id": "102", "text": "try {\n            return await fs.readFile(job.pdfPath);\n        } catch (error) {\n            console.error(`[CompilationQueue] Failed to read PDF for job ${jobId}:`, error);\n            return null;\n        }\n    }\n\n    /**\n     * L·∫•y log content c·ªßa job\n     */\n    public async getLog(jobId: string): Promise<string | null> {\n        const job = this.getJob(jobId);\n        if (!job || !job.logPath) {\n            return null;\n        }\n\n        try {\n            return await fs.readFile(job.logPath, 'utf-8');\n        } catch (error) {\n            console.error(`[CompilationQueue] Failed to read log for job ${jobId}:`, error);\n            return null;\n        }\n    }\n}\n\n// Singleton instance\nexport const compilationQueue = new CompilationQueue();", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/CompilationQueue.ts", "file_name": "CompilationQueue.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-20"}}
{"id": "103", "text": "/**\n * FileStorage Service\n * Qu·∫£n l√Ω c·∫•u tr√∫c th∆∞ m·ª•c v√† files cho t·ª´ng user\n * Structure: users/{userId}/{projectId}/files/...\n */\n\nimport fs from 'fs/promises';\nimport path from 'path';\nimport { existsSync } from 'fs';\n\nexport class FileStorageService {\n    private readonly baseDir: string;\n\n    constructor(baseDir: string = path.join(process.cwd(), '../users')) {\n        this.baseDir = baseDir;\n        this.initBaseDir();\n    }\n\n    private async initBaseDir() {\n        try {\n            await fs.mkdir(this.baseDir, { recursive: true });\n            console.log(`[FileStorage] Base directory initialized: ${this.baseDir}`);\n        } catch (error) {\n            console.error('[FileStorage] Failed to create base directory:', error);\n        }\n    }\n\n    /**\n     * L·∫•y ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c c·ªßa user\n     */\n    public getUserDir(userId: string): string {\n        return path.join(this.baseDir, userId);\n    }\n\n    /**\n     * L·∫•y ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c c·ªßa project\n     */\n    public getProjectDir(userId: string, projectId: string): string {\n        return path.join(this.getUserDir(userId), projectId);\n    }\n\n    /**\n     * L·∫•y ƒë∆∞·ªùng d·∫´n th∆∞ m·ª•c files c·ªßa project\n     */\n    public getProjectFilesDir(userId: string, projectId: string): string {\n        return path.join(this.getProjectDir(userId, projectId), 'files');\n    }\n\n    /**\n     * L·∫•y ƒë∆∞·ªùng d·∫´n file c·ª• th·ªÉ\n     */\n    public getFilePath(userId: string, projectId: string, relativePath: string): string {\n        // Remove leading slash if present\n        const cleanPath = relativePath.startsWith('/') ? relativePath.slice(1) : relativePath;\n        return path.join(this.getProjectFilesDir(userId, projectId), cleanPath);\n    }", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/FileStorage.ts", "file_name": "FileStorage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "104", "text": "/**\n     * T·∫°o th∆∞ m·ª•c user n·∫øu ch∆∞a t·ªìn t·∫°i\n     */\n    public async ensureUserDir(userId: string): Promise<void> {\n        const userDir = this.getUserDir(userId);\n        if (!existsSync(userDir)) {\n            await fs.mkdir(userDir, { recursive: true });\n            console.log(`[FileStorage] Created user directory: ${userId}`);\n        }\n    }\n\n    /**\n     * T·∫°o th∆∞ m·ª•c project\n     */\n    public async createProjectDir(userId: string, projectId: string): Promise<void> {\n        await this.ensureUserDir(userId);\n        \n        const projectDir = this.getProjectDir(userId, projectId);\n        const filesDir = this.getProjectFilesDir(userId, projectId);\n        \n        await fs.mkdir(projectDir, { recursive: true });\n        await fs.mkdir(filesDir, { recursive: true });\n        \n        // T·∫°o file metadata.json ƒë·ªÉ l∆∞u th√¥ng tin project\n        const metadataPath = path.join(projectDir, 'metadata.json');\n        const metadata = {\n            projectId,\n            userId,\n            createdAt: new Date().toISOString(),\n            lastModified: new Date().toISOString(),\n        };\n        await fs.writeFile(metadataPath, JSON.stringify(metadata, null, 2));\n        \n        console.log(`[FileStorage] Created project directory: ${userId}/${projectId}`);\n    }\n\n    /**\n     * L∆∞u file content\n     */\n    public async saveFile(\n        userId: string,\n        projectId: string,\n        relativePath: string,\n        content: string | Buffer\n    ): Promise<void> {\n        const filePath = this.getFilePath(userId, projectId, relativePath);\n        const fileDir = path.dirname(filePath);\n        \n        // T·∫°o th∆∞ m·ª•c cha n·∫øu ch∆∞a t·ªìn t·∫°i\n        await fs.mkdir(fileDir, { recursive: true });\n        \n        // L∆∞u file\n        await fs.writeFile(filePath, content, 'utf-8');\n        \n        // Update last modified trong metadata\n        await this.updateProjectMetadata(userId, projectId);\n    }", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/FileStorage.ts", "file_name": "FileStorage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "105", "text": "/**\n     * ƒê·ªçc file content\n     */\n    public async readFile(\n        userId: string,\n        projectId: string,\n        relativePath: string\n    ): Promise<string> {\n        const filePath = this.getFilePath(userId, projectId, relativePath);\n        return await fs.readFile(filePath, 'utf-8');\n    }\n\n    /**\n     * X√≥a file\n     */\n    public async deleteFile(\n        userId: string,\n        projectId: string,\n        relativePath: string\n    ): Promise<void> {\n        const filePath = this.getFilePath(userId, projectId, relativePath);\n        await fs.unlink(filePath);\n        await this.updateProjectMetadata(userId, projectId);\n    }\n\n    /**\n     * T·∫°o th∆∞ m·ª•c\n     */\n    public async createFolder(\n        userId: string,\n        projectId: string,\n        relativePath: string\n    ): Promise<void> {\n        const folderPath = this.getFilePath(userId, projectId, relativePath);\n        await fs.mkdir(folderPath, { recursive: true });\n        await this.updateProjectMetadata(userId, projectId);\n    }\n\n    /**\n     * X√≥a th∆∞ m·ª•c\n     */\n    public async deleteFolder(\n        userId: string,\n        projectId: string,\n        relativePath: string\n    ): Promise<void> {\n        const folderPath = this.getFilePath(userId, projectId, relativePath);\n        await fs.rm(folderPath, { recursive: true, force: true });\n        await this.updateProjectMetadata(userId, projectId);\n    }\n\n    /**\n     * X√≥a to√†n b·ªô project\n     */\n    public async deleteProject(userId: string, projectId: string): Promise<void> {\n        const projectDir = this.getProjectDir(userId, projectId);\n        await fs.rm(projectDir, { recursive: true, force: true });\n        console.log(`[FileStorage] Deleted project: ${userId}/${projectId}`);\n    }", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/FileStorage.ts", "file_name": "FileStorage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "106", "text": "/**\n     * L·∫•y danh s√°ch files trong th∆∞ m·ª•c\n     */\n    public async listFiles(\n        userId: string,\n        projectId: string,\n        relativePath: string = ''\n    ): Promise<string[]> {\n        const dirPath = relativePath\n            ? this.getFilePath(userId, projectId, relativePath)\n            : this.getProjectFilesDir(userId, projectId);\n        \n        try {\n            const entries = await fs.readdir(dirPath, { withFileTypes: true });\n            return entries.map(entry => entry.name);\n        } catch (error) {\n            return [];\n        }\n    }\n\n    /**\n     * Ki·ªÉm tra file c√≥ t·ªìn t·∫°i kh√¥ng\n     */\n    public fileExists(userId: string, projectId: string, relativePath: string): boolean {\n        const filePath = this.getFilePath(userId, projectId, relativePath);\n        return existsSync(filePath);\n    }\n\n    /**\n     * Update project metadata\n     */\n    private async updateProjectMetadata(userId: string, projectId: string): Promise<void> {\n        const metadataPath = path.join(this.getProjectDir(userId, projectId), 'metadata.json');\n        try {\n            const content = await fs.readFile(metadataPath, 'utf-8');\n            const metadata = JSON.parse(content);\n            metadata.lastModified = new Date().toISOString();\n            await fs.writeFile(metadataPath, JSON.stringify(metadata, null, 2));\n        } catch (error) {\n            // Metadata file might not exist for old projects\n            console.warn(`[FileStorage] Failed to update metadata for ${userId}/${projectId}`);\n        }\n    }\n\n    /**\n     * L·∫•y th√¥ng tin metadata c·ªßa project\n     */\n    public async getProjectMetadata(userId: string, projectId: string): Promise<any> {\n        const metadataPath = path.join(this.getProjectDir(userId, projectId), 'metadata.json');\n        try {\n            const content = await fs.readFile(metadataPath, 'utf-8');\n            return JSON.parse(content);\n        } catch (error) {\n            return null;\n        }\n    }", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/FileStorage.ts", "file_name": "FileStorage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "107", "text": "/**\n     * L·∫•y danh s√°ch projects c·ªßa user\n     */\n    public async getUserProjects(userId: string): Promise<string[]> {\n        const userDir = this.getUserDir(userId);\n        try {\n            const entries = await fs.readdir(userDir, { withFileTypes: true });\n            return entries\n                .filter(entry => entry.isDirectory())\n                .map(entry => entry.name);\n        } catch (error) {\n            return [];\n        }\n    }\n\n    /**\n     * L·∫•y t·ªïng dung l∆∞·ª£ng c·ªßa user (t·∫•t c·∫£ projects)\n     */\n    public async getUserStorageSize(userId: string): Promise<number> {\n        const userDir = this.getUserDir(userId);\n        try {\n            return await this.getDirectorySize(userDir);\n        } catch (error) {\n            return 0;\n        }\n    }\n\n    /**\n     * L·∫•y dung l∆∞·ª£ng c·ªßa m·ªôt project\n     */\n    public async getProjectStorageSize(userId: string, projectId: string): Promise<number> {\n        const projectDir = this.getProjectDir(userId, projectId);\n        try {\n            return await this.getDirectorySize(projectDir);\n        } catch (error) {\n            return 0;\n        }\n    }\n\n    /**\n     * Helper: T√≠nh t·ªïng dung l∆∞·ª£ng c·ªßa th∆∞ m·ª•c (recursive)\n     */\n    private async getDirectorySize(dirPath: string): Promise<number> {\n        let totalSize = 0;\n        \n        try {\n            const entries = await fs.readdir(dirPath, { withFileTypes: true });\n            \n            for (const entry of entries) {\n                const fullPath = path.join(dirPath, entry.name);\n                \n                if (entry.isDirectory()) {\n                    totalSize += await this.getDirectorySize(fullPath);\n                } else {\n                    const stats = await fs.stat(fullPath);\n                    totalSize += stats.size;\n                }\n            }\n        } catch (error) {\n            console.error(`[FileStorage] Error calculating size for ${dirPath}:`, error);\n        }\n        \n        return totalSize;\n    }", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/FileStorage.ts", "file_name": "FileStorage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "108", "text": "/**\n     * Rename/move file\n     */\n    public async renameFile(\n        userId: string,\n        projectId: string,\n        oldPath: string,\n        newPath: string\n    ): Promise<void> {\n        const oldFilePath = this.getFilePath(userId, projectId, oldPath);\n        const newFilePath = this.getFilePath(userId, projectId, newPath);\n        \n        // T·∫°o th∆∞ m·ª•c ƒë√≠ch n·∫øu c·∫ßn\n        const newDir = path.dirname(newFilePath);\n        await fs.mkdir(newDir, { recursive: true });\n        \n        // Rename file\n        await fs.rename(oldFilePath, newFilePath);\n        await this.updateProjectMetadata(userId, projectId);\n    }\n\n    /**\n     * Copy file\n     */\n    public async copyFile(\n        userId: string,\n        projectId: string,\n        sourcePath: string,\n        destPath: string\n    ): Promise<void> {\n        const sourceFilePath = this.getFilePath(userId, projectId, sourcePath);\n        const destFilePath = this.getFilePath(userId, projectId, destPath);\n        \n        // T·∫°o th∆∞ m·ª•c ƒë√≠ch n·∫øu c·∫ßn\n        const destDir = path.dirname(destFilePath);\n        await fs.mkdir(destDir, { recursive: true });\n        \n        // Copy file\n        await fs.copyFile(sourceFilePath, destFilePath);\n        await this.updateProjectMetadata(userId, projectId);\n    }\n}\n\n// Export singleton instance\nexport const fileStorage = new FileStorageService();", "metadata": {"file_path": "/Users/mac/heytex/server/src/services/FileStorage.ts", "file_name": "FileStorage.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "109", "text": "import { Server as HttpServer } from 'http';\nimport { Server as SocketIOServer, Socket } from 'socket.io';\nimport * as Y from 'yjs';\nimport * as encoding from 'lib0/encoding';\nimport * as decoding from 'lib0/decoding';\nimport * as syncProtocol from 'y-protocols/sync';\nimport * as awarenessProtocol from 'y-protocols/awareness';\nimport { prisma } from '../lib/prisma';\nimport { config } from '../config/index';\n\n// Store for Yjs documents\nconst docs = new Map<string, Y.Doc>();\nconst awarenessMap = new Map<string, awarenessProtocol.Awareness>();\n\n// Message types\nconst messageSync = 0;\nconst messageAwareness = 1;\n\ninterface UserInfo {\n    id: string;\n    name: string;\n    color: string;\n}\n\nfunction getRandomColor(): string {\n    const colors = [\n        '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4',\n        '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F',\n        '#BB8FCE', '#85C1E9', '#F8B500', '#00CED1',\n    ];\n    return colors[Math.floor(Math.random() * colors.length)];\n}\n\nfunction getDoc(docName: string): Y.Doc {\n    let doc = docs.get(docName);\n    if (!doc) {\n        doc = new Y.Doc();\n        docs.set(docName, doc);\n\n        // Set up persistence - save to DB periodically\n        doc.on('update', async () => {\n            try {\n                // Debounce and save to database\n                await saveDocToDatabase(docName, doc!);\n            } catch (e) {\n                console.error('Failed to save doc:', e);\n            }\n        });\n    }\n    return doc;\n}\n\nfunction getAwareness(docName: string, doc: Y.Doc): awarenessProtocol.Awareness {\n    let awareness = awarenessMap.get(docName);\n    if (!awareness) {\n        awareness = new awarenessProtocol.Awareness(doc);\n        awarenessMap.set(docName, awareness);\n    }\n    return awareness;\n}", "metadata": {"file_path": "/Users/mac/heytex/server/src/websocket/collab.ts", "file_name": "collab.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "110", "text": "// Debounce save operations\nconst saveTimeouts = new Map<string, NodeJS.Timeout>();\n\nasync function saveDocToDatabase(docName: string, doc: Y.Doc): Promise<void> {\n    // Clear existing timeout\n    const existingTimeout = saveTimeouts.get(docName);\n    if (existingTimeout) {\n        clearTimeout(existingTimeout);\n    }\n\n    // Set new timeout for debounced save\n    saveTimeouts.set(docName, setTimeout(async () => {\n        try {\n            // docName format: \"project:projectId:path\"\n            const parts = docName.split(':');\n            if (parts.length < 3) return;\n\n            const projectId = parts[1];\n            const path = parts.slice(2).join(':');\n\n            const text = doc.getText('content');\n            const content = text.toString();\n\n            await prisma.file.updateMany({\n                where: { projectId, path },\n                data: { content },\n            });\n        } catch (e) {\n            console.error('Failed to persist doc:', e);\n        }\n    }, 2000)); // Save after 2 seconds of inactivity\n}\n\nasync function loadDocFromDatabase(docName: string, doc: Y.Doc): Promise<void> {\n    try {\n        const parts = docName.split(':');\n        if (parts.length < 3) return;\n\n        const projectId = parts[1];\n        const path = parts.slice(2).join(':');\n\n        const file = await prisma.file.findUnique({\n            where: { projectId_path: { projectId, path } },\n        });\n\n        if (file?.content) {\n            const text = doc.getText('content');\n            if (text.length === 0) {\n                text.insert(0, file.content);\n            }\n        }\n    } catch (e) {\n        console.error('Failed to load doc from database:', e);\n    }\n}\n\nexport function setupCollaborationServer(httpServer: HttpServer): SocketIOServer {\n    const io = new SocketIOServer(httpServer, {\n        cors: {\n            origin: config.cors.origin,\n            methods: ['GET', 'POST'],\n            credentials: true,\n        },\n        path: '/collab',\n    });", "metadata": {"file_path": "/Users/mac/heytex/server/src/websocket/collab.ts", "file_name": "collab.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "111", "text": "io.on('connection', (socket: Socket) => {\n        console.log('Client connected:', socket.id);\n\n        let currentDocName: string | null = null;\n        let currentDoc: Y.Doc | null = null;\n        let currentAwareness: awarenessProtocol.Awareness | null = null;\n        let userInfo: UserInfo | null = null;\n\n        socket.on('join-room', async (data: { docName: string; user: { id: string; name: string } }) => {\n            const { docName, user } = data;\n\n            // Leave previous room if any\n            if (currentDocName) {\n                socket.leave(currentDocName);\n            }\n\n            currentDocName = docName;\n            currentDoc = getDoc(docName);\n            currentAwareness = getAwareness(docName, currentDoc);\n            userInfo = { ...user, color: getRandomColor() };\n\n            // Load initial content from database if doc is empty\n            if (currentDoc.getText('content').length === 0) {\n                await loadDocFromDatabase(docName, currentDoc);\n            }\n\n            // Join the room\n            socket.join(docName);\n\n            // Set up awareness for this client\n            const clientId = currentDoc.clientID;\n            currentAwareness.setLocalStateField('user', userInfo);\n\n            // Send sync step 1\n            const encoder = encoding.createEncoder();\n            encoding.writeVarUint(encoder, messageSync);\n            syncProtocol.writeSyncStep1(encoder, currentDoc);\n            socket.emit('sync', encoding.toUint8Array(encoder));\n\n            // Send current awareness state\n            const awarenessEncoder = encoding.createEncoder();\n            encoding.writeVarUint(awarenessEncoder, messageAwareness);\n            encoding.writeVarUint8Array(\n                awarenessEncoder,\n                awarenessProtocol.encodeAwarenessUpdate(\n                    currentAwareness,\n                    Array.from(currentAwareness.getStates().keys())\n                )\n            );\n            socket.emit('sync', encoding.toUint8Array(awarenessEncoder));\n\n            console.log(`User ${user.name} joined room ${docName}`);\n        });\n\n        socket.on('sync', (message: Uint8Array) => {\n            if (!currentDoc || !currentDocName || !currentAwareness) return;", "metadata": {"file_path": "/Users/mac/heytex/server/src/websocket/collab.ts", "file_name": "collab.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "112", "text": "socket.on('sync', (message: Uint8Array) => {\n            if (!currentDoc || !currentDocName || !currentAwareness) return;\n\n            try {\n                const decoder = decoding.createDecoder(message);\n                const messageType = decoding.readVarUint(decoder);\n\n                switch (messageType) {\n                    case messageSync: {\n                        const encoder = encoding.createEncoder();\n                        encoding.writeVarUint(encoder, messageSync);\n                        const syncMessageType = syncProtocol.readSyncMessage(\n                            decoder,\n                            encoder,\n                            currentDoc,\n                            null\n                        );\n\n                        if (syncMessageType !== 0) {\n                            // Broadcast to all clients in room except sender\n                            socket.to(currentDocName).emit('sync', encoding.toUint8Array(encoder));\n                        }\n\n                        // If this was sync step 1, we need to respond with step 2\n                        if (encoding.length(encoder) > 1) {\n                            socket.emit('sync', encoding.toUint8Array(encoder));\n                        }\n                        break;\n                    }\n\n                    case messageAwareness: {\n                        const update = decoding.readVarUint8Array(decoder);\n                        awarenessProtocol.applyAwarenessUpdate(\n                            currentAwareness,\n                            update,\n                            socket\n                        );\n\n                        // Broadcast awareness to all clients in room\n                        socket.to(currentDocName).emit('sync', message);\n                        break;\n                    }\n                }\n            } catch (e) {\n                console.error('Error processing sync message:', e);\n            }\n        });\n\n        socket.on('update', (update: Uint8Array) => {\n            if (!currentDoc || !currentDocName) return;\n\n            try {\n                Y.applyUpdate(currentDoc, update);\n\n                // Broadcast to all other clients in the room\n                socket.to(currentDocName).emit('update', update);\n            } catch (e) {\n                console.error('Error applying update:', e);\n            }\n        });\n\n        socket.on('disconnect', () => {\n            console.log('Client disconnected:', socket.id);\n\n            if (currentAwareness && currentDoc) {\n                // Remove this client's awareness state\n                awarenessProtocol.removeAwarenessStates(\n                    currentAwareness,\n                    [currentDoc.clientID],\n                    null\n                );\n            }\n        });\n    });\n\n    return io;\n}", "metadata": {"file_path": "/Users/mac/heytex/server/src/websocket/collab.ts", "file_name": "collab.ts", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "113", "text": "#root {\n  max-width: 1280px;\n  margin: 0 auto;\n  padding: 2rem;\n  text-align: center;\n}\n\n.logo {\n  height: 6em;\n  padding: 1.5em;\n  will-change: filter;\n  transition: filter 300ms;\n}\n.logo:hover {\n  filter: drop-shadow(0 0 2em #646cffaa);\n}\n.logo.react:hover {\n  filter: drop-shadow(0 0 2em #61dafbaa);\n}\n\n@keyframes logo-spin {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n@media (prefers-reduced-motion: no-preference) {\n  a:nth-of-type(2) .logo {\n    animation: logo-spin infinite 20s linear;\n  }\n}\n\n.card {\n  padding: 2em;\n}\n\n.read-the-docs {\n  color: #888;\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/App.css", "file_name": "App.css", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "114", "text": "import { useEffect } from 'react';\nimport { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';\nimport { useAuthStore } from './stores';\nimport { LoadingScreen } from './components/ui/Spinner';\nimport { LoginPage } from './pages/LoginPage';\nimport { RegisterPage } from './pages/RegisterPage';\nimport { DashboardPage } from './pages/DashboardPage';\nimport { EditorPage } from './pages/EditorPage';\n\nfunction ProtectedRoute({ children }: { children: React.ReactNode }) {\n  const { isAuthenticated, isLoading } = useAuthStore();\n\n  if (isLoading) {\n    return <LoadingScreen message=\"ƒêang x√°c th·ª±c...\" />;\n  }\n\n  if (!isAuthenticated) {\n    return <Navigate to=\"/login\" replace />;\n  }\n\n  return <>{children}</>;\n}\n\nfunction PublicRoute({ children }: { children: React.ReactNode }) {\n  const { isAuthenticated, isLoading } = useAuthStore();\n\n  if (isLoading) {\n    return <LoadingScreen message=\"ƒêang t·∫£i...\" />;\n  }\n\n  if (isAuthenticated) {\n    return <Navigate to=\"/dashboard\" replace />;\n  }\n\n  return <>{children}</>;\n}\n\nfunction App() {\n  const { checkAuth } = useAuthStore();\n\n  useEffect(() => {\n    checkAuth();\n  }, [checkAuth]);\n\n  return (\n    <BrowserRouter>\n      <Routes>\n        <Route\n          path=\"/login\"\n          element={\n            <PublicRoute>\n              <LoginPage />\n            </PublicRoute>\n          }\n        />\n        <Route\n          path=\"/register\"\n          element={\n            <PublicRoute>\n              <RegisterPage />\n            </PublicRoute>\n          }\n        />\n        <Route\n          path=\"/dashboard\"\n          element={\n            <ProtectedRoute>\n              <DashboardPage />\n            </ProtectedRoute>\n          }\n        />\n        <Route\n          path=\"/editor/:projectId\"\n          element={\n            <ProtectedRoute>\n              <EditorPage />\n            </ProtectedRoute>\n          }\n        />\n        <Route path=\"/\" element={<Navigate to=\"/dashboard\" replace />} />\n        <Route path=\"*\" element={<Navigate to=\"/dashboard\" replace />} />\n      </Routes>\n    </BrowserRouter>\n  );\n}\n\nexport default App;", "metadata": {"file_path": "/Users/mac/heytex/client/src/App.tsx", "file_name": "App.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "115", "text": "/**\n * API Client for Compilation Service\n */\n\nimport axios from 'axios';\n\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5433';\n\nexport interface CompileJobResponse {\n    success: boolean;\n    jobId: string;\n    status: 'queued' | 'compiling' | 'completed' | 'failed';\n    queuePosition?: number;\n    stats: {\n        compiling: number;\n        queued: number;\n    };\n}\n\nexport interface JobStatusResponse {\n    success: boolean;\n    job: {\n        id: string;\n        status: 'queued' | 'compiling' | 'completed' | 'failed';\n        queuePosition?: number;\n        createdAt: string;\n        startedAt?: string;\n        completedAt?: string;\n        error?: string;\n    };\n    stats: {\n        compiling: number;\n        queued: number;\n    };\n}\n\nexport interface StatsResponse {\n    success: boolean;\n    stats: {\n        compiling: number;\n        queued: number;\n        total: number;\n        available: number;\n    };\n}\n\nexport class CompilationAPI {\n    private token: string | null = null;\n\n    constructor() {\n        // Get token from localStorage\n        this.token = localStorage.getItem('token');\n    }\n\n    private get headers() {\n        return {\n            'Authorization': `Bearer ${this.token}`,\n            'Content-Type': 'application/json',\n        };\n    }\n\n    /**\n     * Submit a compilation job\n     */\n    async submitJob(fileName: string, content: string, projectId?: string): Promise<CompileJobResponse> {\n        const response = await axios.post<CompileJobResponse>(\n            `${API_URL}/api/compile`,\n            { fileName, content, projectId },\n            { headers: this.headers }\n        );\n        return response.data;\n    }\n\n    /**\n     * Get job status\n     */\n    async getJobStatus(jobId: string): Promise<JobStatusResponse> {\n        const response = await axios.get<JobStatusResponse>(\n            `${API_URL}/api/compile/${jobId}`,\n            { headers: this.headers }\n        );\n        return response.data;\n    }", "metadata": {"file_path": "/Users/mac/heytex/client/src/api/compilation.ts", "file_name": "compilation.ts", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "116", "text": "/**\n     * Get PDF for completed job\n     */\n    async getPDF(jobId: string): Promise<Blob> {\n        const response = await axios.get(\n            `${API_URL}/api/compile/${jobId}/pdf`,\n            {\n                headers: this.headers,\n                responseType: 'blob',\n            }\n        );\n        return response.data;\n    }\n\n    /**\n     * Get compilation log\n     */\n    async getLog(jobId: string): Promise<string> {\n        const response = await axios.get(\n            `${API_URL}/api/compile/${jobId}/log`,\n            {\n                headers: this.headers,\n                responseType: 'text',\n            }\n        );\n        return response.data;\n    }\n\n    /**\n     * Get queue statistics (public endpoint)\n     */\n    async getStats(): Promise<StatsResponse> {\n        const response = await axios.get<StatsResponse>(\n            `${API_URL}/api/compile/stats`\n        );\n        return response.data;\n    }\n\n    /**\n     * Poll job status until completed or failed\n     */\n    async pollJobStatus(\n        jobId: string,\n        onUpdate?: (status: JobStatusResponse) => void,\n        interval: number = 1000\n    ): Promise<JobStatusResponse> {\n        return new Promise((resolve, reject) => {\n            const poll = async () => {\n                try {\n                    const status = await this.getJobStatus(jobId);\n                    \n                    if (onUpdate) {\n                        onUpdate(status);\n                    }\n\n                    if (status.job.status === 'completed' || status.job.status === 'failed') {\n                        resolve(status);\n                    } else {\n                        setTimeout(poll, interval);\n                    }\n                } catch (error) {\n                    reject(error);\n                }\n            };\n\n            poll();\n        });\n    }\n}\n\n// Singleton instance\nexport const compilationAPI = new CompilationAPI();", "metadata": {"file_path": "/Users/mac/heytex/client/src/api/compilation.ts", "file_name": "compilation.ts", "creation_date": "2025-12-15", "last_modified_date": "2025-12-15"}}
{"id": "117", "text": "import { useState } from 'react';\nimport { Document, Page, pdfjs } from 'react-pdf';\nimport { ChevronLeft, ChevronRight, ZoomIn, ZoomOut } from 'lucide-react';\nimport { Button } from './ui/Button';\n\n// Use local worker (bundled with pdfjs-dist)\npdfjs.GlobalWorkerOptions.workerSrc = new URL(\n    'pdfjs-dist/build/pdf.worker.min.mjs',\n    import.meta.url\n).toString();\n\ninterface PDFViewerProps {\n    pdfUrl: string;\n}\n\nexport function PDFViewer({ pdfUrl }: PDFViewerProps) {\n    const [numPages, setNumPages] = useState<number>(0);\n    const [pageNumber, setPageNumber] = useState<number>(1);\n    const [scale, setScale] = useState<number>(1.0);\n    const [error, setError] = useState<string | null>(null);\n\n    function onDocumentLoadSuccess({ numPages }: { numPages: number }) {\n        console.log('[PDFViewer] PDF loaded successfully, pages:', numPages);\n        setNumPages(numPages);\n        setPageNumber(1);\n        setError(null);\n    }\n\n    function onDocumentLoadError(error: Error) {\n        console.error('[PDFViewer] Failed to load PDF:', error);\n        setError(error.message || 'Failed to load PDF');\n    }\n\n    const goToPrevPage = () => {\n        setPageNumber(prev => Math.max(prev - 1, 1));\n    };\n\n    const goToNextPage = () => {\n        setPageNumber(prev => Math.min(prev + 1, numPages));\n    };\n\n    const zoomIn = () => {\n        setScale(prev => Math.min(prev + 0.2, 3.0));\n    };\n\n    const zoomOut = () => {\n        setScale(prev => Math.max(prev - 0.2, 0.5));\n    };", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/PDFViewer.tsx", "file_name": "PDFViewer.tsx", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "118", "text": "const zoomOut = () => {\n        setScale(prev => Math.max(prev - 0.2, 0.5));\n    };\n\n    return (\n        <div className=\"w-full h-full flex flex-col bg-gray-50 dark:bg-gray-900\">\n            {/* Custom Toolbar */}\n            <div className=\"flex items-center justify-between px-4 py-2 bg-gray-100 dark:bg-gray-800 border-b border-gray-300 dark:border-gray-700\">\n                <div className=\"flex items-center gap-2\">\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={goToPrevPage}\n                        disabled={pageNumber <= 1}\n                    >\n                        <ChevronLeft className=\"h-4 w-4\" />\n                    </Button>\n                    <span className=\"text-sm text-muted-foreground\">\n                        {pageNumber} / {numPages || '‚Äî'}\n                    </span>\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={goToNextPage}\n                        disabled={pageNumber >= numPages}\n                    >\n                        <ChevronRight className=\"h-4 w-4\" />\n                    </Button>\n                </div>\n                <div className=\"flex items-center gap-2\">\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={zoomOut}\n                        disabled={scale <= 0.5}\n                    >\n                        <ZoomOut className=\"h-4 w-4\" />\n                    </Button>\n                    <span className=\"text-sm text-muted-foreground\">\n                        {Math.round(scale * 100)}%\n                    </span>\n                    <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={zoomIn}\n                        disabled={scale >= 3.0}\n                    >\n                        <ZoomIn className=\"h-4 w-4\" />\n                    </Button>\n                </div>\n            </div>", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/PDFViewer.tsx", "file_name": "PDFViewer.tsx", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "119", "text": "{/* PDF Content */}\n            <div className=\"flex-1 overflow-auto flex items-start justify-center p-4\">\n                {error ? (\n                    <div className=\"text-center p-8\">\n                        <div className=\"text-destructive text-lg mb-2\">Failed to load PDF</div>\n                        <div className=\"text-sm text-muted-foreground\">{error}</div>\n                        <div className=\"text-xs text-muted-foreground mt-4\">URL: {pdfUrl.substring(0, 50)}...</div>\n                    </div>\n                ) : (\n                    <Document\n                        file={pdfUrl}\n                        onLoadSuccess={onDocumentLoadSuccess}\n                        onLoadError={onDocumentLoadError}\n                        loading={\n                            <div className=\"flex flex-col items-center justify-center p-8\">\n                                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mb-2\"></div>\n                                <div className=\"text-sm text-muted-foreground\">Loading PDF...</div>\n                            </div>\n                        }\n                        error={\n                            <div className=\"text-center p-8 text-destructive\">\n                                Error rendering PDF\n                            </div>\n                        }\n                    >\n                        <Page\n                            pageNumber={pageNumber}\n                            scale={scale}\n                            renderTextLayer={false}\n                            renderAnnotationLayer={false}\n                            className=\"shadow-lg\"\n                        />\n                    </Document>\n                )}\n            </div>\n        </div>\n    );\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/PDFViewer.tsx", "file_name": "PDFViewer.tsx", "creation_date": "2025-12-16", "last_modified_date": "2025-12-16"}}
{"id": "120", "text": "import { useState } from 'react';\nimport { X, Users, Copy, Check, UserPlus, Trash2 } from 'lucide-react';\nimport { Button } from './ui/Button';\nimport { Spinner } from './ui/Spinner';\nimport { api } from '../lib/api';\n\ninterface ShareModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    projectId: string;\n    projectName: string;\n    collaborators: Array<{\n        id: string;\n        role: string;\n        user: {\n            id: string;\n            name: string;\n            email: string;\n        };\n    }>;\n    onCollaboratorAdded?: () => void;\n}\n\nexport function ShareModal({\n    isOpen,\n    onClose,\n    projectId,\n    projectName,\n    collaborators,\n    onCollaboratorAdded,\n}: ShareModalProps) {\n    const [email, setEmail] = useState('');\n    const [role, setRole] = useState<'VIEWER' | 'EDITOR'>('EDITOR');\n    const [isAdding, setIsAdding] = useState(false);\n    const [removingId, setRemovingId] = useState<string | null>(null);\n    const [error, setError] = useState('');\n    const [copied, setCopied] = useState(false);\n\n    const shareLink = `${window.location.origin}/editor/${projectId}`;\n\n    const handleCopyLink = () => {\n        navigator.clipboard.writeText(shareLink);\n        setCopied(true);\n        setTimeout(() => setCopied(false), 2000);\n    };\n\n    const handleAddCollaborator = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setError('');\n        setIsAdding(true);\n\n        try {\n            await api.addCollaborator(projectId, email, role);\n            setEmail('');\n            onCollaboratorAdded?.();\n        } catch (err: any) {\n            setError(err.message || 'Kh√¥ng th·ªÉ th√™m c·ªông t√°c vi√™n');\n        } finally {\n            setIsAdding(false);\n        }\n    };", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/ShareModal.tsx", "file_name": "ShareModal.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "121", "text": "const handleRemoveCollaborator = async (userId: string) => {\n        setRemovingId(userId);\n        try {\n            await api.removeCollaborator(projectId, userId);\n            onCollaboratorAdded?.(); // Refresh the list\n        } catch (err: any) {\n            setError(err.message || 'Kh√¥ng th·ªÉ x√≥a c·ªông t√°c vi√™n');\n        } finally {\n            setRemovingId(null);\n        }\n    };\n\n    if (!isOpen) return null;\n\n    return (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50\">\n            <div className=\"bg-card border rounded-lg shadow-lg w-full max-w-md max-h-[90vh] overflow-y-auto\">\n                {/* Header */}\n                <div className=\"flex items-center justify-between p-4 border-b\">\n                    <div className=\"flex items-center gap-2\">\n                        <Users className=\"h-5 w-5 text-primary\" />\n                        <h2 className=\"font-semibold\">Chia s·∫ª d·ª± √°n</h2>\n                    </div>\n                    <button\n                        onClick={onClose}\n                        className=\"p-1 hover:bg-accent rounded\"\n                    >\n                        <X className=\"h-5 w-5\" />\n                    </button>\n                </div>\n\n                {/* Content */}\n                <div className=\"p-4 space-y-4\">\n                    {/* Project name */}\n                    <div>\n                        <p className=\"text-sm text-muted-foreground\">D·ª± √°n</p>\n                        <p className=\"font-medium\">{projectName}</p>\n                    </div>", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/ShareModal.tsx", "file_name": "ShareModal.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "122", "text": "{/* Share link */}\n                    <div>\n                        <label className=\"text-sm font-medium mb-2 block\">\n                            Link chia s·∫ª\n                        </label>\n                        <div className=\"flex gap-2\">\n                            <input\n                                type=\"text\"\n                                value={shareLink}\n                                readOnly\n                                className=\"flex-1 px-3 py-2 bg-muted border rounded text-sm\"\n                            />\n                            <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={handleCopyLink}\n                                className=\"gap-2\"\n                            >\n                                {copied ? (\n                                    <>\n                                        <Check className=\"h-4 w-4\" />\n                                        ƒê√£ copy\n                                    </>\n                                ) : (\n                                    <>\n                                        <Copy className=\"h-4 w-4\" />\n                                        Copy\n                                    </>\n                                )}\n                            </Button>\n                        </div>\n                    </div>\n\n                    {/* Add collaborator form */}\n                    <form onSubmit={handleAddCollaborator} className=\"space-y-3\">\n                        <div>\n                            <label className=\"text-sm font-medium mb-2 block\">\n                                Th√™m c·ªông t√°c vi√™n\n                            </label>\n                            <input\n                                type=\"email\"\n                                value={email}\n                                onChange={(e) => setEmail(e.target.value)}\n                                placeholder=\"Email ng∆∞·ªùi d√πng\"\n                                className=\"w-full px-3 py-2 bg-background border rounded\"\n                                required\n                            />\n                        </div>\n\n                        <div>\n                            <label className=\"text-sm font-medium mb-2 block\">\n                                Quy·ªÅn truy c·∫≠p\n                            </label>\n                            <select\n                                value={role}\n                                onChange={(e) => setRole(e.target.value as 'VIEWER' | 'EDITOR')}\n                                className=\"w-full px-3 py-2 bg-background border rounded\"\n                            >\n                                <option value=\"VIEWER\">Viewer (Ch·ªâ xem)</option>\n                                <option value=\"EDITOR\">Editor (Ch·ªânh s·ª≠a)</option>\n                            </select>\n                        </div>\n\n                        {error && (\n                            <p className=\"text-sm text-destructive\">{error}</p>\n                        )}", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/ShareModal.tsx", "file_name": "ShareModal.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "123", "text": "{error && (\n                            <p className=\"text-sm text-destructive\">{error}</p>\n                        )}\n\n                        <Button\n                            type=\"submit\"\n                            disabled={isAdding || !email}\n                            className=\"w-full gap-2\"\n                        >\n                            {isAdding ? (\n                                <Spinner size=\"sm\" />\n                            ) : (\n                                <UserPlus className=\"h-4 w-4\" />\n                            )}\n                            Th√™m c·ªông t√°c vi√™n\n                        </Button>\n                    </form>", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/ShareModal.tsx", "file_name": "ShareModal.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "124", "text": "{/* Collaborators list */}\n                    {collaborators.length > 0 && (\n                        <div>\n                            <h3 className=\"text-sm font-medium mb-2\">\n                                C·ªông t√°c vi√™n ({collaborators.length})\n                            </h3>\n                            <div className=\"space-y-2\">\n                                {collaborators.map((collab) => (\n                                    <div\n                                        key={collab.id}\n                                        className=\"flex items-center justify-between p-2 bg-muted rounded\"\n                                    >\n                                        <div className=\"flex-1\">\n                                            <p className=\"font-medium text-sm\">\n                                                {collab.user.name}\n                                            </p>\n                                            <p className=\"text-xs text-muted-foreground\">\n                                                {collab.user.email}\n                                            </p>\n                                        </div>\n                                        <div className=\"flex items-center gap-2\">\n                                            <span className={`text-xs px-2 py-1 rounded ${\n                                                collab.role === 'VIEWER'\n                                                    ? 'bg-blue-500/10 text-blue-500'\n                                                    : 'bg-green-500/10 text-green-500'\n                                            }`}>\n                                                {collab.role === 'VIEWER' ? 'Viewer' : 'Editor'}\n                                            </span>\n                                            <button\n                                                onClick={() => handleRemoveCollaborator(collab.user.id)}\n                                                disabled={removingId === collab.user.id}\n                                                className=\"p-1 hover:bg-destructive/10 hover:text-destructive rounded transition-colors disabled:opacity-50\"\n                                                title=\"X√≥a c·ªông t√°c vi√™n\"\n                                            >\n                                                {removingId === collab.user.id ? (\n                                                    <Spinner size=\"sm\" />\n                                                ) : (\n                                                    <Trash2 className=\"h-4 w-4\" />\n                                                )}\n                                            </button>\n                                        </div>\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>\n        </div>\n    );\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/ShareModal.tsx", "file_name": "ShareModal.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "125", "text": "import * as React from 'react';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '../../lib/utils';\n\nconst buttonVariants = cva(\n    'inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50',\n    {\n        variants: {\n            variant: {\n                default: 'bg-primary text-primary-foreground hover:bg-primary/90 shadow-sm',\n                destructive: 'bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-sm',\n                outline: 'border border-input bg-background hover:bg-accent hover:text-accent-foreground',\n                secondary: 'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n                ghost: 'hover:bg-accent hover:text-accent-foreground',\n                link: 'text-primary underline-offset-4 hover:underline',\n            },\n            size: {\n                default: 'h-9 px-4 py-2',\n                sm: 'h-8 rounded-md px-3 text-xs',\n                lg: 'h-10 rounded-md px-8',\n                icon: 'h-9 w-9',\n            },\n        },\n        defaultVariants: {\n            variant: 'default',\n            size: 'default',\n        },\n    }\n);\n\nexport interface ButtonProps\n    extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> { }\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n    ({ className, variant, size, ...props }, ref) => {\n        return (\n            <button\n                className={cn(buttonVariants({ variant, size, className }))}\n                ref={ref}\n                {...props}\n            />\n        );\n    }\n);\nButton.displayName = 'Button';\n\nexport { Button, buttonVariants };", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/ui/Button.tsx", "file_name": "Button.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "126", "text": "import * as React from 'react';\nimport { cn } from '../../lib/utils';\n\nexport interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {\n    label?: string;\n    error?: string;\n}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n    ({ className, type, label, error, ...props }, ref) => {\n        return (\n            <div className=\"space-y-1.5\">\n                {label && (\n                    <label className=\"text-sm font-medium text-foreground\">\n                        {label}\n                    </label>\n                )}\n                <input\n                    type={type}\n                    className={cn(\n                        'flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 transition-colors',\n                        error && 'border-destructive focus-visible:ring-destructive',\n                        className\n                    )}\n                    ref={ref}\n                    {...props}\n                />\n                {error && (\n                    <p className=\"text-sm text-destructive\">{error}</p>\n                )}\n            </div>\n        );\n    }\n);\nInput.displayName = 'Input';\n\nexport { Input };", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/ui/Input.tsx", "file_name": "Input.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "127", "text": "import { cn } from '../../lib/utils';\nimport { Loader2 } from 'lucide-react';\n\ninterface SpinnerProps {\n    className?: string;\n    size?: 'sm' | 'md' | 'lg';\n}\n\nexport function Spinner({ className, size = 'md' }: SpinnerProps) {\n    const sizeClasses = {\n        sm: 'h-4 w-4',\n        md: 'h-6 w-6',\n        lg: 'h-8 w-8',\n    };\n\n    return (\n        <Loader2 className={cn('animate-spin text-primary', sizeClasses[size], className)} />\n    );\n}\n\ninterface LoadingScreenProps {\n    message?: string;\n}\n\nexport function LoadingScreen({ message = 'ƒêang t·∫£i...' }: LoadingScreenProps) {\n    return (\n        <div className=\"flex h-full w-full items-center justify-center bg-background\">\n            <div className=\"flex flex-col items-center gap-4\">\n                <Spinner size=\"lg\" />\n                <p className=\"text-muted-foreground\">{message}</p>\n            </div>\n        </div>\n    );\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/components/ui/Spinner.tsx", "file_name": "Spinner.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "128", "text": "// src/engines/BaseEngine.ts\nexport interface CompileResult {\n    pdf?: Uint8Array;\n    status: number;\n    log: string;\n}\n\nexport interface EngineConfig {\n    name: string;\n    setupScript: string;\n    engineScript: string;\n    engineClass: string;\n}\n\nexport abstract class BaseEngine {\n    protected engine: any = undefined;\n    protected status: 'unloaded' | 'loading' | 'ready' | 'compiling' | 'error' =\n        'unloaded';\n    protected statusListeners: Set<() => void> = new Set();\n    protected config: EngineConfig;\n\n    constructor(config: EngineConfig) {\n        this.config = config;\n    }\n\n    abstract loadScripts(): Promise<void>;\n    abstract createEngine(): any;\n    abstract setTexliveEndpoint(endpoint: string): void;\n    abstract writeMemFSFile(filename: string, content: string | Uint8Array): void;\n    abstract makeMemFSFolder(folder: string): void;\n    abstract setEngineMainFile(filename: string): void;\n    abstract flushCache(): void;\n    abstract dumpDirectory(dir: string): Promise<{ [key: string]: ArrayBuffer }>;\n    abstract compile(\n        mainFileName: string,\n        fileTree: any[],\n    ): Promise<CompileResult>;\n\n    getStatus() {\n        return this.status;\n    }\n\n    isReady(): boolean {\n        return this.status === 'ready';\n    }\n\n    isCompiling(): boolean {\n        return this.status === 'compiling';\n    }\n\n    addStatusListener(listener: () => void): () => void {\n        this.statusListeners.add(listener);\n        return () => this.statusListeners.delete(listener);\n    }\n\n    protected notifyStatusChange(): void {\n        this.statusListeners.forEach((listener) => listener());\n    }\n\n    protected setStatus(status: typeof this.status): void {\n        this.status = status;\n        this.notifyStatusChange();\n    }", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/BaseEngine.ts", "file_name": "BaseEngine.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "129", "text": "protected notifyStatusChange(): void {\n        this.statusListeners.forEach((listener) => listener());\n    }\n\n    protected setStatus(status: typeof this.status): void {\n        this.status = status;\n        this.notifyStatusChange();\n    }\n\n    async initialize(): Promise<void> {\n        if (this.status === 'ready') return;\n        if (this.status === 'loading') {\n            return new Promise((resolve, reject) => {\n                const checkStatus = () => {\n                    if (this.status === 'ready') {\n                        resolve();\n                    } else if (this.status === 'error') {\n                        reject(\n                            new Error(`Failed to initialize ${this.config.name} engine`),\n                        );\n                    } else {\n                        setTimeout(checkStatus, 100);\n                    }\n                };\n                checkStatus();\n            });\n        }\n\n        this.setStatus('loading');\n        try {\n            await this.loadScripts();\n            this.engine = this.createEngine();\n\n            // Set up the engine without calling methods that might send messages\n            await this.engine.loadEngine();\n\n            this.setStatus('ready');\n        } catch (error) {\n            this.setStatus('error');\n            throw error;\n        }\n    }\n\n    async reinitialize(): Promise<void> {\n        this.cleanup();\n        await this.initialize();\n    }\n\n    protected cleanup(): void {\n        if (this.engine) {\n            try {\n                this.engine.closeWorker();\n            } catch (error) {\n                console.warn('Error during engine cleanup:', error);\n            }\n            this.engine = undefined;\n        }\n        this.setStatus('unloaded');\n    }\n\n    stopCompilation(): void {\n        if (this.isCompiling() && this.engine) {\n            try {\n                this.engine.closeWorker();\n                this.setStatus('error');\n                this.status = 'ready';\n            } catch (error) {\n                console.warn('Error stopping compilation:', error);\n            }\n        }\n    }\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/BaseEngine.ts", "file_name": "BaseEngine.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "130", "text": "/**\n * Dvipdfmx Engine Wrapper for HeyTeX\n * Converts XDV files to PDF\n */\n\ndeclare const DvipdfmxEngine: any;\n\nexport class DvipdfmxEngineWrapper {\n    private engine: any;\n    private texliveEndpoint: string = '';\n\n    async initialize(): Promise<void> {\n        // Load the DvipdfmxEngine script\n        if (typeof DvipdfmxEngine === 'undefined') {\n            await this.loadScript('/core/swiftlatex/DvipdfmxEngine.js');\n            await this.loadScript('/core/swiftlatex/TexlyreDvipdfmxEngineSetup.js');\n        }\n\n        this.engine = new (window as any).DvipdfmxEngine();\n        await this.engine.loadEngine();\n        \n        if (this.texliveEndpoint) {\n            this.engine.setTexliveEndpoint(this.texliveEndpoint);\n        }\n    }\n\n    private loadScript(src: string): Promise<void> {\n        return new Promise((resolve, reject) => {\n            const script = document.createElement('script');\n            script.src = src;\n            script.onload = () => resolve();\n            script.onerror = reject;\n            document.head.appendChild(script);\n        });\n    }\n\n    async convertXdvToPdf(xdvData: Uint8Array, filename: string = 'main.xdv', fonts?: Record<string, ArrayBuffer>): Promise<Uint8Array> {\n        // Create a fresh engine instance to avoid font cache issues\n        // This fixes: \"Assertion failed: font_cache.fonts == NULL\"\n        const freshEngine = new (window as any).DvipdfmxEngine();\n        await freshEngine.loadEngine();\n        \n        if (this.texliveEndpoint) {\n            freshEngine.setTexliveEndpoint(this.texliveEndpoint);\n        }\n\n        // Create /tex directory for font files\n        try {\n            await freshEngine.makeMemFSFolder('/tex');\n        } catch (e) {\n            // Directory might already exist\n        }\n\n        // Copy fonts to fresh engine's MemFS if provided\n        if (fonts) {\n            for (const [path, content] of Object.entries(fonts)) {\n                await freshEngine.writeMemFSFile(path, new Uint8Array(content));\n            }\n        }", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/DvipdfmxEngine.ts", "file_name": "DvipdfmxEngine.ts", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "131", "text": "// Write XDV file to MemFS\n        await freshEngine.writeMemFSFile(`/work/${filename}`, xdvData);\n        await freshEngine.setEngineMainFile(filename);\n\n        // Convert to PDF\n        const result = await freshEngine.compilePDF();\n\n        if (result.status === 0 && result.pdf) {\n            return result.pdf;\n        }\n\n        throw new Error(`PDF conversion failed: ${result.log || 'Unknown error'}`);\n    }\n\n    setTexliveEndpoint(url: string): void {\n        this.texliveEndpoint = url;\n        if (this.engine) {\n            this.engine.setTexliveEndpoint(url);\n        }\n    }\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/DvipdfmxEngine.ts", "file_name": "DvipdfmxEngine.ts", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "132", "text": "// src/engines/EngineLoader.ts\nexport class EngineLoader {\n    private static loadedScripts = new Set<string>();\n\n    static async loadScript(src: string): Promise<void> {\n        if (EngineLoader.loadedScripts.has(src)) {\n            return Promise.resolve();\n        }\n\n        return new Promise((resolve, reject) => {\n            const script = document.createElement('script');\n            script.src = src;\n            script.onload = () => {\n                EngineLoader.loadedScripts.add(src);\n                resolve();\n            };\n            script.onerror = (_error) => {\n                reject(new Error(`Failed to load script: ${src}`));\n            };\n            document.head.appendChild(script);\n        });\n    }\n\n    static async loadScripts(scripts: string[]): Promise<void> {\n        for (const script of scripts) {\n            await EngineLoader.loadScript(script);\n        }\n    }\n\n    static isScriptLoaded(src: string): boolean {\n        return EngineLoader.loadedScripts.has(src);\n    }\n\n    static removeScript(src: string): void {\n        const script = document.querySelector(`script[src=\"${src}\"]`);\n        if (script) {\n            script.remove();\n            EngineLoader.loadedScripts.delete(src);\n        }\n    }\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/EngineLoader.ts", "file_name": "EngineLoader.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "133", "text": "// src/engines/TypstCompilerEngine.ts\nimport { nanoid } from 'nanoid';\n\n// Re-defining types inline to avoid dependency compilation issues if shared types are missing\nexport interface TypstPdfOptions {\n    // Add options as needed\n}\n\nexport type TypstWorkerMessage =\n    | { id: string; type: 'compile'; payload: { mainFilePath: string; sources: Record<string, string | Uint8Array>; format: 'pdf' | 'svg' | 'canvas'; pdfOptions?: TypstPdfOptions } }\n    | { id: string; type: 'ping' };\n\nexport type TypstWorkerResponse =\n    | { id: string; type: 'pong' }\n    | { id: string; type: 'done'; result: { format: string; output: Uint8Array | string; diagnostics?: any[] } }\n    | { id: string; type: 'error'; error: string };\n\nexport class TypstCompilerEngine {\n    private worker: Worker | null = null;\n    private pendingResolves: Map<string, (v: any) => void> = new Map();\n    private pendingRejects: Map<string, (e: any) => void> = new Map();\n\n    getWorker(): Worker {\n        if (this.worker) return this.worker;\n\n        // Path to worker needs to be correct relative to where this file is imported or built\n        // Since we are in src/engines, and worker will be in src/workers or similar?\n        // Let's place the worker in src/workers/typst.worker.ts and reference it\n        // Vite handles this well usually.\n        this.worker = new Worker(new URL('../workers/typst.worker.ts', import.meta.url), {\n            type: 'module',\n        });\n\n        this.worker.onmessage = (e: MessageEvent<TypstWorkerResponse>) => {\n            const { id, type } = e.data;\n\n            if (!id) return;", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/TypstCompilerEngine.ts", "file_name": "TypstCompilerEngine.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "134", "text": "this.worker.onmessage = (e: MessageEvent<TypstWorkerResponse>) => {\n            const { id, type } = e.data;\n\n            if (!id) return;\n\n            if (type === 'done' || type === 'pong') {\n                const resolve = this.pendingResolves.get(id);\n                if (resolve) resolve('result' in e.data ? e.data.result : undefined);\n            } else if (type === 'error') {\n                const reject = this.pendingRejects.get(id);\n                if (reject) reject(new Error(e.data.error || 'Worker error'));\n            }\n\n            this.pendingResolves.delete(id);\n            this.pendingRejects.delete(id);\n        };\n\n        this.worker.onerror = (ev) => {\n            const err = new Error(`Typst worker error: ${String(ev.message || ev)}`);\n            this.pendingRejects.forEach((reject) => reject(err));\n            this.pendingResolves.clear();\n            this.pendingRejects.clear();\n            this.worker = null;\n        };\n\n        return this.worker;\n    }\n\n    async ping(): Promise<void> {\n        return this.callWorker('ping', undefined);\n    }\n\n    async compile(\n        mainFilePath: string,\n        sources: Record<string, string | Uint8Array>,\n        format: 'pdf' | 'svg' | 'canvas',\n        pdfOptions?: TypstPdfOptions,\n        signal?: AbortSignal\n    ): Promise<{ format: string; output: Uint8Array | string; diagnostics?: any[] }> {\n        return this.callWorker('compile', { mainFilePath, sources, format, pdfOptions }, signal);\n    }\n\n    terminate(): void {\n        if (this.worker) {\n            this.worker.terminate();\n            this.worker = null;\n        }\n        this.pendingResolves.clear();\n        this.pendingRejects.clear();\n    }", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/TypstCompilerEngine.ts", "file_name": "TypstCompilerEngine.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "135", "text": "terminate(): void {\n        if (this.worker) {\n            this.worker.terminate();\n            this.worker = null;\n        }\n        this.pendingResolves.clear();\n        this.pendingRejects.clear();\n    }\n\n    private callWorker<TType extends 'compile' | 'ping'>(\n        type: TType,\n        payload: TType extends 'compile'\n            ? { mainFilePath: string; sources: Record<string, string | Uint8Array>; format: 'pdf' | 'svg' | 'canvas'; pdfOptions?: TypstPdfOptions }\n            : undefined,\n        signal?: AbortSignal\n    ): Promise<any> {\n        const id = nanoid();\n        const worker = this.getWorker();\n\n        const promise = new Promise((resolve, reject) => {\n            this.pendingResolves.set(id, resolve);\n            this.pendingRejects.set(id, reject);\n        });\n\n        const abort = () => {\n            if (this.worker) {\n                this.worker.terminate();\n                this.worker = null;\n            }\n            const reject = this.pendingRejects.get(id);\n            if (reject) reject(new Error('Compilation was cancelled'));\n            this.pendingResolves.delete(id);\n            this.pendingRejects.delete(id);\n        };\n\n        if (signal) {\n            if (signal.aborted) {\n                abort();\n                return Promise.reject(new Error('Compilation was cancelled'));\n            }\n            signal.addEventListener('abort', abort, { once: true });\n        }\n\n        worker.postMessage({ id, type, payload });\n\n        return promise;\n    }\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/TypstCompilerEngine.ts", "file_name": "TypstCompilerEngine.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "136", "text": "// src/engines/XeTeXEngine.ts\nimport {\n    BaseEngine,\n    type CompileResult,\n    type EngineConfig,\n} from './BaseEngine';\nimport { EngineLoader } from './EngineLoader';\n\ndeclare global {\n    interface Window {\n        XeTeXEngine: any;\n    }\n}\n\ninterface XeTeXCompileResult extends CompileResult {\n    xdv?: Uint8Array;\n}\n\nexport class XeTeXEngine extends BaseEngine {\n    constructor() {\n        const config: EngineConfig = {\n            name: 'XeTeX',\n            setupScript: `/core/swiftlatex/TexlyreXeTeXEngineSetup.js`,\n            engineScript: `/core/swiftlatex/texlyrexetex.js`,\n            engineClass: 'XeTeXEngine',\n        };\n        super(config);\n    }\n\n    async loadScripts(): Promise<void> {\n        if (typeof window.XeTeXEngine === 'function') {\n            return;\n        }\n\n        await EngineLoader.loadScripts([\n            this.config.setupScript,\n            this.config.engineScript,\n        ]);\n\n        if (typeof window.XeTeXEngine !== 'function') {\n            throw new Error('XeTeXEngine not available after loading scripts');\n        }\n    }\n\n    createEngine(): any {\n        return new window.XeTeXEngine();\n    }\n\n    setTexliveEndpoint(endpoint: string): void {\n        this.engine.setTexliveEndpoint(endpoint);\n        console.log(`[XeTeXEngine] TexLive endpoint set for XeTeX: ${endpoint}`);\n    }\n\n    writeMemFSFile(filename: string, content: string | Uint8Array): void {\n        if (!this.engine) throw new Error('Engine not initialized');\n        this.engine.writeMemFSFile(filename, content);\n    }\n\n    makeMemFSFolder(folder: string): void {\n        if (!this.engine) throw new Error('Engine not initialized');\n        this.engine.makeMemFSFolder(folder);\n    }\n\n    setEngineMainFile(filename: string): void {\n        if (!this.engine) throw new Error('Engine not initialized');\n        this.engine.setEngineMainFile(filename);\n    }\n\n    flushCache(): void {\n        if (!this.engine) throw new Error('Engine not initialized');\n        this.engine.flushCache();\n    }", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/XeTeXEngine.ts", "file_name": "XeTeXEngine.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "137", "text": "flushCache(): void {\n        if (!this.engine) throw new Error('Engine not initialized');\n        this.engine.flushCache();\n    }\n\n    async dumpDirectory(dir: string): Promise<{ [key: string]: ArrayBuffer }> {\n        if (!this.engine) throw new Error('Engine not initialized');\n        return await this.engine.dumpDirectory(dir);\n    }\n\n    async compile(\n        _mainFileName: string,\n        _fileNodes: any[],\n    ): Promise<CompileResult> {\n        if (!this.engine || !this.isReady()) {\n            throw new Error('Engine not ready');\n        }\n\n        this.setStatus('compiling');\n\n        try {\n            await this.engine.compileLaTeX(); // Do it twice for tables\n            await this.engine.compileLaTeX(); // Do it thrice for good luck and bib\n            const result = await this.engine.compileLaTeX();\n            this.setStatus('ready');\n            // this.flushCache();\n\n            console.log('[XeTeXEngine] XeTeX compilation result:', {\n                status: result.status,\n                hasPdf: !!result.pdf,\n                hasXdv: !!result.xdv,\n                pdfSize: result.pdf?.length,\n                xdvSize: result.xdv?.length,\n            });", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/XeTeXEngine.ts", "file_name": "XeTeXEngine.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "138", "text": "if (result.status === 0 && result.pdf) {\n                return {\n                    pdf: undefined,\n                    status: result.status,\n                    log: result.log,\n                    xdv: result.pdf,\n                } as XeTeXCompileResult; // Note: swiftlatex seems to return PDF in xdv field sometimes or vice versa? \n                // Wait, checking original code:\n                // if (result.status === 0 && result.pdf) { return { ..., xdv: result.pdf } } \n                // It seems it treats 'pdf' output as 'xdv' in some cases or maybe I reused the interface incorrectly?\n                // Actually in the reference code it was:\n                // xdv: result.pdf \n                // This looks like it returns the PDF binary in the XDV field? \n                // For now I'll stick to the interface I defined in BaseEngine which has 'pdf'.\n                // If I look at BaseEngine I defined: pdf?: Uint8Array\n                // Here I am returning pdf: undefined but xdv: result.pdf?\n                // Let's look closer at the reference XeTeXEngine I read earlier.\n                /*\n                if (result.status === 0 && result.pdf) {\n                    return {\n                        pdf: undefined,\n                        status: result.status,\n                        log: result.log,\n                        xdv: result.pdf,\n                    } as XeTeXCompileResult;\n                }\n                return {\n                    pdf: result.pdf,\n                    ...\n                */\n                // It seems for XeTeX it might produce XDV which is then converted?\n                // But wait, `result.pdf` is populated. \n                // NOTE: The mocked worker returned a blob. EditorPage expects a blob.\n                // I should ensuring `compile` returns `pdf` populated.\n                // If the reference returns `pdf: undefined`, then `EditorPage` won't get a PDF.\n                // BUT `EditorPage` in `heytex` handles `result.pdf`.\n                // I should modify this to return `pdf: result.pdf` if it exists.\n\n                // Let's simplify and just return what we have, ensuring we match BaseEngine interface.\n                // If result.pdf is present, we return it as pdf.\n            }", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/XeTeXEngine.ts", "file_name": "XeTeXEngine.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "139", "text": "// Let's simplify and just return what we have, ensuring we match BaseEngine interface.\n                // If result.pdf is present, we return it as pdf.\n            }\n\n            // Simplified return for safety\n            return {\n                pdf: result.pdf, // This is Uint8Array\n                status: result.status,\n                log: result.log,\n            };\n\n        } catch (error) {\n            this.flushCache();\n            this.setStatus('error');\n            throw error;\n        }\n    }\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/engines/XeTeXEngine.ts", "file_name": "XeTeXEngine.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "140", "text": "@import \"tailwindcss\";\n@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');\n\n@theme {\n  --color-background: oklch(100% 0 0);\n  --color-foreground: oklch(15% 0.02 260);\n  --color-card: oklch(100% 0 0);\n  --color-card-foreground: oklch(15% 0.02 260);\n  --color-popover: oklch(100% 0 0);\n  --color-popover-foreground: oklch(15% 0.02 260);\n  --color-primary: oklch(55% 0.25 280);\n  --color-primary-foreground: oklch(98% 0 0);\n  --color-secondary: oklch(96% 0.01 260);\n  --color-secondary-foreground: oklch(15% 0.02 260);\n  --color-muted: oklch(96% 0.01 260);\n  --color-muted-foreground: oklch(55% 0.02 260);\n  --color-accent: oklch(96% 0.01 260);\n  --color-accent-foreground: oklch(15% 0.02 260);\n  --color-destructive: oklch(60% 0.25 25);\n  --color-destructive-foreground: oklch(98% 0 0);\n  --color-border: oklch(92% 0.01 260);\n  --color-input: oklch(92% 0.01 260);\n  --color-ring: oklch(55% 0.25 280);\n  --radius: 0.5rem;\n  --font-sans: 'Inter', system-ui, sans-serif;\n  --font-mono: 'JetBrains Mono', 'Fira Code', monospace;\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/index.css", "file_name": "index.css", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "141", "text": ".dark {\n  --color-background: oklch(15% 0.02 260);\n  --color-foreground: oklch(98% 0 0);\n  --color-card: oklch(18% 0.02 260);\n  --color-card-foreground: oklch(98% 0 0);\n  --color-popover: oklch(18% 0.02 260);\n  --color-popover-foreground: oklch(98% 0 0);\n  --color-primary: oklch(60% 0.25 280);\n  --color-primary-foreground: oklch(98% 0 0);\n  --color-secondary: oklch(22% 0.02 260);\n  --color-secondary-foreground: oklch(98% 0 0);\n  --color-muted: oklch(22% 0.02 260);\n  --color-muted-foreground: oklch(70% 0.02 260);\n  --color-accent: oklch(22% 0.02 260);\n  --color-accent-foreground: oklch(98% 0 0);\n  --color-destructive: oklch(55% 0.22 25);\n  --color-destructive-foreground: oklch(98% 0 0);\n  --color-border: oklch(25% 0.02 260);\n  --color-input: oklch(25% 0.02 260);\n  --color-ring: oklch(60% 0.25 280);\n}\n\n* {\n  border-color: var(--color-border);\n}\n\nbody {\n  background-color: var(--color-background);\n  color: var(--color-foreground);\n  font-family: var(--font-sans);\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\nhtml,\nbody,\n#root {\n  height: 100%;\n  width: 100%;\n  margin: 0;\n  padding: 0;\n}\n\n/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/index.css", "file_name": "index.css", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "142", "text": "/* Custom scrollbar */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n::-webkit-scrollbar-thumb {\n  background: oklch(50% 0 0 / 0.2);\n  border-radius: 9999px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: oklch(50% 0 0 / 0.4);\n}\n\n/* Monaco Editor custom styles */\n.monaco-editor {\n  font-family: 'JetBrains Mono', monospace !important;\n}\n\n/* Animations */\n@keyframes fadeIn {\n  from {\n    opacity: 0;\n  }\n\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes slideIn {\n  from {\n    transform: translateX(-100%);\n  }\n\n  to {\n    transform: translateX(0);\n  }\n}\n\n.animate-fade-in {\n  animation: fadeIn 0.2s ease-out;\n}\n\n.animate-slide-in {\n  animation: slideIn 0.2s ease-out;\n}\n\n/* Glass effect */\n.glass {\n  background-color: oklch(from var(--color-background) l c h / 0.8);\n  backdrop-filter: blur(12px);\n  border: 1px solid oklch(from var(--color-border) l c h / 0.5);\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/index.css", "file_name": "index.css", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "143", "text": "import type { User, Project, ProjectFile } from './types';\n\nconst API_URL = import.meta.env.VITE_API_URL || 'http://localhost:5433';\n\ninterface ApiOptions {\n    method?: string;\n    body?: unknown;\n    headers?: Record<string, string>;\n    responseType?: 'json' | 'blob';\n}\n\nclass ApiClient {\n    private baseUrl: string;\n\n    constructor(baseUrl: string) {\n        this.baseUrl = baseUrl;\n    }\n\n    private getToken(): string | null {\n        return localStorage.getItem('heytex_token');\n    }\n\n    private async request<T>(endpoint: string, options: ApiOptions = {}): Promise<T> {\n        const { method = 'GET', body, headers = {} } = options;\n\n        const token = this.getToken();\n\n        const config: RequestInit = {\n            method,\n            headers: {\n                'Content-Type': 'application/json',\n                ...(token ? { Authorization: `Bearer ${token}` } : {}),\n                ...headers,\n            },\n        };\n\n        if (body) {\n            config.body = JSON.stringify(body);\n        }\n\n        const response = await fetch(`${this.baseUrl}${endpoint}`, config);\n\n        if (!response.ok) {\n            const error = await response.json().catch(() => ({ error: 'Unknown error' }));\n            throw new Error(error.error || `HTTP error ${response.status}`);\n        }\n\n        if (options.responseType === 'blob') {\n            return response.blob() as unknown as T;\n        }\n\n        return response.json();\n    }\n\n    // Auth\n    async login(email: string, password: string) {\n        const data = await this.request<{ user: User; token: string }>('/api/auth/login', {\n            method: 'POST',\n            body: { email, password },\n        });\n        localStorage.setItem('heytex_token', data.token);\n        return data;\n    }\n\n    async register(email: string, password: string, name: string) {\n        const data = await this.request<{ user: User; token: string }>('/api/auth/register', {\n            method: 'POST',\n            body: { email, password, name },\n        });\n        localStorage.setItem('heytex_token', data.token);\n        return data;\n    }", "metadata": {"file_path": "/Users/mac/heytex/client/src/lib/api.ts", "file_name": "api.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-16"}}
{"id": "144", "text": "async getMe() {\n        return this.request<{ user: User }>('/api/auth/me');\n    }\n\n    logout() {\n        localStorage.removeItem('heytex_token');\n    }\n\n    // Projects\n    async getProjects() {\n        return this.request<{ projects: Project[] }>('/api/projects');\n    }\n\n    async getProject(id: string) {\n        return this.request<{ project: Project }>(`/api/projects/${id}`);\n    }\n\n    async createProject(data: { name: string; description?: string; engine: 'LATEX' | 'TYPST' }) {\n        return this.request<{ project: Project }>('/api/projects', {\n            method: 'POST',\n            body: data,\n        });\n    }\n\n    async updateProject(id: string, data: { name?: string; description?: string; mainFile?: string }) {\n        return this.request<{ project: Project }>(`/api/projects/${id}`, {\n            method: 'PATCH',\n            body: data,\n        });\n    }\n\n    async deleteProject(id: string) {\n        return this.request(`/api/projects/${id}`, { method: 'DELETE' });\n    }\n\n    async addCollaborator(projectId: string, email: string, role: 'VIEWER' | 'EDITOR') {\n        return this.request(`/api/projects/${projectId}/collaborators`, {\n            method: 'POST',\n            body: { email, role },\n        });\n    }\n\n    async removeCollaborator(projectId: string, userId: string) {\n        return this.request(`/api/projects/${projectId}/collaborators/${userId}`, {\n            method: 'DELETE',\n        });\n    }\n\n    // Files\n    async getFiles(projectId: string) {\n        return this.request<{ files: ProjectFile[] }>(`/api/files/project/${projectId}`);\n    }\n\n    async getFile(id: string) {\n        return this.request<{ file: ProjectFile }>(`/api/files/${id}`);\n    }\n\n    async createFile(data: { projectId: string; name: string; path: string; isFolder?: boolean; content?: string }) {\n        return this.request<{ file: ProjectFile }>('/api/files', {\n            method: 'POST',\n            body: data,\n        });\n    }", "metadata": {"file_path": "/Users/mac/heytex/client/src/lib/api.ts", "file_name": "api.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-16"}}
{"id": "145", "text": "async updateFile(id: string, data: { content?: string; name?: string }) {\n        return this.request<{ file: ProjectFile }>(`/api/files/${id}`, {\n            method: 'PATCH',\n            body: data,\n        });\n    }\n\n    async deleteFile(fileId: string): Promise<void> {\n        return this.request(`/api/files/${fileId}`, { method: 'DELETE' });\n    }\n\n    // Compilation\n    async compile(content: string): Promise<Blob> {\n        return this.request<Blob>('/api/compile/latex', {\n            method: 'POST',\n            body: { content },\n            responseType: 'blob'\n        });\n    }\n\n    async uploadFile(data: { projectId: string; path: string; name: string; mimeType: string; data: string }) {\n        return this.request<{ file: ProjectFile }>('/api/files/upload', {\n            method: 'POST',\n            body: data,\n        });\n    }\n}\n\nexport const api = new ApiClient(API_URL);\n\n// Re-export types for convenience\nexport type { User, Project, ProjectFile } from './types';", "metadata": {"file_path": "/Users/mac/heytex/client/src/lib/api.ts", "file_name": "api.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-16"}}
{"id": "146", "text": "// Types for HeyTeX application\n\nexport interface User {\n    id: string;\n    email: string;\n    name: string;\n    avatar?: string;\n    createdAt?: string;\n}\n\nexport interface Project {\n    id: string;\n    name: string;\n    description?: string;\n    engine: 'LATEX' | 'TYPST';\n    mainFile: string;\n    ownerId: string;\n    owner?: User;\n    files?: ProjectFile[];\n    collaborators?: ProjectCollaborator[];\n    createdAt: string;\n    updatedAt: string;\n    _count?: {\n        files: number;\n        collaborators: number;\n    };\n}\n\nexport interface ProjectCollaborator {\n    id: string;\n    projectId: string;\n    userId: string;\n    role: 'VIEWER' | 'EDITOR';\n    user: User;\n    createdAt: string;\n}\n\nexport interface ProjectFile {\n    id: string;\n    name: string;\n    path: string;\n    content?: string | null;\n    mimeType?: string | null;\n    size?: number | null;\n    isFolder: boolean;\n    projectId: string;\n    parentId?: string | null;\n    createdAt: string;\n    updatedAt: string;\n    url?: string;\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/lib/types.ts", "file_name": "types.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-08"}}
{"id": "147", "text": "import { clsx, type ClassValue } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\nexport function cn(...inputs: ClassValue[]) {\n    return twMerge(clsx(inputs));\n}\n\nexport function formatDate(date: Date | string): string {\n    return new Date(date).toLocaleDateString('vi-VN', {\n        day: '2-digit',\n        month: '2-digit',\n        year: 'numeric',\n    });\n}\n\nexport function formatFileSize(bytes: number): string {\n    if (bytes === 0) return '0 B';\n    const k = 1024;\n    const sizes = ['B', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n}\n\nexport function getFileExtension(filename: string): string {\n    return filename.slice(filename.lastIndexOf('.') + 1).toLowerCase();\n}\n\nexport function getFileIcon(filename: string): string {\n    const ext = getFileExtension(filename);\n    const iconMap: Record<string, string> = {\n        tex: 'üìÑ',\n        typ: 'üìÑ',\n        pdf: 'üìï',\n        png: 'üñºÔ∏è',\n        jpg: 'üñºÔ∏è',\n        jpeg: 'üñºÔ∏è',\n        gif: 'üñºÔ∏è',\n        svg: 'üñºÔ∏è',\n        bib: 'üìö',\n        txt: 'üìù',\n        md: 'üìù',\n    };\n    return iconMap[ext] || 'üìÑ';\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/lib/utils.ts", "file_name": "utils.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "148", "text": "import { StrictMode } from 'react';\nimport { createRoot } from 'react-dom/client';\nimport App from './App.tsx';\nimport './index.css';\n\ncreateRoot(document.getElementById('root')!).render(\n  <StrictMode>\n    <App />\n  </StrictMode>\n);", "metadata": {"file_path": "/Users/mac/heytex/client/src/main.tsx", "file_name": "main.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "149", "text": "import { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useAuthStore, useEditorStore } from '../stores';\nimport { api } from '../lib/api';\nimport type { Project } from '../lib/types';\nimport { Button } from '../components/ui/Button';\nimport { Input } from '../components/ui/Input';\nimport { Spinner } from '../components/ui/Spinner';\nimport {\n    FileCode2,\n    Plus,\n    FolderOpen,\n    Clock,\n    LogOut,\n    Sun,\n    Moon,\n    Trash2,\n} from 'lucide-react';\nimport { formatDate } from '../lib/utils';\n\nexport function DashboardPage() {\n    const navigate = useNavigate();\n    const { user, logout } = useAuthStore();\n    const { theme, toggleTheme } = useEditorStore();\n    const [projects, setProjects] = useState<Project[]>([]);\n    const [isLoading, setIsLoading] = useState(true);\n    const [showCreateModal, setShowCreateModal] = useState(false);\n    const [newProjectName, setNewProjectName] = useState('');\n    const [newProjectEngine, setNewProjectEngine] = useState<'TYPST' | 'LATEX'>('TYPST');\n    const [isCreating, setIsCreating] = useState(false);\n\n    useEffect(() => {\n        loadProjects();\n    }, []);\n\n    const loadProjects = async () => {\n        try {\n            const { projects } = await api.getProjects();\n            setProjects(projects);\n        } catch (error) {\n            console.error('Failed to load projects:', error);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const handleCreateProject = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!newProjectName.trim()) return;\n\n        setIsCreating(true);\n        try {\n            const { project } = await api.createProject({\n                name: newProjectName,\n                engine: newProjectEngine,\n            });\n            setProjects([project, ...projects]);\n            setShowCreateModal(false);\n            setNewProjectName('');\n            navigate(`/editor/${project.id}`);\n        } catch (error) {\n            console.error('Failed to create project:', error);\n        } finally {\n            setIsCreating(false);\n        }\n    };", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/DashboardPage.tsx", "file_name": "DashboardPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "150", "text": "const handleDeleteProject = async (id: string) => {\n        if (!confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a d·ª± √°n n√†y?')) return;\n\n        try {\n            await api.deleteProject(id);\n            setProjects(projects.filter(p => p.id !== id));\n        } catch (error) {\n            console.error('Failed to delete project:', error);\n        }\n    };\n\n    const handleLogout = () => {\n        logout();\n        navigate('/login');\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"h-screen flex items-center justify-center\">\n                <Spinner size=\"lg\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-background\">\n            {/* Header */}\n            <header className=\"sticky top-0 z-50 glass border-b\">\n                <div className=\"container mx-auto px-6 py-4 flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                        <FileCode2 className=\"h-8 w-8 text-primary\" />\n                        <span className=\"text-xl font-bold\">HeyTeX</span>\n                    </div>\n\n                    <div className=\"flex items-center gap-4\">\n                        <Button variant=\"ghost\" size=\"icon\" onClick={toggleTheme}>\n                            {theme === 'dark' ? <Sun className=\"h-5 w-5\" /> : <Moon className=\"h-5 w-5\" />}\n                        </Button>\n\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"w-8 h-8 rounded-full bg-primary/20 flex items-center justify-center\">\n                                <span className=\"text-sm font-medium text-primary\">\n                                    {user?.name?.charAt(0).toUpperCase()}\n                                </span>\n                            </div>\n                            <span className=\"text-sm font-medium hidden sm:inline\">{user?.name}</span>\n                        </div>\n\n                        <Button variant=\"ghost\" size=\"icon\" onClick={handleLogout}>\n                            <LogOut className=\"h-5 w-5\" />\n                        </Button>\n                    </div>\n                </div>\n            </header>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/DashboardPage.tsx", "file_name": "DashboardPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "151", "text": "<Button variant=\"ghost\" size=\"icon\" onClick={handleLogout}>\n                            <LogOut className=\"h-5 w-5\" />\n                        </Button>\n                    </div>\n                </div>\n            </header>\n\n            {/* Main Content */}\n            <main className=\"container mx-auto px-6 py-8\">\n                <div className=\"flex items-center justify-between mb-8\">\n                    <div>\n                        <h1 className=\"text-3xl font-bold text-foreground\">D·ª± √°n c·ªßa t√¥i</h1>\n                        <p className=\"text-muted-foreground mt-1\">\n                            Qu·∫£n l√Ω v√† bi√™n t·∫≠p c√°c t√†i li·ªáu LaTeX/Typst c·ªßa b·∫°n\n                        </p>\n                    </div>\n                    <Button onClick={() => setShowCreateModal(true)} className=\"gap-2\">\n                        <Plus className=\"h-4 w-4\" />\n                        T·∫°o d·ª± √°n m·ªõi\n                    </Button>\n                </div>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/DashboardPage.tsx", "file_name": "DashboardPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "152", "text": "{/* Projects Grid */}\n                {projects.length === 0 ? (\n                    <div className=\"text-center py-16\">\n                        <div className=\"w-20 h-20 mx-auto mb-6 rounded-full bg-muted flex items-center justify-center\">\n                            <FolderOpen className=\"h-10 w-10 text-muted-foreground\" />\n                        </div>\n                        <h3 className=\"text-xl font-medium text-foreground mb-2\">\n                            Ch∆∞a c√≥ d·ª± √°n n√†o\n                        </h3>\n                        <p className=\"text-muted-foreground mb-6\">\n                            B·∫Øt ƒë·∫ßu b·∫±ng c√°ch t·∫°o d·ª± √°n LaTeX ho·∫∑c Typst ƒë·∫ßu ti√™n c·ªßa b·∫°n\n                        </p>\n                        <Button onClick={() => setShowCreateModal(true)}>\n                            <Plus className=\"h-4 w-4 mr-2\" />\n                            T·∫°o d·ª± √°n ƒë·∫ßu ti√™n\n                        </Button>\n                    </div>\n                ) : (\n                    <div className=\"grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4\">\n                        {projects.map((project) => (\n                            <div\n                                key={project.id}\n                                className=\"group relative glass rounded-xl p-5 hover:border-primary/50 transition-all cursor-pointer\"\n                                onClick={() => navigate(`/editor/${project.id}`)}\n                            >\n                                <div className=\"flex items-start justify-between mb-4\">\n                                    <div className={`p-2 rounded-lg ${project.engine === 'TYPST'\n                                        ? 'bg-cyan-500/20 text-cyan-500'\n                                        : 'bg-orange-500/20 text-orange-500'\n                                        }`}>\n                                        <FileCode2 className=\"h-5 w-5\" />\n                                    </div>\n                                    <button\n                                        onClick={(e) => {\n                                            e.stopPropagation();\n                                            handleDeleteProject(project.id);\n                                        }}\n                                        className=\"opacity-0 group-hover:opacity-100 p-1 hover:bg-destructive/20 rounded transition-all\"\n                                    >\n                                        <Trash2 className=\"h-4 w-4 text-destructive\" />\n                                    </button>\n                                </div>\n\n                                <h3 className=\"font-semibold text-foreground mb-1 truncate\">\n                                    {project.name}\n                                </h3>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/DashboardPage.tsx", "file_name": "DashboardPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "153", "text": "<h3 className=\"font-semibold text-foreground mb-1 truncate\">\n                                    {project.name}\n                                </h3>\n\n                                <div className=\"flex items-center gap-4 text-xs text-muted-foreground mt-3\">\n                                    <span className=\"flex items-center gap-1\">\n                                        <Clock className=\"h-3 w-3\" />\n                                        {formatDate(project.updatedAt)}\n                                    </span>\n                                    <span className={`px-2 py-0.5 rounded-full ${project.engine === 'TYPST'\n                                        ? 'bg-cyan-500/10 text-cyan-500'\n                                        : 'bg-orange-500/10 text-orange-500'\n                                        }`}>\n                                        {project.engine}\n                                    </span>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </main>\n\n            {/* Create Project Modal */}\n            {showCreateModal && (\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm\">\n                    <div className=\"glass rounded-2xl p-6 w-full max-w-md mx-4 animate-fade-in\">\n                        <h2 className=\"text-xl font-bold mb-4\">T·∫°o d·ª± √°n m·ªõi</h2>\n\n                        <form onSubmit={handleCreateProject} className=\"space-y-4\">\n                            <Input\n                                label=\"T√™n d·ª± √°n\"\n                                placeholder=\"Lu·∫≠n vƒÉn t·ªët nghi·ªáp\"\n                                value={newProjectName}\n                                onChange={(e) => setNewProjectName(e.target.value)}\n                                required\n                                autoFocus\n                            />", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/DashboardPage.tsx", "file_name": "DashboardPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "154", "text": "<div className=\"space-y-2\">\n                                <label className=\"text-sm font-medium\">Ch·ªçn Engine</label>\n                                <div className=\"grid grid-cols-2 gap-3\">\n                                    <button\n                                        type=\"button\"\n                                        onClick={() => setNewProjectEngine('TYPST')}\n                                        className={`p-4 rounded-lg border-2 transition-all ${newProjectEngine === 'TYPST'\n                                            ? 'border-cyan-500 bg-cyan-500/10'\n                                            : 'border-border hover:border-muted-foreground'\n                                            }`}\n                                    >\n                                        <div className=\"font-medium text-cyan-500\">Typst</div>\n                                        <div className=\"text-xs text-muted-foreground mt-1\">\n                                            Nhanh, hi·ªán ƒë·∫°i\n                                        </div>\n                                    </button>\n                                    <button\n                                        type=\"button\"\n                                        onClick={() => setNewProjectEngine('LATEX')}\n                                        className={`p-4 rounded-lg border-2 transition-all ${newProjectEngine === 'LATEX'\n                                            ? 'border-orange-500 bg-orange-500/10'\n                                            : 'border-border hover:border-muted-foreground'\n                                            }`}\n                                    >\n                                        <div className=\"font-medium text-orange-500\">LaTeX</div>\n                                        <div className=\"text-xs text-muted-foreground mt-1\">\n                                            M·∫°nh m·∫Ω, truy·ªÅn th·ªëng\n                                        </div>\n                                    </button>\n                                </div>\n                            </div>\n\n                            <div className=\"flex gap-3 pt-4\">\n                                <Button\n                                    type=\"button\"\n                                    variant=\"outline\"\n                                    className=\"flex-1\"\n                                    onClick={() => setShowCreateModal(false)}\n                                >\n                                    H·ªßy\n                                </Button>\n                                <Button type=\"submit\" className=\"flex-1\" disabled={isCreating}>\n                                    {isCreating ? <Spinner size=\"sm\" /> : 'T·∫°o d·ª± √°n'}\n                                </Button>\n                            </div>\n                        </form>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/DashboardPage.tsx", "file_name": "DashboardPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "155", "text": "import { useEffect, useState, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport Editor, { type OnChange, type OnMount } from '@monaco-editor/react';\nimport type * as monaco from 'monaco-editor';\nimport { io, type Socket } from 'socket.io-client';\nimport * as Y from 'yjs';\nimport { useEditorStore, useAuthStore } from '../stores';\nimport { api } from '../lib/api';\nimport type { ProjectFile } from '../lib/types';\nimport { Button } from '../components/ui/Button';\nimport { Spinner } from '../components/ui/Spinner';\nimport { parseLatexLog, formatErrorsForDisplay } from '../utils/latexLogParser';\nimport {\n    FileCode2,\n    ChevronLeft,\n    PanelLeftClose,\n    PanelLeft,\n    Eye,\n    EyeOff,\n    Play,\n    FileText,\n    Folder,\n    FolderOpen,\n    Sun,\n    Moon,\n    Users,\n    Save,\n    Download,\n    Share2,\n} from 'lucide-react';\nimport { cn, getFileIcon } from '../lib/utils';\nimport { ShareModal } from '../components/ShareModal';\nimport { PDFViewer } from '../components/PDFViewer';\n\nconst SOCKET_URL = import.meta.env.VITE_SOCKET_URL || 'http://localhost:5433';\n\nexport function EditorPage() {\n    const { projectId } = useParams<{ projectId: string }>();\n    const navigate = useNavigate();\n    const { user } = useAuthStore();\n    const {\n        currentProject,\n        setCurrentProject,\n        currentFile,\n        setCurrentFile,\n        files,\n        setFiles,\n        openFiles,\n        addOpenFile,\n        removeOpenFile,\n        isSidebarOpen,\n        toggleSidebar,\n        isPreviewOpen,\n        togglePreview,\n        theme,\n        toggleTheme,\n        compilationStatus,\n        compilationError,\n        setCompilationStatus,\n        pdfData,\n        setPdfData,\n        updateFileContent,\n    } = useEditorStore();", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "156", "text": "const [isLoading, setIsLoading] = useState(true);\n    const [isSaving, setIsSaving] = useState(false);\n    const [expandedFolders, setExpandedFolders] = useState<Set<string>>(new Set(['/']));\n    const [collaborators, setCollaborators] = useState<Array<{ id: string; name: string; color: string }>>([]);\n    const [showShareModal, setShowShareModal] = useState(false);\n    const [queueStats, setQueueStats] = useState<{ compiling: number; queued: number; available: number } | null>(null);\n    \n    // Resizable columns state\n    const [sidebarWidth, setSidebarWidth] = useState(256); // default w-64 = 256px\n    const [editorWidth, setEditorWidth] = useState(50); // 50% of available space\n    const [isResizing, setIsResizing] = useState<'sidebar' | 'editor' | null>(null);\n\n    const socketRef = useRef<Socket | null>(null);\n    const fileInputRef = useRef<HTMLInputElement>(null);\n    const ydocRef = useRef<Y.Doc | null>(null);\n    const editorRef = useRef<monaco.editor.IStandaloneCodeEditor | null>(null);\n    const saveTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n    // Load project\n    useEffect(() => {\n        if (!projectId) return;\n\n        const loadProject = async () => {\n            try {\n                const { project } = await api.getProject(projectId);\n                setCurrentProject(project);\n                setFiles(project.files || []);\n\n                // Open main file by default\n                const mainFile = project.files?.find(f => f.path === `/${project.mainFile}`);\n                if (mainFile) {\n                    addOpenFile(mainFile);\n                }\n            } catch (error) {\n                console.error('Failed to load project:', error);\n                navigate('/dashboard');\n            } finally {\n                setIsLoading(false);\n            }\n        };\n\n        loadProject();\n    }, [projectId]);\n\n    // Setup WebSocket collaboration\n    useEffect(() => {\n        if (!currentFile || !currentProject || !user) return;", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "157", "text": "loadProject();\n    }, [projectId]);\n\n    // Setup WebSocket collaboration\n    useEffect(() => {\n        if (!currentFile || !currentProject || !user) return;\n\n        const socket = io(SOCKET_URL, {\n            path: '/collab',\n            transports: ['websocket'],\n        });\n        socketRef.current = socket;\n\n        const ydoc = new Y.Doc();\n        ydocRef.current = ydoc;\n\n        const docName = `project:${currentProject.id}:${currentFile.path}`;\n\n        socket.on('connect', () => {\n            console.log('Connected to collaboration server');\n            socket.emit('join-room', {\n                docName,\n                user: { id: user.id, name: user.name },\n            });\n        });\n\n        socket.on('sync', (_data: Uint8Array) => {\n            // Handle sync messages\n            console.log('Received sync message');\n        });\n\n        socket.on('update', (update: Uint8Array) => {\n            Y.applyUpdate(ydoc, new Uint8Array(update));\n        });\n\n        socket.on('user-joined', (userData: { id: string; name: string; color: string }) => {\n            setCollaborators(prev => {\n                if (prev.find(c => c.id === userData.id)) return prev;\n                return [...prev, userData];\n            });\n        });\n\n        socket.on('user-left', (userId: string) => {\n            setCollaborators(prev => prev.filter(c => c.id !== userId));\n        });\n\n        return () => {\n            socket.disconnect();\n            socketRef.current = null;\n            ydocRef.current = null;\n        };\n    }, [currentFile?.id, currentProject?.id, user]);\n\n    // Handle editor mount\n    const handleEditorMount: OnMount = (editor, monacoInstance) => {\n        editorRef.current = editor;\n\n        // Configure Monaco for LaTeX/Typst\n        monacoInstance.languages.register({ id: 'latex' });\n        monacoInstance.languages.register({ id: 'typst' });", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "158", "text": "// Configure Monaco for LaTeX/Typst\n        monacoInstance.languages.register({ id: 'latex' });\n        monacoInstance.languages.register({ id: 'typst' });\n\n        // LaTeX syntax highlighting\n        monacoInstance.languages.setMonarchTokensProvider('latex', {\n            tokenizer: {\n                root: [\n                    [/\\\\[a-zA-Z@]+/, 'keyword'],\n                    [/\\\\[^a-zA-Z@]/, 'keyword'],\n                    [/%.*$/, 'comment'],\n                    [/\\{/, 'delimiter.curly'],\n                    [/\\}/, 'delimiter.curly'],\n                    [/\\[/, 'delimiter.square'],\n                    [/\\]/, 'delimiter.square'],\n                    [/\\$\\$/, 'string', '@displaymath'],\n                    [/\\$/, 'string', '@inlinemath'],\n                    [/\\\\begin\\{[^}]+\\}/, 'keyword.control'],\n                    [/\\\\end\\{[^}]+\\}/, 'keyword.control'],\n                ],\n                inlinemath: [\n                    [/[^$]+/, 'string'],\n                    [/\\$/, 'string', '@pop'],\n                ],\n                displaymath: [\n                    [/[^$]+/, 'string'],\n                    [/\\$\\$/, 'string', '@pop'],\n                ],\n            },\n        });\n\n        // Typst syntax highlighting\n        monacoInstance.languages.setMonarchTokensProvider('typst', {\n            tokenizer: {\n                root: [\n                    [/#[a-zA-Z]+/, 'keyword'],\n                    [/\\/\\/.*$/, 'comment'],\n                    [/\\/\\*/, 'comment', '@comment'],\n                    [/\\[/, 'delimiter.square'],\n                    [/\\]/, 'delimiter.square'],\n                    [/\\{/, 'delimiter.curly'],\n                    [/\\}/, 'delimiter.curly'],\n                    [/\"([^\"\\\\]|\\\\.)*$/, 'string.invalid'],\n                    [/\"/, 'string', '@string'],\n                ],\n                comment: [\n                    [/[^/*]+/, 'comment'],\n                    [/\\*\\//, 'comment', '@pop'],\n                    [/[/*]/, 'comment'],\n                ],\n                string: [\n                    [/[^\\\\\"]+/, 'string'],\n                    [/\"/, 'string', '@pop'],\n                ],\n            },\n        });\n\n        // Set initial content\n        if (currentFile?.content) {\n            editor.setValue(currentFile.content);\n        }\n    };", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "159", "text": "// Set initial content\n        if (currentFile?.content) {\n            editor.setValue(currentFile.content);\n        }\n    };\n\n    // Handle content changes with auto-save\n    const handleEditorChange: OnChange = (value) => {\n        if (!currentFile || value === undefined) return;\n\n        updateFileContent(currentFile.id, value);\n\n        // Debounced auto-save\n        if (saveTimeoutRef.current) {\n            clearTimeout(saveTimeoutRef.current);\n        }\n\n        saveTimeoutRef.current = setTimeout(async () => {\n            await saveFile(currentFile.id, value);\n        }, 1500);\n\n        // Send update to collaborators\n        if (ydocRef.current && socketRef.current?.connected) {\n            const update = Y.encodeStateAsUpdate(ydocRef.current);\n            socketRef.current.emit('update', update);\n        }\n    };\n\n    // Engine setup\n    const xeTeXEngineRef = useRef<any>(null);\n    const typstEngineRef = useRef<any>(null);\n    const dvipdfmxEngineRef = useRef<any>(null);\n\n    useEffect(() => {\n        const initEngines = async () => {\n            // Allow opting out of WASM LaTeX engines via env var.\n            // If VITE_USE_WASM_LATEX === 'true' then load client-side WASM engines,\n            // otherwise prefer server-side TeXLive compilation and skip loading large WASM bundles.\n            const useWasmLatex = import.meta.env.VITE_USE_WASM_LATEX === 'true';\n\n            if (useWasmLatex) {\n                // Initialize XeTeX Engine\n                try {\n                    const { XeTeXEngine } = await import('../engines/XeTeXEngine');\n                    const engine = new XeTeXEngine();\n                    await engine.initialize();\n\n                    // Use TeXLive on-demand server running on port 5435\n                    // Worker will construct: http://localhost:5435/ + \"xetex/\" + format/filename\n                    engine.setTexliveEndpoint('http://localhost:5435/');", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "160", "text": "xeTeXEngineRef.current = engine;\n                    // Expose for tests\n                    (window as any).currentEngine = engine;\n                    console.log('XeTeXEngine initialized (WASM)');\n                } catch (e) {\n                    console.error('Failed to init XeTeXEngine (WASM):', e);\n                }\n\n                // Initialize Dvipdfmx Engine for XDV ‚Üí PDF conversion\n                try {\n                    const { DvipdfmxEngineWrapper } = await import('../engines/DvipdfmxEngine');\n                    const engine = new DvipdfmxEngineWrapper();\n                    await engine.initialize();\n                    engine.setTexliveEndpoint('http://localhost:5435/');\n                    \n                    dvipdfmxEngineRef.current = engine;\n                    console.log('DvipdfmxEngine initialized (WASM)');\n                } catch (e) {\n                    console.error('Failed to init DvipdfmxEngine (WASM):', e);\n                }\n            } else {\n                console.log('üöÄ [HeyTeX v2] Skipping WASM XeTeX/Dvipdfmx engines; using server-side TeXLive compilation');\n            }\n\n            // Initialize Typst Engine (always client-side)\n            try {\n                const { TypstCompilerEngine } = await import('../engines/TypstCompilerEngine');\n                const engine = new TypstCompilerEngine();\n                // Typst engine initializes lazily/async via worker\n                typstEngineRef.current = engine;\n                console.log('TypstCompilerEngine initialized');\n            } catch (e) {\n                console.error('Failed to init TypstCompilerEngine:', e);\n            }\n        };\n\n        initEngines();\n\n        return () => {\n            if (xeTeXEngineRef.current) {\n                // cleanup if needed\n                // xeTeXEngineRef.current.cleanup(); \n            }\n            if (typstEngineRef.current) {\n                typstEngineRef.current.terminate();\n            }\n        };\n    }, []);\n\n    // Poll queue stats periodically (for LaTeX projects)\n    useEffect(() => {\n        if (currentProject?.engine !== 'LATEX') return;", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "161", "text": "// Poll queue stats periodically (for LaTeX projects)\n    useEffect(() => {\n        if (currentProject?.engine !== 'LATEX') return;\n\n        const updateStats = async () => {\n            try {\n                const { compilationAPI } = await import('../api/compilation');\n                const stats = await compilationAPI.getStats();\n                setQueueStats(stats.stats);\n            } catch (error) {\n                console.error('[Queue Stats] Failed to fetch:', error);\n            }\n        };\n\n        // Initial fetch\n        updateStats();\n\n        // Poll every 3 seconds\n        const interval = setInterval(updateStats, 3000);\n\n        return () => clearInterval(interval);\n    }, [currentProject?.engine]);\n\n    // Save file\n    const saveFile = async (fileId: string, content: string) => {\n        setIsSaving(true);\n        try {\n            await api.updateFile(fileId, { content });\n        } catch (error) {\n            console.error('Failed to save:', error);\n        } finally {\n            setIsSaving(false);\n        }\n    };\n\n    // Compile document\n    const handleCompile = async () => {\n        if (!currentFile?.content) return;\n\n        setCompilationStatus('compiling');\n\n        try {\n            const engineType = currentProject?.engine || 'LATEX';\n\n            if (engineType === 'TYPST') {\n                // Typst v·∫´n s·ª≠ d·ª•ng WASM (client-side compilation)\n                if (!typstEngineRef.current) throw new Error('Typst engine not ready');\n\n                const result = await typstEngineRef.current.compile(\n                    'main.typ',\n                    { 'main.typ': currentFile.content },\n                    'pdf'\n                );\n\n                if (result.output) {\n                    const blob = new Blob([result.output], { type: 'application/pdf' });\n                    const url = URL.createObjectURL(blob);\n                    setPdfData(url);\n                    setCompilationStatus('success');\n                } else {\n                    throw new Error('No output from Typst');\n                }", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "162", "text": "} else {\n                // LaTeX - S·ª≠ d·ª•ng Server-side TeXLive compilation\n                const { compilationAPI } = await import('../api/compilation');\n                \n                console.log('[Compile] Submitting job to server...');\n                \n                // Submit compilation job\n                const submitResult = await compilationAPI.submitJob(\n                    currentFile.name,\n                    currentFile.content,\n                    currentProject?.id\n                );\n\n                console.log('[Compile] Job submitted:', submitResult.jobId, \n                    `Queue: ${submitResult.stats.queued}, Compiling: ${submitResult.stats.compiling}`);\n\n                // Poll for completion\n                const finalStatus = await compilationAPI.pollJobStatus(\n                    submitResult.jobId,\n                    (status) => {\n                        // Update UI v·ªõi queue position\n                        console.log('[Compile] Job status:', status.job.status, \n                            status.job.queuePosition ? `Position: ${status.job.queuePosition}` : '');\n                    }\n                );\n\n                if (finalStatus.job.status === 'completed') {\n                    // Download PDF\n                    console.log('[Compile] Downloading PDF...');\n                    const pdfBlob = await compilationAPI.getPDF(submitResult.jobId);\n                    const url = URL.createObjectURL(pdfBlob);\n                    setPdfData(url);\n                    setCompilationStatus('success');\n                    console.log('[Compile] PDF ready');\n                } else if (finalStatus.job.status === 'failed') {\n                    // Get error log\n                    const log = await compilationAPI.getLog(submitResult.jobId);\n                    const parsedErrors = parseLatexLog(log);\n                    const formattedErrors = formatErrorsForDisplay(parsedErrors);\n                    setCompilationStatus('error', formattedErrors || finalStatus.job.error || 'Compilation failed');\n                }\n            }\n        } catch (error) {\n            console.error('[Compile] Error:', error);\n            const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n            setCompilationStatus('error', errorMessage);\n        }\n    };\n\n    // Toggle folder expansion\n    const toggleFolder = (path: string) => {\n        setExpandedFolders(prev => {\n            const next = new Set(prev);\n            if (next.has(path)) {\n                next.delete(path);\n            } else {\n                next.add(path);\n            }\n            return next;\n        });\n    };", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "163", "text": "// File operations handlers\n    const handleNewFile = async () => {\n        const fileName = prompt('Enter file name (e.g., main.tex or document.typ):');\n        if (!fileName || !currentProject) return;\n        \n        try {\n            const { file } = await api.createFile({\n                projectId: currentProject.id,\n                name: fileName,\n                path: `/${fileName}`,\n                content: '',\n            });\n            setFiles([...files, file]);\n            addOpenFile(file);\n        } catch (error) {\n            console.error('Failed to create file:', error);\n            alert('Failed to create file');\n        }\n    };\n\n    const handleNewFolder = async () => {\n        const folderName = prompt('Enter folder name:');\n        if (!folderName || !currentProject) return;\n        \n        try {\n            const { file } = await api.createFile({\n                projectId: currentProject.id,\n                name: folderName,\n                path: `/${folderName}`,\n                isFolder: true,\n            });\n            setFiles([...files, file]);\n        } catch (error) {\n            console.error('Failed to create folder:', error);\n            alert('Failed to create folder');\n        }\n    };\n\n    const handleUpload = () => {\n        fileInputRef.current?.click();\n    };\n\n    const handleFileInputChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\n        const selectedFiles = e.target.files;\n        if (!selectedFiles || selectedFiles.length === 0 || !currentProject) return;\n\n        for (const file of Array.from(selectedFiles)) {\n            try {\n                // Read file as base64\n                const reader = new FileReader();\n                const base64Data = await new Promise<string>((resolve, reject) => {\n                    reader.onload = () => {\n                        const result = reader.result as string;\n                        // Remove data URL prefix (e.g., \"data:text/plain;base64,\")\n                        const base64 = result.split(',')[1] || result;\n                        resolve(base64);\n                    };\n                    reader.onerror = reject;\n                    reader.readAsDataURL(file);\n                });", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "164", "text": "// Upload file\n                const { file: uploadedFile } = await api.uploadFile({\n                    projectId: currentProject.id,\n                    path: `/${file.name}`,\n                    name: file.name,\n                    mimeType: file.type || 'application/octet-stream',\n                    data: base64Data,\n                });\n\n                setFiles([...files, uploadedFile]);\n                \n                // If it's a text file, open it\n                if (file.name.endsWith('.tex') || file.name.endsWith('.typ') || file.name.endsWith('.txt')) {\n                    addOpenFile(uploadedFile);\n                }\n            } catch (error) {\n                console.error(`Failed to upload ${file.name}:`, error);\n                alert(`Failed to upload ${file.name}`);\n            }\n        }\n\n        // Reset input\n        if (fileInputRef.current) {\n            fileInputRef.current.value = '';\n        }\n    };\n\n    const handleRename = async () => {\n        if (!currentFile) {\n            alert('Please select a file to rename');\n            return;\n        }\n        \n        const newName = prompt('Enter new name:', currentFile.name);\n        if (!newName || newName === currentFile.name) return;\n        \n        try {\n            await api.updateFile(currentFile.id, { name: newName });\n            const updatedFiles = files.map(f => \n                f.id === currentFile.id ? { ...f, name: newName } : f\n            );\n            setFiles(updatedFiles);\n            if (currentFile.id === currentFile.id) {\n                setCurrentFile({ ...currentFile, name: newName });\n            }\n        } catch (error) {\n            console.error('Failed to rename file:', error);\n            alert('Failed to rename file');\n        }\n    };", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "165", "text": "const handleDelete = async () => {\n        if (!currentFile) {\n            alert('Please select a file to delete');\n            return;\n        }\n        \n        if (!confirm(`Are you sure you want to delete \"${currentFile.name}\"?`)) {\n            return;\n        }\n        \n        try {\n            await api.deleteFile(currentFile.id);\n            const updatedFiles = files.filter(f => f.id !== currentFile.id);\n            setFiles(updatedFiles);\n            removeOpenFile(currentFile.id);\n            if (openFiles.length > 1) {\n                setCurrentFile(openFiles[0]);\n            } else {\n                setCurrentFile(null);\n            }\n        } catch (error) {\n            console.error('Failed to delete file:', error);\n            alert('Failed to delete file');\n        }\n    };\n\n    // Resize handlers\n    const handleMouseDown = (type: 'sidebar' | 'editor') => (e: React.MouseEvent) => {\n        e.preventDefault();\n        setIsResizing(type);\n    };\n\n    useEffect(() => {\n        if (!isResizing) return;\n\n        const handleMouseMove = (e: MouseEvent) => {\n            if (isResizing === 'sidebar') {\n                const newWidth = Math.max(200, Math.min(500, e.clientX));\n                setSidebarWidth(newWidth);\n            } else if (isResizing === 'editor') {\n                const container = document.querySelector('.editor-preview-container');\n                if (container) {\n                    const containerRect = container.getBoundingClientRect();\n                    const relativeX = e.clientX - containerRect.left;\n                    const percentage = Math.max(30, Math.min(70, (relativeX / containerRect.width) * 100));\n                    setEditorWidth(percentage);\n                }\n            }\n        };\n\n        const handleMouseUp = () => {\n            setIsResizing(null);\n        };\n\n        document.addEventListener('mousemove', handleMouseMove);\n        document.addEventListener('mouseup', handleMouseUp);\n\n        return () => {\n            document.removeEventListener('mousemove', handleMouseMove);\n            document.removeEventListener('mouseup', handleMouseUp);\n        };\n    }, [isResizing]);\n\n    // Build file tree structure - kept for future use\n    /* const buildFileTree = useCallback(() => {\n        const tree: { [key: string]: ProjectFile[] } = { '/': [] };", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "166", "text": "// Build file tree structure - kept for future use\n    /* const buildFileTree = useCallback(() => {\n        const tree: { [key: string]: ProjectFile[] } = { '/': [] };\n\n        files.forEach(file => {\n            const parentPath = file.path.substring(0, file.path.lastIndexOf('/')) || '/';\n            if (!tree[parentPath]) tree[parentPath] = [];\n            tree[parentPath].push(file);\n        });\n\n        return tree;\n    }, [files]); */\n\n    // fileTree is available from buildFileTree() when needed\n\n    // Get language for Monaco\n    const getLanguage = () => {\n        if (!currentFile) return 'plaintext';\n        const ext = currentFile.name.split('.').pop()?.toLowerCase();\n        if (ext === 'tex') return 'latex';\n        if (ext === 'typ') return 'typst';\n        if (ext === 'bib') return 'bibtex';\n        if (ext === 'md') return 'markdown';\n        return 'plaintext';\n    };\n\n    if (isLoading) {\n        return (\n            <div className=\"h-screen flex items-center justify-center bg-background\">\n                <Spinner size=\"lg\" />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"h-screen flex flex-col bg-background overflow-hidden\">\n            {/* Top Bar */}\n            <header className=\"h-12 flex items-center justify-between px-4 border-b bg-card shrink-0\">\n                <div className=\"flex items-center gap-3\">\n                    <Button variant=\"ghost\" size=\"icon\" onClick={() => navigate('/dashboard')}>\n                        <ChevronLeft className=\"h-5 w-5\" />\n                    </Button>\n                    <div className=\"flex items-center gap-2\">\n                        <FileCode2 className=\"h-5 w-5 text-primary\" />\n                        <span className=\"font-medium\">{currentProject?.name}</span>\n                        <span className={`text-xs px-2 py-0.5 rounded-full ${currentProject?.engine === 'TYPST'\n                            ? 'bg-cyan-500/10 text-cyan-500'\n                            : 'bg-orange-500/10 text-orange-500'\n                            }`}>\n                            {currentProject?.engine}\n                        </span>\n                    </div>\n                </div>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "167", "text": "<div className=\"flex items-center gap-2\">\n                    {/* Collaborators */}\n                    {collaborators.length > 0 && (\n                        <div className=\"flex items-center gap-1 mr-2\">\n                            <Users className=\"h-4 w-4 text-muted-foreground\" />\n                            <div className=\"flex -space-x-2\">\n                                {collaborators.slice(0, 3).map(c => (\n                                    <div\n                                        key={c.id}\n                                        className=\"w-6 h-6 rounded-full border-2 border-background flex items-center justify-center text-xs font-medium text-white\"\n                                        style={{ backgroundColor: c.color }}\n                                        title={c.name}\n                                    >\n                                        {c.name.charAt(0)}\n                                    </div>\n                                ))}\n                            </div>\n                        </div>\n                    )}\n\n                    {/* Save indicator */}\n                    <div className=\"flex items-center gap-1 text-sm text-muted-foreground\">\n                        {isSaving ? (\n                            <Spinner size=\"sm\" />\n                        ) : (\n                            <Save className=\"h-4 w-4\" />\n                        )}\n                        <span>{isSaving ? 'ƒêang l∆∞u...' : 'ƒê√£ l∆∞u'}</span>\n                    </div>\n\n                    <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => setShowShareModal(true)}\n                        className=\"gap-2\"\n                    >\n                        <Share2 className=\"h-4 w-4\" />\n                        Chia s·∫ª\n                    </Button>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "168", "text": "{/* Queue stats for LaTeX projects */}\n                    {currentProject?.engine === 'LATEX' && queueStats && (\n                        <div className=\"flex items-center gap-1 text-xs text-muted-foreground border rounded px-2 py-1\">\n                            <div className=\"flex items-center gap-1\">\n                                <div className=\"w-2 h-2 rounded-full bg-green-500\"></div>\n                                <span>{queueStats.compiling} ƒëang d·ªãch</span>\n                            </div>\n                            {queueStats.queued > 0 && (\n                                <>\n                                    <span>‚Ä¢</span>\n                                    <div className=\"flex items-center gap-1\">\n                                        <div className=\"w-2 h-2 rounded-full bg-yellow-500\"></div>\n                                        <span>{queueStats.queued} ƒëang ch·ªù</span>\n                                    </div>\n                                </>\n                            )}\n                        </div>\n                    )}\n\n                    <Button\n                        size=\"sm\"\n                        onClick={handleCompile}\n                        disabled={\n                            compilationStatus === 'compiling' || \n                            (currentProject?.engine === 'LATEX' && !!(queueStats && queueStats.available === 0))\n                        }\n                        className=\"gap-2\"\n                        title={\n                            queueStats && queueStats.available === 0 \n                                ? 'Server ƒëang ƒë·∫ßy, vui l√≤ng ch·ªù...' \n                                : undefined\n                        }\n                    >\n                        {compilationStatus === 'compiling' ? (\n                            <Spinner size=\"sm\" />\n                        ) : (\n                            <Play className=\"h-4 w-4\" />\n                        )}\n                        Bi√™n d·ªãch\n                    </Button>\n\n                    <Button variant=\"ghost\" size=\"icon\" onClick={toggleTheme}>\n                        {theme === 'dark' ? <Sun className=\"h-4 w-4\" /> : <Moon className=\"h-4 w-4\" />}\n                    </Button>\n                </div>\n            </header>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "169", "text": "{/* Main Content */}\n            <div className=\"flex-1 flex overflow-hidden\">\n                {/* Hidden file input for upload */}\n                <input\n                    ref={fileInputRef}\n                    type=\"file\"\n                    multiple\n                    className=\"hidden\"\n                    onChange={handleFileInputChange}\n                />\n                \n                {/* Sidebar */}\n                <aside\n                    style={{ width: isSidebarOpen ? `${sidebarWidth}px` : '0' }}\n                    className={cn(\n                        'border-r bg-card flex flex-col transition-all duration-200 shrink-0',\n                        !isSidebarOpen && 'border-r-0'\n                    )}\n                >\n                    {isSidebarOpen && (\n                        <>\n                            <div className=\"px-2 py-1.", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "170", "text": "!isSidebarOpen && 'border-r-0'\n                    )}\n                >\n                    {isSidebarOpen && (\n                        <>\n                            <div className=\"px-2 py-1.5 border-b flex items-center justify-between gap-1\">\n                                <div className=\"flex items-center gap-1\">\n                                    <Button \n                                        variant=\"ghost\" \n                                        size=\"icon\" \n                                        className=\"h-7 w-7\"\n                                        title=\"New file\"\n                                        onClick={handleNewFile}\n                                    >\n                                        <FileText className=\"h-4 w-4\" />\n                                    </Button>\n                                    <Button \n                                        variant=\"ghost\" \n                                        size=\"icon\" \n                                        className=\"h-7 w-7\"\n                                        title=\"New folder\"\n                                        onClick={handleNewFolder}\n                                    >\n                                        <FolderOpen className=\"h-4 w-4\" />\n                                    </Button>\n                                    <Button \n                                        variant=\"ghost\" \n                                        size=\"icon\" \n                                        className=\"h-7 w-7\"\n                                        title=\"Upload\"\n                                        onClick={handleUpload}\n                                    >\n                                        <Download className=\"h-4 w-4 rotate-180\" />\n                                    </Button>\n                                </div>\n                                <div className=\"flex items-center gap-1\">\n                                    <Button \n                                        variant=\"ghost\" \n                                        size=\"icon\" \n                                        className=\"h-7 w-7\"\n                                        title=\"Rename\"\n                                        onClick={handleRename}\n                                    >\n                                        <FileCode2 className=\"h-4 w-4\" />\n                                    </Button>\n                                    <Button \n                                        variant=\"ghost\" \n                                        size=\"icon\" \n                                        className=\"h-7 w-7 hover:text-destructive\"\n                                        title=\"Delete\"\n                                        onClick={handleDelete}\n                                    >\n                                        <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "171", "text": "867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n                                        </svg>\n                                    </Button>\n                                </div>\n                            </div>\n\n                            <div className=\"flex-1 overflow-y-auto p-2\">\n                                {files.filter(f => !f.path.includes('/', 1) || f.path.split('/').length === 2).map(file => (\n                                    <FileTreeItem\n                                        key={file.id}\n                                        file={file}\n                                        files={files}\n                                        isExpanded={expandedFolders.has(file.path)}\n                                        onToggle={toggleFolder}\n                                        onSelect={(f) => {\n                                            if (!f.isFolder) {\n                                                addOpenFile(f);\n                                            }\n                                        }}\n                                        isSelected={currentFile?.id === file.id}\n                                        level={0}\n                                    />\n                                ))}\n                            </div>\n                        </>\n                    )}\n                </aside>\n\n                {/* Sidebar Resize Handle */}\n                {isSidebarOpen && (\n                    <div\n                        onMouseDown={handleMouseDown('sidebar')}\n                        className={cn(\n                            'w-1 hover:w-1.5 bg-border hover:bg-primary/50 cursor-col-resize transition-all shrink-0',\n                            isResizing === 'sidebar' && 'bg-primary w-1.5'\n                        )}\n                    />\n                )}\n\n                {/* Toggle Sidebar Button */}\n                <button\n                    onClick={toggleSidebar}\n                    className=\"w-5 h-full flex items-center justify-center hover:bg-muted transition-colors shrink-0\"\n                >\n                    {isSidebarOpen ? (\n                        <PanelLeftClose className=\"h-4 w-4 text-muted-foreground\" />\n                    ) : (\n                        <PanelLeft className=\"h-4 w-4 text-muted-foreground\" />\n                    )}\n                </button>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "172", "text": "{/* Editor + Preview */}\n                <div className=\"flex-1 flex overflow-hidden editor-preview-container\">\n                    {/* Editor Panel */}\n                    <div \n                        style={{ width: isPreviewOpen ? `${editorWidth}%` : '100%' }}\n                        className=\"flex flex-col min-w-0 transition-all duration-200\"\n                    >\n                        {/* Tabs */}\n                        <div className=\"h-9 flex items-center border-b bg-card/50 overflow-x-auto shrink-0\">\n                            {openFiles.map(file => (\n                                <div\n                                    key={file.id}\n                                    onClick={() => setCurrentFile(file)}\n                                    className={cn(\n                                        'flex items-center gap-2 px-3 h-full border-r cursor-pointer group',\n                                        currentFile?.id === file.id\n                                            ? 'bg-background border-b-2 border-b-primary'\n                                            : 'hover:bg-muted/50'\n                                    )}\n                                >\n                                    <span className=\"text-sm\">{getFileIcon(file.name)}</span>\n                                    <span className=\"text-sm truncate max-w-32\">{file.name}</span>\n                                    <button\n                                        onClick={(e) => {\n                                            e.stopPropagation();\n                                            removeOpenFile(file.id);\n                                        }}\n                                        className=\"opacity-0 group-hover:opacity-100 hover:text-destructive\"\n                                    >\n                                        √ó\n                                    </button>\n                                </div>\n                            ))}\n                        </div>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "173", "text": "{/* Monaco Editor */}\n                        <div className=\"flex-1 min-h-0\">\n                            {currentFile ? (\n                                <Editor\n                                    height=\"100%\"\n                                    language={getLanguage()}\n                                    value={currentFile.content || ''}\n                                    onChange={handleEditorChange}\n                                    onMount={handleEditorMount}\n                                    theme={theme === 'dark' ? 'vs-dark' : 'light'}\n                                    options={{\n                                        fontSize: 14,\n                                        fontFamily: 'JetBrains Mono, Consolas, monospace',\n                                        minimap: { enabled: false },\n                                        wordWrap: 'on',\n                                        lineNumbers: 'on',\n                                        folding: true,\n                                        automaticLayout: true,\n                                        scrollBeyondLastLine: false,\n                                        padding: { top: 16 },\n                                        bracketPairColorization: { enabled: true },\n                                        matchBrackets: 'always',\n                                        colorDecorators: true,\n                                        renderWhitespace: 'selection',\n                                        occurrencesHighlight: 'multiFile',\n                                    }}\n                                />\n                            ) : (\n                                <div className=\"h-full flex items-center justify-center text-muted-foreground\">\n                                    <div className=\"text-center\">\n                                        <FileText className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                                        <p>Ch·ªçn m·ªôt file ƒë·ªÉ b·∫Øt ƒë·∫ßu bi√™n t·∫≠p</p>\n                                    </div>\n                                </div>\n                            )}\n                        </div>\n                    </div>\n\n                    {/* Preview Panel Toggle */}\n                    <button\n                        onClick={togglePreview}\n                        className=\"w-5 h-full flex items-center justify-center hover:bg-muted transition-colors shrink-0 border-x\"\n                    >\n                        {isPreviewOpen ? (\n                            <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                        ) : (\n                            <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                        )}\n                    </button>\n\n                    {/* Editor-Preview Resize Handle */}\n                    {isPreviewOpen && (\n                        <div\n                            onMouseDown={handleMouseDown('editor')}\n                            className={cn(\n                                'w-1 hover:w-1.5 bg-border hover:bg-primary/50 cursor-col-resize transition-all shrink-0',\n                                isResizing === 'editor' && 'bg-primary w-1.5'\n                            )}\n                        />\n                    )}", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "174", "text": "{/* Preview Panel */}\n                    {isPreviewOpen && (\n                        <div \n                            style={{ width: `${100 - editorWidth}%` }}\n                            className=\"flex flex-col bg-muted/30 min-w-0\"\n                        >\n                            <div className=\"h-9 flex items-center justify-between px-4 border-b bg-card/50 shrink-0\">\n                                <span className=\"text-sm font-medium text-muted-foreground\">PDF PREVIEW</span>\n                                <Button variant=\"ghost\" size=\"sm\" className=\"h-7 gap-2\">\n                                    <Download className=\"h-3 w-3\" />\n                                    Export\n                                </Button>\n                            </div>\n\n                            <div className=\"flex-1 flex items-center justify-center overflow-auto p-4\">\n                                {compilationStatus === 'compiling' ? (\n                                    <div className=\"text-center\">\n                                        <Spinner size=\"lg\" />\n                                        <p className=\"mt-4 text-muted-foreground\">ƒêang bi√™n d·ªãch...</p>\n                                    </div>\n                                ) : compilationStatus === 'error' ? (\n                                    <div className=\"w-full h-full overflow-auto p-4\">\n                                        <div className=\"bg-destructive/10 border border-destructive/30 rounded-lg p-4 mb-4\">\n                                            <h3 className=\"text-lg font-semibold text-destructive mb-2\">‚ùå Compilation Failed</h3>\n                                            <p className=\"text-sm text-muted-foreground mb-4\">\n                                                Compilation encountered errors. Please fix them and try again.\n                                            </p>\n                                        </div>\n                                        <div className=\"bg-card border rounded-lg overflow-hidden mb-4\">\n                                            <div className=\"bg-muted px-4 py-2 border-b font-semibold text-sm\">\n                                                üìã Error Details\n                                            </div>\n                                            <pre className=\"p-4 text-sm font-mono whitespace-pre-wrap overflow-auto max-h-96\">\n                                                {compilationError || 'Compilation failed. No detailed error message available.'}", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "175", "text": "No detailed error message available.'}\n                                            </pre>\n                                        </div>\n                                        <div className=\"mt-4 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg\">\n                                            <h4 className=\"font-semibold text-blue-600 mb-2\">üí° Need Help?</h4>\n                                            <ul className=\"text-sm space-y-2\">\n                                                <li>‚Ä¢ Check if all required packages are available in the TeXLive distribution</li>\n                                                <li>‚Ä¢ Missing packages? Install them via <code className=\"bg-card px-1 rounded\">tlmgr</code> or use alternatives</li>\n                                                <li>‚Ä¢ Copy this log to get help from the community</li>\n                                            </ul>\n                                        </div>\n                                    </div>\n                                ) : pdfData ? (\n                                    <PDFViewer pdfUrl={pdfData} />\n                                ) : (\n                                    <div className=\"text-center text-muted-foreground\">\n                                        <Eye className=\"h-12 w-12 mx-auto mb-4 opacity-50\" />\n                                        <p>Nh·∫•n \"Bi√™n d·ªãch\" ƒë·ªÉ xem k·∫øt qu·∫£</p>\n                                    </div>\n                                )}\n                            </div>\n                        </div>\n                    )}\n                </div>\n            </div>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "176", "text": "{/* Status Bar */}\n            <footer className=\"h-6 flex items-center justify-between px-4 border-t bg-card text-xs text-muted-foreground shrink-0\">\n                <div className=\"flex items-center gap-4\">\n                    <span>{currentProject?.engine}</span>\n                    <span>{currentFile?.path}</span>\n                </div>\n                <div className=\"flex items-center gap-4\">\n                    <span className={cn(\n                        'flex items-center gap-1',\n                        compilationStatus === 'success' && 'text-green-500',\n                        compilationStatus === 'error' && 'text-destructive'\n                    )}>\n                        {compilationStatus === 'idle' && '‚ö™ S·∫µn s√†ng'}\n                        {compilationStatus === 'compiling' && 'üîÑ ƒêang bi√™n d·ªãch'}\n                        {compilationStatus === 'success' && '‚úì Th√†nh c√¥ng'}\n                        {compilationStatus === 'error' && '‚úó L·ªói'}\n                    </span>\n                </div>\n            </footer>\n\n            {/* Share Modal */}\n            {showShareModal && currentProject && (\n                <ShareModal\n                    isOpen={showShareModal}\n                    onClose={() => setShowShareModal(false)}\n                    projectId={currentProject.id}\n                    projectName={currentProject.name}\n                    collaborators={currentProject.collaborators || []}\n                    onCollaboratorAdded={async () => {\n                        // Reload project to get updated collaborators\n                        if (projectId) {\n                            const { project } = await api.getProject(projectId);\n                            setCurrentProject(project);\n                        }\n                    }}\n                />\n            )}\n        </div>\n    );\n}\n\n// File Tree Item Component\ninterface FileTreeItemProps {\n    file: ProjectFile;\n    files: ProjectFile[];\n    isExpanded: boolean;\n    onToggle: (path: string) => void;\n    onSelect: (file: ProjectFile) => void;\n    isSelected: boolean;\n    level: number;\n}\n\nfunction FileTreeItem({ file, files, isExpanded, onToggle, onSelect, isSelected, level }: FileTreeItemProps) {\n    const children = files.filter(f => {\n        const parentPath = f.path.substring(0, f.path.lastIndexOf('/')) || '/';\n        return parentPath === file.path && f.id !== file.id;\n    });", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "177", "text": "return (\n        <div>\n            <div\n                onClick={() => file.isFolder ? onToggle(file.path) : onSelect(file)}\n                className={cn(\n                    'flex items-center gap-2 px-2 py-1 rounded cursor-pointer text-sm',\n                    isSelected ? 'bg-primary/20 text-primary' : 'hover:bg-muted'\n                )}\n                style={{ paddingLeft: `${level * 12 + 8}px` }}\n            >\n                {file.isFolder ? (\n                    isExpanded ? <FolderOpen className=\"h-4 w-4 text-yellow-500\" /> : <Folder className=\"h-4 w-4 text-yellow-500\" />\n                ) : (\n                    <span>{getFileIcon(file.name)}</span>\n                )}\n                <span className=\"truncate\">{file.name}</span>\n            </div>\n\n            {file.isFolder && isExpanded && children.map(child => (\n                <FileTreeItem\n                    key={child.id}\n                    file={child}\n                    files={files}\n                    isExpanded={isExpanded}\n                    onToggle={onToggle}\n                    onSelect={onSelect}\n                    isSelected={isSelected}\n                    level={level + 1}\n                />\n            ))}\n        </div>\n    );\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/EditorPage.tsx", "file_name": "EditorPage.tsx", "creation_date": "2025-12-08", "last_modified_date": "2025-12-16"}}
{"id": "178", "text": "import { useState } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { useAuthStore } from '../stores';\nimport { Button } from '../components/ui/Button';\nimport { Input } from '../components/ui/Input';\nimport { Spinner } from '../components/ui/Spinner';\nimport { FileCode2, Sparkles } from 'lucide-react';\n\nexport function LoginPage() {\n    const navigate = useNavigate();\n    const { login } = useAuthStore();\n    const [email, setEmail] = useState('');\n    const [password, setPassword] = useState('');\n    const [error, setError] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setError('');\n        setIsLoading(true);\n\n        try {\n            await login(email, password);\n            navigate('/dashboard');\n        } catch (err) {\n            setError(err instanceof Error ? err.message : 'ƒêƒÉng nh·∫≠p th·∫•t b·∫°i');\n        } finally {\n            setIsLoading(false);\n        }\n    };", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/LoginPage.tsx", "file_name": "LoginPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "179", "text": "return (\n        <div className=\"flex min-h-screen\">\n            {/* Left side - Branding */}\n            <div className=\"hidden lg:flex lg:w-1/2 bg-gradient-to-br from-primary/20 via-primary/10 to-background items-center justify-center p-12\">\n                <div className=\"max-w-md space-y-6\">\n                    <div className=\"flex items-center gap-3\">\n                        <div className=\"p-3 rounded-xl bg-primary/20\">\n                            <FileCode2 className=\"h-10 w-10 text-primary\" />\n                        </div>\n                        <span className=\"text-4xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent\">\n                            HeyTeX\n                        </span>\n                    </div>\n                    <h1 className=\"text-3xl font-bold text-foreground\">\n                        Bi√™n t·∫≠p LaTeX & Typst chuy√™n nghi·ªáp\n                    </h1>\n                    <p className=\"text-lg text-muted-foreground\">\n                        Tr·∫£i nghi·ªám giao di·ªán gi·ªëng VS Code, bi√™n d·ªãch Wasm si√™u t·ªëc,\n                        v√† c·ªông t√°c th·ªùi gian th·ª±c v·ªõi ƒë·ªìng nghi·ªáp.\n                    </p>\n                    <div className=\"flex items-center gap-2 text-primary\">\n                        <Sparkles className=\"h-5 w-5\" />\n                        <span>Powered by WebAssembly</span>\n                    </div>\n                </div>\n            </div>", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/LoginPage.tsx", "file_name": "LoginPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "180", "text": "{/* Right side - Login form */}\n            <div className=\"flex w-full lg:w-1/2 items-center justify-center p-8\">\n                <div className=\"w-full max-w-md space-y-8\">\n                    <div className=\"text-center lg:text-left\">\n                        <div className=\"flex items-center gap-2 justify-center lg:hidden mb-8\">\n                            <FileCode2 className=\"h-8 w-8 text-primary\" />\n                            <span className=\"text-2xl font-bold\">HeyTeX</span>\n                        </div>\n                        <h2 className=\"text-2xl font-bold text-foreground\">ƒêƒÉng nh·∫≠p</h2>\n                        <p className=\"mt-2 text-muted-foreground\">\n                            Ch√†o m·ª´ng b·∫°n quay l·∫°i! Vui l√≤ng nh·∫≠p th√¥ng tin ƒëƒÉng nh·∫≠p.\n                        </p>\n                    </div>\n\n                    <form onSubmit={handleSubmit} className=\"space-y-6\">\n                        {error && (\n                            <div className=\"p-3 rounded-lg bg-destructive/10 text-destructive text-sm\">\n                                {error}\n                            </div>\n                        )}\n\n                        <Input\n                            label=\"Email\"\n                            type=\"email\"\n                            placeholder=\"email@example.com\"\n                            value={email}\n                            onChange={(e) => setEmail(e.target.value)}\n                            required\n                            autoComplete=\"email\"\n                        />\n\n                        <Input\n                            label=\"M·∫≠t kh·∫©u\"\n                            type=\"password\"\n                            placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                            value={password}\n                            onChange={(e) => setPassword(e.target.value)}\n                            required\n                            autoComplete=\"current-password\"\n                        />\n\n                        <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n                            {isLoading ? <Spinner size=\"sm\" /> : 'ƒêƒÉng nh·∫≠p'}\n                        </Button>\n                    </form>\n\n                    <p className=\"text-center text-sm text-muted-foreground\">\n                        Ch∆∞a c√≥ t√†i kho·∫£n?{' '}\n                        <Link to=\"/register\" className=\"text-primary hover:underline font-medium\">\n                            ƒêƒÉng k√Ω ngay\n                        </Link>\n                    </p>\n                </div>\n            </div>\n        </div>\n    );\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/LoginPage.tsx", "file_name": "LoginPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "181", "text": "import { useState } from 'react';\nimport { useNavigate, Link } from 'react-router-dom';\nimport { useAuthStore } from '../stores';\nimport { Button } from '../components/ui/Button';\nimport { Input } from '../components/ui/Input';\nimport { Spinner } from '../components/ui/Spinner';\nimport { FileCode2 } from 'lucide-react';\n\nexport function RegisterPage() {\n    const navigate = useNavigate();\n    const { register } = useAuthStore();\n    const [name, setName] = useState('');\n    const [email, setEmail] = useState('');\n    const [password, setPassword] = useState('');\n    const [confirmPassword, setConfirmPassword] = useState('');\n    const [error, setError] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setError('');\n\n        if (password !== confirmPassword) {\n            setError('M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp');\n            return;\n        }\n\n        if (password.length < 6) {\n            setError('M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±');\n            return;\n        }\n\n        setIsLoading(true);\n\n        try {\n            await register(email, password, name);\n            navigate('/dashboard');\n        } catch (err) {\n            setError(err instanceof Error ? err.message : 'ƒêƒÉng k√Ω th·∫•t b·∫°i');\n        } finally {\n            setIsLoading(false);\n        }\n    };", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/RegisterPage.tsx", "file_name": "RegisterPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "182", "text": "return (\n        <div className=\"flex min-h-screen items-center justify-center bg-gradient-to-br from-background via-background to-primary/5 p-8\">\n            <div className=\"w-full max-w-md space-y-8\">\n                <div className=\"text-center\">\n                    <div className=\"flex items-center gap-2 justify-center mb-6\">\n                        <FileCode2 className=\"h-10 w-10 text-primary\" />\n                        <span className=\"text-3xl font-bold bg-gradient-to-r from-primary to-primary/60 bg-clip-text text-transparent\">\n                            HeyTeX\n                        </span>\n                    </div>\n                    <h2 className=\"text-2xl font-bold text-foreground\">T·∫°o t√†i kho·∫£n m·ªõi</h2>\n                    <p className=\"mt-2 text-muted-foreground\">\n                        B·∫Øt ƒë·∫ßu h√†nh tr√¨nh bi√™n t·∫≠p t√†i li·ªáu chuy√™n nghi·ªáp\n                    </p>\n                </div>\n\n                <div className=\"glass rounded-2xl p-8 shadow-xl\">\n                    <form onSubmit={handleSubmit} className=\"space-y-5\">\n                        {error && (\n                            <div className=\"p-3 rounded-lg bg-destructive/10 text-destructive text-sm\">\n                                {error}\n                            </div>\n                        )}\n\n                        <Input\n                            label=\"H·ªç v√† t√™n\"\n                            type=\"text\"\n                            placeholder=\"Nguy·ªÖn VƒÉn A\"\n                            value={name}\n                            onChange={(e) => setName(e.target.value)}\n                            required\n                            autoComplete=\"name\"\n                        />\n\n                        <Input\n                            label=\"Email\"\n                            type=\"email\"\n                            placeholder=\"email@example.com\"\n                            value={email}\n                            onChange={(e) => setEmail(e.target.value)}\n                            required\n                            autoComplete=\"email\"\n                        />\n\n                        <Input\n                            label=\"M·∫≠t kh·∫©u\"\n                            type=\"password\"\n                            placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                            value={password}\n                            onChange={(e) => setPassword(e.target.value)}\n                            required\n                            autoComplete=\"new-password\"\n                        />", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/RegisterPage.tsx", "file_name": "RegisterPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "183", "text": "<Input\n                            label=\"X√°c nh·∫≠n m·∫≠t kh·∫©u\"\n                            type=\"password\"\n                            placeholder=\"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢\"\n                            value={confirmPassword}\n                            onChange={(e) => setConfirmPassword(e.target.value)}\n                            required\n                            autoComplete=\"new-password\"\n                        />\n\n                        <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n                            {isLoading ? <Spinner size=\"sm\" /> : 'ƒêƒÉng k√Ω'}\n                        </Button>\n                    </form>\n                </div>\n\n                <p className=\"text-center text-sm text-muted-foreground\">\n                    ƒê√£ c√≥ t√†i kho·∫£n?{' '}\n                    <Link to=\"/login\" className=\"text-primary hover:underline font-medium\">\n                        ƒêƒÉng nh·∫≠p\n                    </Link>\n                </p>\n            </div>\n        </div>\n    );\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/pages/RegisterPage.tsx", "file_name": "RegisterPage.tsx", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "184", "text": "import { create } from 'zustand';\nimport { api } from '../lib/api';\nimport type { User, Project, ProjectFile } from '../lib/types';\n\ninterface AuthState {\n    user: User | null;\n    isAuthenticated: boolean;\n    isLoading: boolean;\n    login: (email: string, password: string) => Promise<void>;\n    register: (email: string, password: string, name: string) => Promise<void>;\n    logout: () => void;\n    checkAuth: () => Promise<void>;\n}\n\nexport const useAuthStore = create<AuthState>((set) => ({\n    user: null,\n    isAuthenticated: false,\n    isLoading: true,\n\n    login: async (email, password) => {\n        const { user } = await api.login(email, password);\n        set({ user, isAuthenticated: true });\n    },\n\n    register: async (email, password, name) => {\n        const { user } = await api.register(email, password, name);\n        set({ user, isAuthenticated: true });\n    },\n\n    logout: () => {\n        api.logout();\n        set({ user: null, isAuthenticated: false });\n    },\n\n    checkAuth: async () => {\n        try {\n            const token = localStorage.getItem('heytex_token');\n            if (!token) {\n                set({ isLoading: false });\n                return;\n            }\n            const { user } = await api.getMe();\n            set({ user, isAuthenticated: true, isLoading: false });\n        } catch {\n            localStorage.removeItem('heytex_token');\n            set({ user: null, isAuthenticated: false, isLoading: false });\n        }\n    },\n}));\n\ninterface EditorState {\n    currentProject: Project | null;\n    currentFile: ProjectFile | null;\n    files: ProjectFile[];\n    openFiles: ProjectFile[];\n    isSidebarOpen: boolean;\n    isPreviewOpen: boolean;\n    theme: 'light' | 'dark';\n    compilationStatus: 'idle' | 'compiling' | 'success' | 'error';\n    compilationError: string | null;\n    pdfData: string | null;", "metadata": {"file_path": "/Users/mac/heytex/client/src/stores/index.ts", "file_name": "index.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "185", "text": "setCurrentProject: (project: Project | null) => void;\n    setCurrentFile: (file: ProjectFile | null) => void;\n    setFiles: (files: ProjectFile[]) => void;\n    addOpenFile: (file: ProjectFile) => void;\n    removeOpenFile: (fileId: string) => void;\n    toggleSidebar: () => void;\n    togglePreview: () => void;\n    toggleTheme: () => void;\n    setCompilationStatus: (status: 'idle' | 'compiling' | 'success' | 'error', error?: string) => void;\n    setPdfData: (data: string | null) => void;\n    updateFileContent: (fileId: string, content: string) => void;\n}\n\nexport const useEditorStore = create<EditorState>((set, get) => ({\n    currentProject: null,\n    currentFile: null,\n    files: [],\n    openFiles: [],\n    isSidebarOpen: true,\n    isPreviewOpen: true,\n    theme: (localStorage.getItem('heytex_theme') as 'light' | 'dark') || 'light',\n    compilationStatus: 'idle',\n    compilationError: null,\n    pdfData: null,\n\n    setCurrentProject: (project) => set({ currentProject: project }),\n    setCurrentFile: (file) => set({ currentFile: file }),\n    setFiles: (files) => set({ files }),\n\n    addOpenFile: (file) => {\n        const { openFiles } = get();\n        if (!openFiles.find(f => f.id === file.id)) {\n            set({ openFiles: [...openFiles, file] });\n        }\n        set({ currentFile: file });\n    },\n\n    removeOpenFile: (fileId) => {\n        const { openFiles, currentFile } = get();\n        const newOpenFiles = openFiles.filter(f => f.id !== fileId);\n        set({ openFiles: newOpenFiles });\n\n        if (currentFile?.id === fileId) {\n            set({ currentFile: newOpenFiles[newOpenFiles.length - 1] || null });\n        }\n    },", "metadata": {"file_path": "/Users/mac/heytex/client/src/stores/index.ts", "file_name": "index.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "186", "text": "if (currentFile?.id === fileId) {\n            set({ currentFile: newOpenFiles[newOpenFiles.length - 1] || null });\n        }\n    },\n\n    toggleSidebar: () => set((s) => ({ isSidebarOpen: !s.isSidebarOpen })),\n    togglePreview: () => set((s) => ({ isPreviewOpen: !s.isPreviewOpen })),\n\n    toggleTheme: () => {\n        const newTheme = get().theme === 'light' ? 'dark' : 'light';\n        localStorage.setItem('heytex_theme', newTheme);\n        document.documentElement.classList.toggle('dark', newTheme === 'dark');\n        set({ theme: newTheme });\n    },\n\n    setCompilationStatus: (status, error) => set({\n        compilationStatus: status,\n        compilationError: error || null\n    }),\n\n    setPdfData: (data) => set({ pdfData: data }),\n\n    updateFileContent: (fileId, content) => {\n        const { files, openFiles, currentFile } = get();\n\n        const updateContent = (f: ProjectFile) =>\n            f.id === fileId ? { ...f, content } : f;\n\n        set({\n            files: files.map(updateContent),\n            openFiles: openFiles.map(updateContent),\n            currentFile: currentFile?.id === fileId ? { ...currentFile, content } : currentFile,\n        });\n    },\n}));\n\n// Initialize theme\nif (typeof window !== 'undefined') {\n    const theme = localStorage.getItem('heytex_theme') || 'light';\n    document.documentElement.classList.toggle('dark', theme === 'dark');\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/stores/index.ts", "file_name": "index.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "187", "text": "/**\n * LaTeX Log Parser\n * Parses LaTeX compilation logs and extracts errors, warnings, and useful information\n */\n\nexport interface ParsedError {\n    type: 'error' | 'warning' | 'info';\n    message: string;\n    line?: number;\n    file?: string;\n    lineContent?: string;\n    fullMessage?: string;\n}\n\nexport function parseLatexLog(log: string): ParsedError[] {\n    const result: ParsedError[] = [];\n    const lines = log.split('\\n');\n    let currentFile = 'main.tex';\n\n    for (let i = 0; i < lines.length; i++) {\n        const line = lines[i];\n\n        // Track current file context\n        const fileMatch = line.match(/^\\(([^)]+\\.(?:tex|sty|cls|def))/);\n        if (fileMatch) {\n            currentFile = fileMatch[1];\n        }\n\n        // Parse errors: ! <error message>\n        if (line.startsWith('!')) {\n            const errorMessage = line.substring(1).trim();\n            let lineNumber: number | undefined;\n            let lineContent: string | undefined;\n            let fullMessage = errorMessage;\n\n            // Check next few lines for line number and context\n            for (let j = i + 1; j < Math.min(i + 5, lines.length); j++) {\n                const nextLine = lines[j];\n                \n                // Line number: l.123 ...\n                const lineMatch = nextLine.match(/^l\\.(\\d+)\\s+(.*)/);\n                if (lineMatch) {\n                    lineNumber = parseInt(lineMatch[1]);\n                    lineContent = lineMatch[2];\n                }\n\n                // Additional error details\n                if (nextLine && !nextLine.startsWith('!') && !nextLine.startsWith('l.')) {\n                    fullMessage += '\\n' + nextLine.trim();\n                }\n\n                if (lineMatch || j - i > 3) break;\n            }\n\n            result.push({\n                type: 'error',\n                message: errorMessage,\n                line: lineNumber,\n                file: currentFile,\n                lineContent,\n                fullMessage,\n            });\n        }", "metadata": {"file_path": "/Users/mac/heytex/client/src/utils/latexLogParser.ts", "file_name": "latexLogParser.ts", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "188", "text": "result.push({\n                type: 'error',\n                message: errorMessage,\n                line: lineNumber,\n                file: currentFile,\n                lineContent,\n                fullMessage,\n            });\n        }\n\n        // Parse warnings\n        if (line.includes('Warning:') || line.includes('warning:')) {\n            const warningMatch = line.match(/(?:LaTeX|Package|Class)\\s+(\\w+)?\\s*Warning:\\s*(.+)/);\n            if (warningMatch) {\n                const message = warningMatch[2];\n                const lineMatch = line.match(/on input line (\\d+)/);\n                \n                result.push({\n                    type: 'warning',\n                    message,\n                    line: lineMatch ? parseInt(lineMatch[1]) : undefined,\n                    file: currentFile,\n                });\n            }\n        }\n\n        // Parse missing packages/files\n        if (line.includes('File') && line.includes('not found')) {\n            const fileMatch = line.match(/File\\s+['`\"]([^'\"]+)[''\"]\\s+not found/);\n            if (fileMatch) {\n                result.push({\n                    type: 'error',\n                    message: `File not found: ${fileMatch[1]}`,\n                    file: currentFile,\n                    fullMessage: 'This file is required but could not be loaded. Make sure it exists in your project or is available in the TeXLive distribution.',\n                });\n            }\n        }\n\n        // Parse missing packages\n        if (line.includes('Package') && line.includes('not found')) {\n            const pkgMatch = line.match(/Package\\s+['`\"]?(\\w+)['`\"]?\\s+(?:not found|Error)/i);\n            if (pkgMatch) {\n                result.push({\n                    type: 'error',\n                    message: `Package not found: ${pkgMatch[1]}`,\n                    fullMessage: `The package '${pkgMatch[1]}' is not available. Install it via your TeXLive distribution or remove it from your document.`,\n                });\n            }\n        }", "metadata": {"file_path": "/Users/mac/heytex/client/src/utils/latexLogParser.ts", "file_name": "latexLogParser.ts", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "189", "text": "// Undefined control sequence\n        if (line.includes('Undefined control sequence')) {\n            const cmdMatch = lines[i + 1]?.match(/\\\\([a-zA-Z]+)/);\n            result.push({\n                type: 'error',\n                message: `Undefined control sequence${cmdMatch ? `: \\\\${cmdMatch[1]}` : ''}`,\n                line: undefined,\n                file: currentFile,\n                fullMessage: 'A command was used that LaTeX doesn\\'t recognize. Check for typos or missing packages.',\n            });\n        }\n    }\n\n    return result;\n}\n\nexport function formatErrorsForDisplay(errors: ParsedError[]): string {\n    if (errors.length === 0) {\n        return '‚úÖ No errors found';\n    }\n\n    const errorCount = errors.filter(e => e.type === 'error').length;\n    const warningCount = errors.filter(e => e.type === 'warning').length;\n\n    let output = `üìä Compilation Summary:\\n`;\n    output += `   ‚ùå ${errorCount} error(s)\\n`;\n    output += `   ‚ö†Ô∏è  ${warningCount} warning(s)\\n\\n`;\n\n    errors.forEach((err, index) => {\n        const icon = err.type === 'error' ? '‚ùå' : err.type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';\n        output += `${icon} ${err.type.toUpperCase()}`;\n        \n        if (err.line) {\n            output += ` at line ${err.line}`;\n        }\n        if (err.file && err.file !== 'main.tex') {\n            output += ` in ${err.file}`;\n        }\n        output += `\\n   ${err.message}\\n`;\n        \n        if (err.lineContent) {\n            output += `   Code: ${err.lineContent}\\n`;\n        }\n        \n        if (index < errors.length - 1) {\n            output += `\\n`;\n        }\n    });\n\n    return output;\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/utils/latexLogParser.ts", "file_name": "latexLogParser.ts", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "190", "text": "import { PDFDocument, rgb } from 'pdf-lib';\n\nself.onmessage = async (e: MessageEvent) => {\n    const { type, content } = e.data;\n\n    if (type === 'compile') {\n        try {\n            // TODO: Replace this with actual TeXlyre Wasm compilation\n            // Currently mocking PDF generation to demonstrate Client-side architecture\n\n            const pdfDoc = await PDFDocument.create();\n            const page = pdfDoc.addPage();\n            const { height } = page.getSize();\n\n            page.drawText('HeyTeX Client-side Compilation (Mock)', {\n                x: 50,\n                y: height - 50,\n                size: 20,\n                color: rgb(0.2, 0.4, 0.8),\n            });\n\n            page.drawText('This PDF was generated entirely in your browser!', {\n                x: 50,\n                y: height - 80,\n                size: 12,\n                color: rgb(0.5, 0.5, 0.5),\n            });\n\n            page.drawText('Please upload TeXlyre Wasm assets to enable full LaTeX compilation.', {\n                x: 50,\n                y: height - 100,\n                size: 10,\n                color: rgb(0.8, 0.2, 0.2),\n            });\n\n            page.drawText('Source Code Preview:', {\n                x: 50,\n                y: height - 140,\n                size: 14,\n            });\n\n            // Simple text wrapping for demo\n            const lines = content.split('\\n');\n            let y = height - 160;\n            for (const line of lines) {\n                if (y < 50) {\n                    page.drawText('... (truncated)', { x: 50, y });\n                    break;\n                }\n                // Basic sanitization/truncation\n                const safeLine = line.substring(0, 90).replace(/[^\\x20-\\x7E]/g, '');\n                page.drawText(safeLine, {\n                    x: 50,\n                    y,\n                    size: 10,\n                    font: await pdfDoc.embedFont('Helvetica-Courier' as any).catch(() => undefined) // Fallback\n                });\n                y -= 12;\n            }", "metadata": {"file_path": "/Users/mac/heytex/client/src/workers/latex.worker.ts", "file_name": "latex.worker.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "191", "text": "const pdfBytes = await pdfDoc.save();\n            const blob = new Blob([pdfBytes as any], { type: 'application/pdf' });\n\n            self.postMessage({ type: 'success', blob });\n\n        } catch (error: any) {\n            console.error('Worker error:', error);\n            self.postMessage({ type: 'error', message: error.message });\n        }\n    }\n};", "metadata": {"file_path": "/Users/mac/heytex/client/src/workers/latex.worker.ts", "file_name": "latex.worker.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-07"}}
{"id": "192", "text": "/// <reference lib=\"webworker\" />\nexport { };\nimport { createTypstCompiler } from '@myriaddreamin/typst.ts/compiler';\nimport { createTypstRenderer } from '@myriaddreamin/typst.ts/renderer';\nimport { TypstSnippet } from '@myriaddreamin/typst.ts/dist/esm/contrib/snippet.mjs';\n\ndeclare const self: DedicatedWorkerGlobalScope;\n\ntype OutputFormat = 'pdf' | 'svg' | 'canvas';\n\ntype CompileMessage = {\n    id: string;\n    type: 'compile';\n    payload: {\n        mainFilePath: string;\n        sources: Record<string, string | Uint8Array>;\n        format: OutputFormat;\n        pdfOptions?: {\n            pdfStandard?: string;\n            pdfTags?: boolean;\n            creationTimestamp?: number;\n        };\n    };\n};\n\ntype PingMessage = {\n    id: string;\n    type: 'ping';\n};\n\ntype InboundMessage = CompileMessage | PingMessage;\n\ntype DoneResponse = {\n    id: string;\n    type: 'done';\n    result: {\n        format: OutputFormat;\n        output: Uint8Array | string;\n        diagnostics?: any[];\n    };\n};\n\ntype PongResponse = {\n    id: string;\n    type: 'pong';\n};\n\ntype ErrorResponse = {\n    id: string;\n    type: 'error';\n    error: string;\n};\n\nlet compiler: any = null;\nlet renderer: any = null;\nlet initialized = false;", "metadata": {"file_path": "/Users/mac/heytex/client/src/workers/typst.worker.ts", "file_name": "typst.worker.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-08"}}
{"id": "193", "text": "type ErrorResponse = {\n    id: string;\n    type: 'error';\n    error: string;\n};\n\nlet compiler: any = null;\nlet renderer: any = null;\nlet initialized = false;\n\nconst defaultFonts = [\n    'DejaVuSansMono-Bold.ttf',\n    'DejaVuSansMono-BoldOblique.ttf',\n    'DejaVuSansMono-Oblique.ttf',\n    'DejaVuSansMono.ttf',\n    'LibertinusSerif-Bold.otf',\n    'LibertinusSerif-BoldItalic.otf',\n    'LibertinusSerif-Italic.otf',\n    'LibertinusSerif-Regular.otf',\n    'LibertinusSerif-Semibold.otf',\n    'LibertinusSerif-SemiboldItalic.otf',\n    'NewCM10-Bold.otf',\n    'NewCM10-BoldItalic.otf',\n    'NewCM10-Italic.otf',\n    'NewCM10-Regular.otf',\n    'NewCMMath-Bold.otf',\n    'NewCMMath-Book.otf',\n    'NewCMMath-Regular.otf',\n];\n\nasync function loadFonts(baseUrl: string = `/assets/fonts`) {\n    const fontPaths: string[] = [];\n\n    try {\n        const indexResponse = await fetch(`${baseUrl}/fonts.json`);\n        if (indexResponse.ok) {\n            const fontList = await indexResponse.json();\n            fontPaths.push(...fontList.map((font: string) => `${baseUrl}/${font}`));\n        }\n    } catch {\n        console.warn('fonts.json not found, using default font list');\n        fontPaths.push(...defaultFonts.map(font => `${baseUrl}/${font}`));\n    }\n\n    const fontPromises = fontPaths.map(async (path) => {\n        try {\n            const response = await fetch(path);\n            if (!response.ok) {\n                console.warn(`Failed to fetch font: ${path}`);\n                return null;\n            }\n            const buffer = await response.arrayBuffer();\n            return new Uint8Array(buffer);\n        } catch (err) {\n            console.warn(`Error loading font ${path}:`, err);\n            return null;\n        }\n    });\n    const fonts = await Promise.all(fontPromises);\n    return fonts.filter((f) => f !== null) as Uint8Array[];\n}", "metadata": {"file_path": "/Users/mac/heytex/client/src/workers/typst.worker.ts", "file_name": "typst.worker.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-08"}}
{"id": "194", "text": "async function ensureInit() {\n    if (initialized) return;\n\n    const fonts = await loadFonts();\n    const packageRegistry = TypstSnippet.fetchPackageRegistry();\n\n    compiler = createTypstCompiler();\n\n    // TODO (fabawi): this is hard-coded for now. **NOT NEEDED ANYMORE**\n    // Need to add mechanism for re-initializing when pdf options change\n    // compiler.setPdfOpts({\n    //     pdf_standard: '\"2.0\"',\n    //     pdf_tags: false,\n    //     creation_timestamp: Math.floor(Date.now() / 1000)\n    // });\n\n    await compiler.init({\n        getModule: () => `/core/typst-ts-web-compiler/pkg/typst_ts_web_compiler_bg.wasm`,\n        beforeBuild: [\n            ...packageRegistry.provides,\n            async (_: any, { builder }: any) => {\n                for (const font of fonts) {\n                    await builder.add_raw_font(font);\n                }\n            }\n        ],\n    });\n\n    renderer = createTypstRenderer();\n    await renderer.init({\n        getModule: () => `/core/typst-ts-renderer/pkg/typst_ts_renderer_bg.wasm`,\n        beforeBuild: [\n            async (_: any, { builder }: any) => {\n                for (const font of fonts) {\n                    await builder.add_raw_font(font);\n                }\n            }\n        ],\n    });\n\n    initialized = true;\n}\n\nfunction getFormatArg(format: string): number {\n    switch (format) {\n        case 'vector':\n            return 0;\n        case 'pdf':\n            return 1;\n        default:\n            throw new Error(`Unsupported format: ${format}`);\n    }\n}\n\nself.addEventListener('message', async (e: MessageEvent<InboundMessage>) => {\n    const data = e.data;\n    const { id, type } = data;\n    try {\n        if (type === 'ping') {\n            const resp: PongResponse = { id, type: 'pong' };\n            self.postMessage(resp);\n            return;\n        }\n        await ensureInit();\n\n        const { payload } = data as CompileMessage;\n        const { mainFilePath, sources, format, pdfOptions } = payload;", "metadata": {"file_path": "/Users/mac/heytex/client/src/workers/typst.worker.ts", "file_name": "typst.worker.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-08"}}
{"id": "195", "text": "const { payload } = data as CompileMessage;\n        const { mainFilePath, sources, format, pdfOptions } = payload;\n\n        compiler.resetShadow();\n        for (const [path, content] of Object.entries(sources)) {\n            const absolutePath = path.startsWith('/') ? path : `/${path}`;\n            if (typeof content === 'string') {\n                compiler.addSource(absolutePath, content);\n            } else {\n                compiler.mapShadow(absolutePath, content);\n            }\n        }\n        const absoluteMainPath =\n            mainFilePath.startsWith('/') ? mainFilePath : `/${mainFilePath}`;\n        let output: Uint8Array | string;\n        let diagnostics: any[] = [];\n\n        if (format === 'pdf') {\n            const pdfStandard = pdfOptions?.pdfStandard || '\"1.7\"';\n            const pdfTags = pdfOptions?.pdfTags !== undefined ? pdfOptions.pdfTags : true;\n            const creationTimestamp = pdfOptions?.creationTimestamp || Math.floor(Date.now() / 1000);\n\n            compiler.setPdfOptsForNextCompile({\n                pdf_standard: pdfStandard,\n                pdf_tags: pdfTags,\n                creation_timestamp: creationTimestamp\n            });\n\n            const compileResult = await compiler.compile({\n                mainFilePath: absoluteMainPath,\n                format: getFormatArg('pdf'),\n            });\n            console.log('[Typst Worker] Compile result:', compileResult);\n            console.log('[Typst Worker] Diagnostics:', compileResult.diagnostics);\n            output = compileResult.result as Uint8Array;\n            diagnostics = compileResult.diagnostics || [];\n            \n            if (!output || output.byteLength === 0) {\n                console.error('[Typst Worker] No output from compiler!');\n                throw new Error('Compiler returned empty output');\n            }\n        } else {\n            const compileResult = await compiler.compile({\n                mainFilePath: absoluteMainPath,\n                format: 'vector',\n            });\n            diagnostics = compileResult.diagnostics || [];\n\n            if (!compileResult.result || compileResult.result.byteLength === 0) {\n                const transferList: Transferable[] = [];\n                const resp: DoneResponse = {\n                    id,\n                    type: 'done',\n                    result: { format, output: new Uint8Array(0), diagnostics },\n                };\n                self.postMessage(resp, transferList);\n                return;\n            }", "metadata": {"file_path": "/Users/mac/heytex/client/src/workers/typst.worker.ts", "file_name": "typst.worker.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-08"}}
{"id": "196", "text": "output = await renderer.renderSvg({\n                artifactContent: compileResult.result,\n            });\n        }\n\n        const transferList: Transferable[] =\n            output instanceof Uint8Array ? [output.buffer as ArrayBuffer] : [];\n        const resp: DoneResponse = {\n            id,\n            type: 'done',\n            result: { format, output, diagnostics },\n        };\n        self.postMessage(resp, transferList);\n    } catch (err: unknown) {\n        const message =\n            typeof err === 'object' && err && 'message' in err\n                ? String((err as any).message)\n                : String(err);\n        const resp: ErrorResponse = { id, type: 'error', error: message };\n        self.postMessage(resp);\n    }\n});", "metadata": {"file_path": "/Users/mac/heytex/client/src/workers/typst.worker.ts", "file_name": "typst.worker.ts", "creation_date": "2025-12-07", "last_modified_date": "2025-12-08"}}
{"id": "197", "text": "# HeyTeX Launch Daemon Auto-Start\n\nHeyTeX s·ª≠ d·ª•ng **Launch Daemon** ƒë·ªÉ t·ª± ƒë·ªông kh·ªüi ƒë·ªông khi Mac Mini boot (kh√¥ng c·∫ßn SSH login).\n\n## C√°c Service\n\nT·∫•t c·∫£ services ch·∫°y v·ªõi user `mac`, group `staff`:\n\n| Service | Port | LaunchDaemon |\n|---------|------|--------------|\n| PostgreSQL | 5432 | com.heytex.postgresql |\n| Backend | 5433 | com.heytex.backend |\n| MinIO | 5434 | com.heytex.minio |\n| TeXLive | 5435 | com.heytex.texlive |\n\n## File Locations\n\n- **Source plists**: `/Users/mac/heytex/launchd-daemons/*.plist`\n- **System plists**: `/Library/LaunchDaemons/com.heytex.*.plist` (owner: root:wheel)\n- **Logs**: `/tmp/heytex-*.log` v√† `/tmp/heytex-*-error.log`\n\n## Management Commands", "metadata": {"file_path": "/Users/mac/heytex/documents/LAUNCHDAEMON.md", "file_name": "LAUNCHDAEMON.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
{"id": "198", "text": "## File Locations\n\n- **Source plists**: `/Users/mac/heytex/launchd-daemons/*.plist`\n- **System plists**: `/Library/LaunchDaemons/com.heytex.*.plist` (owner: root:wheel)\n- **Logs**: `/tmp/heytex-*.log` v√† `/tmp/heytex-*-error.log`\n\n## Management Commands\n\n```bash\n# Ki·ªÉm tra status\nsudo launchctl list | grep heytex\n\n# Unload service\nsudo launchctl unload /Library/LaunchDaemons/com.heytex.backend.plist\n\n# Load service\nsudo launchctl load /Library/LaunchDaemons/com.heytex.backend.plist\n\n# Restart service\nsudo launchctl unload /Library/LaunchDaemons/com.heytex.backend.plist\nsudo launchctl load /Library/LaunchDaemons/com.heytex.backend.plist\n\n# Xem logs\ntail -f /tmp/heytex-backend.log\ntail -f /tmp/heytex-backend-error.log\n```\n\n## Update Service\n\nN·∫øu c·∫ßn update plist:", "metadata": {"file_path": "/Users/mac/heytex/documents/LAUNCHDAEMON.md", "file_name": "LAUNCHDAEMON.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
{"id": "199", "text": "# Unload service\nsudo launchctl unload /Library/LaunchDaemons/com.heytex.backend.plist\n\n# Load service\nsudo launchctl load /Library/LaunchDaemons/com.heytex.backend.plist\n\n# Restart service\nsudo launchctl unload /Library/LaunchDaemons/com.heytex.backend.plist\nsudo launchctl load /Library/LaunchDaemons/com.heytex.backend.plist\n\n# Xem logs\ntail -f /tmp/heytex-backend.log\ntail -f /tmp/heytex-backend-error.log\n```\n\n## Update Service\n\nN·∫øu c·∫ßn update plist:\n\n```bash\n# 1. Edit source file\nnano /Users/mac/heytex/launchd-daemons/com.heytex.backend.plist\n\n# 2. Unload old daemon\nsudo launchctl unload /Library/LaunchDaemons/com.heytex.backend.plist", "metadata": {"file_path": "/Users/mac/heytex/documents/LAUNCHDAEMON.md", "file_name": "LAUNCHDAEMON.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
{"id": "200", "text": "# Xem logs\ntail -f /tmp/heytex-backend.log\ntail -f /tmp/heytex-backend-error.log\n```\n\n## Update Service\n\nN·∫øu c·∫ßn update plist:\n\n```bash\n# 1. Edit source file\nnano /Users/mac/heytex/launchd-daemons/com.heytex.backend.plist\n\n# 2. Unload old daemon\nsudo launchctl unload /Library/LaunchDaemons/com.heytex.backend.plist\n\n# 3. Copy v√† set ownership\nsudo cp /Users/mac/heytex/launchd-daemons/com.heytex.backend.plist /Library/LaunchDaemons/\nsudo chown root:wheel /Library/LaunchDaemons/com.heytex.backend.plist\n\n# 4. Load l·∫°i\nsudo launchctl load /Library/LaunchDaemons/com.heytex.backend.plist\n```\n\n## Troubleshooting\n\n### Service kh√¥ng start\n\n```bash\n# Xem error log\ncat /tmp/heytex-backend-error.log\n\n# Check port conflicts\nlsof -i :5433\n```", "metadata": {"file_path": "/Users/mac/heytex/documents/LAUNCHDAEMON.md", "file_name": "LAUNCHDAEMON.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
{"id": "201", "text": "# 3. Copy v√† set ownership\nsudo cp /Users/mac/heytex/launchd-daemons/com.heytex.backend.plist /Library/LaunchDaemons/\nsudo chown root:wheel /Library/LaunchDaemons/com.heytex.backend.plist\n\n# 4. Load l·∫°i\nsudo launchctl load /Library/LaunchDaemons/com.heytex.backend.plist\n```\n\n## Troubleshooting\n\n### Service kh√¥ng start\n\n```bash\n# Xem error log\ncat /tmp/heytex-backend-error.log\n\n# Check port conflicts\nlsof -i :5433\n```\n\n### Port already in use\n\nKill process c≈© tr∆∞·ªõc khi load daemon:\n\n```bash\nlsof -i :5433 | grep LISTEN  # T√¨m PID\nkill <PID>\nsudo launchctl load /Library/LaunchDaemons/com.heytex.backend.plist\n```\n\n## L∆∞u √Ω", "metadata": {"file_path": "/Users/mac/heytex/documents/LAUNCHDAEMON.md", "file_name": "LAUNCHDAEMON.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
{"id": "202", "text": "## Troubleshooting\n\n### Service kh√¥ng start\n\n```bash\n# Xem error log\ncat /tmp/heytex-backend-error.log\n\n# Check port conflicts\nlsof -i :5433\n```\n\n### Port already in use\n\nKill process c≈© tr∆∞·ªõc khi load daemon:\n\n```bash\nlsof -i :5433 | grep LISTEN  # T√¨m PID\nkill <PID>\nsudo launchctl load /Library/LaunchDaemons/com.heytex.backend.plist\n```\n\n## L∆∞u √Ω\n\n- **LaunchDaemon vs LaunchAgent**: Daemon ch·∫°y khi boot (kh√¥ng c·∫ßn login), Agent ch·∫°y khi user login\n- **SSH Login**: LaunchAgent kh√¥ng ch·∫°y qua SSH, ph·∫£i d√πng LaunchDaemon\n- **Ownership**: Daemon plist ph·∫£i c√≥ owner `root:wheel`\n- **Location**: System daemon ·ªü `/Library/LaunchDaemons/`, user agent ·ªü `~/Library/LaunchAgents/`", "metadata": {"file_path": "/Users/mac/heytex/documents/LAUNCHDAEMON.md", "file_name": "LAUNCHDAEMON.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
{"id": "203", "text": "# HeyTeX - Package Management Guide\n\n## üì¶ Cached Packages\n\nHeyTeX ƒë√£ pre-cache c√°c packages ph·ªï bi·∫øn ƒë·ªÉ tƒÉng t·ªëc bi√™n d·ªãch:\n\n### ‚úÖ Vietnamese Support (H·ªó tr·ª£ ti·∫øng Vi·ªát)\n- `vntex` - Vietnamese TeX support\n- `vietnam` - Vietnamese language\n- `babel-vietnamese` - Babel Vietnamese\n- T5 encoding fonts (vnr, t5-lmr)\n\n### ‚úÖ Document Layout\n- `geometry` - Page layout\n- `fancyhdr` - Headers and footers\n- `titlesec`, `titletoc` - Section titles\n- `tocloft` - Table of contents\n- `parskip`, `setspace` - Spacing\n- `indentfirst` - Paragraph indentation", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "204", "text": "### ‚úÖ Document Layout\n- `geometry` - Page layout\n- `fancyhdr` - Headers and footers\n- `titlesec`, `titletoc` - Section titles\n- `tocloft` - Table of contents\n- `parskip`, `setspace` - Spacing\n- `indentfirst` - Paragraph indentation\n\n### ‚úÖ Fonts & Typography\n- `fontspec` - Font selection (XeTeX)\n- `fontaxes`, `type1cm` - Font utilities\n- `libertine`, `libertinust1math` - Libertine fonts\n- `newtxtext`, `newtxmath` - New TX fonts\n- Latin Modern fonts (lmroman, lmsans, lmmono)\n- Computer Modern fonts (complete set)\n\n### ‚úÖ Math & Science\n- `amsmath`, `amssymb`, `amsthm` - AMS math\n- `mathtools` - Math tools\n- `physics` - Physics notation\n- `siunitx` - SI units", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "205", "text": "### ‚úÖ Math & Science\n- `amsmath`, `amssymb`, `amsthm` - AMS math\n- `mathtools` - Math tools\n- `physics` - Physics notation\n- `siunitx` - SI units\n\n### ‚úÖ Graphics & Plotting\n- `graphicx`, `xcolor`, `color` - Graphics\n- **TikZ/PGF** (complete):\n  - `tikz`, `pgf`, `pgfplots`, `pgfplotstable`\n  - All TikZ libraries (arrows, shapes, calc, positioning, etc.)\n  - PGF core modules\n\n### ‚úÖ Tables & Lists\n- `array`, `booktabs`, `multirow`, `longtable`\n- `enumitem` - Enhanced lists\n\n### ‚úÖ References & Citations\n- `hyperref`, `cleveref` - Cross-references\n- `natbib`, `biblatex` - Citations", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "206", "text": "### ‚úÖ Tables & Lists\n- `array`, `booktabs`, `multirow`, `longtable`\n- `enumitem` - Enhanced lists\n\n### ‚úÖ References & Citations\n- `hyperref`, `cleveref` - Cross-references\n- `natbib`, `biblatex` - Citations\n\n### ‚úÖ Utilities\n- `lipsum`, `blindtext` - Dummy text\n- `framed`, `mdframed` - Frames\n- `xpatch`, `xstring`, `etoolbox` - Programming\n- `ifthen`, `calc` - Conditions & calculations\n- `footmisc` - Footnotes\n\n## üîÑ Re-caching Packages\n\nƒê·ªÉ c·∫≠p nh·∫≠t cache sau khi c√†i packages m·ªõi:\n\n```bash\ncd /Users/mac/heytex\n./cache-packages.sh\n```\n\n## üì• Installing New Packages\n\n### N·∫øu package KH√îNG c√≥ trong cache:", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "207", "text": "## üîÑ Re-caching Packages\n\nƒê·ªÉ c·∫≠p nh·∫≠t cache sau khi c√†i packages m·ªõi:\n\n```bash\ncd /Users/mac/heytex\n./cache-packages.sh\n```\n\n## üì• Installing New Packages\n\n### N·∫øu package KH√îNG c√≥ trong cache:\n\n#### Option 1: Using tlmgr (Recommended)\n```bash\n# Search for package\ntlmgr search --global <package-name>\n\n# Install package\nsudo tlmgr install <package-name>\n\n# Update cache\n./cache-packages.sh\n```\n\n#### Option 2: Manual .sty file\n1. Download `.sty` file t·ª´ CTAN\n2. Copy v√†o project ho·∫∑c cache directory:\n```bash\ncp mypackage.sty /Users/mac/heytex/client/public/core/swiftlatex/xetex/26/\n```\n\n#### Option 3: Install full collection\n```bash\n# Vietnamese collection\nsudo tlmgr install collection-langvietnamese\n\n# Recommended fonts\nsudo tlmgr install collection-fontsrecommended", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "208", "text": "# Install package\nsudo tlmgr install <package-name>\n\n# Update cache\n./cache-packages.sh\n```\n\n#### Option 2: Manual .sty file\n1. Download `.sty` file t·ª´ CTAN\n2. Copy v√†o project ho·∫∑c cache directory:\n```bash\ncp mypackage.sty /Users/mac/heytex/client/public/core/swiftlatex/xetex/26/\n```\n\n#### Option 3: Install full collection\n```bash\n# Vietnamese collection\nsudo tlmgr install collection-langvietnamese\n\n# Recommended fonts\nsudo tlmgr install collection-fontsrecommended\n\n# Recommended LaTeX packages\nsudo tlmgr install collection-latexrecommended\n```\n\n## üß™ Testing\n\nTest file ti·∫øng Vi·ªát v·ªõi TikZ:\n```bash\ncat /Users/mac/heytex/test-vietnamese.tex\n```\n\nUpload file n√†y v√†o HeyTeX editor v√† compile ƒë·ªÉ test:\n- Vietnamese characters\n- Math equations\n- TikZ plots\n- All cached packages\n\n## üìä Cache Statistics", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "209", "text": "# Recommended fonts\nsudo tlmgr install collection-fontsrecommended\n\n# Recommended LaTeX packages\nsudo tlmgr install collection-latexrecommended\n```\n\n## üß™ Testing\n\nTest file ti·∫øng Vi·ªát v·ªõi TikZ:\n```bash\ncat /Users/mac/heytex/test-vietnamese.tex\n```\n\nUpload file n√†y v√†o HeyTeX editor v√† compile ƒë·ªÉ test:\n- Vietnamese characters\n- Math equations\n- TikZ plots\n- All cached packages\n\n## üìä Cache Statistics\n\nCurrent cache (sau khi ch·∫°y `cache-packages.sh`):\n\n```\nFormat 3  (TFM fonts):      31 files\nFormat 10 (Format files):    1 file\nFormat 11 (Maps/configs):    3 files\nFormat 26 (Packages):      496 files ‚≠ê\nFormat 45 (OpenType fonts):  7 files\n```\n\n**Total: 538 files cached** - Compile time gi·∫£m t·ª´ 7-10s xu·ªëng ~0.5s!\n\n## üîç Checking Package Availability", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "210", "text": "## üìä Cache Statistics\n\nCurrent cache (sau khi ch·∫°y `cache-packages.sh`):\n\n```\nFormat 3  (TFM fonts):      31 files\nFormat 10 (Format files):    1 file\nFormat 11 (Maps/configs):    3 files\nFormat 26 (Packages):      496 files ‚≠ê\nFormat 45 (OpenType fonts):  7 files\n```\n\n**Total: 538 files cached** - Compile time gi·∫£m t·ª´ 7-10s xu·ªëng ~0.5s!\n\n## üîç Checking Package Availability\n\n```bash\n# Check if package exists in TeXLive\nkpsewhich <package>.sty\n\n# Example\nkpsewhich tikz.sty\nkpsewhich vntex.sty\nkpsewhich geometry.sty\n```\n\n## üìù Vietnamese Document Template", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "211", "text": "**Total: 538 files cached** - Compile time gi·∫£m t·ª´ 7-10s xu·ªëng ~0.5s!\n\n## üîç Checking Package Availability\n\n```bash\n# Check if package exists in TeXLive\nkpsewhich <package>.sty\n\n# Example\nkpsewhich tikz.sty\nkpsewhich vntex.sty\nkpsewhich geometry.sty\n```\n\n## üìù Vietnamese Document Template\n\n```latex\n\\documentclass[12pt,a4paper]{article}\n\\usepackage[utf8]{inputenc}\n\\usepackage[T5]{fontenc}\n\\usepackage[vietnamese]{babel}\n\\usepackage{geometry,graphicx,amsmath,tikz}\n\n\\title{Ti√™u ƒë·ªÅ ti·∫øng Vi·ªát}\n\\author{T√°c gi·∫£}\n\\date{\\today}\n\n\\begin{document}\n\\maketitle\n\n\\section{Gi·ªõi thi·ªáu}\nN·ªôi dung ti·∫øng Vi·ªát v·ªõi ƒë·∫ßy ƒë·ªß d·∫•u thanh.", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "212", "text": "\\title{Ti√™u ƒë·ªÅ ti·∫øng Vi·ªát}\n\\author{T√°c gi·∫£}\n\\date{\\today}\n\n\\begin{document}\n\\maketitle\n\n\\section{Gi·ªõi thi·ªáu}\nN·ªôi dung ti·∫øng Vi·ªát v·ªõi ƒë·∫ßy ƒë·ªß d·∫•u thanh.\n\n\\end{document}\n```\n\n## üöÄ Performance Tips\n\n1. **First compile**: ~7s (t·∫£i packages)\n2. **Subsequent compiles**: ~0.5s (s·ª≠ d·ª•ng cache)\n3. **Monitor logs**: `tail -f /tmp/heytex-texlive.log`\n\n## üõ†Ô∏è Maintenance Scripts\n\n```bash\n# Start all services\n./start-all.sh\n\n# Stop all services  \n./stop-all.sh\n\n# Restart (apply new cache)\n./stop-all.sh && ./start-all.sh", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "213", "text": "\\end{document}\n```\n\n## üöÄ Performance Tips\n\n1. **First compile**: ~7s (t·∫£i packages)\n2. **Subsequent compiles**: ~0.5s (s·ª≠ d·ª•ng cache)\n3. **Monitor logs**: `tail -f /tmp/heytex-texlive.log`\n\n## üõ†Ô∏è Maintenance Scripts\n\n```bash\n# Start all services\n./start-all.sh\n\n# Stop all services  \n./stop-all.sh\n\n# Restart (apply new cache)\n./stop-all.sh && ./start-all.sh\n\n# View logs\ntail -f /tmp/heytex-backend.log\ntail -f /tmp/heytex-frontend.log\ntail -f /tmp/heytex-texlive.log\n```\n\n## üìö Useful Resources\n\n- CTAN: https://ctan.org/\n- TikZ Examples: https://texample.net/tikz/\n- Vietnamese LaTeX: http://vntex.sourceforge.net/\n- LaTeX Wikibook: https://en.wikibooks.org/wiki/LaTeX", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "214", "text": "# Restart (apply new cache)\n./stop-all.sh && ./start-all.sh\n\n# View logs\ntail -f /tmp/heytex-backend.log\ntail -f /tmp/heytex-frontend.log\ntail -f /tmp/heytex-texlive.log\n```\n\n## üìö Useful Resources\n\n- CTAN: https://ctan.org/\n- TikZ Examples: https://texample.net/tikz/\n- Vietnamese LaTeX: http://vntex.sourceforge.net/\n- LaTeX Wikibook: https://en.wikibooks.org/wiki/LaTeX\n\n## ‚ö†Ô∏è Troubleshooting\n\n### Package not found\n```bash\n# Check package existence\nkpsewhich <package>.sty\n\n# If not found, install via tlmgr\nsudo tlmgr install <package>\n\n# Re-cache\n./cache-packages.sh\n```\n\n### Compile errors\n1. Check TeXLive logs: `/tmp/heytex-texlive.log`\n2. Check browser console for download errors\n3. Verify nginx is proxying requests correctly", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "215", "text": "## ‚ö†Ô∏è Troubleshooting\n\n### Package not found\n```bash\n# Check package existence\nkpsewhich <package>.sty\n\n# If not found, install via tlmgr\nsudo tlmgr install <package>\n\n# Re-cache\n./cache-packages.sh\n```\n\n### Compile errors\n1. Check TeXLive logs: `/tmp/heytex-texlive.log`\n2. Check browser console for download errors\n3. Verify nginx is proxying requests correctly\n\n### Performance issues\n1. Pre-cache more packages: Edit `cache-packages.sh`\n2. Check disk space in cache directory\n3. Restart services to clear old cache\n\n---\n\n**Status**: ‚úÖ Ready for production use with Vietnamese support and 500+ cached packages!", "metadata": {"file_path": "/Users/mac/heytex/documents/PACKAGES.md", "file_name": "PACKAGES.md", "creation_date": "2025-12-08", "last_modified_date": "2025-12-08"}}
{"id": "216", "text": "# HeyTeX Port Configuration\n\n**Updated:** December 13, 2025\n\n## Port Mapping\n\nAll HeyTeX services now use ports close to PostgreSQL (5432) to avoid common port conflicts:\n\n| Service | Old Port | New Port | Description |\n|---------|----------|----------|-------------|\n| PostgreSQL | 5432 | **5432** | Database (unchanged) |\n| Backend API | 3001 | **5433** | Express + Socket.IO |\n| MinIO S3 | 9000 | **5434** | Object storage |\n| TeXLive Server | 8082 | **5435** | LaTeX compilation |\n| nginx | 8080 | **5436** | Web server |\n\n## Service Management\n\n### Quick Start\n```bash\n./start-services.sh\n```\n\n### Manual Start\n\n#### 1. PostgreSQL (5432)\n```bash\n/opt/homebrew/opt/postgresql@16/bin/pg_ctl -D /opt/homebrew/var/postgresql@16 start\n```", "metadata": {"file_path": "/Users/mac/heytex/documents/PORTS.md", "file_name": "PORTS.md", "creation_date": "2025-12-12", "last_modified_date": "2025-12-12"}}
{"id": "217", "text": "## Service Management\n\n### Quick Start\n```bash\n./start-services.sh\n```\n\n### Manual Start\n\n#### 1. PostgreSQL (5432)\n```bash\n/opt/homebrew/opt/postgresql@16/bin/pg_ctl -D /opt/homebrew/var/postgresql@16 start\n```\n\n#### 2. Backend (5433)\n```bash\ncd /Users/mac/heytex/server\nnohup node --require tsx/cjs src/index.ts > /tmp/heytex-backend.log 2>&1 &\n```\n\n#### 3. MinIO (5434)\n```bash\ncd /Users/mac/heytex\nexport MINIO_ROOT_USER=heytex_admin\nexport MINIO_ROOT_PASSWORD=heytex_minio_2024\nnohup minio server data/minio --address \":5434\" --console-address \":5437\" > /tmp/minio.log 2>&1 &\n```", "metadata": {"file_path": "/Users/mac/heytex/documents/PORTS.md", "file_name": "PORTS.md", "creation_date": "2025-12-12", "last_modified_date": "2025-12-12"}}
{"id": "218", "text": "#### 3. MinIO (5434)\n```bash\ncd /Users/mac/heytex\nexport MINIO_ROOT_USER=heytex_admin\nexport MINIO_ROOT_PASSWORD=heytex_minio_2024\nnohup minio server data/minio --address \":5434\" --console-address \":5437\" > /tmp/minio.log 2>&1 &\n```\n\n#### 4. TeXLive (5435)\n```bash\ncd /Users/mac/heytex\nnohup node texlive-server.js > /tmp/texlive-server.log 2>&1 &\n```\n\n#### 5. nginx (5436)\n```bash\nsudo nginx\n```\n\n### Stop Services\n```bash\n./stop-all.sh\n```\n\nOr manually:\n```bash\npkill -f \"node.*heytex.*src/index\"\npkill -f \"minio server\"\npkill -f \"node texlive-server\"\nsudo nginx -s stop\n```\n\n## Access URLs", "metadata": {"file_path": "/Users/mac/heytex/documents/PORTS.md", "file_name": "PORTS.md", "creation_date": "2025-12-12", "last_modified_date": "2025-12-12"}}
{"id": "219", "text": "#### 4. TeXLive (5435)\n```bash\ncd /Users/mac/heytex\nnohup node texlive-server.js > /tmp/texlive-server.log 2>&1 &\n```\n\n#### 5. nginx (5436)\n```bash\nsudo nginx\n```\n\n### Stop Services\n```bash\n./stop-all.sh\n```\n\nOr manually:\n```bash\npkill -f \"node.*heytex.*src/index\"\npkill -f \"minio server\"\npkill -f \"node texlive-server\"\nsudo nginx -s stop\n```\n\n## Access URLs\n\n### Local Development\n- Website: http://localhost:5436\n- Backend API: http://localhost:5433/api\n- MinIO Console: http://localhost:5437\n- TeXLive Health: http://localhost:5435/health\n\n### Production\n- Website: https://heytex.truyenthong.edu.vn\n- (All API calls proxied through nginx)\n\n## Configuration Files Updated", "metadata": {"file_path": "/Users/mac/heytex/documents/PORTS.md", "file_name": "PORTS.md", "creation_date": "2025-12-12", "last_modified_date": "2025-12-12"}}
{"id": "220", "text": "## Access URLs\n\n### Local Development\n- Website: http://localhost:5436\n- Backend API: http://localhost:5433/api\n- MinIO Console: http://localhost:5437\n- TeXLive Health: http://localhost:5435/health\n\n### Production\n- Website: https://heytex.truyenthong.edu.vn\n- (All API calls proxied through nginx)\n\n## Configuration Files Updated\n\n- `/Users/mac/heytex/.env.example` - Port examples\n- `/Users/mac/heytex/server/.env` - Backend environment\n- `/Users/mac/heytex/nginx-heytex.conf` - nginx proxy config\n- `/Users/mac/heytex/texlive-server.js` - TeXLive port\n- `/Users/mac/heytex/client/src/lib/api.ts` - API endpoint\n- `/Users/mac/heytex/client/src/pages/EditorPage.tsx` - Socket.IO + TeXLive URLs\n- `/Users/mac/heytex/cloudflare-tunnel-config.yml` - Tunnel ingress\n\n## PM2 Alternative (Optional)", "metadata": {"file_path": "/Users/mac/heytex/documents/PORTS.md", "file_name": "PORTS.md", "creation_date": "2025-12-12", "last_modified_date": "2025-12-12"}}
{"id": "221", "text": "## PM2 Alternative (Optional)\n\nEcosystem config available at `/Users/mac/heytex/ecosystem.config.js` but currently uses manual nohup for better stability.\n\nTo use PM2:\n```bash\nnpm install -g pm2\npm2 start ecosystem.config.js --only heytex-minio,heytex-texlive\npm2 save\npm2 startup\n```\n\n## Troubleshooting\n\n### Check Service Status\n```bash\nlsof -i :5432 -i :5433 -i :5434 -i :5435 -i :5436 | grep LISTEN\n```\n\n### View Logs\n```bash\n# Backend\ntail -f /tmp/heytex-backend.log\n\n# MinIO\ntail -f /tmp/minio.log\n\n# TeXLive\ntail -f /tmp/texlive-server.log\n\n# nginx\ntail -f /opt/homebrew/var/log/nginx/error.log\n```\n\n### After Reboot\nRun `./start-services.sh` to start all services.\n\n## Benefits of New Ports", "metadata": {"file_path": "/Users/mac/heytex/documents/PORTS.md", "file_name": "PORTS.md", "creation_date": "2025-12-12", "last_modified_date": "2025-12-12"}}
{"id": "222", "text": "### View Logs\n```bash\n# Backend\ntail -f /tmp/heytex-backend.log\n\n# MinIO\ntail -f /tmp/minio.log\n\n# TeXLive\ntail -f /tmp/texlive-server.log\n\n# nginx\ntail -f /opt/homebrew/var/log/nginx/error.log\n```\n\n### After Reboot\nRun `./start-services.sh` to start all services.\n\n## Benefits of New Ports\n\n1. **Avoid Conflicts**: Ports 3000-9000 commonly used by dev servers\n2. **Sequential**: Easy to remember (5433, 5434, 5435, 5436)\n3. **Near PostgreSQL**: Grouped with database port\n4. **Production Ready**: Less likely to conflict with other services", "metadata": {"file_path": "/Users/mac/heytex/documents/PORTS.md", "file_name": "PORTS.md", "creation_date": "2025-12-12", "last_modified_date": "2025-12-12"}}
{"id": "223", "text": "# Scripts & Configs Overview\n\n## Active Scripts\n\n### Setup\n- **setup-mac.sh** - Initial setup: Install PostgreSQL, MinIO, Node.js, nginx\n- **setup-nginx.sh** - Configure nginx with HeyTeX config\n\n### Service Management\n- **start-services.sh** - Manual start all services (fallback, not needed with LaunchDaemon)\n- **stop-services.sh** - Stop all HeyTeX LaunchDaemon services\n\n### Utilities\n- **cache-packages.sh** - Cache LaTeX packages for offline use\n\n## Active Configs\n\n- **nginx-heytex.conf** - Nginx reverse proxy config (port 5436)\n  - Location: Copied to `/opt/homebrew/etc/nginx/servers/heytex.conf`\n  - Serves: Static files + Backend proxy\n\n- **cloudflare-tunnel-config.yml** - Cloudflare tunnel routing\n  - Location: `~/.cloudflared/config.yml`\n  - Routes: heytex.truyenthong.edu.vn ‚Üí localhost:5436\n\n## LaunchDaemons (Auto-start)", "metadata": {"file_path": "/Users/mac/heytex/documents/SCRIPTS.md", "file_name": "SCRIPTS.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
{"id": "224", "text": "## Active Configs\n\n- **nginx-heytex.conf** - Nginx reverse proxy config (port 5436)\n  - Location: Copied to `/opt/homebrew/etc/nginx/servers/heytex.conf`\n  - Serves: Static files + Backend proxy\n\n- **cloudflare-tunnel-config.yml** - Cloudflare tunnel routing\n  - Location: `~/.cloudflared/config.yml`\n  - Routes: heytex.truyenthong.edu.vn ‚Üí localhost:5436\n\n## LaunchDaemons (Auto-start)\n\nServices automatically start on boot via LaunchDaemon:\n\n```\n/Library/LaunchDaemons/\n‚îú‚îÄ‚îÄ com.heytex.postgresql.plist   (Port 5432)\n‚îú‚îÄ‚îÄ com.heytex.backend.plist      (Port 5433)\n‚îú‚îÄ‚îÄ com.heytex.minio.plist        (Port 5434)\n‚îî‚îÄ‚îÄ com.heytex.texlive.plist      (Port 5435)\n```\n\nSource files: `launchd-daemons/*.plist`", "metadata": {"file_path": "/Users/mac/heytex/documents/SCRIPTS.md", "file_name": "SCRIPTS.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
{"id": "225", "text": "## LaunchDaemons (Auto-start)\n\nServices automatically start on boot via LaunchDaemon:\n\n```\n/Library/LaunchDaemons/\n‚îú‚îÄ‚îÄ com.heytex.postgresql.plist   (Port 5432)\n‚îú‚îÄ‚îÄ com.heytex.backend.plist      (Port 5433)\n‚îú‚îÄ‚îÄ com.heytex.minio.plist        (Port 5434)\n‚îî‚îÄ‚îÄ com.heytex.texlive.plist      (Port 5435)\n```\n\nSource files: `launchd-daemons/*.plist`\n\nSee [LAUNCHDAEMON.md](LAUNCHDAEMON.md) for management commands.\n\n## Removed Files", "metadata": {"file_path": "/Users/mac/heytex/documents/SCRIPTS.md", "file_name": "SCRIPTS.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
{"id": "226", "text": "Source files: `launchd-daemons/*.plist`\n\nSee [LAUNCHDAEMON.md](LAUNCHDAEMON.md) for management commands.\n\n## Removed Files\n\nCleaned up outdated/unused files:\n- ‚ùå `*.service` - systemd configs (Linux only, not macOS)\n- ‚ùå `start.sh, start-all.sh, start-mac.sh, start-production.sh` - Old port configs\n- ‚ùå `autostart.sh` - Replaced by LaunchDaemon\n- ‚ùå `run-backend.sh, run-frontend.sh` - Redundant\n- ‚ùå `stop-all.sh` - Merged into stop-services.sh\n- ‚ùå `nginx.conf, heytex-simple.conf` - Old configs", "metadata": {"file_path": "/Users/mac/heytex/documents/SCRIPTS.md", "file_name": "SCRIPTS.md", "creation_date": "2025-12-13", "last_modified_date": "2025-12-13"}}
