{"version":3,"file":"global-compiler-DJrFC2AB.js","sources":["../node_modules/@myriaddreamin/typst.ts/dist/esm/contrib/global-compiler.mjs"],"sourcesContent":["let globalCompiler = undefined;\nlet globalCompilerInitReady;\nlet isReady = false;\nexport function getGlobalCompiler() {\n    return isReady ? globalCompiler : undefined;\n}\nexport function createGlobalCompiler(creator, initOptions) {\n    // todo: determine compiler thread-safety\n    // todo: check inconsistent initOptions\n    const compiler = globalCompiler || creator();\n    if (globalCompilerInitReady !== undefined) {\n        return globalCompilerInitReady;\n    }\n    return (globalCompilerInitReady = (async () => {\n        isReady = true;\n        await compiler.init(initOptions);\n        return (globalCompiler = compiler);\n    })());\n}\nexport function withGlobalCompiler(creator, initOptions, resolve, reject) {\n    const compiler = getGlobalCompiler();\n    if (compiler) {\n        resolve(compiler);\n        return;\n    }\n    createGlobalCompiler(creator, initOptions).then(resolve).catch(reject);\n}\n//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2xvYmFsLWNvbXBpbGVyLm1qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb250cmliL2dsb2JhbC1jb21waWxlci5tdHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsSUFBSSxjQUFjLEdBQThCLFNBQVMsQ0FBQztBQUMxRCxJQUFJLHVCQUErQyxDQUFDO0FBQ3BELElBQUksT0FBTyxHQUFHLEtBQUssQ0FBQztBQUVwQixNQUFNLFVBQVUsaUJBQWlCO0lBQy9CLE9BQU8sT0FBTyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztBQUM5QyxDQUFDO0FBRUQsTUFBTSxVQUFVLG9CQUFvQixDQUNsQyxPQUE0QixFQUM1QixXQUFrQztJQUVsQyx5Q0FBeUM7SUFDekMsdUNBQXVDO0lBQ3ZDLE1BQU0sUUFBUSxHQUFHLGNBQWMsSUFBSSxPQUFPLEVBQUUsQ0FBQztJQUU3QyxJQUFJLHVCQUF1QixLQUFLLFNBQVMsRUFBRSxDQUFDO1FBQzFDLE9BQU8sdUJBQXVCLENBQUM7SUFDakMsQ0FBQztJQUVELE9BQU8sQ0FBQyx1QkFBdUIsR0FBRyxDQUFDLEtBQUssSUFBSSxFQUFFO1FBQzVDLE9BQU8sR0FBRyxJQUFJLENBQUM7UUFDZixNQUFNLFFBQVEsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7UUFDakMsT0FBTyxDQUFDLGNBQWMsR0FBRyxRQUFRLENBQUMsQ0FBQztJQUNyQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7QUFDUixDQUFDO0FBRUQsTUFBTSxVQUFVLGtCQUFrQixDQUNoQyxPQUE0QixFQUM1QixXQUE2QyxFQUM3QyxPQUEwQyxFQUMxQyxNQUEyQjtJQUUzQixNQUFNLFFBQVEsR0FBRyxpQkFBaUIsRUFBRSxDQUFDO0lBQ3JDLElBQUksUUFBUSxFQUFFLENBQUM7UUFDYixPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEIsT0FBTztJQUNULENBQUM7SUFFRCxvQkFBb0IsQ0FBQyxPQUFPLEVBQUUsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUN6RSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBJbml0T3B0aW9ucyB9IGZyb20gJy4uL29wdGlvbnMuaW5pdC5tanMnO1xuaW1wb3J0IHR5cGUgeyBUeXBzdENvbXBpbGVyIH0gZnJvbSAnLi4vY29tcGlsZXIubWpzJztcblxubGV0IGdsb2JhbENvbXBpbGVyOiBUeXBzdENvbXBpbGVyIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkO1xubGV0IGdsb2JhbENvbXBpbGVySW5pdFJlYWR5OiBQcm9taXNlPFR5cHN0Q29tcGlsZXI+O1xubGV0IGlzUmVhZHkgPSBmYWxzZTtcblxuZXhwb3J0IGZ1bmN0aW9uIGdldEdsb2JhbENvbXBpbGVyKCk6IFR5cHN0Q29tcGlsZXIgfCB1bmRlZmluZWQge1xuICByZXR1cm4gaXNSZWFkeSA/IGdsb2JhbENvbXBpbGVyIDogdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlR2xvYmFsQ29tcGlsZXIoXG4gIGNyZWF0b3I6ICgpID0+IFR5cHN0Q29tcGlsZXIsXG4gIGluaXRPcHRpb25zPzogUGFydGlhbDxJbml0T3B0aW9ucz4sXG4pOiBQcm9taXNlPFR5cHN0Q29tcGlsZXI+IHtcbiAgLy8gdG9kbzogZGV0ZXJtaW5lIGNvbXBpbGVyIHRocmVhZC1zYWZldHlcbiAgLy8gdG9kbzogY2hlY2sgaW5jb25zaXN0ZW50IGluaXRPcHRpb25zXG4gIGNvbnN0IGNvbXBpbGVyID0gZ2xvYmFsQ29tcGlsZXIgfHwgY3JlYXRvcigpO1xuXG4gIGlmIChnbG9iYWxDb21waWxlckluaXRSZWFkeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIGdsb2JhbENvbXBpbGVySW5pdFJlYWR5O1xuICB9XG5cbiAgcmV0dXJuIChnbG9iYWxDb21waWxlckluaXRSZWFkeSA9IChhc3luYyAoKSA9PiB7XG4gICAgaXNSZWFkeSA9IHRydWU7XG4gICAgYXdhaXQgY29tcGlsZXIuaW5pdChpbml0T3B0aW9ucyk7XG4gICAgcmV0dXJuIChnbG9iYWxDb21waWxlciA9IGNvbXBpbGVyKTtcbiAgfSkoKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3aXRoR2xvYmFsQ29tcGlsZXIoXG4gIGNyZWF0b3I6ICgpID0+IFR5cHN0Q29tcGlsZXIsXG4gIGluaXRPcHRpb25zOiBQYXJ0aWFsPEluaXRPcHRpb25zPiB8IHVuZGVmaW5lZCxcbiAgcmVzb2x2ZTogKGNvbXBpbGVyOiBUeXBzdENvbXBpbGVyKSA9PiB2b2lkLFxuICByZWplY3Q/OiAoZXJyOiBhbnkpID0+IHZvaWQsXG4pIHtcbiAgY29uc3QgY29tcGlsZXIgPSBnZXRHbG9iYWxDb21waWxlcigpO1xuICBpZiAoY29tcGlsZXIpIHtcbiAgICByZXNvbHZlKGNvbXBpbGVyKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBjcmVhdGVHbG9iYWxDb21waWxlcihjcmVhdG9yLCBpbml0T3B0aW9ucykudGhlbihyZXNvbHZlKS5jYXRjaChyZWplY3QpO1xufVxuIl19"],"names":["globalCompiler","globalCompilerInitReady","createGlobalCompiler","creator","initOptions","compiler"],"mappings":"AAAA,IAAIA,EACAC,EAKG,SAASC,EAAqBC,EAASC,EAAa,CAGvD,MAAMC,EAAWL,GAAkBG,EAAO,EAC1C,OAAIF,IAA4B,OACrBA,EAEHA,GAA2B,UAE/B,MAAMI,EAAS,KAAKD,CAAW,EACvBJ,EAAiBK,IAC5B,CACL","x_google_ignoreList":[0]}