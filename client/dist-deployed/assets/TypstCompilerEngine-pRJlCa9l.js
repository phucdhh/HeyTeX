var p=Object.defineProperty;var h=(n,e,r)=>e in n?p(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var o=(n,e,r)=>h(n,typeof e!="symbol"?e+"":e,r);const w="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let g=(n=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=w[r[n]&63];return e};class u{constructor(){o(this,"worker",null);o(this,"pendingResolves",new Map);o(this,"pendingRejects",new Map)}getWorker(){return this.worker?this.worker:(this.worker=new Worker(new URL("/assets/typst.worker-DaZY_zu0.js",import.meta.url),{type:"module"}),this.worker.onmessage=e=>{const{id:r,type:s}=e.data;if(r){if(s==="done"||s==="pong"){const t=this.pendingResolves.get(r);t&&t("result"in e.data?e.data.result:void 0)}else if(s==="error"){const t=this.pendingRejects.get(r);t&&t(new Error(e.data.error||"Worker error"))}this.pendingResolves.delete(r),this.pendingRejects.delete(r)}},this.worker.onerror=e=>{const r=new Error(`Typst worker error: ${String(e.message||e)}`);this.pendingRejects.forEach(s=>s(r)),this.pendingResolves.clear(),this.pendingRejects.clear(),this.worker=null},this.worker)}async ping(){return this.callWorker("ping",void 0)}async compile(e,r,s,t,l){return this.callWorker("compile",{mainFilePath:e,sources:r,format:s,pdfOptions:t},l)}terminate(){this.worker&&(this.worker.terminate(),this.worker=null),this.pendingResolves.clear(),this.pendingRejects.clear()}callWorker(e,r,s){const t=g(),l=this.getWorker(),c=new Promise((i,d)=>{this.pendingResolves.set(t,i),this.pendingRejects.set(t,d)}),a=()=>{this.worker&&(this.worker.terminate(),this.worker=null);const i=this.pendingRejects.get(t);i&&i(new Error("Compilation was cancelled")),this.pendingResolves.delete(t),this.pendingRejects.delete(t)};if(s){if(s.aborted)return a(),Promise.reject(new Error("Compilation was cancelled"));s.addEventListener("abort",a,{once:!0})}return l.postMessage({id:t,type:e,payload:r}),c}}export{u as TypstCompilerEngine};
//# sourceMappingURL=TypstCompilerEngine-pRJlCa9l.js.map
